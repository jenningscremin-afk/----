<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬ä¸€ç« ï¼šå‡½æ•°åŸºç¡€ (äº¤äº’å¼è¯¾ä»¶)</title>
    <script src="../common-assets/js/d3-7.8.5.min.js"></script>
    <!-- ä½¿ç”¨ç»Ÿä¸€çš„MathJaxé…ç½®æ–‡ä»¶ï¼Œé¿å…é…ç½®å†²çª -->
    <script src="../common-assets/js/mathjax-config.js"></script>
    <script type="text/javascript" id="MathJax-script" async
            src="../common-assets/js/mathjax-3.2.2-tex-svg.min.js">
    </script>

    <style>
        @import url('../common-assets/css/fonts.css');

        :root {
            --chalkboard-bg: transparent;
            --chalk-text: #ecf0f1;
            --visualization-bg: #fdfdfd00;
            --primary-color: #3498db;
            --accent-color: #e67e22;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --info-color: #9b59b6;
            --text-color: #34495e;
            --heading-font: 'Noto Serif SC', serif;
            --handwriting-font: 'Noto Serif SC', serif;
        }

        body {
            font-family: var(--heading-font);
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            overflow: auto;
            height: 100vh;
            width: 100vw;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
        }
        
        #presentation-container {
            width: 100vw;
            height: 100vh;
            max-width: 100vw;
            aspect-ratio: 16 / 9;
            position: relative;
            background: rgba(255, 255, 255, 0);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            overflow: auto;
        }

        .slide {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            visibility: hidden;
            display: flex;
            transition: opacity 0.6s ease-in-out;
        }

        .slide.active {
            opacity: 1;
            visibility: visible;
            z-index: 10;
        }

        /* iframeå®¹å™¨æ ·å¼ */
        .iframe-container {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .iframe-nav-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            pointer-events: none;
            background: transparent;
        }

        /* å…¨å±€æ§åˆ¶é¢æ¿æ ·å¼ */
        .global-control-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid rgba(0, 255, 255, 0.5);
            border-radius: 10px;
            padding: 15px;
            z-index: 1000;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }

        .control-title {
            color: #00ffff;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
            font-family: 'Orbitron', monospace;
        }

        .control-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }


        /* æ·»åŠ å¯¼èˆªæç¤º */
        .iframe-nav-hint {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 1002;
            pointer-events: none;
        }

        .chalkboard {
            flex: 0 0 35%;
            background-color: #2c3e50 !important;
            background-image: url('../common-assets/images/black-felt.png');
            border: 10px solid #8B4513;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5), inset 0 0 15px rgba(0,0,0,0.7);
            color: var(--chalk-text, #f0f0f0);
            padding: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow-y: auto;
            box-sizing: border-box;
        }

        .chalkboard h2 {
            font-family: var(--handwriting-font);
            font-size: 2.2rem;
            color: #f1c40f;
            border-bottom: 2px solid rgba(241, 196, 15, 0.5);
            padding-bottom: 2px;
            margin-bottom: 3px;
        }

        .chalkboard h3 {
            font-family: var(--handwriting-font);
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-top: 5px;
            margin-bottom: 5px;
        }

        .chalkboard p, .chalkboard li {
            font-size: 1.1rem;
            line-height: 1.7;
            margin-bottom: 15px;
        }
        
        .chalkboard ol {
            padding-left: 25px;
        }

        .chalkboard ul {
            list-style-type: 'â†’ ';
            padding-left: 20px;
        }

        .math-formula {
            font-size: 1.3rem;
            color: #1abc9c;
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            margin: 15px 0;
            line-height: 1.5;
        }

        .highlight {
            color: var(--warning-color);
            font-weight: bold;
        }

        .visualization {
            flex: 1;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: auto;
            position: relative;
            box-sizing: border-box;
        }

        .visualization.full-width {
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
        }
        
        .visualization.fullscreen {
            background: white;
            width: 100vw;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1000;
            padding: 0;
            margin: 0;
        }
        
        .visualization.white-bg {
            background: white;
        }


        /* é¡µç æŒ‡ç¤ºå™¨ */
        .page-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 100;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* è¿”å›é¢æ¿æ ·å¼ */
        .return-home-panel {
            position: fixed;
            top: 16px;
            left: 16px;
            display: flex;
            gap: 10px;
            z-index: 9999;
            flex-wrap: wrap;
        }
        
        .return-home-panel .return-link {
            padding: 8px 14px;
            border-radius: 999px;
            background: rgba(15, 23, 42, 0.8);
            color: #f8fafc;
            font-size: 14px;
            text-decoration: none;
            box-shadow: 0 6px 20px rgba(15, 23, 42, 0.25);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .return-home-panel .return-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(15, 23, 42, 0.35);
        }
        
        .return-home-panel .return-link.return-main {
            background: rgba(79, 70, 229, 0.85);
        }

        /* é¦–é¡µå¯¼èˆªæŒ‰é’®æ ·å¼ - ç®€åŒ–ç‰ˆ */
        .home-nav-buttons {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .home-nav-btn {
            display: flex;
            align-items: center;
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            text-decoration: none;
            color: rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
            backdrop-filter: blur(8px);
            font-size: 0.85rem;
            font-weight: 500;
        }

        .home-nav-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.4);
            color: white;
            transform: translateY(-1px);
        }

        .home-nav-btn .btn-icon {
            font-size: 0.8rem;
            margin-right: 6px;
            font-weight: bold;
        }

        .home-nav-btn .btn-text {
            font-size: 0.8rem;
        }

        /* ç¿»é¡µæŒ‰é’®æ ·å¼ - é€æ˜ç‰ˆ */
        .nav-buttons {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 1000;
        }

        .nav-btn {
            width: 36px;
            height: 36px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.3);
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            backdrop-filter: blur(8px);
        }

        .nav-btn:hover {
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-1px);
        }

        .nav-btn:disabled {
            background: rgba(0, 0, 0, 0.2);
            color: rgba(255, 255, 255, 0.3);
            cursor: not-allowed;
            transform: none;
        }

        /* é¡µé¢æŒ‡ç¤ºå™¨æ ·å¼ */
        .page-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 1000;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* å…¨å±€åŠ¨ç”»æ§åˆ¶é¢æ¿æ ·å¼ */
        .global-animation-controls {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }



        /* ç»Ÿä¸€æ§åˆ¶é¢æ¿æ ·å¼ */
        .unified-control-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
            font-family: var(--heading-font);
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        /* æµ®åŠ¨èœå•æ ·å¼ - ç®€åŒ–ç‰ˆ */
        #floating-menu {
            position: relative;
        }

        /* ç« èŠ‚ç›®å½•èœå•æ ·å¼ */
        #chapter-menu {
            position: relative;
        }

        .menu-toggle {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: rgba(255, 255, 255, 0.6);
            padding: 5px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            font-weight: normal;
            transition: all 0.2s ease;
            backdrop-filter: blur(5px);
            min-width: 32px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .menu-toggle:hover {
            background: rgba(0, 0, 0, 0.5);
            color: rgba(255, 255, 255, 1);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .menu-toggle:active {
            transform: scale(0.95);
        }

        .menu-toggle .menu-icon {
            font-size: 12px;
            font-weight: normal;
            transition: transform 0.3s ease;
        }

        .menu-toggle.active .menu-icon {
            transform: rotate(45deg);
        }

        .menu-content {
            position: absolute;
            bottom: 40px;
            right: 0;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 8px 0;
            backdrop-filter: blur(10px);
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            transition: all 0.3s ease;
            min-width: 160px;
            max-height: 300px;
            overflow-y: auto;
        }

        .menu-content.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
        .menu-content::-webkit-scrollbar {
            width: 6px;
        }

        .menu-content::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 3px;
        }

        .menu-content::-webkit-scrollbar-thumb {
            background: rgba(102, 126, 234, 0.5);
            border-radius: 3px;
        }

        .menu-content::-webkit-scrollbar-thumb:hover {
            background: rgba(102, 126, 234, 0.7);
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 6px 12px;
            text-decoration: none;
            color: rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
            border-radius: 4px;
            margin: 0 4px;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transform: translateX(2px);
        }

        .menu-item .menu-icon {
            font-size: 12px;
            margin-right: 8px;
            width: 16px;
            text-align: center;
        }

        .menu-item .menu-text {
            font-size: 13px;
            font-weight: 500;
        }

        /* äºŒçº§èœå•æ ·å¼ */
        .menu-section {
            margin-bottom: 8px;
        }

        .menu-section:last-child {
            margin-bottom: 0;
        }

        .menu-section-title {
            color: rgba(255, 255, 255, 0.6);
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 4px 12px;
            margin-bottom: 4px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .info-box-style {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            color: #333;
            font-size: 14px;
            line-height: 1.6;
            margin-top: 20px;
            border: 1px solid #eee;
        }
        .info-box-style .color-sine { color: var(--danger-color); }
        .info-box-style .color-cosine { color: var(--primary-color); }
        .info-box-style .color-tangent { color: var(--success-color); }

        .toc-local {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.2);
        }
        .toc-local h4 {
            font-size: 1rem;
            color: var(--warning-color);
            margin-bottom: 10px;
        }
        .toc-local a {
            display: block;
            color: var(--chalk-text);
            text-decoration: none;
            padding: 5px 0;
            font-size: 0.9rem;
            transition: color 0.2s;
        }
        .toc-local a:hover {
            color: var(--primary-color);
        }

        #back-to-top-btn {
            position: fixed;
            bottom: 80px;
            right: 30px;
            width: 40px;
            height: 40px;
            background: rgba(0,0,0,0.5);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s, transform 0.3s;
            z-index: 2000;
            backdrop-filter: blur(5px);
        }
        #back-to-top-btn.show {
            opacity: 1;
            visibility: visible;
        }
        #back-to-top-btn:hover {
            background: rgba(0,0,0,0.8);
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <div class="return-home-panel">
        <a class="return-link return-sub" href="index.html">â† è¿”å›è¯¾ä»¶ç›®å½•</a>
        <a class="return-link return-main" href="../index.html">âŒ‚ è¿”å›ä¸»ç«™</a>
    </div>

    <div id="presentation-container">
        
        <!-- å¹»ç¯ç‰‡0ï¼šæ ‡é¢˜é¡µ -->
        <div class="slide active">
            <div class="chalkboard" style="flex: 1; text-align: center;">
                <h2 style="font-size: 4rem; border: none;">ç¬¬ä¸€ç« </h2>
                <p style="font-size: 2.5rem; color: white;">ä»£æ•°ä¸å‡½æ•°</p>
                
                <div class="home-nav-buttons">
                    <a href="../index.html" class="home-nav-btn">
                        <span class="btn-icon">HOME</span>
                        <span class="btn-text">ä¸»é¡µ</span>
                    </a>
                    <a href="../æ•…äº‹ä¹¦/index.html" class="home-nav-btn">
                        <span class="btn-icon">STORY</span>
                        <span class="btn-text">æ•…äº‹ä¹¦</span>
                    </a>
                    <a href="../ä¹ é¢˜/index.html" class="home-nav-btn">
                        <span class="btn-icon">EXERCISE</span>
                        <span class="btn-text">ä¹ é¢˜</span>
                    </a>
                    <a href="../ç½‘é¡µèµ„æº/index.html" class="home-nav-btn">
                        <span class="btn-icon">RESOURCE</span>
                        <span class="btn-text">ç½‘é¡µèµ„æº</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- å¹»ç¯ç‰‡1ï¼šç›®å½•é¡µ -->
        <div class="slide">
            <div class="chalkboard" style="flex: 1; text-align: center; overflow-y: auto; align-items: flex-start; justify-content: flex-start;">
                <div style="writing-mode: vertical-rl; text-orientation: mixed; font-size: 3rem; border: none; margin-bottom: 1.5rem; height: 8rem; display: flex; align-items: flex-start; justify-content: center;">
                    ç›®å½•
                </div>
                
                <div style="width: 100%; max-width: 1200px; text-align: left; padding: 2rem; margin: 0 auto;">
                    <div style="background: rgba(255,255,255,0.1); padding: 1.2rem; border-radius: 10px; margin-bottom: 1.5rem;">
                        <h3 style="color: #e74c3c; font-size: 1.5rem; margin-bottom: 0.8rem; border-bottom: 2px solid #e74c3c; padding-bottom: 0.3rem;">ç¬¬ä¸€èŠ‚ï¼šé›†åˆä¸å‡½æ•°æ¦‚å¿µ</h3>
                        <p style="font-size: 1.1rem; line-height: 1.6;">â€¢ 1.1 é›†åˆä¸åŒºé—´</p>
                        <p style="font-size: 1.1rem; line-height: 1.6;">â€¢ 1.2 å‡½æ•°çš„æ¦‚å¿µ (å®šä¹‰ã€å®šä¹‰åŸŸã€å€¼åŸŸ)</p>
                    </div>

                    <div style="background: rgba(255,255,255,0.1); padding: 1.2rem; border-radius: 10px; margin-bottom: 1.5rem;">
                        <h3 style="color: #3498db; font-size: 1.5rem; margin-bottom: 0.8rem; border-bottom: 2px solid #3498db; padding-bottom: 0.3rem;">ç¬¬äºŒèŠ‚ï¼šåŸºæœ¬åˆç­‰å‡½æ•°</h3>
                        <p style="font-size: 1.1rem; line-height: 1.6;">â€¢ 2.1 å¹‚å‡½æ•° & æŒ‡æ•°è¿ç®—</p>
                        <p style="font-size: 1.1rem; line-height: 1.6;">â€¢ 2.2 æŒ‡æ•°å‡½æ•°</p>
                        <p style="font-size: 1.1rem; line-height: 1.6;">â€¢ 2.3 å¯¹æ•°å‡½æ•° & å¯¹æ•°è¿ç®—</p>
                        <p style="font-size: 1.1rem; line-height: 1.6;">â€¢ 2.4 ä¸‰è§’å‡½æ•°ä¸åä¸‰è§’å‡½æ•°</p>
                    </div>

                    <div style="background: rgba(255,255,255,0.1); padding: 1.2rem; border-radius: 10px; margin-bottom: 1.5rem;">
                        <h3 style="color: #2ecc71; font-size: 1.5rem; margin-bottom: 0.8rem; border-bottom: 2px solid #2ecc71; padding-bottom: 0.3rem;">ç¬¬ä¸‰èŠ‚ï¼šå‡½æ•°çš„åŸºæœ¬æ€§è´¨</h3>
                        <p style="font-size: 1.1rem; line-height: 1.6;">â€¢ 3.1 å•è°ƒæ€§ â€¢ 3.2 å¥‡å¶æ€§ â€¢ 3.3 å‘¨æœŸæ€§ â€¢ 3.4 æœ‰ç•Œæ€§</p>
                    </div>

                    <div style="background: rgba(255,255,255,0.1); padding: 1.2rem; border-radius: 10px;">
                        <h3 style="color: #f1c40f; font-size: 1.5rem; margin-bottom: 0.8rem; border-bottom: 2px solid #f1c40f; padding-bottom: 0.3rem;">ç¬¬å››èŠ‚ï¼šå‡½æ•°çš„è¿ç®—</h3>
                        <p style="font-size: 1.1rem; line-height: 1.6;">â€¢ 4.1 åå‡½æ•° â€¢ 4.2 å¤åˆå‡½æ•°</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- å¹»ç¯ç‰‡2ï¼šè§†é¢‘ä»‹ç»é¡µ -->
        <div class="slide">
            <div class="chalkboard" style="flex: 1; text-align: center; padding: 1rem; overflow: hidden; display: flex; flex-direction: column; justify-content: center;">
                <div style="position: relative; width: 100%; max-width: 400px; height: 0; padding-bottom: 28%; margin: 0 auto;">
                    <iframe 
                        src="https://player.bilibili.com/player.html?bvid=BV1ph4y1g75E&t=22.7&autoplay=0&high_quality=1" 
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);"
                        allowfullscreen>
                    </iframe>
                </div>
            </div>
        </div>

        <!-- ç¬¬ä¸€èŠ‚ï¼šé›†åˆä¸å‡½æ•°æ¦‚å¿µ -->
        
        <!-- å¹»ç¯ç‰‡3ï¼šé›†åˆä¸å¸¸é‡å˜é‡ -->
        <div class="slide">
            <div class="chalkboard">
                <h2>é›†åˆã€å¸¸é‡ä¸å˜é‡</h2>
                
                <h3>é›†åˆ</h3>
                <p>æŒ‡å…·æœ‰æŸç§<span class="highlight">ç‰¹å®šæ€§è´¨</span>çš„ã€ç¡®å®šçš„ã€å¯ä»¥åŒºåˆ†çš„äº‹ç‰©çš„<span class="highlight">å…¨ä½“</span>ã€‚</p>
                <p>ä¾‹å¦‚ï¼šæ‰€æœ‰æ­£æ•´æ•°çš„é›†åˆ {1, 2, 3, ...}</p>
                
                <h3>å¸¸é‡</h3>
                <p>åœ¨é—®é¢˜ç ”ç©¶è¿‡ç¨‹ä¸­ï¼Œ<span class="highlight">å–å€¼å§‹ç»ˆä¿æŒä¸å˜</span>çš„é‡ã€‚</p>
                <ul>
                    <li>ä¾‹å¦‚ï¼šåœ†å‘¨ç‡ $\pi \approx 3.14159$ï¼Œè‡ªç„¶å¸¸æ•° $e \approx 2.718$</li>
                    <li>åœ¨ $y=2x+1$ ä¸­ï¼Œæ•°å­— $2$ å’Œ $1$ éƒ½æ˜¯å¸¸é‡</li>
                </ul>
                
                <h3>å˜é‡</h3>
                <p>åœ¨ä¸€å®šèŒƒå›´å†…ï¼Œ<span class="highlight">å¯ä»¥å–ä¸åŒæ•°å€¼</span>çš„é‡ã€‚</p>
                <ul>
                    <li>ä¾‹å¦‚ï¼šæ—¶é—´ $t$ï¼Œæ¸©åº¦ $T$ï¼Œé€Ÿåº¦ $v$</li>
                    <li>åœ¨ $y=2x+1$ ä¸­ï¼Œ$x$ å’Œ $y$ éƒ½æ˜¯å˜é‡</li>
                </ul>
            </div>
            <div class="visualization" id="vis-variables"></div>
        </div>

        <!-- å¹»ç¯ç‰‡4ï¼šåŒºé—´è¡¨ç¤ºæ³• -->
        <div class="slide">
            <div class="chalkboard">
                <h2>åŒºé—´è¡¨ç¤ºæ³•</h2>
                
                <h3>é—­åŒºé—´ [a, b]</h3>
                <p>åŒ…æ‹¬ç«¯ç‚¹ $a$ å’Œ $b$ã€‚$a \le x \le b$</p>
                
                <h3>å¼€åŒºé—´ (a, b)</h3>
                <p>ä¸åŒ…æ‹¬ç«¯ç‚¹ $a$ å’Œ $b$ã€‚$a < x < b$</p>
                
                <h3>åŠå¼€åŠé—­åŒºé—´</h3>
                <p>$[a, b)$ï¼šåŒ…æ‹¬ $a$ï¼Œä¸åŒ…æ‹¬ $b$ã€‚$a \le x < b$</p>
                <p>$(a, b]$ï¼šä¸åŒ…æ‹¬ $a$ï¼ŒåŒ…æ‹¬ $b$ã€‚$a < x \le b$</p>
            </div>
            <div class="visualization" id="vis-intervals"></div>
        </div>

        <!-- å¹»ç¯ç‰‡5ï¼šå‡½æ•°å®šä¹‰ -->
        <div class="slide">
            <div class="chalkboard">
                <h2>å‡½æ•°</h2>
                <p>å‡½æ•°æ˜¯ä¸€ç§<span class="highlight">ç‰¹æ®Šçš„å¯¹åº”å…³ç³»</span>ï¼Œå°±åƒä¸€ä¸ª"åŠ å·¥æœºå™¨"ã€‚</p>
                <p>å¯¹äºæ¯ä¸€ä¸ªè¾“å…¥çš„æ•°å€¼ $x$ï¼ˆæ¥è‡ªä¸€ä¸ªæŒ‡å®šçš„é›†åˆ Aï¼‰ï¼Œè¿™å°æœºå™¨éƒ½èƒ½äº§å‡º<span class="highlight">å”¯ä¸€ç¡®å®š</span>çš„è¾“å‡ºæ•°å€¼ $y$ï¼ˆæ¥è‡ªé›†åˆ Bï¼‰ã€‚</p>
                <div class="math-formula">
                    $y = f(x)$
                </div>
                <ul>
                    <li>$x$ï¼šè‡ªå˜é‡ (Input)</li>
                    <li>$f$ï¼šå¯¹åº”æ³•åˆ™ (Rule / Machine)</li>
                    <li>$y$ï¼šå› å˜é‡ (Output)</li>
                </ul>
            </div>
            <div class="visualization" id="vis-function-machine"></div>
        </div>

        <!-- å¹»ç¯ç‰‡6ï¼šå®šä¹‰åŸŸ -->
        <div class="slide">
            <div class="chalkboard">
                <h3>å®šä¹‰åŸŸ</h3>
                <p>æ€è€ƒï¼šè¦è®©å‡½æ•°è¡¨è¾¾å¼æœ‰æ„ä¹‰ï¼Œ$x$ å¯ä»¥å–å“ªäº›å€¼ï¼Ÿ</p>
                <ul>
                    <li>åˆ†æ¯ä¸èƒ½ä¸ºé›¶</li>
                    <li>å¶æ¬¡æ ¹å·ä¸‹çš„æ•°å¿…é¡»å¤§äºç­‰äºé›¶</li>
                    <li>å¯¹æ•°çš„çœŸæ•°å¿…é¡»å¤§äºé›¶</li>
                </ul>
                <p>$f(x) = \frac{1}{x-2}$ï¼Œåˆ†æ¯ $x-2 \neq 0$ï¼Œæ‰€ä»¥å®šä¹‰åŸŸæ˜¯ $x \neq 2$</p>
                <p>$g(x) = \sqrt{x-3}$ï¼Œæ ¹å·ä¸‹ $x-3 \ge 0$ï¼Œæ‰€ä»¥å®šä¹‰åŸŸæ˜¯ $x \ge 3$</p>
            </div>
            <div class="visualization" id="vis-domain"></div>
        </div>

        <!-- å¹»ç¯ç‰‡7ï¼šå€¼åŸŸ -->
        <div class="slide">
            <div class="chalkboard">
                <h3>å€¼åŸŸ</h3>
                <p>å½“ $x$ å–éå®šä¹‰åŸŸä¸­çš„æ‰€æœ‰å€¼æ—¶ï¼Œå¯¹åº”çš„ $y$ å€¼ç»„æˆäº†å€¼åŸŸã€‚</p>
                <ul>
                    <li>è§‚å¯Ÿæ³•ï¼šå¯¹äºç®€å•å‡½æ•°ï¼Œç›´æ¥è§‚å¯Ÿå›¾åƒ</li>
                    <li>é…æ–¹æ³•ï¼šå¯¹äºäºŒæ¬¡å‡½æ•°</li>
                    <li>åå‡½æ•°æ³•ï¼šæ±‚åå‡½æ•°çš„å®šä¹‰åŸŸ</li>
                </ul>
                <p>$f(x) = x^2$ã€‚å› ä¸ºå¹³æ–¹æ°¸è¿œæ˜¯éè´Ÿæ•°ï¼Œæ‰€ä»¥å€¼åŸŸæ˜¯ $y \ge 0$</p>
                <p>$g(x) = \sin(x)$ã€‚æ­£å¼¦å‡½æ•°çš„å€¼åœ¨ -1 å’Œ 1 ä¹‹é—´æ³¢åŠ¨ï¼Œæ‰€ä»¥å€¼åŸŸæ˜¯ $[-1, 1]$</p>
            </div>
            <div class="visualization" id="vis-range"></div>
        </div>

        <!-- ç¬¬äºŒèŠ‚ï¼šåŸºæœ¬åˆç­‰å‡½æ•° -->
        
        <!-- å¹»ç¯ç‰‡8ï¼šåŸºæœ¬åˆç­‰å‡½æ•°ä»‹ç» -->
        <div class="slide">
            <div class="visualization full-width" id="vis-elementary-intro"></div>
        </div>

        <!-- å¹»ç¯ç‰‡9ï¼šå¹‚å‡½æ•°å¯è§†åŒ– -->
        <div class="slide">
            <div class="visualization fullscreen" id="vis-power-function"></div>
        </div>

        <!-- å¹»ç¯ç‰‡10ï¼šæŒ‡æ•°å®šä¹‰ -->
        <div class="slide">
            <div class="chalkboard">
                <h2>æŒ‡æ•°</h2>
                <h3>å®šä¹‰</h3>
                <p>æŒ‡æ•°è¡¨ç¤ºä¸€ä¸ªæ•°ï¼ˆåº•æ•°ï¼‰è¿ç»­ä¹˜ä»¥è‡ªèº«å¤šå°‘æ¬¡ã€‚</p>
                <div class="math-formula">
                    $a^n = \underbrace{a \times a \times \dots \times a}_{n \text{ ä¸ª}}$
                </div>
                <p>å…¶ä¸­ï¼Œ$a$ æ˜¯ <span class="highlight">åº•æ•°</span>ï¼Œ$n$ æ˜¯ <span class="highlight">æŒ‡æ•°</span>ã€‚</p>
                <h3>ä¾‹å­</h3>
                <p>$2^3 = 2 \times 2 \times 2 = 8$</p>
                <p>$10^4 = 10 \times 10 \times 10 \times 10 = 10000$</p>
            </div>
            <div class="visualization" id="vis-exponents"></div>
        </div>

        <!-- å¹»ç¯ç‰‡11ï¼šæŒ‡æ•°è¿ç®—æ³•åˆ™1 -->
        <div class="slide">
            <div class="chalkboard">
                <h3>ä¹˜æ³•æ³•åˆ™</h3>
                <div class="formula-rule">
                    $a^m \cdot a^n = a^{m+n}$
                </div>
                <p>åŒåº•æ•°å¹‚ç›¸ä¹˜ï¼Œ<span class="highlight">åº•æ•°ä¸å˜ï¼ŒæŒ‡æ•°ç›¸åŠ </span>ã€‚</p>
                <p>ä¾‹ï¼š$2^3 \cdot 2^4 = 2^{3+4} = 2^7 = 128$</p>
                
                <h3>é™¤æ³•æ³•åˆ™</h3>
                <div class="formula-rule">
                    $\frac{a^m}{a^n} = a^{m-n}$
                </div>
                <p>åŒåº•æ•°å¹‚ç›¸é™¤ï¼Œ<span class="highlight">åº•æ•°ä¸å˜ï¼ŒæŒ‡æ•°ç›¸å‡</span>ã€‚</p>
                <p>ä¾‹ï¼š$\frac{5^7}{5^3} = 5^{7-3} = 5^4 = 625$</p>
            </div>
            <div class="visualization" id="vis-exponent-rules-1"></div>
        </div>

        <!-- å¹»ç¯ç‰‡12ï¼šæŒ‡æ•°è¿ç®—æ³•åˆ™2 -->
        <div class="slide">
            <div class="chalkboard">
                <h3>å¹‚çš„å¹‚æ³•åˆ™</h3>
                <div class="formula-rule">
                    $(a^m)^n = a^{m \cdot n}$
                </div>
                <p>å¹‚çš„å¹‚ï¼Œ<span class="highlight">åº•æ•°ä¸å˜ï¼ŒæŒ‡æ•°ç›¸ä¹˜</span>ã€‚</p>
                <p>ä¾‹ï¼š$(3^2)^4 = 3^{2 \times 4} = 3^8$</p>
                
                <h3>ä¹˜ç§¯çš„å¹‚æ³•åˆ™</h3>
                <div class="formula-rule">
                    $(ab)^n = a^n \cdot b^n$
                </div>
                <p>ç§¯çš„å¹‚ç­‰äº<span class="highlight">å¹‚çš„ç§¯</span>ã€‚</p>
                <p>ä¾‹ï¼š$(2 \times 3)^4 = 2^4 \times 3^4 = 16 \times 81$</p>
            </div>
            <div class="visualization" id="vis-exponent-rules-2"></div>
        </div>

        <!-- å¹»ç¯ç‰‡13ï¼šé›¶æŒ‡æ•°ä¸è´ŸæŒ‡æ•° -->
        <div class="slide">
            <div class="chalkboard">
                <h3>é›¶æŒ‡æ•°</h3>
                <div class="formula-rule">
                    $a^0 = 1$ ï¼ˆ$a \neq 0$ï¼‰
                </div>
                <p>ä»»ä½•éé›¶æ•°çš„é›¶æ¬¡æ–¹éƒ½ç­‰äº <span class="highlight">1</span>ã€‚</p>
                <p>å¯ä»¥é€šè¿‡ $\frac{a^m}{a^m} = a^{m-m} = a^0$ æ¥ç†è§£ã€‚</p>
                
                <h3>è´ŸæŒ‡æ•°</h3>
                <div class="formula-rule">
                    $a^{-n} = \frac{1}{a^n}$
                </div>
                <p>è´ŸæŒ‡æ•°è¡¨ç¤º<span class="highlight">å€’æ•°</span>ã€‚</p>
                <p>å¯ä»¥ä» $\frac{a^0}{a^n} = a^{0-n} = a^{-n}$ æ¨å¯¼å‡ºæ¥ã€‚</p>
            </div>
            <div class="visualization" id="vis-special-exponents"></div>
        </div>

        <!-- å¹»ç¯ç‰‡14ï¼šåˆ†æ•°æŒ‡æ•° -->
        <div class="slide">
            <div class="chalkboard">
                <h3>åˆ†æ•°æŒ‡æ•°</h3>
                <p>åˆ†æ•°æŒ‡æ•°æ˜¯<span class="highlight">å¼€æ–¹è¿ç®—</span>çš„å¦ä¸€ç§å†™æ³•ã€‚</p>
                <div class="formula-rule">
                    $a^{\frac{1}{n}} = \sqrt[n]{a}$
                </div>
                <p>è¯»ä½œï¼š$a$ çš„ $n$ åˆ†ä¹‹ä¸€æ¬¡æ–¹ç­‰äº $a$ çš„ $n$ æ¬¡æ–¹æ ¹ã€‚</p>
                <p>â€¢ $27^{\frac{1}{3}} = \sqrt[3]{27} = 3$</p>
                <p>â€¢ $16^{\frac{1}{4}} = \sqrt[4]{16} = 2$</p>
                <p>â€¢ $8^{\frac{1}{3}} = \sqrt[3]{8} = 2$</p>
                <p>æŒ‡æ•° $\frac{1}{n}$ è¡¨ç¤ºï¼š<span class="highlight">"ä»€ä¹ˆæ•°çš„ $n$ æ¬¡æ–¹ç­‰äºåº•æ•°ï¼Ÿ"</span></p>
            </div>
            <div class="visualization" id="vis-fractional-exponents"></div>
        </div>

        <!-- å¹»ç¯ç‰‡15ï¼šæŒ‡æ•°å‡½æ•°å¯è§†åŒ– -->
        <div class="slide">
            <div class="visualization full-width white-bg" id="vis-interactive-exponential"></div>
        </div>

        <!-- å¹»ç¯ç‰‡16ï¼šå¯¹æ•°å‘å±•å†å² -->
        <div class="slide">
            <div class="visualization full-width" id="vis-log-history"></div>
        </div>

        <!-- å¹»ç¯ç‰‡17ï¼šå¯¹æ•°å®šä¹‰ -->
        <div class="slide">
            <div class="chalkboard">
                <h2>å¯¹æ•°</h2>
                <p>å¯¹æ•°æ˜¯<strong>æŒ‡æ•°</strong>çš„é€†è¿ç®—ã€‚</p>
                <p>å¦‚æœ $b^y = x$ï¼Œé‚£ä¹ˆ $\log_b(x) = y$</p>
                <ul>
                    <li>$b$ æ˜¯åº•æ•°</li>
                    <li>$x$ æ˜¯çœŸæ•°</li>
                    <li>$y$ å°±æ˜¯ä»¥$b$ä¸ºåº•$x$çš„å¯¹æ•°</li>
                </ul>
                <p>å¯¹æ•° $y$ å›ç­”äº†ä¸€ä¸ªé—®é¢˜ï¼š"åº•æ•° $b$ éœ€è¦è‡ªèº«ç›¸ä¹˜å¤šå°‘æ¬¡æ‰èƒ½å¾—åˆ° $x$ï¼Ÿ"</p>
                <p>å°†å¤æ‚çš„å¤§æ•°<strong>ä¹˜é™¤</strong>è¿ç®—ï¼Œè½¬åŒ–ä¸ºç®€å•çš„<strong>åŠ å‡</strong>è¿ç®—ã€‚</p>
            </div>
            <div class="visualization" id="vis-log-definition">
                <svg id="animation2" width="100%" height="100%"></svg>
            </div>
        </div>

        <!-- å¹»ç¯ç‰‡18ï¼šå¯¹æ•°å‡½æ•°å¯è§†åŒ– -->
        <div class="slide">
            <div class="visualization full-width white-bg" id="vis-interactive-logarithm"></div>
        </div>

        <!-- å¹»ç¯ç‰‡19ï¼šå¯¹æ•°è¿ç®—æ³•åˆ™ -->
        <div class="slide">
            <div class="chalkboard">
                <h3>ä¹˜ç§¯çš„å¯¹æ•°</h3>
                <p>$\log_b(xy) = \log_b(x) + \log_b(y)$</p>
                <p style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px;">
                    <strong>ä¾‹ï¼š</strong>$\log_2(8 \times 4) = \log_2(8) + \log_2(4) = 3 + 2 = 5$<br>
                    éªŒè¯ï¼š$2^5 = 32 = 8 \times 4$ âœ“
                </p>

                <h3>å•†çš„å¯¹æ•°</h3>
                <p>$\log_b(\frac{x}{y}) = \log_b(x) - \log_b(y)$</p>
                <p style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 5px;">
                    <strong>ä¾‹ï¼š</strong>$\log_2(\frac{16}{4}) = \log_2(16) - \log_2(4) = 4 - 2 = 2$<br>
                    éªŒè¯ï¼š$2^2 = 4 = \frac{16}{4}$ âœ“
                </p>

                <h3>å¹‚çš„å¯¹æ•°</h3>
                <p>$\log_b(x^n) = n \cdot \log_b(x)$</p>

                <h3>æ¢åº•å…¬å¼</h3>
                <p>$\log_b(x) = \frac{\log_a(x)}{\log_a(b)}$</p>
            </div>
            <div class="visualization" id="vis-log-properties"></div>
        </div>

        <!-- å¹»ç¯ç‰‡20ï¼šå¸¸ç”¨å¯¹æ•°ç³»ç»Ÿ -->
        <div class="slide">
            <div class="chalkboard">
                <h3>å¸¸ç”¨å¯¹æ•°ç³»ç»Ÿ</h3>
                <div style="margin: 20px 0;">
                    <h3 style="color: #e74c3c;">å¸¸ç”¨å¯¹æ•°ï¼ˆlgï¼‰</h3>
                    <p>ä»¥10ä¸ºåº•çš„å¯¹æ•°ï¼š$\lg(x) = \log_{10}(x)$</p>
                    <ul>
                        <li>$\lg(10) = 1$</li>
                        <li>$\lg(100) = 2$</li>
                        <li>$\lg(1000) = 3$</li>
                    </ul>
                </div>
                <div style="margin: 20px 0;">
                    <h3 style="color: #27ae60;">è‡ªç„¶å¯¹æ•°ï¼ˆlnï¼‰</h3>
                    <p>ä»¥$e$ä¸ºåº•çš„å¯¹æ•°ï¼š$\ln(x) = \log_e(x)$</p>
                    <p>å…¶ä¸­ $e \approx 2.718...$ï¼ˆæ¬§æ‹‰æ•°ï¼‰</p>
                    <ul>
                        <li>$\ln(e) = 1$</li>
                        <li>$\ln(e^2) = 2$</li>
                        <li>$\ln(1) = 0$</li>
                    </ul>
                </div>
            </div>
            <div class="visualization" id="vis-common-logs">
                <svg id="animation5" width="100%" height="100%"></svg>
            </div>
        </div>

        <!-- å¹»ç¯ç‰‡21ï¼šå¯¹æ•°è¿ç®—å¯è§†åŒ– -->
        <div class="slide">
            <div class="visualization full-width white-bg" id="vis-log-operations">
                <svg id="animation3" width="100vw" height="100vh"></svg>
            </div>
        </div>

        <!-- å¹»ç¯ç‰‡22ï¼šä¸‰è§’å‡½æ•°å¯è§†åŒ– (ä¼˜åŒ–ç‰ˆ) -->
        <div class="slide">
            <div class="chalkboard" style="flex: 0 0 30%; padding: 20px; overflow-y: auto;">
                <h2 id="trig-functions-anchor">ä¸‰è§’å‡½æ•°</h2>
                <h3>å•ä½åœ†å®šä¹‰</h3>
                <p>åœ¨å•ä½åœ†ä¸Šï¼Œä¸€ä¸ªè§’ \(\theta\) çš„ç»ˆè¾¹ä¸åœ†äº¤äºç‚¹ \(P(x, y)\)ï¼Œåˆ™ï¼š</p>
                <ul>
                    <li>\(\sin(\theta) = y\) (æ­£å¼¦)</li>
                    <li>\(\cos(\theta) = x\) (ä½™å¼¦)</li>
                    <li>\(\tan(\theta) = \frac{y}{x}\) (æ­£åˆ‡)</li>
                </ul>
                <div id="trig-info-box" class="info-box-style"></div>
                <div class="toc-local">
                    <h4>æœ¬èŠ‚å¯¼èˆª</h4>
                    <a href="javascript:void(0);" onclick="document.getElementById('vis-interactive-trig').scrollIntoView({behavior: 'smooth'});">ä¸‰è§’å‡½æ•°</a>
                    <a href="javascript:void(0);" onclick="document.getElementById('vis-interactive-inv-trig').scrollIntoView({behavior: 'smooth'});">åä¸‰è§’å‡½æ•°</a>
                </div>
            </div>
            <div class="visualization white-bg" style="flex: 1;" id="vis-interactive-trig"></div>
        </div>

        <!-- å¹»ç¯ç‰‡23ï¼šå…­ç§ä¸‰è§’ä¸ä½™å‡½æ•°å›¾åƒæ€»è§ˆ -->
        <div class="slide">
            <div class="visualization white-bg" style="flex: 1;" id="vis-trig-all"></div>
        </div>

        <!-- å¹»ç¯ç‰‡23ï¼šåä¸‰è§’å‡½æ•°å¯è§†åŒ– (ä¼˜åŒ–ç‰ˆ) -->
        <div class="slide">
            <div class="chalkboard" style="flex: 0 0 30%; padding: 20px; overflow-y: auto;">
                <h2 id="inv-trig-functions-anchor">åä¸‰è§’å‡½æ•°</h2>
                <h3>å®šä¹‰</h3>
                <p>ä¸ºäº†è®©ä¸‰è§’å‡½æ•°æœ‰åå‡½æ•°ï¼Œæˆ‘ä»¬å¿…é¡»é™åˆ¶å…¶å®šä¹‰åŸŸï¼Œä½¿å…¶æˆä¸ºä¸€ä¸€å¯¹åº”çš„å…³ç³»ã€‚</p>
                <ul>
                    <li>åæ­£å¼¦ (arcsin): å®šä¹‰åŸŸ \([-1, 1]\), å€¼åŸŸ \([-\frac{\pi}{2}, \frac{\pi}{2}]\)</li>
                    <li>åä½™å¼¦ (arccos): å®šä¹‰åŸŸ \([-1, 1]\), å€¼åŸŸ \([0, \pi]\)</li>
                </ul>
                <p>æ‹–åŠ¨å›¾ä¸­çš„æ»‘å—ï¼Œè§‚å¯Ÿ \(y=\sin(x)\) å¦‚ä½•é€šè¿‡é™åˆ¶å®šä¹‰åŸŸæ¥å¾—åˆ°å…¶åå‡½æ•° \(y=\arcsin(x)\)ã€‚</p>
                 <div class="toc-local">
                    <h4>æœ¬èŠ‚å¯¼èˆª</h4>
                    <a href="javascript:void(0);" onclick="document.getElementById('vis-interactive-trig').scrollIntoView({behavior: 'smooth'});">ä¸‰è§’å‡½æ•°</a>
                    <a href="javascript:void(0);" onclick="document.getElementById('vis-interactive-inv-trig').scrollIntoView({behavior: 'smooth'});">åä¸‰è§’å‡½æ•°</a>
                </div>
            </div>
            <div class="visualization white-bg" style="flex: 1;" id="vis-interactive-inv-trig"></div>
        </div>

        <!-- ç¬¬ä¸‰èŠ‚ï¼šå‡½æ•°çš„åŸºæœ¬æ€§è´¨ -->
        
        <!-- å¹»ç¯ç‰‡24ï¼šå‡½æ•°æ€§è´¨ä»‹ç» -->
        <div class="slide">
            <div class="chalkboard">
                <h3>å‡½æ•°çš„åŸºæœ¬æ€§è´¨</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                    <div>
                        <h4><span class="highlight">å•è°ƒæ€§</span></h4>
                        <p>æè¿°å‡½æ•°å›¾åƒæ˜¯"ä¸Šå¡"è¿˜æ˜¯"ä¸‹å¡"</p>
                    </div>
                    <div>
                        <h4><span class="highlight">å¥‡å¶æ€§</span></h4>
                        <p>æè¿°å‡½æ•°å›¾åƒçš„å¯¹ç§°æ€§</p>
                    </div>
                    <div>
                        <h4><span class="highlight">å‘¨æœŸæ€§</span></h4>
                        <p>æè¿°å‡½æ•°å›¾åƒçš„é‡å¤æ€§</p>
                    </div>
                    <div>
                        <h4><span class="highlight">æœ‰ç•Œæ€§</span></h4>
                        <p>æè¿°å‡½æ•°å€¼çš„èŒƒå›´é™åˆ¶</p>
                    </div>
                </div>
            </div>
            <div class="visualization" id="vis-properties-intro"></div>
        </div>

        <!-- å¹»ç¯ç‰‡25ï¼šå•è°ƒé€’å¢ -->
        <div class="slide">
            <div class="chalkboard">
                <h3>å•è°ƒé€’å¢</h3>
                <p>åœ¨ä¸€ä¸ªåŒºé—´å†…ï¼Œå¦‚æœå‡½æ•°å€¼ $y$ <span class="highlight">éšç€ $x$ çš„å¢å¤§è€Œå¢å¤§</span>ï¼Œé‚£ä¹ˆå‡½æ•°åœ¨è¯¥åŒºé—´ä¸Šæ˜¯å•è°ƒé€’å¢çš„ã€‚</p>
                <p>å‡ ä½•ä¸Šçœ‹ï¼Œå›¾åƒæ˜¯<span class="highlight">ä»å·¦åˆ°å³ä¸Šå‡çš„ï¼ˆä¸Šå¡ï¼‰</span>ã€‚</p>
                <div class="math-formula">
                    è‹¥ $x_1 < x_2$ï¼Œåˆ™ $f(x_1) < f(x_2)$
                </div>
            </div>
            <div class="visualization" id="vis-monotonicity-inc"></div>
        </div>

        <!-- å¹»ç¯ç‰‡26ï¼šå•è°ƒé€’å‡ -->
        <div class="slide">
            <div class="chalkboard">
                <h3>å•è°ƒé€’å‡</h3>
                <p>åœ¨ä¸€ä¸ªåŒºé—´å†…ï¼Œå¦‚æœå‡½æ•°å€¼ $y$ <span class="highlight">éšç€ $x$ çš„å¢å¤§è€Œå‡å°</span>ï¼Œé‚£ä¹ˆå‡½æ•°åœ¨è¯¥åŒºé—´ä¸Šæ˜¯å•è°ƒé€’å‡çš„ã€‚</p>
                <p>å‡ ä½•ä¸Šçœ‹ï¼Œå›¾åƒæ˜¯<span class="highlight">ä»å·¦åˆ°å³ä¸‹é™çš„ï¼ˆä¸‹å¡ï¼‰</span>ã€‚</p>
                <div class="math-formula">
                    è‹¥ $x_1 < x_2$ï¼Œåˆ™ $f(x_1) > f(x_2)$
                </div>
            </div>
            <div class="visualization" id="vis-monotonicity-dec"></div>
        </div>

        <!-- å¹»ç¯ç‰‡27ï¼šå•è°ƒåŒºé—´ -->
        <div class="slide">
            <div class="chalkboard">
                <h3>å•è°ƒåŒºé—´</h3>
                <p>å‡½æ•°çš„å•è°ƒæ€§åœ¨ä¸åŒåŒºé—´å¯èƒ½å‘ˆç°ä¸åŒç‰¹å¾ã€‚</p>
                <p>åˆ†æå‡½æ•°æ€§è´¨æ—¶ï¼Œéœ€è¦æ˜ç¡®åˆ’åˆ†å…¶å•è°ƒé€’å¢å’Œå•è°ƒé€’å‡çš„åŒºé—´èŒƒå›´ã€‚</p>
                <p>$f(x) = x^2$</p>
                <ul>
                    <li>åœ¨åŒºé—´ $(-\infty, 0]$ ä¸Šï¼Œå‡½æ•°<span class="highlight">å•è°ƒé€’å‡</span>ã€‚</li>
                    <li>åœ¨åŒºé—´ $[0, +\infty)$ ä¸Šï¼Œå‡½æ•°<span class="highlight">å•è°ƒé€’å¢</span>ã€‚</li>
                </ul>
                <p>ç‚¹ $x=0$ æ˜¯å®ƒçš„"è½¬æŠ˜ç‚¹"ã€‚</p>
            </div>
            <div class="visualization" id="vis-monotonicity-intervals"></div>
        </div>

        <!-- å¹»ç¯ç‰‡28ï¼šå¥‡å¶æ€§ä»‹ç» -->
        <div class="slide">
            <div class="chalkboard">
                <h3>å¥‡å¶æ€§</h3>
                <p>å¥‡å¶æ€§æè¿°çš„æ˜¯å‡½æ•°å›¾åƒå…³äº<span class="highlight">åæ ‡è½´æˆ–åŸç‚¹</span>çš„å¯¹ç§°æ€§ã€‚</p>
                <p>åˆ¤æ–­å¥‡å¶æ€§çš„å‰ææ˜¯ï¼šå‡½æ•°çš„<span class="highlight">å®šä¹‰åŸŸå¿…é¡»å…³äºåŸç‚¹å¯¹ç§°</span>ã€‚</p>
                <ul>
                    <li><strong>å¶å‡½æ•°</strong>ï¼šå›¾åƒå…³äº Y è½´å¯¹ç§°</li>
                    <li><strong>å¥‡å‡½æ•°</strong>ï¼šå›¾åƒå…³äºåŸç‚¹å¯¹ç§°</li>
                </ul>
            </div>
            <div class="visualization" id="vis-parity-intro"></div>
        </div>

        <!-- å¹»ç¯ç‰‡29ï¼šå¶å‡½æ•° -->
        <div class="slide">
            <div class="chalkboard">
                <h3>å¶å‡½æ•°</h3>
                <p>å¦‚æœå¯¹äºå®šä¹‰åŸŸå†…çš„ä»»æ„ $x$ï¼Œéƒ½æ»¡è¶³ï¼š</p>
                <div class="math-formula">
                    $f(-x) = f(x)$
                </div>
                <p>é‚£ä¹ˆ $f(x)$ å°±æ˜¯ä¸€ä¸ªå¶å‡½æ•°ã€‚</p>
                <p>å‡½æ•°å›¾åƒå…³äº <span class="highlight">Y è½´å¯¹ç§°</span>ã€‚å°±åƒé•œå­ä¸€æ ·ã€‚</p>
                <p>ä¾‹ï¼š$f(x) = x^2$, $f(x) = |x|$, $f(x) = \cos(x)$</p>
            </div>
            <div class="visualization" id="vis-even-function"></div>
        </div>

        <!-- å¹»ç¯ç‰‡30ï¼šå¥‡å‡½æ•° -->
        <div class="slide">
            <div class="chalkboard">
                <h3>å¥‡å‡½æ•°</h3>
                <p>å¦‚æœå¯¹äºå®šä¹‰åŸŸå†…çš„ä»»æ„ $x$ï¼Œéƒ½æ»¡è¶³ï¼š</p>
                <div class="math-formula">
                    $f(-x) = -f(x)$
                </div>
                <p>é‚£ä¹ˆ $f(x)$ å°±æ˜¯ä¸€ä¸ªå¥‡å‡½æ•°ã€‚</p>
                <p>å‡½æ•°å›¾åƒå…³äº <span class="highlight">åŸç‚¹ (0,0) å¯¹ç§°</span>ã€‚å›¾åƒæ—‹è½¬180åº¦åä¼šä¸åŸå›¾é‡åˆã€‚</p>
                <p>ä¾‹ï¼š$f(x) = x$, $f(x) = x^3$, $f(x) = \sin(x)$</p>
            </div>
            <div class="visualization" id="vis-odd-function"></div>
        </div>

        <!-- å¹»ç¯ç‰‡31ï¼šæœ‰ç•Œæ€§ -->
        <div class="slide">
            <div class="chalkboard">
                <h3>æœ‰ç•Œæ€§</h3>
                <p>å¦‚æœå­˜åœ¨ä¸€ä¸ªæ­£æ•° Mï¼Œä½¿å¾—å‡½æ•° f(x) åœ¨å…¶æ•´ä¸ªå®šä¹‰åŸŸä¸Šï¼Œæ’æœ‰ <span class="highlight">|f(x)| â‰¤ M</span> æˆç«‹ï¼Œé‚£ä¹ˆå°±ç§° f(x) ä¸ºæœ‰ç•Œå‡½æ•°ã€‚</p>
                <p>é€šä¿—åœ°è¯´ï¼Œå‡½æ•°çš„å›¾åƒè¢«ä¸¤æ¡æ°´å¹³çº¿"å¤¹ä½"äº†ï¼Œæ—¢ä¸ä¼šè·‘åˆ°"å¤©ä¸Šå»"ï¼Œä¹Ÿä¸ä¼šæ‰åˆ°"æ— åº•æ´"ã€‚</p>
                <p>ä¾‹å¦‚ï¼š</p>
                <ul>
                    <li>$y = \sin(x)$ å’Œ $y = \cos(x)$ éƒ½æ˜¯æœ‰ç•Œå‡½æ•°ï¼Œå› ä¸ºå®ƒä»¬çš„å€¼åŸŸéƒ½åœ¨ $[-1, 1]$ ä¹‹é—´</li>
                    <li>$y = x^2$ åœ¨ $(-\infty, +\infty)$ ä¸Šæ— ç•Œï¼Œä½†åœ¨ä»»ä½•æœ‰é™åŒºé—´ $[a, b]$ ä¸Šæœ‰ç•Œ</li>
                </ul>
            </div>
            <div class="visualization" id="vis-boundedness"></div>
        </div>

        <!-- ç¬¬å››èŠ‚ï¼šå‡½æ•°çš„è¿ç®— -->
        
        <!-- å¹»ç¯ç‰‡32ï¼šåå‡½æ•°å®šä¹‰ -->
        <div class="slide">
            <div class="chalkboard">
                <h3>åå‡½æ•°</h3>
                <p>å¦‚æœå‡½æ•° $f$ æŠŠ $x$ å˜æˆäº† $y$ï¼Œé‚£ä¹ˆå®ƒçš„åå‡½æ•° $f^{-1}$ å°±æ˜¯æŠŠ $y$ <span class="highlight">å˜å›</span> $x$ çš„æ“ä½œã€‚</p>
                <div class="math-formula">
                    è‹¥ $y = f(x)$ï¼Œåˆ™ $x = f^{-1}(y)$
                </div>
                <p><span class="highlight">æ³¨æ„</span>ï¼šåªæœ‰å•è°ƒå‡½æ•°ï¼ˆä¸¥æ ¼ä¸€å¯¹ä¸€çš„å‡½æ•°ï¼‰æ‰æœ‰åå‡½æ•°ã€‚</p>
            </div>
            <div class="visualization" id="vis-inverse-machine"></div>
        </div>

        <!-- å¹»ç¯ç‰‡33ï¼šåå‡½æ•°å›¾åƒ -->
        <div class="slide">
            <div class="chalkboard">
                <h3>åå‡½æ•°ä¸åŸå‡½æ•°</h3>
                <ul>
                    <li>åŸå‡½æ•° $f(x)$ çš„<span class="highlight">å®šä¹‰åŸŸ</span>æ˜¯åå‡½æ•° $f^{-1}(x)$ çš„<span class="highlight">å€¼åŸŸ</span>ã€‚</li>
                    <li>åŸå‡½æ•° $f(x)$ çš„<span class="highlight">å€¼åŸŸ</span>æ˜¯åå‡½æ•° $f^{-1}(x)$ çš„<span class="highlight">å®šä¹‰åŸŸ</span>ã€‚</li>
                </ul>
                <p>å‡½æ•° $y=f(x)$ å’Œå®ƒçš„åå‡½æ•° $y=f^{-1}(x)$ çš„å›¾åƒå…³äºç›´çº¿ <span class="highlight">$y=x$ å¯¹ç§°</span>ã€‚</p>
            </div>
            <div class="visualization" id="vis-inverse-graph"></div>
        </div>

        <!-- å¹»ç¯ç‰‡34ï¼šæŒ‡å¯¹æ•°äº’ä¸ºåå‡½æ•°å¯è§†åŒ– -->
        <div class="slide">
            <div class="visualization full-width white-bg" id="vis-interactive-inverse-exp-log"></div>
        </div>

        <!-- å¹»ç¯ç‰‡35ï¼šå¤åˆå‡½æ•° -->
        <div class="slide">
            <div class="chalkboard">
                <h3>å¤åˆå‡½æ•°</h3>
                <p>å¦‚æœ $u=g(x)$ï¼Œè€Œ $y=f(u)$ï¼Œé‚£ä¹ˆ $y=f(g(x))$ å°±æ˜¯ä¸€ä¸ªå¤åˆå‡½æ•°ã€‚</p>
                <ul>
                    <li>$g(x)$ æ˜¯<span class="highlight">å†…å±‚å‡½æ•°</span>ã€‚</li>
                    <li>$f(u)$ æ˜¯<span class="highlight">å¤–å±‚å‡½æ•°</span>ã€‚</li>
                </ul>
                <p>è®¡ç®—æ—¶ï¼Œè¦<span class="highlight">ç”±å†…å‘å¤–</span>ï¼Œå±‚å±‚è®¡ç®—ã€‚</p>
                <p>1. å…ˆç®—å†…å±‚å‡½æ•°ï¼š$u = g(x)$</p>
                <p>2. å†æŠŠç»“æœ $u$ ä»£å…¥å¤–å±‚å‡½æ•°ï¼š$y = f(u)$</p>
            </div>
            <div class="visualization" id="vis-composite-machine"></div>
        </div>

        <!-- ç¿»é¡µæŒ‰é’® -->
        <div class="nav-buttons">
            <button class="nav-btn" id="prev-btn" onclick="previousSlide()" title="ä¸Šä¸€é¡µ (â†)">â€¹</button>
            <button class="nav-btn" id="next-btn" onclick="nextSlide()" title="ä¸‹ä¸€é¡µ (â†’)">â€º</button>
        </div>

        <div class="page-indicator" id="page-indicator">1 / 37</div>
</div>


 

<!-- ç»Ÿä¸€æ§åˆ¶é¢æ¿ -->
<div class="unified-control-panel">
<!-- æµ®åŠ¨èœå•æŒ‰é’® -->
<div id="floating-menu">
    <div id="menu-toggle" class="menu-toggle">
        <span class="menu-icon">â˜°</span>
    </div>
    <div id="menu-content" class="menu-content">
        <div class="menu-section">
            <div class="menu-section-title">å®éªŒå®¤</div>
        <a href="../ç½‘é¡µèµ„æº/lab 1-1.html" target="_blank" class="menu-item">
                <span class="menu-icon">ğŸ“Š</span>
            <span class="menu-text">æŒ‡æ•°è¿ç®—å®éªŒå®¤</span>
        </a>
        <a href="../ç½‘é¡µèµ„æº/lab 1-2.html" target="_blank" class="menu-item">
                <span class="menu-icon">ğŸ“ˆ</span>
            <span class="menu-text">å¯¹æ•°è¿ç®—å®éªŒå®¤</span>
        </a>
        <a href="../ç½‘é¡µèµ„æº/lab 1-3.html" target="_blank" class="menu-item">
                <span class="menu-icon">ğŸŒŠ</span>
                <span class="menu-text">ä¸‰è§’å‡½æ•°å®éªŒå®¤</span>
        </a>
        <a href="../ç½‘é¡µèµ„æº/lab 1-4.html" target="_blank" class="menu-item">
                <span class="menu-icon">ğŸ”„</span>
                <span class="menu-text">åä¸‰è§’å‡½æ•°å®éªŒå®¤</span>
            </a>
        </div>
        <div class="menu-section">
            <div class="menu-section-title">å…¶ä»–èµ„æº</div>
            <a href="../æ•…äº‹ä¹¦/index.html" target="_blank" class="menu-item">
                <span class="menu-icon">ğŸ“š</span>
                <span class="menu-text">æ•…äº‹ä¹¦</span>
            </a>
            <a href="../ä¹ é¢˜/index.html" target="_blank" class="menu-item">
                <span class="menu-icon">ğŸ“</span>
                <span class="menu-text">ä¹ é¢˜</span>
            </a>
        </div>
    </div>
</div>

<!-- ç« èŠ‚ç›®å½•èœå• -->
<div id="chapter-menu">
    <div id="chapter-toggle" class="menu-toggle">
        <span class="menu-icon">ğŸ“š</span>
    </div>
    <div id="chapter-content" class="menu-content">
        <div class="menu-section">
            <div class="menu-section-title">åŸºç¡€æ¦‚å¿µ</div>
        <a href="#" class="menu-item" onclick="goToSlide(0); toggleChapterMenu();">
            <span class="menu-icon">ğŸ </span>
            <span class="menu-text">æ ‡é¢˜é¡µ</span>
        </a>
        <a href="#" class="menu-item" onclick="goToSlide(1); toggleChapterMenu();">
            <span class="menu-icon">ğŸ“‹</span>
            <span class="menu-text">ç›®å½•</span>
        </a>
        <a href="#" class="menu-item" onclick="goToSlide(3); toggleChapterMenu();">
            <span class="menu-icon">1</span>
            <span class="menu-text">é›†åˆã€å¸¸é‡ä¸å˜é‡</span>
        </a>
        <a href="#" class="menu-item" onclick="goToSlide(4); toggleChapterMenu();">
            <span class="menu-icon">2</span>
            <span class="menu-text">åŒºé—´è¡¨ç¤ºæ³•</span>
        </a>
        <a href="#" class="menu-item" onclick="goToSlide(5); toggleChapterMenu();">
            <span class="menu-icon">3</span>
            <span class="menu-text">å‡½æ•°åŸºç¡€</span>
        </a>
        <a href="#" class="menu-item" onclick="goToSlide(6); toggleChapterMenu();">
            <span class="menu-icon">4</span>
            <span class="menu-text">å®šä¹‰åŸŸä¸å€¼åŸŸ</span>
        </a>
        </div>
        <div class="menu-section">
            <div class="menu-section-title">å‡½æ•°ç±»å‹</div>
        <a href="#" class="menu-item" onclick="goToSlide(10); toggleChapterMenu();">
            <span class="menu-icon">5</span>
            <span class="menu-text">æŒ‡æ•°è¿ç®—</span>
        </a>
        <a href="#" class="menu-item" onclick="goToSlide(16); toggleChapterMenu();">
            <span class="menu-icon">6</span>
            <span class="menu-text">å¯¹æ•°è¿ç®—</span>
        </a>
        <a href="#" class="menu-item" onclick="goToSlide(24); toggleChapterMenu();">
            <span class="menu-icon">7</span>
            <span class="menu-text">å‡½æ•°æ€§è´¨</span>
        </a>
        <a href="#" class="menu-item" onclick="goToSlide(32); toggleChapterMenu();">
            <span class="menu-icon">8</span>
            <span class="menu-text">åå‡½æ•°</span>
        </a>
        <a href="#" class="menu-item" onclick="goToSlide(35); toggleChapterMenu();">
            <span class="menu-icon">9</span>
            <span class="menu-text">å¤åˆå‡½æ•°</span>
        </a>
        </div>
    </div>
    </div>
</div>

<script>
        // === åŸºç¡€å¯¼èˆªåŠŸèƒ½ ===
        let slides, totalSlides, counter, currentSlide = 0;
        let currentAnimation;

        // å…¨å±€åŠ¨ç”»æ§åˆ¶å˜é‡
        let globalAnimationPlaying = true;
        let globalAnimationSpeed = 1.0;
        let currentAnimationFunction = null;

        const animationState = {
            isPaused: false,
            speed: 1,
            resumeCallback: null,
        };

        function stopCurrentAnimation() {
            if (currentAnimation && typeof currentAnimation.interrupt === 'function') {
                currentAnimation.interrupt();
            }
            currentAnimation = null;
        }

        function applyCurrentAnimation(handlers) {
            if (!handlers || typeof handlers !== 'object') {
                currentAnimation = null;
                return;
            }

            currentAnimation = {
                pause: typeof handlers.pause === 'function' ? handlers.pause : () => {},
                resume: typeof handlers.resume === 'function' ? handlers.resume : () => {},
                setSpeed: typeof handlers.setSpeed === 'function' ? handlers.setSpeed : () => {},
                interrupt: typeof handlers.interrupt === 'function' ? handlers.interrupt : () => {},
            };

            currentAnimation.setSpeed(animationState.speed);

            if (animationState.isPaused) {
                currentAnimation.pause();
            }
        }

        function nextSlide() {
            if (!slides || totalSlides === 0) return;
            currentSlide = (currentSlide + 1) % totalSlides;
            showSlide(currentSlide);
        }

        function previousSlide() {
            if (!slides || totalSlides === 0) return;
            currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
            showSlide(currentSlide);
        }

        function showSlide(index) {
            if (!slides || index < 0 || index >= totalSlides) return;
            
            slides.forEach(slide => slide.classList.remove('active'));
            currentSlide = index;
            slides[currentSlide].classList.add('active');
            
            counter.textContent = `${currentSlide + 1} / ${totalSlides}`;
            updateNavButtons();
            
            
            // è¿è¡Œå½“å‰å¹»ç¯ç‰‡çš„å¯è§†åŒ–
            runVisualization(currentSlide);
            
            // æ¸²æŸ“æ•°å­¦å…¬å¼
            setTimeout(() => renderMathJax(slides[currentSlide]), 50);
        }

        function updateNavButtons() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            
            if (prevBtn && nextBtn) {
                prevBtn.disabled = (currentSlide === 0);
                nextBtn.disabled = (currentSlide === totalSlides - 1);
            }
        }



        

        // æ§åˆ¶é¡µé¢å†…çš„åŠ¨ç”»
        function controlPageAnimations() {
            // è¿™é‡Œå¯ä»¥æ·»åŠ æ§åˆ¶é¡µé¢å†…åŠ¨ç”»çš„é€»è¾‘
            // ä¾‹å¦‚æ§åˆ¶D3åŠ¨ç”»ã€CSSåŠ¨ç”»ç­‰
        }

        // é‡ç½®é¡µé¢å†…çš„åŠ¨ç”»
        function resetPageAnimations() {
            // è¿™é‡Œå¯ä»¥æ·»åŠ é‡ç½®é¡µé¢å†…åŠ¨ç”»çš„é€»è¾‘
        }

        // åˆå§‹åŒ–æ‚¬æµ®èœå•
        function initFloatingMenus() {
            // æµ®åŠ¨èœå•åŠŸèƒ½
            const menuToggle = document.getElementById('menu-toggle');
            const menuContent = document.getElementById('menu-content');
            
            if (menuToggle && menuContent) {
                menuToggle.addEventListener('click', function(e) {
                    e.stopPropagation();
                    menuToggle.classList.toggle('active');
                    menuContent.classList.toggle('active');
                });
                
                // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­èœå•
                document.addEventListener('click', function(e) {
                    if (!menuToggle.contains(e.target) && !menuContent.contains(e.target)) {
                        menuToggle.classList.remove('active');
                        menuContent.classList.remove('active');
                    }
                });
                
                // é˜²æ­¢èœå•å†…å®¹ç‚¹å‡»æ—¶å…³é—­èœå•
                menuContent.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            }

            // ç« èŠ‚ç›®å½•èœå•åŠŸèƒ½
            const chapterToggle = document.getElementById('chapter-toggle');
            const chapterContent = document.getElementById('chapter-content');
            
            if (chapterToggle && chapterContent) {
                chapterToggle.addEventListener('click', function(e) {
                    e.stopPropagation();
                    chapterToggle.classList.toggle('active');
                    chapterContent.classList.toggle('active');
                });
                
                // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­èœå•
                document.addEventListener('click', function(e) {
                    if (!chapterToggle.contains(e.target) && !chapterContent.contains(e.target)) {
                        chapterToggle.classList.remove('active');
                        chapterContent.classList.remove('active');
                    }
                });
                
                // é˜²æ­¢èœå•å†…å®¹ç‚¹å‡»æ—¶å…³é—­èœå•
                chapterContent.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            }
        }

        // ç« èŠ‚ç›®å½•èœå•åˆ‡æ¢å‡½æ•°
        function toggleChapterMenu() {
            const chapterToggle = document.getElementById('chapter-toggle');
            const chapterContent = document.getElementById('chapter-content');
            
            if (chapterToggle && chapterContent) {
                chapterToggle.classList.toggle('active');
                chapterContent.classList.toggle('active');
            }
        }

        // è·³è½¬åˆ°æŒ‡å®šå¹»ç¯ç‰‡
        function goToSlide(index) {
            if (index >= 0 && index < totalSlides) {
                showSlide(index);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            slides = document.querySelectorAll('.slide');
            totalSlides = slides.length;
            counter = document.getElementById('page-indicator');
            
            
            
            
            // åˆå§‹åŒ–æ‚¬æµ®èœå•
            initFloatingMenus();
            
            showSlide(0);
            
            // é”®ç›˜å¯¼èˆª
            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowRight' || e.key === 'ArrowDown' || e.key === ' ' ||
                    e.key === 'PageDown' || e.key === 'Enter') {
                    e.preventDefault();
                    nextSlide();
                }
                else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp' ||
                         e.key === 'PageUp' || e.key === 'Backspace') {
                    e.preventDefault();
                    previousSlide();
                }
                else if (e.key === 'Home') {
                    e.preventDefault();
                    showSlide(0);
                }
                else if (e.key === 'End') {
                    e.preventDefault();
                    showSlide(totalSlides - 1);
                }
            });
            
            // é¼ æ ‡æ»šè½®å¯¼èˆªï¼ˆå¾ªç¯ç¿»é¡µï¼‰
            document.addEventListener('wheel', (e) => {
                let target = e.target;
                // è‹¥åœ¨å¯æ»šåŠ¨å®¹å™¨å†…ï¼Œå…è®¸é»˜è®¤æ»šåŠ¨
                while (target && target !== document.body) {
                    if (target.scrollHeight > target.clientHeight) {
                        return;
                    }
                    target = target.parentElement;
                }

                e.preventDefault();
                if (e.deltaY > 0) {
                    // ä¸‹æ»šï¼šåˆ°æœ«é¡µåå›åˆ°é¦–é¡µ
                    currentSlide = (currentSlide + 1) % totalSlides;
                    showSlide(currentSlide);
                } else {
                    // ä¸Šæ»šï¼šåˆ°é¦–é¡µå‰ä¸€é¡µè·³åˆ°æœ«é¡µ
                    currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
                    showSlide(currentSlide);
                }
            }, { passive: false });
        });

        // === MathJax æ¸²æŸ“å‡½æ•° ===
        const renderMathJax = async (container) => {
            if (window.MathJax && window.MathJax.typesetPromise) {
                try {
                    await window.MathJax.typesetPromise([container]);
                } catch (error) {
                    console.warn('MathJax rendering failed:', error);
                }
            }
        };

        const renderMathJaxInContainer = async (containerId) => {
            if (window.MathJax && window.MathJax.typesetPromise) {
                try {
                    const container = document.getElementById(containerId);
                    if (container) {
                        await window.MathJax.typesetPromise([container]);
                    }
                } catch (error) {
                    console.warn('MathJax container rendering failed:', error);
                }
            }
        };

        // === D3.js è¾…åŠ©å‡½æ•° ===
        function setupD3(containerId, margins = {top: 40, right: 40, bottom: 40, left: 40}) {
            const container = d3.select(`#${containerId}`);
            if (container.empty()) {
                console.error("Container not found:", containerId);
                return null;
            }
            container.html('');

            const bounds = container.node().getBoundingClientRect();
            if (bounds.width === 0 || bounds.height === 0) return null;

            const svg = container.append('svg')
                .attr('width', bounds.width)
                .attr('height', bounds.height);

            const width = bounds.width - margins.left - margins.right;
            const height = bounds.height - margins.top - margins.bottom;

            const g = svg.append('g')
                .attr('transform', `translate(${margins.left}, ${margins.top})`);

            return { container, svg, g, width, height };
        }

        function drawAxes(g, xScale, yScale, width, height) {
            g.append('g')
                .attr('transform', `translate(0, ${yScale(0)})`)
                .call(d3.axisBottom(xScale).ticks(10))
                .call(g => g.select(".domain").attr("stroke-width", 1.5).attr("stroke", "#333"))
                .call(g => g.selectAll(".tick line").remove());

            g.append('g')
                .attr('transform', `translate(${xScale(0)}, 0)`)
                .call(d3.axisLeft(yScale).ticks(10))
                .call(g => g.select(".domain").attr("stroke-width", 1.5).attr("stroke", "#333"))
                .call(g => g.selectAll(".tick line").remove());
        }

        function animatePath(path) {
            if (!path.node()) return;
            const totalLength = path.node().getTotalLength();
            path.attr("stroke-dasharray", totalLength + " " + totalLength)
                .attr("stroke-dashoffset", totalLength)
                .transition()
                .duration(2000)
                .ease(d3.easeLinear)
                .attr("stroke-dashoffset", 0);
        }

        // === å¯è§†åŒ–å‡½æ•° ===
        
        // å¹»ç¯ç‰‡3ï¼šå¸¸é‡ä¸å˜é‡å¯è§†åŒ–
        function visualizeVariables(containerId) {
            const setup = setupD3(containerId);
            if (!setup) return;
            const { g, width, height } = setup;

            // å¸¸é‡ç¤ºä¾‹ï¼ˆÏ€ï¼‰
            g.append("circle")
                .attr("cx", width * 0.25)
                .attr("cy", height * 0.5)
                .attr("r", 10)
                .attr("fill", "var(--danger-color)");
            
            g.append("text")
                .attr("x", width * 0.25)
                .attr("y", height * 0.5 + 40)
                .text("å¸¸é‡ Ï€")
                .attr("text-anchor", "middle")
                .attr("font-size", "1.2em");

            // å˜é‡ç¤ºä¾‹ï¼ˆåŠ¨æ€ç§»åŠ¨çš„ç‚¹ï¼‰
            g.append("line")
                .attr("x1", width * 0.6)
                .attr("y1", height * 0.5)
                .attr("x2", width * 0.9)
                .attr("y2", height * 0.5)
                .attr("stroke", "#ccc")
                .attr("stroke-width", 2);
            
            const variablePoint = g.append("circle")
                .attr("cy", height * 0.5)
                .attr("r", 10)
                .attr("fill", "var(--primary-color)");
            
            g.append("text")
                .attr("x", width * 0.75)
                .attr("y", height * 0.5 + 40)
                .text("å˜é‡ x")
                .attr("text-anchor", "middle")
                .attr("font-size", "1.2em");

            const leftX = width * 0.6;
            const rightX = width * 0.9;
            let movingRight = true;
            let currentTransition = null;
            let isAnimating = false;
            let paused = animationState.isPaused;
            let speed = animationState.speed || 1;
            let active = true;

            function cancelTransition() {
                if (currentTransition) {
                    variablePoint.interrupt();
                    currentTransition = null;
                }
                isAnimating = false;
            }

            function runTransition() {
                if (!active || paused || isAnimating) return;
                isAnimating = true;
                const targetX = movingRight ? rightX : leftX;
                currentTransition = variablePoint.transition()
                    .duration(2000 / speed)
                    .attr("cx", targetX)
                    .on("end", () => {
                        if (!active) return;
                        currentTransition = null;
                        isAnimating = false;
                        movingRight = !movingRight;
                        runTransition();
                    });
            }

            runTransition();

            return {
                pause() {
                    if (paused) return;
                    paused = true;
                    cancelTransition();
                },
                resume() {
                    if (!active || !paused) return;
                    paused = false;
                    runTransition();
                },
                setSpeed(newSpeed) {
                    speed = newSpeed || 1;
                    if (!paused && active) {
                        cancelTransition();
                        runTransition();
                    }
                },
                interrupt() {
                    active = false;
                    cancelTransition();
                    g.selectAll("*").interrupt();
                }
            };
        }

        // å¹»ç¯ç‰‡4ï¼šåŒºé—´å¯è§†åŒ–
        function visualizeIntervals(containerId) {
            const setup = setupD3(containerId);
            if (!setup) return;
            const { g, width, height } = setup;
            
            const axisY = height * 0.2;

            // é—­åŒºé—´
            g.append("line").attr("x1", 0).attr("y1", axisY).attr("x2", width).attr("y2", axisY).attr("stroke", "black");
            g.append("line").attr("x1", width*0.1).attr("y1", axisY).attr("x2", width*0.4).attr("y2", axisY).attr("stroke", "var(--success-color)").attr("stroke-width", 5);
            g.append("circle").attr("cx", width*0.1).attr("cy", axisY).attr("r", 5).attr("fill", "var(--success-color)");
            g.append("circle").attr("cx", width*0.4).attr("cy", axisY).attr("r", 5).attr("fill", "var(--success-color)");
            g.append("text").attr("x", width*0.25).attr("y", axisY + 40).text("é—­åŒºé—´ [a, b]").attr("text-anchor", "middle");

            // å¼€åŒºé—´
            const axisY2 = height * 0.5;
            g.append("line").attr("x1", 0).attr("y1", axisY2).attr("x2", width).attr("y2", axisY2).attr("stroke", "black");
            g.append("line").attr("x1", width*0.1).attr("y1", axisY2).attr("x2", width*0.4).attr("y2", axisY2).attr("stroke", "var(--warning-color)").attr("stroke-width", 5);
            g.append("circle").attr("cx", width*0.1).attr("cy", axisY2).attr("r", 5).attr("fill", "white").attr("stroke", "var(--warning-color)").attr("stroke-width", 2);
            g.append("circle").attr("cx", width*0.4).attr("cy", axisY2).attr("r", 5).attr("fill", "white").attr("stroke", "var(--warning-color)").attr("stroke-width", 2);
            g.append("text").attr("x", width*0.25).attr("y", axisY2 + 40).text("å¼€åŒºé—´ (a, b)").attr("text-anchor", "middle");

            // åŠå¼€åŒºé—´
            const axisY3 = height * 0.8;
            g.append("line").attr("x1", 0).attr("y1", axisY3).attr("x2", width).attr("y2", axisY3).attr("stroke", "black");
            g.append("line").attr("x1", width*0.1).attr("y1", axisY3).attr("x2", width*0.4).attr("y2", axisY3).attr("stroke", "var(--info-color)").attr("stroke-width", 5);
            g.append("circle").attr("cx", width*0.1).attr("cy", axisY3).attr("r", 5).attr("fill", "var(--info-color)");
            g.append("circle").attr("cx", width*0.4).attr("cy", axisY3).attr("r", 5).attr("fill", "white").attr("stroke", "var(--info-color)").attr("stroke-width", 2);
            g.append("text").attr("x", width*0.25).attr("y", axisY3 + 40).text("åŠå¼€åŒºé—´ [a, b)").attr("text-anchor", "middle");
        }

        // å¹»ç¯ç‰‡5ï¼šå‡½æ•°æœºå™¨å¯è§†åŒ–
        function visualizeFunctionMachine(containerId) {
            const container = d3.select(`#${containerId}`);
            container.html("");
            const width = container.node().clientWidth;
            const height = container.node().clientHeight;
            
            const svg = container.append("svg")
                .attr("width", width)
                .attr("height", height);

            // å‡½æ•°æœºå™¨
            const machine = { x: width / 2, y: height / 2, width: 150, height: 100 };
            
            svg.append("rect")
                .attr("x", machine.x - machine.width / 2)
                .attr("y", machine.y - machine.height / 2)
                .attr("width", machine.width)
                .attr("height", machine.height)
                .attr("rx", 10)
                .attr("fill", "#4a90e2")
                .attr("stroke", "#357ABD")
                .attr("stroke-width", 3);

            svg.append("text")
                .text("f(x) = 2x + 1")
                .attr("x", machine.x)
                .attr("y", machine.y)
                .attr("text-anchor", "middle")
                .attr("dy", ".3em")
                .attr("fill", "white")
                .style("font-size", "18px")
                .style("font-weight", "bold");

            // è¾“å…¥æ¼æ–—
            svg.append("path")
                .attr("d", `M ${machine.x - 50} ${machine.y - machine.height/2 - 50} 
                           L ${machine.x - 25} ${machine.y - machine.height/2} 
                           H ${machine.x + 25} 
                           L ${machine.x + 50} ${machine.y - machine.height/2 - 50} Z`)
                .attr("fill", "#a2cffe");

            // è¾“å‡ºç®¡é“
            svg.append("rect")
                .attr("x", machine.x - 25)
                .attr("y", machine.y + machine.height/2)
                .attr("width", 50)
                .attr("height", 30)
                .attr("fill", "#a2cffe");

            const timeouts = new Set();
            let paused = animationState.isPaused;
            let speed = animationState.speed || 1;
            let active = true;

            function clearTimers() {
                timeouts.forEach(id => clearTimeout(id));
                timeouts.clear();
            }

            function scheduleTask(fn, baseDelay) {
                const id = setTimeout(() => {
                    timeouts.delete(id);
                    if (!active || paused) return;
                    fn();
                }, baseDelay / speed);
                timeouts.add(id);
            }

            function animateNumber() {
                if (!active || paused) return;

                const input = Math.floor(Math.random() * 10) - 5;
                const output = 2 * input + 1;

                const inputText = svg.append("text")
                    .text(input)
                    .attr("x", machine.x)
                    .attr("y", machine.y - machine.height/2 - 60)
                    .attr("text-anchor", "middle")
                    .attr("fill", "#333")
                    .style("font-size", "20px")
                    .style("font-weight", "bold");

                const moveDuration = 1000 / speed;
                const fadeInDuration = 500 / speed;
                const holdDuration = 1500 / speed;
                const fadeOutDuration = 500 / speed;

                inputText.transition()
                    .duration(moveDuration)
                    .attr("y", machine.y)
                    .style("opacity", 0)
                    .remove();

                scheduleTask(() => {
                    const outputText = svg.append("text")
                        .text(output)
                        .attr("x", machine.x)
                        .attr("y", machine.y + machine.height/2 + 30)
                        .attr("text-anchor", "middle")
                        .attr("fill", "#2ecc71")
                        .style("font-size", "20px")
                        .style("font-weight", "bold")
                        .style("opacity", 0);

                    outputText.transition()
                        .duration(fadeInDuration)
                        .style("opacity", 1)
                        .transition()
                        .delay(holdDuration)
                        .duration(fadeOutDuration)
                        .style("opacity", 0)
                        .remove();
                }, moveDuration);

                scheduleTask(animateNumber, 3000);
            }

            animateNumber();

            return {
                pause() {
                    if (paused) return;
                    paused = true;
                    clearTimers();
                    svg.selectAll("*").interrupt();
                },
                resume() {
                    if (!active || !paused) return;
                    paused = false;
                    animateNumber();
                },
                setSpeed(newSpeed) {
                    speed = newSpeed || 1;
                    if (!paused && active) {
                        clearTimers();
                        svg.selectAll("*").interrupt();
                        animateNumber();
                    }
                },
                interrupt() {
                    active = false;
                    clearTimers();
                    svg.selectAll("*").interrupt();
                }
            };
        }

        // å¹»ç¯ç‰‡6ï¼šå®šä¹‰åŸŸå¯è§†åŒ–
        function visualizeDomain(containerId) {
            const container = d3.select(`#${containerId}`);
            container.html("");
            const width = container.node().clientWidth;
            const height = container.node().clientHeight;
            const svg = container.append("svg").attr("width", width).attr("height", height);

            const machine = { x: width / 2, y: height / 2, width: 150, height: 100 };

            // å‡½æ•°æœºå™¨
            svg.append("rect")
                .attr("x", machine.x - machine.width / 2)
                .attr("y", machine.y - machine.height / 2)
                .attr("width", machine.width)
                .attr("height", machine.height)
                .attr("rx", 10)
                .attr("fill", "#4a90e2")
                .attr("stroke", "#357ABD")
                .attr("stroke-width", 3);

            svg.append("text")
                .text("f(x) = âˆš(x-2)")
                .attr("x", machine.x)
                .attr("y", machine.y)
                .attr("text-anchor", "middle")
                .attr("dy", ".3em")
                .attr("fill", "white")
                .style("font-size", "18px")
                .style("font-weight", "bold");

            // æ•°è½´
            const numLineY = height - 50;
            const scaleX = d3.scaleLinear().domain([-2, 10]).range([50, width - 50]);
            
            svg.append("line")
                .attr("x1", scaleX.range()[0])
                .attr("y1", numLineY)
                .attr("x2", scaleX.range()[1])
                .attr("y2", numLineY)
                .attr("stroke", "#333");

            // å®šä¹‰åŸŸé«˜äº®
            svg.append("rect")
                .attr("x", scaleX(2))
                .attr("y", numLineY - 10)
                .attr("width", scaleX(10) - scaleX(2))
                .attr("height", 20)
                .attr("fill", "#50e3c2")
                .attr("opacity", 0.5);

            svg.append("text")
                .text("å®šä¹‰åŸŸ: x â‰¥ 2")
                .attr("x", scaleX(6))
                .attr("y", numLineY - 25)
                .attr("text-anchor", "middle")
                .style("font-weight", "bold")
                .style("fill", "#2c3e50");

            const timeouts = new Set();
            let paused = animationState.isPaused;
            let speed = animationState.speed || 1;
            let active = true;

            function clearTimers() {
                timeouts.forEach(id => clearTimeout(id));
                timeouts.clear();
            }

            function scheduleNext() {
                const id = setTimeout(() => {
                    timeouts.delete(id);
                    if (!active || paused) return;
                    generateParticle();
                }, 1500 / speed);
                timeouts.add(id);
            }

            function generateParticle() {
                if (!active || paused) return;

                const value = Math.floor(Math.random() * 12) - 1;
                const isValid = value >= 2;
                
                const particle = svg.append("g")
                    .attr("transform", `translate(${width * 0.2}, ${height * 0.2})`);

                particle.append("circle")
                    .attr("r", 15)
                    .attr("fill", isValid ? "#50e3c2" : "#e74c3c");
                
                particle.append("text")
                    .text(value)
                    .attr("text-anchor", "middle")
                    .attr("dy", ".3em")
                    .attr("fill", "white")
                    .style("font-size", "14px");

                const travelDuration = 2000 / speed;
                const exitDuration = 1000 / speed;

                particle.transition()
                    .duration(travelDuration)
                    .attr("transform", `translate(${machine.x}, ${machine.y - machine.height/2 - 20})`);

                if (isValid) {
                    particle.transition()
                        .delay(travelDuration)
                        .duration(exitDuration)
                        .attr("transform", `translate(${machine.x}, ${machine.y + machine.height/2 + 20})`)
                        .style("opacity", 0)
                        .remove();
                } else {
                    particle.transition()
                        .delay(travelDuration)
                        .duration(exitDuration)
                        .attr("transform", `translate(${machine.x + 100}, ${machine.y - machine.height - 50})`)
                        .style("opacity", 0)
                        .remove();
                }

                scheduleNext();
            }

            scheduleNext();

            return {
                pause() {
                    if (paused) return;
                    paused = true;
                    clearTimers();
                    svg.selectAll("*").interrupt();
                },
                resume() {
                    if (!active || !paused) return;
                    paused = false;
                    generateParticle();
                },
                setSpeed(newSpeed) {
                    speed = newSpeed || 1;
                    if (!paused && active) {
                        clearTimers();
                        svg.selectAll("*").interrupt();
                        generateParticle();
                    }
                },
                interrupt() {
                    active = false;
                    clearTimers();
                    svg.selectAll("*").interrupt();
                }
            };
        }

        // å¹»ç¯ç‰‡7ï¼šå€¼åŸŸå¯è§†åŒ–
        function visualizeRange(containerId) {
            const container = d3.select(`#${containerId}`);
            container.html("");
            const width = container.node().clientWidth;
            const height = container.node().clientHeight;
            const svg = container.append("svg").attr("width", width).attr("height", height);

            const machine = { x: width / 2, y: height / 2, width: 150, height: 100 };

            svg.append("rect")
                .attr("x", machine.x - machine.width / 2)
                .attr("y", machine.y - machine.height / 2)
                .attr("width", machine.width)
                .attr("height", machine.height)
                .attr("rx", 10)
                .attr("fill", "#4a90e2");

            svg.append("text")
                .text("f(x) = xÂ²")
                .attr("x", machine.x)
                .attr("y", machine.y)
                .attr("text-anchor", "middle")
                .attr("dy", ".3em")
                .attr("fill", "white")
                .style("font-size", "20px");

            // å€¼åŸŸè½´
            const numLineX = width - 100;
            const scaleY = d3.scaleLinear().domain([-2, 10]).range([height - 50, 50]);
            
            svg.append("line")
                .attr("x1", numLineX)
                .attr("y1", scaleY.range()[0])
                .attr("x2", numLineX)
                .attr("y2", scaleY.range()[1])
                .attr("stroke", "#333");

            // å€¼åŸŸé«˜äº®
            svg.append("rect")
                .attr("x", numLineX - 10)
                .attr("y", scaleY(10))
                .attr("width", 20)
                .attr("height", scaleY(0) - scaleY(10))
                .attr("fill", "#f5a623")
                .attr("opacity", 0.5);

            svg.append("text")
                .text("å€¼åŸŸ: y â‰¥ 0")
                .attr("x", numLineX)
                .attr("y", scaleY(10) - 10)
                .attr("text-anchor", "middle")
                .style("font-weight", "bold")
                .style("fill", "#2c3e50");

            const timeouts = new Set();
            let paused = animationState.isPaused;
            let speed = animationState.speed || 1;
            let active = true;

            function clearTimers() {
                timeouts.forEach(id => clearTimeout(id));
                timeouts.clear();
            }

            function scheduleNext() {
                const id = setTimeout(() => {
                    timeouts.delete(id);
                    if (!active || paused) return;
                    generateParticle();
                }, 2000 / speed);
                timeouts.add(id);
            }

            function generateParticle() {
                if (!active || paused) return;

                const value = (Math.random() * 6) - 3;
                const outputValue = value * value;

                const particle = svg.append("g")
                    .attr("transform", `translate(${50}, ${machine.y})`);

                particle.append("circle")
                    .attr("r", 15)
                    .attr("fill", "#50e3c2");
                
                particle.append("text")
                    .text(value.toFixed(1))
                    .attr("text-anchor", "middle")
                    .attr("dy", ".3em")
                    .attr("fill", "white");

                const moveDuration = 1500 / speed;
                const fadeDuration = 500 / speed;

                particle.transition()
                    .duration(moveDuration)
                    .attr("transform", `translate(${machine.x - machine.width/2 - 20}, ${machine.y})`)
                    .transition()
                    .duration(fadeDuration)
                    .style("opacity", 0)
                    .remove()
                    .on("end", () => {
                        if (!active || paused) return;

                        const outputParticle = svg.append("g")
                            .attr("transform", `translate(${machine.x + machine.width/2 + 20}, ${machine.y})`);
                        
                        outputParticle.append("circle")
                            .attr("r", 15)
                            .attr("fill", "#f5a623");
                        
                        outputParticle.append("text")
                            .text(outputValue.toFixed(1))
                            .attr("text-anchor", "middle")
                            .attr("dy", ".3em")
                            .attr("fill", "white");

                        outputParticle.transition()
                            .duration(moveDuration)
                            .attr("transform", `translate(${numLineX}, ${scaleY(outputValue)})`);

                        outputParticle.select("circle")
                            .transition()
                            .delay(moveDuration)
                            .duration(fadeDuration)
                            .attr("r", 5);

                        outputParticle.transition()
                            .delay(moveDuration)
                            .duration(fadeDuration)
                            .style("opacity", 0.7);
                    });

                scheduleNext();
            }

            scheduleNext();

            return {
                pause() {
                    if (paused) return;
                    paused = true;
                    clearTimers();
                    svg.selectAll("*").interrupt();
                },
                resume() {
                    if (!active || !paused) return;
                    paused = false;
                    generateParticle();
                },
                setSpeed(newSpeed) {
                    speed = newSpeed || 1;
                    if (!paused && active) {
                        clearTimers();
                        svg.selectAll("*").interrupt();
                        generateParticle();
                    }
                },
                interrupt() {
                    active = false;
                    clearTimers();
                    svg.selectAll("*").interrupt();
                }
            };
        }

        // å¹»ç¯ç‰‡8ï¼šåŸºæœ¬åˆç­‰å‡½æ•°æ˜Ÿç³»å¯è§†åŒ–
        function visualizeElementaryIntro(containerId) {
            const setup = setupD3(containerId, { top: 0, right: 0, bottom: 0, left: 0 });
            if (!setup) return;
            const { container, svg, g, width, height } = setup;

            // è®¾ç½®æ˜Ÿç©ºèƒŒæ™¯
            svg.style('background', 'radial-gradient(ellipse at center, #1a1a2e 0%, #16213e 50%, #0f0f23 100%)');

            const centerX = width / 2;
            const centerY = height / 2;

            // åˆ›å»ºæ˜Ÿç©ºèƒŒæ™¯
            function createStarField() {
                const starCount = 50;
                const stars = [];

                for (let i = 0; i < starCount; i++) {
                    stars.push({
                        x: Math.random() * width,
                        y: Math.random() * height,
                        radius: Math.random() * 1.5 + 0.5,
                        opacity: Math.random() * 0.6 + 0.4
                    });
                }

                const starGroup = g.append('g').attr('class', 'star-field');
                starGroup.selectAll('.star')
                    .data(stars)
                    .enter()
                    .append('circle')
                    .attr('class', 'star')
                    .attr('cx', d => d.x)
                    .attr('cy', d => d.y)
                    .attr('r', d => d.radius)
                    .attr('fill', 'white')
                    .attr('opacity', d => d.opacity);
            }

            createStarField();

            // æ·»åŠ æ ‡é¢˜
            svg.append('text')
                .attr('x', width / 2)
                .attr('y', 60)
                .attr('text-anchor', 'middle')
                .attr('fill', 'white')
                .style('font-size', '48px')
                .style('font-weight', 'bold')
                .text('åŸºæœ¬åˆç­‰å‡½æ•°æ˜Ÿç³»');

            // å®šä¹‰è¡Œæ˜Ÿæ•°æ®
            const planetsData = [
                { name: "å¹‚å‡½æ•°", color: "#e74c3c", radius: 22, orbitRadius: 100, speed: 0.002 },
                { name: "æŒ‡æ•°å‡½æ•°", color: "#3498db", radius: 25, orbitRadius: 160, speed: 0.0015 },
                { name: "å¯¹æ•°å‡½æ•°", color: "#2ecc71", radius: 25, orbitRadius: 220, speed: 0.0012 },
                { name: "ä¸‰è§’å‡½æ•°", color: "#f1c40f", radius: 28, orbitRadius: 280, speed: 0.001 },
                { name: "åä¸‰è§’å‡½æ•°", color: "#9b59b6", radius: 20, orbitRadius: 340, speed: 0.0008 },
                { name: "å¸¸æ•°å‡½æ•°", color: "#bdc3c7", radius: 18, orbitRadius: 60, speed: 0.0025 }
            ];

            // ç»˜åˆ¶è½¨é“
            g.selectAll(".orbit")
                .data(planetsData)
                .enter().append("circle")
                .attr("class", "orbit")
                .attr("cx", centerX)
                .attr("cy", centerY)
                .attr("r", d => d.orbitRadius)
                .attr("fill", "none")
                .attr("stroke", "rgba(255, 255, 255, 0.3)")
                .attr("stroke-width", 1)
                .attr("stroke-dasharray", "5, 5");

            // ç»˜åˆ¶ä¸­å¤®å¤ªé˜³
            const sun = g.append("g")
                .attr("transform", `translate(${centerX}, ${centerY})`);

            sun.append("circle")
                .attr("r", 45)
                .attr("fill", "#f1c40f");

            sun.append("text")
                .attr("text-anchor", "middle")
                .attr("dy", "0.35em")
                .attr("fill", "#333")
                .style("font-size", "14px")
                .style("font-weight", "bold")
                .text("åˆç­‰å‡½æ•°");

            // åˆ›å»ºè¡Œæ˜Ÿ
            const planets = g.selectAll(".planet")
                .data(planetsData)
                .enter().append("g")
                .attr("class", "planet");

            planets.append("circle")
                .attr("r", d => d.radius)
                .attr("fill", d => d.color)
                .attr("stroke", d => d.color)
                .attr("stroke-width", 1)
                .attr("stroke-opacity", 0.5);

            planets.append("text")
                .attr("dy", d => d.radius + 15)
                .attr("text-anchor", "middle")
                .attr("fill", "#fff")
                .style("font-size", "12px")
                .style("font-weight", "bold")
                .text(d => d.name);

            // è¡Œæ˜Ÿè¿è¡ŒåŠ¨ç”»
            let angle = 0;
            let frameId = null;
            let lastTimestamp = null;
            let paused = animationState.isPaused;
            let speed = animationState.speed || 1;
            let active = true;
            const baseAngularVelocity = 0.6; // radian per second baseline

            function step(timestamp) {
                if (!active) return;

                if (paused) {
                    lastTimestamp = timestamp;
                    frameId = requestAnimationFrame(step);
                    return;
                }

                if (lastTimestamp === null) {
                    lastTimestamp = timestamp;
                }

                const deltaSeconds = (timestamp - lastTimestamp) / 1000;
                lastTimestamp = timestamp;
                angle += deltaSeconds * baseAngularVelocity * speed;

                planets.attr("transform", d => {
                    const planetAngle = angle * d.speed;
                    const x = centerX + d.orbitRadius * Math.cos(planetAngle);
                    const y = centerY + d.orbitRadius * Math.sin(planetAngle);
                    return `translate(${x}, ${y})`;
                });

                frameId = requestAnimationFrame(step);
            }

            if (!paused) {
                frameId = requestAnimationFrame(step);
            }

            return {
                pause() {
                    if (paused) return;
                    paused = true;
                    if (frameId !== null) {
                        cancelAnimationFrame(frameId);
                        frameId = null;
                    }
                },
                resume() {
                    if (!active || !paused) return;
                    paused = false;
                    lastTimestamp = null;
                    frameId = requestAnimationFrame(step);
                },
                setSpeed(newSpeed) {
                    speed = newSpeed || 1;
                },
                interrupt() {
                    active = false;
                    if (frameId !== null) {
                        cancelAnimationFrame(frameId);
                        frameId = null;
                    }
                }
            };
        }

        // å¹»ç¯ç‰‡10ï¼šæŒ‡æ•°å®šä¹‰å¯è§†åŒ–
        function visualizeExponents(containerId) {
            const setup = setupD3(containerId);
            if (!setup) return;
            const { g, width, height } = setup;
            
            const data = [
                { x: 0, y: 1, label: "2^0" },
                { x: 1, y: 2, label: "2^1" },
                { x: 2, y: 4, label: "2^2" },
                { x: 3, y: 8, label: "2^3" }
            ];
            
            const xScale = d3.scaleLinear().domain([-1, 4]).range([0, width]);
            const yScale = d3.scaleLinear().domain([0, 10]).range([height, 0]);
            
            // ç»˜åˆ¶æŸ±çŠ¶å›¾
            g.selectAll("rect")
                .data(data)
                .enter().append("rect")
                .attr("x", d => xScale(d.x) - width/10)
                .attr("y", height)
                .attr("width", width/5)
                .attr("height", 0)
                .attr("fill", "var(--primary-color)")
                .transition().duration(1000).delay((d, i) => i * 300)
                .attr("y", d => yScale(d.y))
                .attr("height", d => height - yScale(d.y));
            
            // æ·»åŠ æ ‡ç­¾
            g.selectAll(".label")
                .data(data)
                .enter().append("text")
                .attr("class", "label")
                .attr("x", d => xScale(d.x))
                .attr("y", d => yScale(d.y) - 10)
                .attr("text-anchor", "middle")
                .attr("font-size", "1.2em")
                .attr("fill", "var(--text-color)")
                .style("opacity", 0)
                .text(d => d.y)
                .transition().duration(500).delay((d, i) => 1000 + i * 300)
                .style("opacity", 1);
        }

        // å¹»ç¯ç‰‡11ï¼šæŒ‡æ•°è¿ç®—æ³•åˆ™1å¯è§†åŒ–
        function visualizeExponentRules1(containerId) {
            const setup = setupD3(containerId);
            if (!setup) return;
            const { svg, g, width, height } = setup;

            const mulY = height * 0.25;
            
            // ä¹˜æ³•æ³•åˆ™åŠ¨ç”»
            const mulGroup = g.append("g");
            const mulText = mulGroup.append("text")
                .attr("x", width / 2)
                .attr("y", mulY - 30)
                .attr("text-anchor", "middle")
                .attr("font-size", "1.8em")
                .attr("fill", "var(--text-color)");
            
            mulText.append("tspan").text("2Â³ Ã— 2Â² = 2âµ");

            // åŠ¨ç”»åœ†åœˆ
            const circles1 = g.selectAll(".c1")
                .data(d3.range(3))
                .enter().append("circle")
                .attr("class", "c1")
                .attr("cy", mulY)
                .attr("cx", (d, i) => width * 0.2 + i * 40)
                .attr("r", 15)
                .attr("fill", "var(--primary-color)");
            
            const circles2 = g.selectAll(".c2")
                .data(d3.range(2))
                .enter().append("circle")
                .attr("class", "c2")
                .attr("cy", mulY)
                .attr("cx", (d, i) => width * 0.8 - i * 40)
                .attr("r", 15)
                .attr("fill", "var(--accent-color)");
            
            // åˆå¹¶åŠ¨ç”»
            circles1.transition().delay(1000).duration(1500)
                .attr("cx", (d, i) => width/2 - 100 + i * 40);
            
            circles2.transition().delay(1000).duration(1500)
                .attr("cx", (d, i) => width/2 + 20 + i * 40);

            // é™¤æ³•æ³•åˆ™
            const divY = height * 0.75;
            g.append("line")
                .attr("x1", 0).attr("y1", height/2)
                .attr("x2", width).attr("y2", height/2)
                .attr("stroke", "#ddd").attr("stroke-width", 2);
            
            const divText = g.append("text")
                .attr("x", width / 2)
                .attr("y", divY - 50)
                .attr("text-anchor", "middle")
                .attr("font-size", "1.8em")
                .attr("fill", "var(--text-color)")
                .text("5â´ Ã· 5Â² = 5Â²");
        }

        // å¹»ç¯ç‰‡12ï¼šæŒ‡æ•°è¿ç®—æ³•åˆ™2å¯è§†åŒ–
        function visualizeExponentRules2(containerId) {
            const setup = setupD3(containerId, {top: 0, right: 0, bottom: 0, left: 0});
            if (!setup) return;
            const { svg, g, width, height } = setup;

            svg.style("background", "transparent");

            // æ ‡é¢˜
            g.append("text")
                .attr("x", width/2)
                .attr("y", 50)
                .attr("text-anchor", "middle")
                .attr("font-size", "2em")
                .attr("font-weight", "300")
                .attr("fill", "#2d3436")
                .text("(2Â³)â´ = ?");

            // å¤§åœ†åœˆåŠ¨ç”»
            setTimeout(() => {
                const bigCircle = g.append("circle")
                    .attr("cx", width/2)
                    .attr("cy", height/2)
                    .attr("r", 0)
                    .attr("fill", "#74b9ff")
                    .attr("stroke", "#0984e3")
                    .attr("stroke-width", 3)
                    .style("opacity", 0.8);

                bigCircle.transition()
                    .duration(1000)
                    .attr("r", 60);

                g.append("text")
                    .attr("x", width/2)
                    .attr("y", height/2 + 5)
                    .attr("text-anchor", "middle")
                    .attr("font-size", "1.8em")
                    .attr("font-weight", "bold")
                    .attr("fill", "white")
                    .text("2Â³")
                    .style("opacity", 0)
                    .transition()
                    .delay(800)
                    .duration(600)
                    .style("opacity", 1);
            }, 1000);

            // åˆ†æ•£æˆ4ä¸ªå°åœ†
            setTimeout(() => {
                const positions = [
                    {x: width/2, y: height/2 - 120},
                    {x: width/2 + 120, y: height/2},
                    {x: width/2, y: height/2 + 120},
                    {x: width/2 - 120, y: height/2}
                ];

                positions.forEach((pos, i) => {
                    const bubble = g.append("circle")
                        .attr("cx", width/2)
                        .attr("cy", height/2)
                        .attr("r", 15)
                        .attr("fill", "#74b9ff")
                        .attr("stroke", "#0984e3")
                        .attr("stroke-width", 2)
                        .style("opacity", 0);

                    bubble.transition()
                        .delay(500 + i * 150)
                        .duration(100)
                        .style("opacity", 0.8)
                        .transition()
                        .duration(800)
                        .attr("cx", pos.x)
                        .attr("cy", pos.y)
                        .attr("r", 35);

                    g.append("text")
                        .attr("x", width/2)
                        .attr("y", height/2)
                        .attr("text-anchor", "middle")
                        .attr("font-size", "1.2em")
                        .attr("font-weight", "bold")
                        .attr("fill", "white")
                        .text("2Â³")
                        .style("opacity", 0)
                        .transition()
                        .delay(600 + i * 150)
                        .duration(800)
                        .attr("x", pos.x)
                        .attr("y", pos.y + 5)
                        .style("opacity", 1);
                });
            }, 3000);

            // æœ€ç»ˆç»“æœ
            setTimeout(() => {
                g.append("text")
                    .attr("x", width/2)
                    .attr("y", height - 50)
                    .attr("text-anchor", "middle")
                    .attr("font-size", "2.2em")
                    .attr("font-weight", "bold")
                    .attr("fill", "#e74c3c")
                    .text("(2Â³)â´ = 2Â¹Â² = 4096")
                    .style("opacity", 0)
                    .transition()
                    .duration(800)
                    .style("opacity", 1);
            }, 6000);
        }

        // å¹»ç¯ç‰‡13ï¼šé›¶æŒ‡æ•°ä¸è´ŸæŒ‡æ•°å¯è§†åŒ–  
// å¹»ç¯ç‰‡13ï¼ˆç¬¬14é¡µï¼‰ï¼šé›¶æŒ‡æ•°ä¸è´ŸæŒ‡æ•°å¯è§†åŒ– - å¢å¼ºç‰ˆ
function visualizeSpecialExponentsNew(containerId) {
    const setup = setupD3(containerId);
    if (!setup) return;
    const { svg, g, width, height } = setup;

        const sectionHeight = height / 2;
        const sectionWidth = width;

        // --- Section 1: Zero Exponent ---
    const zeroGroup = g.append("g");
        const scaleGroup = zeroGroup.append("g")
            .attr("transform", `translate(${sectionWidth / 2}, ${sectionHeight * 0.6})`);

        scaleGroup.append("polygon").attr("points", "-10,0 10,0 0,15").attr("fill", "#555");
        const beam = scaleGroup.append("line").attr("x1", -100).attr("x2", 100).attr("stroke", "#555").attr("stroke-width", 4);
        const leftPan = scaleGroup.append("text").attr("x", -70).attr("y", -15).attr("font-size", "1.5em").attr("text-anchor", "middle");
        const rightPan = scaleGroup.append("text").attr("x", 70).attr("y", -15).attr("font-size", "1.5em").attr("text-anchor", "middle");

        // é›¶æŒ‡æ•°åŠ¨ç”» - ç«‹å³å¼€å§‹
        leftPan.append("tspan").text("aÂ³").style("opacity", 0).transition().delay(0).duration(500).style("opacity", 1);
        rightPan.append("tspan").text("aÂ³").style("opacity", 0).transition().delay(0).duration(500).style("opacity", 1);

        setTimeout(() => {
            leftPan.html("aÂ³ Ã· aÂ³");
            rightPan.html("aÂ³ Ã· aÂ³");
        }, 800);

        setTimeout(() => {
            beam.transition().duration(500).attr("transform", "rotate(5)").transition().duration(500).attr("transform", "rotate(-5)").transition().duration(500).attr("transform", "rotate(0)");
            leftPan.html("aâ°").attr("font-size", "1.5em").attr("fill", "var(--danger-color)");
            rightPan.html("1").attr("font-size", "1.5em").attr("fill", "var(--success-color)");
        }, 1500);

        // --- Section 2: Negative Exponent ---
        g.append("line").attr("x1", 0).attr("y1", sectionHeight).attr("x2", width).attr("y2", sectionHeight).attr("stroke", "#ddd");
        const negGroup2 = g.append("g").attr("transform", `translate(0, ${sectionHeight})`);
        // è´ŸæŒ‡æ•°åŠ¨ç”» - 1ç§’åå¼€å§‹
        const negTitle = negGroup2.append("text").attr("x", sectionWidth/2).attr("y", sectionHeight * 0.2).attr("text-anchor", "middle").attr("font-size", "1.5em").text("aÂ² Ã· aâµ = ?").style("opacity", 0).transition().delay(1000).duration(500).style("opacity", 1);

const fraction = negGroup2.append("g").attr("transform", `translate(${sectionWidth/2}, ${sectionHeight * 0.6})`).style("opacity", 0);
const numerator = fraction.selectAll(".num").data("aa".split("")).enter().append("text").attr("class", "num").text("a").attr("x", (d,i) => -25 + i * 25).attr("y", -15).attr("font-size", "1.5em");

const denominator = fraction.selectAll(".den").data("aaaaa".split("")).enter().append("text").attr("class", "den").text("a").attr("x", (d,i) => -60 + i * 25).attr("y", 25).attr("font-size", "1.5em");


    // === è´ŸæŒ‡æ•°éƒ¨åˆ† ===
    const negGroup = g.append("g")
        .attr("transform", `translate(0, ${height/2 + 30})`);

    // æ ‡é¢˜
    const negTitleFO = negGroup.append("foreignObject")
        .attr("x", 0)
        .attr("y", 200)
        .attr("width", width)
        .attr("height", 60)
        .html(`<div style="text-align: center; font-size: 24px; font-weight: bold; color: #e74c3c;">
            è´ŸæŒ‡æ•°å®šå¾‹ï¼š$a^{-n} = \\frac{1}{a^n}$
        </div>`);

    // åˆ›å»ºäº¤äº’å¼ç¤ºä¾‹
    const exampleY = 80;
    const examples = [
        { base: 2, exp: -1, value: 1/2 },
        { base: 2, exp: -2, value: 1/4 },
        { base: 2, exp: -3, value: 1/8 }
    ];

    examples.forEach((ex, i) => {
        const exGroup = negGroup.append("g")
            .attr("transform", `translate(${width * (0.25 + i * 0.25)}, ${exampleY})`);

        // èƒŒæ™¯åœ†
        exGroup.append("circle")
            .attr("r", 45)
            .attr("fill", "#e74c3c")
            .attr("fill-opacity", 0.1)
            .attr("stroke", "#e74c3c")
            .attr("stroke-width", 2)
            .style("opacity", 0)
            .transition()
            .delay(5000 + i * 300)
            .duration(600)
            .style("opacity", 1);

        // å…¬å¼
        const formulaFO = exGroup.append("foreignObject")
            .attr("x", -40)
            .attr("y", -20)
            .attr("width", 80)
            .attr("height", 40)
            .html(`<div style="text-align: center; font-size: 18px; color: #c0392b;">
                $2^{${ex.exp}}$
            </div>`)
            .style("opacity", 0);

        formulaFO.transition()
            .delay(5300 + i * 300)
            .duration(600)
            .style("opacity", 1);

        // å¯è§†åŒ–åˆ†æ•°é¥¼å›¾
        const pieRadius = 25;
        const pieY = 60;

    const arc = d3.arc()
        .innerRadius(0)
            .outerRadius(pieRadius);

        const denominator = Math.pow(2, -ex.exp);
        const pieData = d3.pie()(Array(denominator).fill(1));
        
        const pieGroup = exGroup.append("g")
            .attr("transform", `translate(0, ${pieY})`);
    
    pieGroup.selectAll("path")
        .data(pieData)
        .enter()
        .append("path")
        .attr("d", arc)
            .attr("fill", (d, j) => j === 0 ? "#e74c3c" : "#fce4ec")
        .attr("stroke", "#fff")
            .attr("stroke-width", 1)
        .style("opacity", 0)
        .transition()
            .delay(5600 + i * 300)
            .duration(600)
        .style("opacity", 1);

        // æ•°å€¼æ ‡ç­¾
        const valueFO = exGroup.append("foreignObject")
            .attr("x", -40)
            .attr("y", pieY + pieRadius + 10)
            .attr("width", 180)
            .attr("height", 30)
            .html(`<div style="text-align: center; font-size: 14px; color: #7f8c8d;">
                $= \\frac{1}{${denominator}} = ${ex.value}$
            </div>`)
            .style("opacity", 0);

        valueFO.transition()
            .delay(6000 + i * 300)
        .duration(600)
        .style("opacity", 1);
    });

    // æ¸²æŸ“æ‰€æœ‰MathJaxå…¬å¼
    setTimeout(() => {
        renderMathJaxInContainer(containerId);
    }, 100);
}
 // å¹»ç¯ç‰‡14ï¼ˆç¬¬15é¡µï¼‰ï¼šåˆ†æ•°æŒ‡æ•°å¯è§†åŒ– - ä¿®å¤ç‰ˆ
        function visualizeFractionalExponents(containerId) {
    const setup = setupD3(containerId);
    if (!setup) return;
    const { svg, g, width, height } = setup;

    // æ¸…é™¤ä¹‹å‰çš„å†…å®¹
    g.selectAll("*").remove();

    // æ ‡é¢˜
    const titleFO = g.append("foreignObject")
        .attr("x", 0)
        .attr("y", 0)
        .attr("width", width)
        .attr("height", 50)
        .html(`<div style="text-align: center; font-size: 28px; font-weight: bold; color: #2c3e50; padding-top: 10px;">
            åˆ†æ•°æŒ‡æ•°çš„æ„ä¹‰ï¼š$a^{\\frac{m}{n}} = \\sqrt[n]{a^m}$
        </div>`);

    // åˆ›å»ºä¸‰ä¸ªäº¤äº’å¼ç¤ºä¾‹
    const examples = [
        { base: 27, numerator: 1, denominator: 3, result: 3, color: "#e74c3c" },
        { base: 16, numerator: 1, denominator: 2, result: 4, color: "#3498db" },
        { base: 8, numerator: 2, denominator: 3, result: 4, color: "#2ecc71" }
    ];

    const cardSpacing = width / 3;

    examples.forEach((ex, i) => {
        const cardGroup = g.append("g")
            .attr("transform", `translate(${cardSpacing * (i + 0.5)}, ${height * 0.5})`);

        // ä¸»åœ†å½¢èƒŒæ™¯
        const mainCircle = cardGroup.append("circle")
            .attr("r", 0)
            .attr("fill", ex.color)
            .attr("fill-opacity", 0.15)
            .attr("stroke", ex.color)
            .attr("stroke-width", 3)
            .transition()
            .delay(500 + i * 300)
            .duration(800)
            .attr("r", 80);

        // æ­¥éª¤1ï¼šåŸå§‹è¡¨è¾¾å¼
        const step1FO = cardGroup.append("foreignObject")
            .attr("x", -60)
            .attr("y", -120)
            .attr("width", 120)
            .attr("height", 40)
            .html(`<div style="text-align: center; font-size: 20px; color: ${ex.color}; font-weight: bold;">
                ${ex.base}^{\\frac{${ex.numerator}}{${ex.denominator}}}$
            </div>`)
            .style("opacity", 0);

        step1FO.transition()
            .delay(800 + i * 300)
            .duration(600)
            .style("opacity", 1);

        // æ­¥éª¤2ï¼šæ ¹å¼è¡¨ç¤º
        const step2FO = cardGroup.append("foreignObject")
            .attr("x", -60)
            .attr("y", -30)
            .attr("width", 120)
            .attr("height", 40)
            .html(`<div style="text-align: center; font-size: 20px; color: #2c3e50;">
                $\\sqrt[${ex.denominator}]{${ex.base}^{${ex.numerator}}}$
            </div>`)
            .style("opacity", 0);

        step2FO.transition()
            .delay(2000 + i * 300)
            .duration(600)
            .style("opacity", 1);

        // æ­¥éª¤3ï¼šç»“æœ
        const resultGroup = cardGroup.append("g")
            .attr("transform", "translate(0, 80)");

        const resultCircle = resultGroup.append("circle")
            .attr("r", 0)
            .attr("fill", ex.color)
            .attr("stroke", "#fff")
            .attr("stroke-width", 3);

        resultCircle.transition()
            .delay(3200 + i * 300)
            .duration(600)
            .attr("r", 35);

        const resultText = resultGroup.append("text")
            .attr("text-anchor", "middle")
            .attr("dy", "0.3em")
            .style("font-size", "28px")
            .style("font-weight", "bold")
            .style("fill", "white")
            .text(ex.result)
            .style("opacity", 0);

        resultText.transition()
            .delay(3500 + i * 300)
            .duration(400)
            .style("opacity", 1);

        // è„‰åŠ¨åŠ¨ç”»
        function pulse() {
            resultCircle.transition()
                .duration(1500)
                .attr("r", 40)
                .transition()
                .duration(1500)
                .attr("r", 35)
                .on("end", pulse);
        }
        setTimeout(() => pulse(), 4000 + i * 300);
    });

    // åº•éƒ¨æ€»ç»“
    const summaryFO = g.append("foreignObject")
        .attr("x", 50)
        .attr("y", height - 60)
        .attr("width", width - 100)
        .attr("height", 50)
        .html(`<div style="text-align: center; padding: 10px; background: rgba(255,255,255,0.9); border-radius: 10px; border: 2px solid #95a5a6;">
            <span style="font-size: 16px; color: #2c3e50;">
                <strong>è®°å¿†æŠ€å·§ï¼š</strong> åˆ†æ•°æŒ‡æ•°ä¸­ï¼Œ<span style="color: #e74c3c;">åˆ†æ¯æ˜¯æ ¹æ¬¡</span>ï¼Œ<span style="color: #3498db;">åˆ†å­æ˜¯å¹‚æ¬¡</span>
            </span>
        </div>`)
        .style("opacity", 0);

    summaryFO.transition()
        .delay(5000)
        .duration(800)
        .style("opacity", 1);

    // æ¸²æŸ“MathJax
    setTimeout(() => {
        renderMathJaxInContainer(containerId);
    }, 100);
}


        // å¹»ç¯ç‰‡16ï¼šå¯¹æ•°å†å²å¯è§†åŒ– - å¢å¼ºç‰ˆ
        function visualizeLogHistory(containerId) {
            const setup = setupD3(containerId, { top: 0, right: 0, bottom: 0, left: 0 });
            if (!setup) return;
            const { svg, g, width, height } = setup;

            // æ·±è‰²èƒŒæ™¯æ¸å˜
            svg.style('background', 'radial-gradient(ellipse at center, #1a1a2e 0%, #16213e 50%, #0f0c29 100%)');

            // åŠ¨æ€æ˜Ÿç©ºæ•ˆæœ
            const stars = g.append("g").attr("class", "stars");
            for(let i = 0; i < 80; i++) {
                const star = stars.append("circle")
                    .attr("cx", Math.random() * width)
                    .attr("cy", Math.random() * height)
                    .attr("r", Math.random() * 2 + 0.5)
                    .attr("fill", "white")
                    .attr("opacity", Math.random() * 0.9 + 0.1);
                
                // æ·»åŠ é—ªçƒåŠ¨ç”»
                star.transition()
                    .duration((Math.random() * 3000) + 1000)
                    .attr("opacity", Math.random() * 0.3 + 0.1)
                    .transition()
                    .duration((Math.random() * 2000) + 500)
                    .attr("opacity", Math.random() * 0.9 + 0.1)
                    .on("end", function repeat() {
                        d3.select(this)
                            .transition()
                            .duration((Math.random() * 3000) + 1000)
                            .attr("opacity", Math.random() * 0.3 + 0.1)
                            .transition()
                            .duration((Math.random() * 2000) + 500)
                            .attr("opacity", Math.random() * 0.9 + 0.1)
                            .on("end", repeat);
                    });
            }

            // æ·»åŠ æµæ˜Ÿæ•ˆæœ
            function createMeteor() {
                const meteor = g.append("circle")
                    .attr("r", 0)
                    .attr("fill", "white")
                    .attr("opacity", 0);
                
                meteor.transition()
                    .duration(0)
                    .attr("cx", Math.random() * width)
                    .attr("cy", Math.random() * height * 0.3)
                    .attr("r", 3)
                    .attr("opacity", 1)
                    .transition()
                    .duration(2000)
                    .attr("cx", Math.random() * width)
                    .attr("cy", height + 50)
                    .attr("opacity", 0)
                    .remove();
            }

            // å®šæœŸåˆ›å»ºæµæ˜Ÿ
            setInterval(createMeteor, 3000);

            // æ ‡é¢˜å¸¦å‘å…‰æ•ˆæœ
            const title = g.append("text")
                .attr("x", width/2)
                .attr("y", 80)
                .attr("text-anchor", "middle")
                .style("font-size", "42px")
                .style("font-weight", "bold")
                .style("fill", "#f1c40f")
                .style("text-shadow", "0 0 20px #f1c40f, 0 0 40px #f1c40f")
                .text("å¯¹æ•°çš„å†å²é•¿æ²³")
                .style("opacity", 0)
                .transition()
                .duration(1500)
                .style("opacity", 1);

            // æµåŠ¨çš„æ—¶é—´çº¿
            g.append("line")
                .attr("x1", width * 0.1)
                .attr("y1", height/2)
                .attr("x2", width * 0.9)
                .attr("y2", height/2)
                .attr("stroke", "url(#timelineGradient)")
                .attr("stroke-width", 4)
                .style("opacity", 0);

            // æ·»åŠ æ—¶é—´çº¿æ¸å˜
            const defs = svg.append("defs");
            const timelineGradient = defs.append("linearGradient")
                .attr("id", "timelineGradient");
            timelineGradient.append("stop").attr("offset", "0%").style("stop-color", "#3498db");
            timelineGradient.append("stop").attr("offset", "50%").style("stop-color", "#f1c40f");
            timelineGradient.append("stop").attr("offset", "100%").style("stop-color", "#e74c3c");

            g.select("line").transition()
                .delay(800)
                .duration(2000)
                .style("opacity", 0.8);

            // å†å²äº‹ä»¶ï¼ˆæ›´ä¸°å¯Œçš„ä¿¡æ¯ï¼‰
            const events = [
                { 
                    year: 1614, 
                    title: "å¯¹æ•°è¯ç”Ÿ", 
                    desc: "çº³çš®å°”å‘æ˜å¯¹æ•°", 
                    detail: "ã€Šå¥‡å¦™å¯¹æ•°è¡¨ã€‹å‡ºç‰ˆ",
                    x: 0.15, 
                    icon: "ğŸ“œ", 
                    color: "#e74c3c",
                    impact: "é©å‘½æ€§çªç ´"
                },
                { 
                    year: 1617, 
                    title: "å¯¹æ•°è¡¨", 
                    desc: "å¸ƒé‡Œæ ¼æ–¯åˆ¶ä½œå¸¸ç”¨å¯¹æ•°è¡¨", 
                    detail: "ä»¥10ä¸ºåº•çš„å¯¹æ•°",
                    x: 0.3, 
                    icon: "ğŸ“Š", 
                    color: "#3498db",
                    impact: "å®ç”¨åŒ–"
                },
                { 
                    year: 1620, 
                    title: "èˆªæµ·åº”ç”¨", 
                    desc: "å¯¹æ•°ç®€åŒ–èˆªæµ·è®¡ç®—", 
                    detail: "å¤©æ–‡å¯¼èˆªé©å‘½",
                    x: 0.45, 
                    icon: "âš“", 
                    color: "#2ecc71",
                    impact: "èˆªæµ·æ—¶ä»£"
                },
                { 
                    year: 1622, 
                    title: "è®¡ç®—å°º", 
                    desc: "æ»‘å°ºè®¡ç®—å™¨å‘æ˜", 
                    detail: "æœºæ¢°è®¡ç®—å·¥å…·",
                    x: 0.6, 
                    icon: "ğŸ“", 
                    color: "#f39c12",
                    impact: "è®¡ç®—å·¥å…·"
                },
                { 
                    year: 1970, 
                    title: "è®¡ç®—å™¨æ—¶ä»£", 
                    desc: "ç”µå­è®¡ç®—å™¨æ™®åŠ", 
                    detail: "å¯¹æ•°åŠŸèƒ½å†…ç½®",
                    x: 0.75, 
                    icon: "ğŸ–©", 
                    color: "#9b59b6",
                    impact: "æ•°å­—åŒ–"
                },
                { 
                    year: 2024, 
                    title: "AIæ—¶ä»£", 
                    desc: "å¯¹æ•°åœ¨æœºå™¨å­¦ä¹ ä¸­çš„åº”ç”¨", 
                    detail: "æ·±åº¦å­¦ä¹ åŸºç¡€",
                    x: 0.9, 
                    icon: "ğŸ¤–", 
                    color: "#1abc9c",
                    impact: "æ™ºèƒ½æ—¶ä»£"
                }
            ];

            events.forEach((event, i) => {
                const eventGroup = g.append("g")
                    .attr("transform", `translate(${width * event.x}, ${height/2})`)
                    .attr("class", "event-group");

                // æ—¶é—´ç‚¹ï¼ˆå¸¦è„‰å†²æ•ˆæœï¼‰
                const timePoint = eventGroup.append("circle")
                    .attr("r", 0)
                    .attr("fill", event.color)
                    .attr("stroke", "#fff")
                    .attr("stroke-width", 3)
                    .style("filter", `drop-shadow(0 0 10px ${event.color})`);

                timePoint.transition()
                    .delay(1500 + i * 300)
                    .duration(800)
                    .attr("r", 15)
                    .transition()
                    .duration(1000)
                    .attr("r", 12);

                // è„‰å†²ç¯æ•ˆæœ
                const pulseRing = eventGroup.append("circle")
                    .attr("r", 0)
                    .attr("fill", "none")
                    .attr("stroke", event.color)
                    .attr("stroke-width", 2)
                    .attr("opacity", 0.6);

                pulseRing.transition()
                    .delay(2000 + i * 300)
                    .duration(1500)
                    .attr("r", 25)
                    .attr("opacity", 0)
                    .transition()
                    .duration(0)
                    .attr("r", 0)
                    .attr("opacity", 0.6)
                    .on("end", function repeat() {
                        d3.select(this)
                            .transition()
                            .duration(2000)
                            .attr("r", 25)
                            .attr("opacity", 0)
                            .transition()
                            .duration(0)
                            .attr("r", 0)
                            .attr("opacity", 0.6)
                            .on("end", repeat);
                    });

                // äº‹ä»¶å¡ç‰‡ï¼ˆå¸¦æ‚¬åœæ•ˆæœï¼‰
                const card = eventGroup.append("g")
                    .attr("transform", `translate(0, ${i % 2 === 0 ? -120 : 120})`)
                    .attr("class", "event-card")
                    .style("cursor", "pointer");

                const cardRect = card.append("rect")
                    .attr("x", -75)
                    .attr("y", -45)
                    .attr("width", 150)
                    .attr("height", 90)
                    .attr("rx", 15)
                    .attr("fill", event.color)
                    .attr("fill-opacity", 0.9)
                    .attr("stroke", "#fff")
                    .attr("stroke-width", 2)
                    .style("filter", `drop-shadow(0 5px 15px rgba(0,0,0,0.3))`)
                    .style("opacity", 0);

                cardRect.transition()
                    .delay(1800 + i * 300)
                    .duration(800)
                    .style("opacity", 1);

                // æ‚¬åœæ•ˆæœ
                card.on("mouseover", function() {
                    d3.select(this).select("rect")
                        .transition()
                        .duration(200)
                        .attr("fill-opacity", 1)
                        .attr("transform", "scale(1.05)");
                }).on("mouseout", function() {
                    d3.select(this).select("rect")
                        .transition()
                        .duration(200)
                        .attr("fill-opacity", 0.9)
                        .attr("transform", "scale(1)");
                });

                // å›¾æ ‡
                card.append("text")
                    .attr("y", -15)
                    .attr("text-anchor", "middle")
                    .style("font-size", "28px")
                    .text(event.icon)
                    .style("opacity", 0)
                    .transition()
                    .delay(2000 + i * 300)
                    .duration(500)
                    .style("opacity", 1);

                // å¹´ä»½
                card.append("text")
                    .attr("y", 5)
                    .attr("text-anchor", "middle")
                    .style("font-size", "18px")
                    .style("font-weight", "bold")
                    .style("fill", "white")
                    .text(event.year)
                    .style("opacity", 0)
                    .transition()
                    .delay(2100 + i * 300)
                    .duration(500)
                    .style("opacity", 1);

                // æè¿°
                card.append("text")
                    .attr("y", 25)
                    .attr("text-anchor", "middle")
                    .style("font-size", "12px")
                    .style("fill", "white")
                    .text(event.desc)
                    .style("opacity", 0)
                    .transition()
                    .delay(2200 + i * 300)
                    .duration(500)
                    .style("opacity", 1);

                // è¿æ¥çº¿ï¼ˆå¸¦æµåŠ¨æ•ˆæœï¼‰
                const connection = eventGroup.append("line")
                    .attr("x1", 0)
                    .attr("y1", 0)
                    .attr("x2", 0)
                    .attr("y2", 0)
                    .attr("stroke", event.color)
                    .attr("stroke-width", 3)
                    .attr("stroke-dasharray", "5, 5")
                    .style("opacity", 0);

                connection.transition()
                    .delay(1700 + i * 300)
                    .duration(800)
                    .attr("y2", i % 2 === 0 ? -85 : 85)
                    .style("opacity", 0.8);

                // æµåŠ¨åŠ¨ç”»
                connection.transition()
                    .delay(2500 + i * 300)
                    .duration(2000)
                    .attr("stroke-dashoffset", -20)
                    .transition()
                    .duration(2000)
                    .attr("stroke-dashoffset", 0)
                    .on("end", function repeat() {
                        d3.select(this)
                            .transition()
                            .duration(2000)
                            .attr("stroke-dashoffset", -20)
                            .transition()
                            .duration(2000)
                            .attr("stroke-dashoffset", 0)
                            .on("end", repeat);
                    });
            });

            // åº•éƒ¨è¯´æ˜ï¼ˆå¸¦æ‰“å­—æœºæ•ˆæœï¼‰
            const bottomText = g.append("text")
                .attr("x", width/2)
                .attr("y", height - 30)
                .attr("text-anchor", "middle")
                .style("font-size", "20px")
                .style("fill", "#ecf0f1")
                .style("text-shadow", "0 0 10px #ecf0f1")
                .style("opacity", 0);

            const textContent = "å¯¹æ•°ï¼šå°†å¤æ‚çš„ä¹˜é™¤è¿ç®—è½¬åŒ–ä¸ºç®€å•çš„åŠ å‡è¿ç®—ï¼Œæ¨åŠ¨äººç±»è®¡ç®—å†å²çš„é©å‘½";
            let currentText = "";
            let index = 0;

            bottomText.transition()
                .delay(5000)
                .duration(500)
                .style("opacity", 1)
                .on("end", function typeWriter() {
                    if (index < textContent.length) {
                        currentText += textContent[index];
                        bottomText.text(currentText);
                        index++;
                        setTimeout(typeWriter, 80);
                    }
                });

            // æ·»åŠ äº¤äº’å¼æ—¶é—´è½´æ§åˆ¶
            const controls = g.append("g")
                .attr("transform", `translate(${width/2}, ${height - 80})`)
                .style("opacity", 0);

            controls.transition()
                .delay(8000)
                .duration(1000)
                .style("opacity", 1);

            // æ’­æ”¾/æš‚åœæŒ‰é’®
            controls.append("circle")
                .attr("r", 20)
                .attr("fill", "#3498db")
                .attr("stroke", "#fff")
                .attr("stroke-width", 2)
                .style("cursor", "pointer");

            controls.append("text")
                .attr("text-anchor", "middle")
                .attr("dy", "0.3em")
                .style("font-size", "16px")
                .style("fill", "white")
                .text("â–¶");

            controls.select("circle").on("click", function() {
                // é‡æ–°æ’­æ”¾åŠ¨ç”»
                location.reload();
            });
        }

        // å¹»ç¯ç‰‡17ï¼šå¯¹æ•°å®šä¹‰å¯è§†åŒ–
        function visualizeLogDefinition(containerId) {
            const svg = d3.select("#animation2");
            if(svg.empty()) return;
            svg.selectAll("*").remove();
            
            const bounds = svg.node().getBoundingClientRect();
            const width = bounds.width, height = bounds.height;
            const centerX = width / 2;
            
            svg.append("text")
                .attr("x", centerX)
                .attr("y", 50)
                .attr("text-anchor", "middle")
                .style("font-size", "20px")
                .text("æ±‚ logâ‚‚(8) = ?");
            
            svg.append("text")
                .attr("x", centerX)
                .attr("y", 80)
                .attr("text-anchor", "middle")
                .style("font-size", "16px")
                .text("ä¹Ÿå°±æ˜¯ï¼Œ2çš„å‡ æ¬¡æ–¹ç­‰äº8ï¼Ÿ");

            // æŒ‡æ•°è¿‡ç¨‹
            const expGroup = svg.append("g");
            expGroup.append("text")
                .attr("x", 50)
                .attr("y", 150)
                .text("æŒ‡æ•°è¿‡ç¨‹:")
                .style("font-size", "16px")
                .style("font-weight", "bold");

            // ç»˜åˆ¶è·¯å¾„
            let pathData = "M 150 145";
            for (let i = 1; i <= 3; i++) {
                pathData += ` L ${150 + i * 100} 145`;
            }

            const expPath = expGroup.append("path")
                .attr("d", pathData)
                .attr("stroke", "#3498db")
                .attr("stroke-width", 2)
                .attr("fill", "none");

            // è·¯å¾„åŠ¨ç”»
            const totalLength = expPath.node().getTotalLength();
            expPath.attr("stroke-dasharray", `${totalLength} ${totalLength}`)
                .attr("stroke-dashoffset", totalLength)
                .transition()
                .duration(2000)
                .ease(d3.easeLinear)
                .attr("stroke-dashoffset", 0);

            // æ·»åŠ èŠ‚ç‚¹
            [1, 2, 4, 8].forEach((val, i) => {
                const node = expGroup.append("g")
                    .attr("transform", `translate(${150 + i * 100}, 145)`)
                    .style("opacity", 0);
                
                node.append("circle")
                    .attr("r", 15)
                    .attr("fill", "#3498db");
                
                node.append("text")
                    .text(val)
                    .attr("y", 40)
                    .attr("text-anchor", "middle")
                    .style("fill", "#2c3e50");
                
                node.transition()
                    .delay(1000 + i * 500)
                    .duration(500)
                    .style("opacity", 1);
            });

            // ç­”æ¡ˆ
            setTimeout(() => {
                svg.append("text")
                    .attr("x", centerX)
                    .attr("y", 300)
                    .attr("text-anchor", "middle")
                    .style("font-size", "24px")
                    .style("fill", "#e74c3c")
                    .style("font-weight", "bold")
                    .text("logâ‚‚(8) = 3")
                    .style("opacity", 0)
                    .transition()
                    .duration(500)
                    .style("opacity", 1);
            }, 4000);
        }

        // å¹»ç¯ç‰‡19ï¼šå¯¹æ•°æ€§è´¨å¯è§†åŒ–
        function visualizeLogProperties(containerId) {
            const container = d3.select(`#${containerId}`);
            if(container.empty()) return;
            container.html('');

            const svg = container.append('svg')
                .attr('width', '100%')
                .attr('height', '100%')
                .style('margin-top', '-60px');

            const bounds = container.node().getBoundingClientRect();
            const width = bounds.width, height = bounds.height;
            const centerX = width / 2;

            const properties = [
                { 
                    title: "ä¹˜æ³•åœ¨å¯¹æ•°ä¸–ç•Œå˜æˆåŠ æ³•",
                    formula: "log(xÂ·y) = log(x) + log(y)",
                    y: height*0.2,
                    color1: "#3498db",
                    color2: "#e74c3c"
                },
                { 
                    title: "é™¤æ³•åœ¨å¯¹æ•°ä¸–ç•Œå˜æˆå‡æ³•",
                    formula: "log(x/y) = log(x) - log(y)",
                    y: height*0.5,
                    color1: "#27ae60",
                    color2: "#f39c12"
                },
                { 
                    title: "å¹‚åœ¨å¯¹æ•°ä¸–ç•Œå˜æˆä¹˜æ³•",
                    formula: "log(x^n) = nÂ·log(x)",
                    y: height*0.8,
                    color1: "#9b59b6",
                    color2: "#e67e22"
                }
            ];

            properties.forEach((prop, index) => {
                const propGroup = svg.append("g")
                    .attr("transform", `translate(${centerX}, ${prop.y})`);

                // ä¸¤ä¸ªåœ†åœˆè¡¨ç¤ºè¿ç®—
                const circle1 = propGroup.append("circle")
                    .attr("cx", -80)
                    .attr("r", 35)
                    .attr("fill", prop.color1)
                    .attr("opacity", 1);
                
                const circle2 = propGroup.append("circle")
                    .attr("cx", 80)
                    .attr("r", 35)
                    .attr("fill", prop.color2)
                    .attr("opacity", 1);

                // æ ‡é¢˜
                propGroup.append("text")
                    .attr("x", -200)
                    .attr("y", 0)
                    .attr("text-anchor", "middle")
                    .style("font-size", "14px")
                    .style("font-weight", "bold")
                    .text(prop.title);

                // å…¬å¼
                propGroup.append("text")
                    .attr("x", -200)
                    .attr("y", 30)
                    .attr("text-anchor", "middle")
                    .style("font-size", "12px")
                    .text(prop.formula);

                // åŠ¨ç”»
                function animateProperty() {
                    circle1.transition().duration(2000)
                        .attr("cx", 0)
                        .transition().duration(1000)
                        .attr("cx", -80);
                    
                    circle2.transition().duration(2000)
                        .attr("cx", 0)
                        .transition().duration(1000)
                        .attr("cx", 80);
                }
                
                setTimeout(() => {
                    animateProperty();
                    setInterval(animateProperty, 6000);
                }, index * 1000);
            });
        }

        // å¹»ç¯ç‰‡20ï¼šå¸¸ç”¨å¯¹æ•°ç³»ç»Ÿå¯è§†åŒ–
        function visualizeCommonLogs(containerId) {
            const svg = d3.select("#animation5");
            if(svg.empty()) return;
            svg.selectAll("*").remove();
            
            const bounds = svg.node().getBoundingClientRect();
            const width = bounds.width, height = bounds.height;
            const centerX = width / 2;

            svg.append("text")
                .attr("x", centerX)
                .attr("y", 40)
                .attr("text-anchor", "middle")
                .style("font-size", "18px")
                .style("font-weight", "bold")
                .text("å¸¸ç”¨å¯¹æ•°ä¸è‡ªç„¶å¯¹æ•°å¯¹æ¯”");

            // å¸¸ç”¨å¯¹æ•°ç¤ºä¾‹
            const lgGroup = svg.append("g")
                .attr("transform", `translate(${width*0.1}, 80)`);
            
            lgGroup.append("text")
                .text("å¸¸ç”¨å¯¹æ•° (lg)")
                .style("font-size", "16px")
                .style("font-weight", "bold")
                .style("fill", "#e74c3c");
            
            [{input: "10", output: "1"}, {input: "100", output: "2"}, {input: "1000", output: "3"}]
                .forEach((ex, i) => {
                    const y = 30 + i * 40;
                    const g = lgGroup.append("g").style("opacity", 0);
                    
                    g.append("rect")
                        .attr("y", y)
                        .attr("width", 150)
                        .attr("height", 30)
                        .attr("fill", "#ffebee")
                        .attr("stroke", "#e74c3c")
                        .attr("rx", 5);
                    
                    g.append("text")
                        .text(`lg(${ex.input}) = ${ex.output}`)
                        .attr("x", 75)
                        .attr("y", y + 20)
                        .attr("text-anchor", "middle")
                        .style("font-size", "14px");
                    
                    g.transition()
                        .delay(500 + i * 300)
                        .duration(500)
                        .style("opacity", 1);
                });

            // è‡ªç„¶å¯¹æ•°ç¤ºä¾‹
            const lnGroup = svg.append("g")
                .attr("transform", `translate(${width*0.9 - 150}, 80)`);
            
            lnGroup.append("text")
                .text("è‡ªç„¶å¯¹æ•° (ln)")
                .style("font-size", "16px")
                .style("font-weight", "bold")
                .style("fill", "#27ae60");
            
            [{input: "e", output: "1"}, {input: "eÂ²", output: "2"}, {input: "1", output: "0"}]
                .forEach((ex, i) => {
                    const y = 30 + i * 40;
                    const g = lnGroup.append("g").style("opacity", 0);
                    
                    g.append("rect")
                        .attr("y", y)
                        .attr("width", 150)
                        .attr("height", 30)
                        .attr("fill", "#e8f5e8")
                        .attr("stroke", "#27ae60")
                        .attr("rx", 5);
                    
                    g.append("text")
                        .text(`ln(${ex.input}) = ${ex.output}`)
                        .attr("x", 75)
                        .attr("y", y + 20)
                        .attr("text-anchor", "middle")
                        .style("font-size", "14px");
                    
                    g.transition()
                        .delay(1500 + i * 300)
                        .duration(500)
                        .style("opacity", 1);
                });
        }
  /**
     * ç¬¬21é¡µï¼šå¯¹æ•°è¿ç®—æ³•åˆ™å¯è§†åŒ–
     * åŠŸèƒ½ï¼šåŠ¨ç”»æ¼”ç¤ºå¯¹æ•°è¿ç®—æ³•åˆ™çš„åº”ç”¨
     * å†…å®¹ï¼šä¹˜ç§¯ã€å•†ã€å¹‚çš„å¯¹æ•°è¿ç®—æ³•åˆ™
     * åŠ¨ç”»ï¼šæ•°å­—å˜æ¢ï¼Œè¿ç®—è¿‡ç¨‹å±•ç¤ºï¼Œæ”¯æŒæ’­æ”¾æ§åˆ¶
     * æ•™å­¦ç›®æ ‡ï¼šæŒæ¡å¯¹æ•°è¿ç®—çš„åŸºæœ¬æ³•åˆ™
     */

function visualizeLogOperations(containerId) {
        const svg = d3.select("#animation3");
        if(svg.empty()) return;
        svg.selectAll("*").remove();

        // è®¾ç½®SVGèƒŒæ™¯è‰²
        svg.append("rect")
            .attr("width", "100%")
            .attr("height", "100%")
            .attr("fill", "#ffffff");

        const width = 1100, height = 800;
        const margin = {top: 220, right: 50, bottom: 120, left: 50};
        const innerWidth = width - margin.left - margin.right;

        const g = svg.append("g").attr("transform", `translate(${margin.left}, ${margin.top})`);

        // åˆ›å»ºèƒŒæ™¯åŒºåŸŸ - å¢å¼ºå¯è§æ€§
        const upperBg = g.append("rect")
            .attr("x", -30)
            .attr("y", -60)
            .attr("width", innerWidth + 60)
            .attr("height", 100)
            .attr("fill", "#e3f2fd")
            .attr("rx", 10)
            .style("opacity", 0.8)
            .style("stroke", "#1976d2")
            .style("stroke-width", 2);

        const lowerBg = g.append("rect")
            .attr("x", -30)
            .attr("y", 90)
            .attr("width", innerWidth + 60)
            .attr("height", 100)
            .attr("fill", "#e8f5e8")
            .attr("rx", 10)
            .style("opacity", 0.8)
            .style("stroke", "#388e3c")
            .style("stroke-width", 2);

    const numbers = [2, 4, 8, 16, 32, 64, 128, 256, 512];
    const logs = [1, 2, 3, 4, 5, 6, 7, 8, 9];

        const scaleNumbers = d3.scalePoint().domain(numbers).range([0, innerWidth]).padding(0.5);
        const scaleLogs = d3.scalePoint().domain(logs).range([0, innerWidth]).padding(0.5);

        // æ•°å­—è½´
        const numberAxis = g.append("g").attr("class", "number-axis");
        numberAxis.call(d3.axisBottom(scaleNumbers));
        numberAxis.selectAll("text").style("font-size", "14px").style("font-weight", "bold");

        // ä¸ºæ•°å­—è½´æ·»åŠ èŠ‚ç‚¹ - æ˜¾ç¤º2çš„å¹‚æ¬¡æ–¹
    numbers.forEach((num, i) => {
            const nodeG = numberAxis.append("g")
                .attr("class", "number-node")
                .attr("transform", `translate(${scaleNumbers(num)}, 0)`);
            nodeG.append("circle")
                .attr("r", 18)
                .attr("cy", -30)
                .attr("fill", "#3498db")
            .attr("fill-opacity", 0.2)
                .attr("stroke", "#3498db")
            .attr("stroke-width", 2);

            // ä½¿ç”¨å¤–ç½®æ–‡æœ¬æ ‡ç­¾æ¥æ˜¾ç¤ºå…¬å¼
            const textElement = nodeG.append("foreignObject")
                .attr("x", -15)
                .attr("y", -38)
                .attr("width", 30)
                .attr("height", 20)
                .html(`<div style="font-size: 12px; text-align: center; color: #2c3e50; font-weight: bold;">$2^{${i+1}}$</div>`);

            // æ¸²æŸ“è¿™ä¸ªèŠ‚ç‚¹çš„æ•°å­¦å…¬å¼
            if (window.MathJax && window.MathJax.typesetPromise) {
                setTimeout(() => {
                    window.MathJax.typesetPromise([textElement.node()]).catch(error => {
                        console.warn('MathJax rendering failed for number node:', error);
                    });
                }, 50);
            }
        });

        // å¯¹æ•°è½´
        const logAxis = g.append("g").attr("transform", `translate(0, 150)`).attr("class", "log-axis");
        logAxis.call(d3.axisBottom(scaleLogs));
        logAxis.selectAll("text").style("font-size", "14px").style("font-weight", "bold");

        // ä¸ºå¯¹æ•°è½´æ·»åŠ èŠ‚ç‚¹
        logs.forEach(log => {
            const nodeG = logAxis.append("g")
                .attr("class", "number-node")
                .attr("transform", `translate(${scaleLogs(log)}, 0)`);
            nodeG.append("rect")
                .attr("x", -25)
                .attr("y", -42)
                .attr("width", 50)
                .attr("height", 24)
                .attr("fill", "#2ecc71")
            .attr("fill-opacity", 0.2)
                .attr("stroke", "#2ecc71")
                .attr("stroke-width", 2)
                .attr("rx", 5);

            // ä½¿ç”¨å¤–ç½®æ–‡æœ¬æ ‡ç­¾æ¥æ˜¾ç¤ºå…¬å¼
            const textElement = nodeG.append("foreignObject")
                .attr("x", -25)
                .attr("y", -38)
                .attr("width", 50)
                .attr("height", 20)
                .html(`<div style="font-size: 10px; text-align: center; color: #2c3e50; font-weight: bold;">$\\log_2(${Math.pow(2, log)})$</div>`);

            // æ¸²æŸ“è¿™ä¸ªèŠ‚ç‚¹çš„æ•°å­¦å…¬å¼
            if (window.MathJax && window.MathJax.typesetPromise) {
                setTimeout(() => {
                    window.MathJax.typesetPromise([textElement.node()]).catch(error => {
                        console.warn('MathJax rendering failed for log node:', error);
                    });
                }, 50);
            }
        });

        g.append("text")
            .attr("x", -40)
            .attr("y", -95)
            .attr("class", "world-description")
            .attr("text-anchor", "start")
            .style("font-weight", "bold")
            .text("(ä¹˜æ³•ã€é™¤æ³•ã€å¹‚è¿ç®—)");

        g.append("text")
            .attr("x", -40)
            .attr("y", 225)
            .attr("class", "world-description")
            .attr("text-anchor", "start")
            .style("font-weight", "bold")
            .text("(åŠ æ³•ã€å‡æ³•ã€ä¹˜æ³•)");

        // æ·»åŠ å‚ç›´è¿æ¥çº¿ï¼ˆè™šçº¿ï¼‰
        numbers.forEach((num, i) => {
            g.append("line")
                .attr("x1", scaleNumbers(num))
                .attr("y1", 20)
                .attr("x2", scaleLogs(logs[i]))
                .attr("y2", 130)
                .attr("stroke", "#9b59b6")
                .attr("stroke-width", 1)
                .attr("stroke-dasharray", "3,3")
                .style("opacity", 0.3);
        });

        // æ¸²æŸ“æ•°å­¦å…¬å¼
        setTimeout(async () => {
            if (window.MathJax && window.MathJax.typesetPromise) {
                try {
                    // å…ˆæ¸²æŸ“æ•´ä¸ªSVG
                    await window.MathJax.typesetPromise([svg.node()]);
                    // å†ä¸“é—¨æ¸²æŸ“SVGä¸­çš„å…¬å¼
                    await renderMathJaxInSVG(svg.node());
                } catch (error) {
                    console.warn('MathJax rendering failed:', error);
                }
            }
        }, 200);

        const operations = [
            { type: 'multiply', num1: 16, num2: 32, log1: 4, log2: 5, title: 'ä¹˜æ³•è¿ç®—', desc: '16 Ã— 32 = ?' },
            { type: 'divide', num1: 256, num2: 16, log1: 8, log2: 4, title: 'é™¤æ³•è¿ç®—', desc: '256 Ã· 16 = ?' },
            { type: 'power', num1: 8, num2: 3, log1: 3, log2: 3, title: 'å¹‚è¿ç®—', desc: '8Â³ = ?' }
        ];

        let resumeIndex = 0;
        let cycleRunning = false;

        const getSpeed = () => animationState.speed || 1;
        const scaledDuration = value => value / getSpeed();
        const scaledDelay = value => value / getSpeed();

        const waitForResume = () => Promise.resolve();

        async function animateOperation(op) {
            return new Promise(resolve => {
                svg.selectAll(".animation-element").remove();

                let logResult, numResult, opSymbol, logOpSymbol, logFormula, numFormula;
                switch(op.type) {
                    case 'multiply':
                        logResult = op.log1 + op.log2;
                        numResult = op.num1 * op.num2;
                        opSymbol = 'Ã—';
                        logOpSymbol = '+';
                        logFormula = `${op.num1}\\times ${op.num2}=2^{${op.log1}}\\times 2^{${op.log2}}=2^{(${op.log1}+${op.log2})}=2^{${logResult}}=${numResult}`;
                        numFormula = `${op.num1} \\times ${op.num2} = ${numResult}`;
                        break;
                    case 'divide':
                        logResult = op.log1 - op.log2;
                        numResult = op.num1 / op.num2;
                        opSymbol = 'Ã·';
                        logOpSymbol = 'âˆ’';
                        logFormula = `${op.num1}\\div ${op.num2}=\\frac{2^{${op.log1}}}{2^{${op.log2}}}=2^{(${op.log1}-${op.log2})}=2^{${logResult}}=${numResult}`;
                        numFormula = `${op.num1} \\div ${op.num2} = ${numResult}`;
                        break;
                    case 'power':
                        logResult = op.log1 * op.log2;
                        numResult = Math.pow(op.num1, op.num2);
                        opSymbol = '^';
                        logOpSymbol = 'Ã—';
                        logFormula = `${op.num1}^{${op.num2}}=(2^{${op.log1}})^{${op.num2}}=2^{${op.log1}\\times ${op.log2}}=2^{${logResult}}=${numResult}`;
                        numFormula = `${op.num1}^{${op.num2}} = ${numResult}`;
                        break;
                }

                const animGroup = g.append("g").attr("class", "animation-element");

                // é—®é¢˜æ¡†
                const questionBox = animGroup.append("g");
                questionBox.append("rect")
                    .attr("x", innerWidth/2 - 150)
                    .attr("y", -130)
                    .attr("width", 300)
                    .attr("height", 50)
                    .attr("class", "operation-box");

                const mainText = questionBox.append("text")
                    .attr("x", innerWidth/2)
                    .attr("y", -100)
                .attr("text-anchor", "middle")
                    .style("font-size", "24px")
                    .style("font-weight", "bold")
                    .style("fill", "#1976d2")
                    .style("text-shadow", "1px 1px 2px rgba(0,0,0,0.1)");

                async function step1() {
                    await waitForResume();
                    mainText.text(op.desc)
                .style("opacity", 0)
                        .transition().duration(scaledDuration(1000)).style("opacity", 1);
                    await new Promise(resolve => setTimeout(resolve, scaledDelay(1000)));
                }

                async function step2() {
                    await waitForResume();
                    // åˆ›å»ºç§»åŠ¨çš„åœ†ç‚¹
                    const mover1 = animGroup.append("circle")
                        .attr("r", 10)
                        .attr("fill", "#e67e22")
                        .attr("cx", scaleNumbers(op.num1))
                        .attr("cy", 0)
                        .attr("class", "highlight-path");

                    let mover2;
                    if (op.type !== 'power') {
                        mover2 = animGroup.append("circle")
                            .attr("r", 10)
                            .attr("fill", "#3498db")
                            .attr("cx", scaleNumbers(op.num2))
                            .attr("cy", 0)
                            .attr("class", "highlight-path");
                    }

                    // ä¸‹ç§»åŠ¨ç”»
                    const pathDown1 = animGroup.append("path")
                        .attr("d", `M${scaleNumbers(op.num1)},0 Q${scaleNumbers(op.num1)},75 ${scaleLogs(op.log1)},150`)
                        .attr("stroke", "#e67e22")
                        .attr("stroke-width", 2)
                .attr("fill", "none")
                        .attr("class", "highlight-path");

                    const len1 = pathDown1.node().getTotalLength();
                    pathDown1.attr("stroke-dasharray", len1 + " " + len1)
                        .attr("stroke-dashoffset", len1)
                        .transition().delay(scaledDelay(500)).duration(scaledDuration(1000)).attr("stroke-dashoffset", 0);

                    mover1.transition().delay(scaledDelay(500)).duration(scaledDuration(1000))
                        .attr("cx", scaleLogs(op.log1))
                        .attr("cy", 150);

                    if (mover2) {
                        const pathDown2 = animGroup.append("path")
                            .attr("d", `M${scaleNumbers(op.num2)},0 Q${scaleNumbers(op.num2)},75 ${scaleLogs(op.log2)},150`)
                            .attr("stroke", "#3498db")
                            .attr("stroke-width", 2)
                            .attr("fill", "none")
                            .attr("class", "highlight-path");

                        const len2 = pathDown2.node().getTotalLength();
                        pathDown2.attr("stroke-dasharray", len2 + " " + len2)
                            .attr("stroke-dashoffset", len2)
                            .transition().delay(scaledDelay(500)).duration(scaledDuration(1000)).attr("stroke-dashoffset", 0);

                        mover2.transition().delay(scaledDelay(500)).duration(scaledDuration(1000))
                            .attr("cx", scaleLogs(op.log2))
                            .attr("cy", 150);
                    }

                    await new Promise(resolve => setTimeout(resolve, scaledDelay(1500)));
                }

                async function step3() {
                    await waitForResume();
                    // æ˜¾ç¤ºå¯¹æ•°å…¬å¼
                    const formulaG = animGroup.append("g");
                    formulaG.append("rect")
                        .attr("x", innerWidth/2 - 180)
                        .attr("y", 200)
                        .attr("width", 360)
                    .attr("height", 40)
                        .attr("fill", "#e8f4f8")
                        .attr("stroke", "#2980b9")
                        .attr("stroke-width", 2)
                        .attr("rx", 8);

                    let latexFormula = (logFormula || "")
                        .replace(/Ã—/g, "\\times")
                        .replace(/Ã·/g, "\\div")
                        .replace(/âˆ’/g, "-");

                    const formulaFO = formulaG.append("foreignObject")
                        .attr("x", innerWidth/2 - 180)
                        .attr("y", 200)
                        .attr("width", 360)
                        .attr("height", 40)
                        .style("opacity", 0);

                    formulaFO.html(`<div xmlns="http://www.w3.org/1999/xhtml" style="font-size:16px;font-weight:bold;color:#2980b9;text-align:center;line-height:40px;">${latexFormula}$</div>`);

                    if (window.MathJax && window.MathJax.typesetPromise) {
                        try {
                            await window.MathJax.typesetPromise([formulaFO.node()]);
                        } catch (error) {
                            console.warn('MathJax rendering failed:', error);
                        }
                    }

                    formulaFO.transition().duration(scaledDuration(1000)).style("opacity", 1);
                    await new Promise(resolve => setTimeout(resolve, scaledDelay(1500)));
                }

                async function step4() {
                    await waitForResume();
                    // ç§»åŠ¨åˆ°ç»“æœä½ç½®
                    const mover1 = animGroup.select("circle");
                    mover1.transition().duration(scaledDuration(1000))
                        .attr("cx", scaleLogs(logResult))
                        .attr("fill", "#2ecc71");

                    const mover2 = animGroup.selectAll("circle").filter((d, i) => i === 1);
                    if (!mover2.empty()) {
                        mover2.transition().duration(scaledDuration(1000))
                            .attr("cx", scaleLogs(logResult))
                            .style("opacity", 0);
                    }

                    await new Promise(resolve => setTimeout(resolve, scaledDelay(1500)));
                }

                async function step5() {
                    await waitForResume();
                    // ä¸Šç§»åŠ¨ç”»
                    const pathUp = animGroup.append("path")
                        .attr("d", `M${scaleLogs(logResult)},150 Q${scaleLogs(logResult)},75 ${scaleNumbers(numResult)},0`)
                        .attr("stroke", "#2ecc71")
                        .attr("stroke-width", 2)
                        .attr("fill", "none")
                        .attr("class", "highlight-path");

                    const lenUp = pathUp.node().getTotalLength();
                    pathUp.attr("stroke-dasharray", lenUp + " " + lenUp)
                        .attr("stroke-dashoffset", lenUp)
                        .transition().duration(scaledDuration(1000)).attr("stroke-dashoffset", 0);

                    const mover1 = animGroup.select("circle");
                    mover1.transition().duration(scaledDuration(1000))
                        .attr("cy", 0)
                        .attr("cx", scaleNumbers(numResult));

                    await new Promise(resolve => setTimeout(resolve, scaledDelay(1000)));
                }

                async function step6() {
                    await waitForResume();
                    // æ˜¾ç¤ºæœ€ç»ˆç»“æœ
                    const resultBox = animGroup.append("g");
                    resultBox.append("rect")
                        .attr("x", innerWidth/2 + 300)
                        .attr("y", -130)
                        .attr("width", 200)
                        .attr("height", 50)
                        .attr("class", "result-box")
                        .style("opacity", 0)
                        .transition().duration(scaledDuration(1000)).style("opacity", 1);

                    resultBox.append("text")
                        .attr("x", innerWidth/2 + 400)
                        .attr("y", -100)
        .attr("text-anchor", "middle")
                        .style("font-size", "26px")
        .style("font-weight", "bold")
                        .style("fill", "white")
                        .text(`ç­”æ¡ˆ: ${numResult}`)
        .style("opacity", 0)
                        .transition().duration(scaledDuration(1000)).style("opacity", 1);

                    await new Promise(resolve => setTimeout(resolve, scaledDelay(2000)));
                    resolve();
                }

                // ä¾æ¬¡æ‰§è¡Œæ‰€æœ‰æ­¥éª¤
                (async () => {
                    await step1();
                    await step2();
                    await step3();
                    await step4();
                    await step5();
                    await step6();
                })();
            });
        }

        async function cycleAnimations(startIndex = 0) {
            if (cycleRunning) return;
            cycleRunning = true;
            animationState.cycleActive = true;

            let index = startIndex;

            while (animationState.cycleActive) {
                for (let i = index; i < operations.length; i++) {
                    if (!animationState.cycleActive) break;
                    animationState.currentOperationIndex = i;
                    await animateOperation(operations[i]);
                    if (!animationState.cycleActive) break;
                    await new Promise(resolve => setTimeout(resolve, scaledDelay(2000)));
                }
                index = 0;
            }

            cycleRunning = false;
            resumeIndex = animationState.currentOperationIndex || 0;
        }

        cycleAnimations();

        // ç¡®ä¿SVGä¸­çš„å…¬å¼æ­£ç¡®æ¸²æŸ“
        const ensureSVGMathRendering = () => {
            if (window.MathJax && window.MathJax.typesetPromise) {
                setTimeout(async () => {
                    try {
                        await renderMathJaxInSVG(svg.node());
                    } catch (error) {
                        console.warn('SVG Math rendering failed:', error);
                    }
                }, 500);
            }
        };

        // ç›‘å¬SVGå†…å®¹å˜åŒ–ï¼Œè‡ªåŠ¨é‡æ–°æ¸²æŸ“å…¬å¼
        const observer = new MutationObserver(() => {
            ensureSVGMathRendering();
        });

        observer.observe(svg.node(), {
            childList: true,
            subtree: true
        });

        const animationHandlers = {
            pause() {
                if (!animationState.cycleActive) return;
                resumeIndex = animationState.currentOperationIndex || 0;
                animationState.cycleActive = false;
                svg.selectAll("*").interrupt();
            },
            resume() {
                if (animationState.cycleActive) return;
                cycleAnimations(resumeIndex);
            },
            setSpeed(newSpeed) {
                animationState.speed = newSpeed || 1;
            },
            interrupt() {
                animationState.cycleActive = false;
                resumeIndex = 0;
                svg.selectAll("*").interrupt();
            }
        };

        return animationHandlers;
}

// å¹»ç¯ç‰‡24ï¼šå‡½æ•°æ€§è´¨ä»‹ç»å¯è§†åŒ–
function visualizePropertiesIntro(containerId) {
    const setup = setupD3(containerId);
    if (!setup) return;
    const { g, width, height } = setup;

    const properties = [
        { name: "å•è°ƒæ€§", x: width * 0.25, y: height * 0.25, color: "#e74c3c" },
        { name: "å¥‡å¶æ€§", x: width * 0.75, y: height * 0.25, color: "#3498db" },
        { name: "å‘¨æœŸæ€§", x: width * 0.25, y: height * 0.75, color: "#2ecc71" },
        { name: "æœ‰ç•Œæ€§", x: width * 0.75, y: height * 0.75, color: "#f39c12" }
    ];

    properties.forEach((prop, i) => {
        const group = g.append("g")
            .attr("transform", `translate(${prop.x}, ${prop.y})`)
            .style("opacity", 0);

        group.append("circle")
            .attr("r", 60)
            .attr("fill", prop.color)
            .attr("fill-opacity", 0.3)
            .attr("stroke", prop.color)
            .attr("stroke-width", 3);

        group.append("text")
            .attr("text-anchor", "middle")
            .attr("dy", "0.3em")
            .style("font-size", "20px")
            .style("font-weight", "bold")
            .text(prop.name);

        group.transition()
            .delay(i * 300)
            .duration(800)
            .style("opacity", 1);
    });
}

// å¹»ç¯ç‰‡25ï¼šå•è°ƒé€’å¢å¯è§†åŒ–
function visualizeMonotonicityInc(containerId) {
    const setup = setupD3(containerId);
    if (!setup) return;
    const { g, width, height } = setup;

    const xScale = d3.scaleLinear().domain([-5, 5]).range([0, width]);
    const yScale = d3.scaleLinear().domain([-5, 5]).range([height, 0]);

    drawAxes(g, xScale, yScale, width, height);

    // ç”»é€’å¢å‡½æ•° y = x
    const line = d3.line()
        .x(d => xScale(d))
        .y(d => yScale(d))
        .curve(d3.curveMonotoneX);

    const data = d3.range(-4, 4.1, 0.1);
    
    const path = g.append("path")
        .datum(data)
        .attr("d", line)
        .attr("stroke", "#2ecc71")
        .attr("stroke-width", 3)
        .attr("fill", "none");

    animatePath(path);

    // æ·»åŠ ä¸Šå‡ç®­å¤´
    g.append("text")
        .attr("x", xScale(3))
        .attr("y", yScale(3) - 20)
        .text("â†—")
        .style("font-size", "30px")
        .style("fill", "#2ecc71");
}

// å¹»ç¯ç‰‡26ï¼šå•è°ƒé€’å‡å¯è§†åŒ–
function visualizeMonotonicityDec(containerId) {
    const setup = setupD3(containerId);
    if (!setup) return;
    const { g, width, height } = setup;

    const xScale = d3.scaleLinear().domain([-5, 5]).range([0, width]);
    const yScale = d3.scaleLinear().domain([-5, 5]).range([height, 0]);

    drawAxes(g, xScale, yScale, width, height);

    // ç”»é€’å‡å‡½æ•° y = -x
    const line = d3.line()
        .x(d => xScale(d))
        .y(d => yScale(-d))
        .curve(d3.curveMonotoneX);

    const data = d3.range(-4, 4.1, 0.1);
    
    const path = g.append("path")
        .datum(data)
        .attr("d", line)
        .attr("stroke", "#e74c3c")
        .attr("stroke-width", 3)
        .attr("fill", "none");

    animatePath(path);

    // æ·»åŠ ä¸‹é™ç®­å¤´
    g.append("text")
        .attr("x", xScale(3))
        .attr("y", yScale(-3) + 40)
        .text("â†˜")
        .style("font-size", "30px")
        .style("fill", "#e74c3c");
}

// å¹»ç¯ç‰‡27ï¼šå•è°ƒåŒºé—´å¯è§†åŒ–
// å¹»ç¯ç‰‡27ï¼ˆæ˜¾ç¤ºç¬¬28é¡µï¼‰ï¼šå•è°ƒåŒºé—´å¯è§†åŒ– - å¢å¼ºç‰ˆ
function visualizeMonotonicityIntervals(containerId) {
    const setup = setupD3(containerId);
    if (!setup) return;
    const { svg, g, width, height } = setup;

    const xScale = d3.scaleLinear().domain([-4, 4]).range([40, width - 40]);
    const yScale = d3.scaleLinear().domain([-2, 10]).range([height - 40, 40]);

    // åæ ‡è½´
    drawAxes(g, xScale, yScale, width, height);

    // ç”» y = (x-1)Â²
    const data = d3.range(-3, 5, 0.05);
    const parabola = d3.line()
        .x(d => xScale(d))
        .y(d => yScale((d - 1) * (d - 1)))
        .curve(d3.curveBasis);

    // åˆ†æ®µç€è‰²
    const leftData = data.filter(d => d <= 1);
    const rightData = data.filter(d => d >= 1);

    // é€’å‡éƒ¨åˆ†ï¼ˆçº¢è‰²ï¼‰
    const leftPath = g.append("path")
        .datum(leftData)
        .attr("d", parabola)
        .attr("stroke", "#e74c3c")
        .attr("stroke-width", 4)
        .attr("fill", "none")
        .style("filter", "drop-shadow(0 2px 4px rgba(231, 76, 60, 0.3))");

    // é€’å¢éƒ¨åˆ†ï¼ˆç»¿è‰²ï¼‰
    const rightPath = g.append("path")
        .datum(rightData)
        .attr("d", parabola)
        .attr("stroke", "#2ecc71")
        .attr("stroke-width", 4)
        .attr("fill", "none")
        .style("filter", "drop-shadow(0 2px 4px rgba(46, 204, 113, 0.3))");

    // åŠ¨ç”»ç»˜åˆ¶æ›²çº¿
    [leftPath, rightPath].forEach((path, i) => {
        const totalLength = path.node().getTotalLength();
        path.attr("stroke-dasharray", totalLength)
            .attr("stroke-dashoffset", totalLength)
            .transition()
            .delay(i * 800)
            .duration(1500)
            .ease(d3.easeLinear)
            .attr("stroke-dashoffset", 0);
    });

    // è½¬æŠ˜ç‚¹ï¼ˆå¸¦è„‰å†²æ•ˆæœï¼‰
    const criticalPoint = g.append("circle")
        .attr("cx", xScale(1))
        .attr("cy", yScale(0))
        .attr("r", 0)
        .attr("fill", "#f39c12")
        .attr("stroke", "#fff")
        .attr("stroke-width", 3)
        .style("filter", "drop-shadow(0 0 10px #f39c12)");

    criticalPoint.transition()
        .delay(2500)
        .duration(800)
        .attr("r", 12);

    // è„‰å†²ç¯æ•ˆæœ
    const pulseRing = g.append("circle")
        .attr("cx", xScale(1))
        .attr("cy", yScale(0))
        .attr("r", 0)
        .attr("fill", "none")
        .attr("stroke", "#f39c12")
        .attr("stroke-width", 2)
        .attr("opacity", 0.6);

    pulseRing.transition()
        .delay(3300)
        .duration(1500)
        .attr("r", 25)
        .attr("opacity", 0)
        .transition()
        .duration(0)
        .attr("r", 0)
        .attr("opacity", 0.6)
        .on("end", function repeat() {
            d3.select(this)
                .transition()
                .duration(2000)
                .attr("r", 25)
                .attr("opacity", 0)
                .transition()
                .duration(0)
                .attr("r", 0)
                .attr("opacity", 0.6)
                .on("end", repeat);
        });

    // åŠ¨æ€æ ‡æ³¨
    const decreaseLabel = g.append("g")
        .attr("transform", `translate(${xScale(-1)}, ${yScale(6)})`);

    decreaseLabel.append("rect")
        .attr("x", -30)
        .attr("y", -15)
        .attr("width", 60)
        .attr("height", 30)
        .attr("rx", 15)
        .attr("fill", "#e74c3c")
        .attr("fill-opacity", 0.9)
        .style("opacity", 0);

    decreaseLabel.append("text")
        .attr("text-anchor", "middle")
        .attr("dy", "0.3em")
        .style("font-size", "16px")
        .style("font-weight", "bold")
        .style("fill", "white")
        .text("é€’å‡â†˜")
        .style("opacity", 0);

    const increaseLabel = g.append("g")
        .attr("transform", `translate(${xScale(2.5)}, ${yScale(6)})`);

    increaseLabel.append("rect")
        .attr("x", -30)
        .attr("y", -15)
        .attr("width", 60)
        .attr("height", 30)
        .attr("rx", 15)
        .attr("fill", "#2ecc71")
        .attr("fill-opacity", 0.9)
        .style("opacity", 0);

    increaseLabel.append("text")
        .attr("text-anchor", "middle")
        .attr("dy", "0.3em")
        .style("font-size", "16px")
        .style("font-weight", "bold")
        .style("fill", "white")
        .text("é€’å¢â†—")
        .style("opacity", 0);

    // åŠ¨ç”»æ˜¾ç¤ºæ ‡æ³¨
    [decreaseLabel, increaseLabel].forEach((label, i) => {
        label.selectAll("*")
            .transition()
            .delay(1000 + i * 400)
            .duration(600)
            .style("opacity", 1);
    });

    // è½¬æŠ˜ç‚¹æ ‡æ³¨
    const criticalLabel = g.append("g")
        .attr("transform", `translate(${xScale(1)}, ${yScale(0) + 40})`);

    criticalLabel.append("rect")
        .attr("x", -50)
        .attr("y", -12)
        .attr("width", 100)
        .attr("height", 24)
        .attr("rx", 12)
        .attr("fill", "#f39c12")
        .attr("fill-opacity", 0.9)
        .style("opacity", 0);

    criticalLabel.append("text")
        .attr("text-anchor", "middle")
        .attr("dy", "0.3em")
        .style("font-size", "14px")
        .style("font-weight", "bold")
        .style("fill", "white")
        .text("è½¬æŠ˜ç‚¹ (1, 0)")
        .style("opacity", 0);

    criticalLabel.selectAll("*")
        .transition()
        .delay(3500)
        .duration(600)
        .style("opacity", 1);

    // å‡½æ•°è¡¨è¾¾å¼
    const title = g.append("text")
        .attr("x", width/2)
        .attr("y", 30)
        .attr("text-anchor", "middle")
        .style("font-size", "24px")
        .style("font-weight", "bold")
        .style("fill", "#2c3e50")
        .text("y = (x - 1)Â²")
        .style("opacity", 0)
        .transition()
        .delay(4000)
        .duration(800)
        .style("opacity", 1);

    // æ·»åŠ äº¤äº’å¼ç‚¹
    function addInteractivePoint(x) {
        const point = g.append("circle")
            .attr("cx", xScale(x))
            .attr("cy", yScale((x - 1) * (x - 1)))
            .attr("r", 6)
            .attr("fill", "#3498db")
            .attr("stroke", "#fff")
            .attr("stroke-width", 2)
            .style("cursor", "pointer")
            .style("opacity", 0);

        point.transition()
            .delay(4500)
            .duration(500)
            .style("opacity", 1);

        // æ‚¬åœæ•ˆæœ
        point.on("mouseover", function() {
            d3.select(this)
                .transition()
                .duration(200)
                .attr("r", 10)
                .attr("fill", "#e74c3c");

            // æ˜¾ç¤ºåæ ‡
            const tooltip = g.append("text")
                .attr("x", xScale(x) + 10)
                .attr("y", yScale((x - 1) * (x - 1)) - 10)
                .style("font-size", "12px")
                .style("fill", "#2c3e50")
                .style("font-weight", "bold")
                .text(`(${x}, ${((x - 1) * (x - 1)).toFixed(2)})`)
                .style("opacity", 0);

            tooltip.transition()
                .duration(200)
                .style("opacity", 1);
        }).on("mouseout", function() {
            d3.select(this)
                .transition()
                .duration(200)
                .attr("r", 6)
                .attr("fill", "#3498db");

            g.selectAll("text").filter(function() {
                return d3.select(this).text().includes("(" + x + ",");
            }).remove();
        });
    }

    // æ·»åŠ å‡ ä¸ªå…³é”®ç‚¹
    setTimeout(() => {
        addInteractivePoint(-2);
        addInteractivePoint(0);
        addInteractivePoint(1);
        addInteractivePoint(3);
    }, 4500);

    // æ·»åŠ åˆ‡çº¿åŠ¨ç”»
    function showTangentAt(x) {
        const slope = 2 * (x - 1); // å¯¼æ•°ä¸º 2(x-1)
        const y = (x - 1) * (x - 1);
        
        // åˆ‡çº¿
        const tangentLine = g.append("line")
            .attr("x1", xScale(x - 1))
            .attr("y1", yScale(y - slope))
            .attr("x2", xScale(x + 1))
            .attr("y2", yScale(y + slope))
            .attr("stroke", "#9b59b6")
            .attr("stroke-width", 2)
            .attr("stroke-dasharray", "5, 5")
            .style("opacity", 0);

        tangentLine.transition()
            .delay(6000)
            .duration(800)
            .style("opacity", 1);

        // åˆ‡çº¿æ ‡ç­¾
        g.append("text")
            .attr("x", xScale(x + 0.5))
            .attr("y", yScale(y + slope) - 10)
            .style("font-size", "12px")
            .style("fill", "#9b59b6")
            .style("font-weight", "bold")
            .text(`æ–œç‡ = ${slope.toFixed(1)}`)
            .style("opacity", 0)
            .transition()
            .delay(6500)
            .duration(600)
            .style("opacity", 1);
    }

    // åœ¨è½¬æŠ˜ç‚¹æ˜¾ç¤ºåˆ‡çº¿
    setTimeout(() => {
        showTangentAt(1);
    }, 6000);
}

// å¹»ç¯ç‰‡28ï¼šå¥‡å¶æ€§ä»‹ç»å¯è§†åŒ–
function visualizeParityIntro(containerId) {
    const setup = setupD3(containerId);
    if (!setup) return;
    const { g, width, height } = setup;

    // å¶å‡½æ•°ç¤ºä¾‹
    const evenGroup = g.append("g")
        .attr("transform", `translate(${width * 0.25}, ${height * 0.5})`);
    
    evenGroup.append("rect")
        .attr("x", -80)
        .attr("y", -80)
        .attr("width", 160)
        .attr("height", 160)
        .attr("fill", "#3498db")
        .attr("fill-opacity", 0.2)
        .attr("stroke", "#3498db")
        .attr("stroke-width", 2);
    
    evenGroup.append("text")
        .attr("text-anchor", "middle")
        .text("å¶å‡½æ•°")
        .style("font-size", "20px");
    
    evenGroup.append("text")
        .attr("y", 30)
        .attr("text-anchor", "middle")
        .text("Yè½´å¯¹ç§°")
        .style("font-size", "16px")
        .style("fill", "#666");

    // å¥‡å‡½æ•°ç¤ºä¾‹
    const oddGroup = g.append("g")
        .attr("transform", `translate(${width * 0.75}, ${height * 0.5})`);
    
    oddGroup.append("circle")
        .attr("r", 80)
        .attr("fill", "#e74c3c")
        .attr("fill-opacity", 0.2)
        .attr("stroke", "#e74c3c")
        .attr("stroke-width", 2);
    
    oddGroup.append("text")
        .attr("text-anchor", "middle")
        .text("å¥‡å‡½æ•°")
        .style("font-size", "20px");
    
    oddGroup.append("text")
        .attr("y", 30)
        .attr("text-anchor", "middle")
        .text("åŸç‚¹å¯¹ç§°")
        .style("font-size", "16px")
        .style("fill", "#666");
}

// å¹»ç¯ç‰‡29ï¼šå¶å‡½æ•°å¯è§†åŒ–
function visualizeEvenFunction(containerId) {
    const setup = setupD3(containerId);
    if (!setup) return;
    const { g, width, height } = setup;

    const xScale = d3.scaleLinear().domain([-5, 5]).range([0, width]);
    const yScale = d3.scaleLinear().domain([-2, 10]).range([height, 0]);

    drawAxes(g, xScale, yScale, width, height);

    // ç”» y = x^2 (å¶å‡½æ•°)
    const data = d3.range(-4, 4.1, 0.1);
    const line = d3.line()
        .x(d => xScale(d))
        .y(d => yScale(d * d))
        .curve(d3.curveBasis);

    const path = g.append("path")
        .datum(data)
        .attr("d", line)
        .attr("stroke", "#3498db")
        .attr("stroke-width", 3)
        .attr("fill", "none");

    animatePath(path);

    // æ ‡è®°å¯¹ç§°ç‚¹
    [-2, 2].forEach(x => {
        g.append("circle")
            .attr("cx", xScale(x))
            .attr("cy", yScale(x * x))
            .attr("r", 5)
            .attr("fill", "#e74c3c");
    });

    // Yè½´å¯¹ç§°çº¿
    g.append("line")
        .attr("x1", xScale(0))
        .attr("y1", 0)
        .attr("x2", xScale(0))
        .attr("y2", height)
        .attr("stroke", "#e74c3c")
        .attr("stroke-width", 2)
        .attr("stroke-dasharray", "5, 5");
}

// å¹»ç¯ç‰‡30ï¼šå¥‡å‡½æ•°å¯è§†åŒ–
function visualizeOddFunction(containerId) {
    const setup = setupD3(containerId);
    if (!setup) return;
    const { g, width, height } = setup;

    const xScale = d3.scaleLinear().domain([-5, 5]).range([0, width]);
    const yScale = d3.scaleLinear().domain([-5, 5]).range([height, 0]);

    drawAxes(g, xScale, yScale, width, height);

    // ç”» y = x^3 (å¥‡å‡½æ•°)
    const data = d3.range(-2, 2.1, 0.1);
    const line = d3.line()
        .x(d => xScale(d))
        .y(d => yScale(d * d * d))
        .curve(d3.curveBasis);

    const path = g.append("path")
        .datum(data)
        .attr("d", line)
        .attr("stroke", "#e74c3c")
        .attr("stroke-width", 3)
        .attr("fill", "none");

    animatePath(path);

    // æ ‡è®°å¯¹ç§°ç‚¹
    [-1.5, 1.5].forEach(x => {
        g.append("circle")
            .attr("cx", xScale(x))
            .attr("cy", yScale(x * x * x))
            .attr("r", 5)
            .attr("fill", "#3498db");
    });

    // åŸç‚¹
    g.append("circle")
        .attr("cx", xScale(0))
        .attr("cy", yScale(0))
        .attr("r", 6)
        .attr("fill", "#f39c12")
        .attr("stroke", "#333")
        .attr("stroke-width", 2);
}

// å¹»ç¯ç‰‡31ï¼šæœ‰ç•Œæ€§å¯è§†åŒ–
function visualizeBoundedness(containerId) {
    const setup = setupD3(containerId);
    if (!setup) return;
    const { g, width, height } = setup;

    const xScale = d3.scaleLinear().domain([-10, 10]).range([0, width]);
    const yScale = d3.scaleLinear().domain([-2, 2]).range([height, 0]);

    drawAxes(g, xScale, yScale, width, height);

    // ç”» sin(x)
    const data = d3.range(-10, 10.1, 0.1);
    const line = d3.line()
        .x(d => xScale(d))
        .y(d => yScale(Math.sin(d)))
        .curve(d3.curveBasis);

    const path = g.append("path")
        .datum(data)
        .attr("d", line)
        .attr("stroke", "#3498db")
        .attr("stroke-width", 3)
        .attr("fill", "none");

    // ä¸Šç•Œçº¿
    g.append("line")
        .attr("x1", 0)
        .attr("y1", yScale(1))
        .attr("x2", width)
        .attr("y2", yScale(1))
        .attr("stroke", "#e74c3c")
        .attr("stroke-width", 2)
        .attr("stroke-dasharray", "10, 5");

    // ä¸‹ç•Œçº¿
    g.append("line")
        .attr("x1", 0)
        .attr("y1", yScale(-1))
        .attr("x2", width)
        .attr("y2", yScale(-1))
        .attr("stroke", "#e74c3c")
        .attr("stroke-width", 2)
        .attr("stroke-dasharray", "10, 5");

    // æ ‡æ³¨
    g.append("text")
        .attr("x", width - 50)
        .attr("y", yScale(1) - 10)
        .text("ä¸Šç•Œ: 1")
        .style("fill", "#e74c3c");

    g.append("text")
        .attr("x", width - 50)
        .attr("y", yScale(-1) + 20)
        .text("ä¸‹ç•Œ: -1")
        .style("fill", "#e74c3c");
}

// å¹»ç¯ç‰‡32ï¼šåå‡½æ•°æœºå™¨å¯è§†åŒ–
// å¹»ç¯ç‰‡32ï¼ˆæ˜¾ç¤ºç¬¬33é¡µï¼‰ï¼šåå‡½æ•°æœºå™¨å¯è§†åŒ– - å¢å¼ºç‰ˆ
// å¹»ç¯ç‰‡32ï¼ˆæ˜¾ç¤ºç¬¬33é¡µï¼‰ï¼šåå‡½æ•°æœºå™¨å¯è§†åŒ– - ä¿®å¤ç‰ˆ
function visualizeInverseMachine(containerId) {
    const setup = setupD3(containerId);
    if (!setup) return;
    const { svg, g, width, height } = setup;

    // æ¸…é™¤ä¹‹å‰çš„å†…å®¹
    g.selectAll("*").remove();

    // æ ‡é¢˜
    const titleFO = g.append("foreignObject")
        .attr("x", 0)
        .attr("y", 0)
        .attr("width", width)
        .attr("height", 60)
        .html(`<div style="text-align: center; font-size: 30px; font-weight: bold; color: #2c3e50; padding-top: 20px;">
            åå‡½æ•°ï¼šäº’é€†çš„æ“ä½œ
        </div>`);

    const centerY = height / 2;

    // æœºå™¨1ï¼šæ­£å‘å‡½æ•°
    const machine1 = g.append("g")
        .attr("transform", `translate(${width * 0.25}, ${centerY})`);

    const box1 = machine1.append("rect")
        .attr("x", -80)
        .attr("y", -60)
        .attr("width", 160)
        .attr("height", 120)
        .attr("rx", 15)
        .attr("fill", "#3498db")
        .attr("stroke", "#fff")
        .attr("stroke-width", 3)
        .style("filter", "drop-shadow(0 4px 8px rgba(0,0,0,0.2))")
        .style("opacity", 0);

    box1.transition()
        .duration(800)
        .style("opacity", 1);

    const machine1FO = machine1.append("foreignObject")
        .attr("x", -70)
        .attr("y", -40)
        .attr("width", 140)
        .attr("height", 80)
        .html(`<div style="text-align: center; color: white;">
            <div style="font-size: 24px; font-weight: bold; margin-bottom: 10px;">$f(x)$</div>
            <div style="font-size: 18px;">$y = 2x + 3$</div>
        </div>`)
        .style("opacity", 0);

    machine1FO.transition()
        .delay(200)
        .duration(600)
        .style("opacity", 1);

    // æœºå™¨2ï¼šåå‡½æ•°
    const machine2 = g.append("g")
        .attr("transform", `translate(${width * 0.75}, ${centerY})`);

    const box2 = machine2.append("rect")
        .attr("x", -80)
        .attr("y", -60)
        .attr("width", 160)
        .attr("height", 120)
        .attr("rx", 15)
        .attr("fill", "#e74c3c")
        .attr("stroke", "#fff")
        .attr("stroke-width", 3)
        .style("filter", "drop-shadow(0 4px 8px rgba(0,0,0,0.2))")
        .style("opacity", 0);

    box2.transition()
        .delay(400)
        .duration(800)
        .style("opacity", 1);

    const machine2FO = machine2.append("foreignObject")
        .attr("x", -70)
        .attr("y", -40)
        .attr("width", 140)
        .attr("height", 180)
        .html(`<div style="text-align: center; color: white;">
            <div style="font-size: 24px; font-weight: bold; margin-bottom: 10px;">$f^{-1}(x)$</div>
            <div style="font-size: 18px;">$x = \\frac{y-3}{2}$</div>
        </div>`)
        .style("opacity", 0);

    machine2FO.transition()
        .delay(600)
        .duration(600)
        .style("opacity", 1);

    // åŠ¨ç”»æ¼”ç¤º
    function animateInverse() {
        const inputValue = 2;
        const outputValue = 2 * inputValue + 3; // f(2) = 7
        
        // åˆ›å»ºæ•°å­—å°çƒ
        const ball = g.append("g")
            .attr("class", "demo-ball");

        const circle = ball.append("circle")
            .attr("cx", width * 0.1)
            .attr("cy", centerY)
            .attr("r", 25)
            .attr("fill", "#2c3e50")
            .style("opacity", 0);

        const ballText = ball.append("text")
            .attr("x", width * 0.1)
            .attr("y", centerY)
            .attr("text-anchor", "middle")
            .attr("dy", "0.3em")
            .style("font-size", "18px")
            .style("font-weight", "bold")
            .style("fill", "white")
            .text(inputValue)
            .style("opacity", 0);

        // æ˜¾ç¤ºè¾“å…¥
        circle.transition().duration(400).style("opacity", 1);
        ballText.transition().duration(400).style("opacity", 1);

        // åç»­åŠ¨ç”»é€»è¾‘...
    }

    // åº•éƒ¨è¯´æ˜
    const explanationFO = g.append("foreignObject")
        .attr("x", 50)
        .attr("y", height - 60)
        .attr("width", width - 100)
        .attr("height", 50)
        .html(`<div style="text-align: center; font-size: 18px; color: #7f8c8d;">
            <strong>å…³é”®æ€§è´¨ï¼š</strong> $f(f^{-1}(x)) = x$ ä¸” $f^{-1}(f(x)) = x$
        </div>`)
                        .style("opacity", 0);

    explanationFO.transition()
        .delay(3000)
        .duration(1000)
        .style("opacity", 1);

    // æ¸²æŸ“MathJax
    setTimeout(() => {
        renderMathJaxInContainer(containerId);
    }, 100);
}

// å¹»ç¯ç‰‡33ï¼šåå‡½æ•°å›¾åƒå¯è§†åŒ–
function visualizeInverseGraph(containerId) {
    const setup = setupD3(containerId);
    if (!setup) return;
    const { g, width, height } = setup;

    const xScale = d3.scaleLinear().domain([-5, 5]).range([0, width]);
    const yScale = d3.scaleLinear().domain([-5, 5]).range([height, 0]);

    drawAxes(g, xScale, yScale, width, height);

    // y = x å¯¹ç§°çº¿
    g.append("line")
        .attr("x1", xScale(-5))
        .attr("y1", yScale(-5))
        .attr("x2", xScale(5))
        .attr("y2", yScale(5))
        .attr("stroke", "#95a5a6")
        .attr("stroke-width", 2)
        .attr("stroke-dasharray", "5, 5");

    // åŸå‡½æ•° y = 2x
    const data = d3.range(-2.5, 2.6, 0.1);
    const lineF = d3.line()
        .x(d => xScale(d))
        .y(d => yScale(2 * d));

    g.append("path")
        .datum(data)
        .attr("d", lineF)
        .attr("stroke", "#3498db")
        .attr("stroke-width", 3)
        .attr("fill", "none");

    // åå‡½æ•° y = x/2
    const lineInv = d3.line()
        .x(d => xScale(d))
        .y(d => yScale(d / 2));

    g.append("path")
        .datum(data)
        .attr("d", lineInv)
        .attr("stroke", "#e74c3c")
        .attr("stroke-width", 3)
        .attr("fill", "none");

    // æ ‡æ³¨
    g.append("text")
        .attr("x", xScale(2))
        .attr("y", yScale(4) - 10)
        .text("f(x) = 2x")
        .style("fill", "#3498db");

    g.append("text")
        .attr("x", xScale(4))
        .attr("y", yScale(2) + 20)
        .text("fâ»Â¹(x) = x/2")
        .style("fill", "#e74c3c");
}

// å¹»ç¯ç‰‡35ï¼šå¤åˆå‡½æ•°æœºå™¨å¯è§†åŒ–
// å¹»ç¯ç‰‡35ï¼ˆæ˜¾ç¤ºç¬¬36é¡µï¼‰ï¼šå¤åˆå‡½æ•°æœºå™¨å¯è§†åŒ– - å¢å¼ºç‰ˆ
function visualizeCompositeMachine(containerId) {
    const setup = setupD3(containerId);
    if (!setup) return;
    const { svg, g, width, height } = setup;

    const centerY = height / 2;

    // ä¸‰ä¸ªå¤„ç†é˜¶æ®µ
    const stages = [
        { x: width * 0.15, label: "è¾“å…¥", formula: "x", color: "#95a5a6", isIO: true },
        { x: width * 0.35, label: "å†…å±‚å‡½æ•°", formula: "g(x) = x + 1", color: "#3498db", isIO: false },
        { x: width * 0.55, label: "å¤–å±‚å‡½æ•°", formula: "f(u) = uÂ²", color: "#e74c3c", isIO: false },
        { x: width * 0.75, label: "è¾“å‡º", formula: "y", color: "#2ecc71", isIO: true }
    ];

    stages.forEach((stage, i) => {
        const stageGroup = g.append("g")
            .attr("transform", `translate(${stage.x}, ${centerY})`);

        if (stage.isIO) {
            // è¾“å…¥è¾“å‡ºç”¨åœ†å½¢
            stageGroup.append("circle")
                .attr("r", 50)
                .attr("fill", stage.color)
                .attr("fill-opacity", 0.2)
                .attr("stroke", stage.color)
                .attr("stroke-width", 3)
                .style("filter", "drop-shadow(0 2px 4px rgba(0,0,0,0.1))");

            stageGroup.append("text")
                .attr("text-anchor", "middle")
                .attr("dy", "0.3em")
                .style("font-size", "24px")
                .style("font-weight", "bold")
                .style("fill", stage.color)
                .text(stage.formula);
        } else {
            // å‡½æ•°ç”¨çŸ©å½¢
            stageGroup.append("rect")
                .attr("x", -70)
                .attr("y", -50)
                .attr("width", 140)
                .attr("height", 200)
                .attr("rx", 15)
                .attr("fill", stage.color)
                .attr("stroke", "#fff")
                .attr("stroke-width", 2)
                .style("filter", "drop-shadow(0 4px 8px rgba(0,0,0,0.2))");

            stageGroup.append("text")
                .attr("text-anchor", "middle")
                .attr("y", -15)
                .style("font-size", "18px")
                .style("font-weight", "bold")
                .style("fill", "white")
                .text(stage.label);

            stageGroup.append("text")
                .attr("text-anchor", "middle")
                .attr("y", 15)
                .style("font-size", "16px")
                .style("fill", "white")
                .text(stage.formula);
        }
    });

    // è¿æ¥çº¿
    for (let i = 0; i < stages.length - 1; i++) {
        const x1 = stages[i].x + (stages[i].isIO ? 50 : 70);
        const x2 = stages[i + 1].x - (stages[i + 1].isIO ? 50 : 70);
        
        const line = g.append("line")
            .attr("x1", x1)
            .attr("y1", centerY)
            .attr("x2", x2)
            .attr("y2", centerY)
            .attr("stroke", "#7f8c8d")
            .attr("stroke-width", 3)
            .attr("stroke-dasharray", "5, 5")
            .style("opacity", 0.8);

        // æµåŠ¨åŠ¨ç”»
        line.transition()
            .delay(i * 500)
            .duration(2000)
            .attr("stroke-dashoffset", -20)
            .transition()
            .duration(2000)
            .attr("stroke-dashoffset", 0)
            .on("end", function repeat() {
                d3.select(this)
                    .transition()
                    .duration(2000)
                    .attr("stroke-dashoffset", -20)
                    .transition()
                    .duration(2000)
                    .attr("stroke-dashoffset", 0)
                    .on("end", repeat);
            });
    }

    // åŠ¨ç”»æ¼”ç¤º
    function animateComposition() {
        const value = Math.floor(Math.random() * 4) + 1;
        
        // æ˜¾ç¤ºåˆå§‹å€¼
        const valueText = g.append("text")
            .attr("x", stages[0].x)
            .attr("y", centerY - 80)
            .attr("text-anchor", "middle")
            .style("font-size", "32px")
            .style("font-weight", "bold")
            .style("fill", "#2c3e50")
            .text(value)
            .style("opacity", 0);

        valueText.transition()
            .duration(500)
            .style("opacity", 1);

        // ç»è¿‡g(x)
        setTimeout(() => {
            const intermediate = value + 1;
            valueText.transition()
                .duration(800)
                .attr("x", stages[1].x)
                .text(`${value} â†’ ${intermediate}`)
                .style("fill", "#3498db");
        }, 1000);

        // ç»è¿‡f(u)
        setTimeout(() => {
            const intermediate = value + 1;
            const final = intermediate * intermediate;
            valueText.transition()
                .duration(800)
                .attr("x", stages[2].x)
                .text(`${intermediate} â†’ ${final}`)
                .style("fill", "#e74c3c");
        }, 2200);

        // æœ€ç»ˆç»“æœ
        setTimeout(() => {
            const final = (value + 1) * (value + 1);
            valueText.transition()
                .duration(800)
                .attr("x", stages[3].x)
                .text(final)
                .style("fill", "#2ecc71");

            // æ˜¾ç¤ºå®Œæ•´å…¬å¼
            const formula = g.append("g")
                .attr("transform", `translate(${width/2}, ${centerY + 120})`);

            formula.append("rect")
                .attr("x", -200)
                .attr("y", -20)
                .attr("width", 400)
                .attr("height", 40)
                .attr("rx", 10)
                .attr("fill", "#f8f9fa")
                .attr("stroke", "#6c757d")
                .attr("stroke-width", 2)
                .style("opacity", 0);

            formula.append("text")
                .attr("text-anchor", "middle")
                .style("font-size", "20px")
                .style("font-weight", "bold")
                .style("fill", "#495057")
                .text(`f(g(${value})) = (${value} + 1)Â² = ${final}`)
                .style("opacity", 0);

            formula.selectAll("*")
                .transition()
                .duration(800)
                .style("opacity", 1)
                .transition()
                .delay(2000)
                .duration(500)
                .style("opacity", 0)
                .remove();
        }, 3400);

        // æ¸…é™¤
        setTimeout(() => {
            valueText.transition()
                .duration(500)
                .style("opacity", 0)
                .remove();
        }, 6000);
    }

    // å¼€å§‹åŠ¨ç”»å¾ªç¯
    setTimeout(() => animateComposition(), 1000);
    setInterval(animateComposition, 7000);

    // æ ‡é¢˜
    g.append("text")
        .attr("x", width/2)
        .attr("y", 40)
        .attr("text-anchor", "middle")
        .style("font-size", "28px")
        .style("font-weight", "bold")
        .style("fill", "#2c3e50")
        .text("å¤åˆå‡½æ•°ï¼šå±‚å±‚å¤„ç†")
        .style("opacity", 0)
        .transition()
        .duration(1000)
        .style("opacity", 1);

    // è¯´æ˜æ–‡å­—
    g.append("text")
        .attr("x", width/2)
        .attr("y", height - 40)
        .attr("text-anchor", "middle")
        .style("font-size", "18px")
        .style("fill", "#7f8c8d")
        .style("font-weight", "bold")
        .text("å¤åˆå‡½æ•°ï¼šå…ˆæ‰§è¡Œå†…å±‚å‡½æ•°ï¼Œå†ç”¨ç»“æœæ‰§è¡Œå¤–å±‚å‡½æ•°")
        .style("opacity", 0)
        .transition()
        .delay(2000)
        .duration(1000)
        .style("opacity", 1);
}







        function visualizeInteractiveExponential(containerId) {
            const setup = setupD3(containerId, {top: 60, right: 40, bottom: 60, left: 50});
            if (!setup) return;
            const { container, svg, g, width, height } = setup;

            // Add title
            svg.append('text')
                .attr('x', width / 2 + 50)
                .attr('y', 30)
                .attr('text-anchor', 'middle')
                .style('font-size', '20px')
                .style('font-weight', 'bold')
                .text('æŒ‡æ•°å‡½æ•° y = a^x');

            const xScale = d3.scaleLinear().domain([-4, 4]).range([0, width]);
            const yScale = d3.scaleLinear().domain([-1, 8]).range([height, 0]);

            // Draw axes
            g.append('g')
                .attr('transform', `translate(0, ${yScale(0)})`)
                .call(d3.axisBottom(xScale).ticks(8))
                .call(sel => sel.select('.domain').attr('stroke-width', 1.5));
            g.append('g')
                .attr('transform', `translate(${xScale(0)}, 0)`)
                .call(d3.axisLeft(yScale).ticks(8))
                .call(sel => sel.select('.domain').attr('stroke-width', 1.5));

            // Slider
            const sliderContainer = container.append('div')
                .style('position', 'absolute')
                .style('bottom', '20px')
                .style('left', '50%')
                .style('transform', 'translateX(-50%)')
                .style('background', 'rgba(255, 255, 255, 0.9)')
                .style('padding', '10px')
                .style('border-radius', '8px')
                .style('box-shadow', '0 2px 8px rgba(0,0,0,0.15)');

            sliderContainer.append('label').text('åº•æ•° a: ').style('color', 'black');
            const slider = sliderContainer.append('input')
                .attr('type', 'range')
                .attr('min', 0.2)
                .attr('max', 4)
                .attr('step', 0.1)
                .attr('value', 2);
            const label = sliderContainer.append('span').text('2.0').style('color', 'black').style('font-weight', 'bold');

            const path = g.append("path")
                .attr("fill", "none")
                .attr("stroke-width", 3);

            const fixedPointLabel = g.append('text')
                .attr('x', xScale(0) + 5)
                .attr('y', yScale(1) - 5)
                .style('font-size', '12px')
                .text('æ’è¿‡ç‚¹ (0, 1)');

            g.append('circle')
                .attr('cx', xScale(0))
                .attr('cy', yScale(1))
                .attr('r', 5)
                .attr('fill', 'var(--accent-color)');

            function update(a) {
                label.text(a.toFixed(1));
                
                let description = '';
                if (a > 1) {
                    path.attr("stroke", "var(--danger-color)");
                    description = 'a > 1, å‡½æ•°å•è°ƒé€’å¢';
                } else if (a === 1) {
                    path.attr("stroke", "var(--info-color)");
                    description = 'a = 1, å‡½æ•°ä¸º y=1';
                } else { // 0 < a < 1
                    path.attr("stroke", "var(--success-color)");
                    description = '0 < a < 1, å‡½æ•°å•è°ƒé€’å‡';
                }
                
                // Update description text
                svg.selectAll('.desc-text').remove();
                svg.append('text')
                    .attr('class', 'desc-text')
                    .attr('x', width / 2 + 50)
                    .attr('y', height - 5)
                    .attr('text-anchor', 'middle')
                    .style('font-size', '14px')
                    .style('fill', '#555')
                    .text(description);

                const line = d3.line()
                    .x(d => xScale(d))
                    .y(d => yScale(Math.pow(a, d)));

                const data = d3.range(-4, 4.1, 0.1);
                path.datum(data).attr("d", line);
            }

            update(2);
            slider.on('input', function() {
                update(+this.value);
            });
        }

        function visualizeInteractiveLogarithm(containerId) {
            const setup = setupD3(containerId, {top: 60, right: 40, bottom: 60, left: 50});
            if (!setup) return;
            const { container, svg, g, width, height } = setup;

            svg.append('text')
                .attr('x', width / 2 + 50)
                .attr('y', 30)
                .attr('text-anchor', 'middle')
                .style('font-size', '20px')
                .style('font-weight', 'bold')
                .text('å¯¹æ•°å‡½æ•° y = logâ‚(x)');

            const xScale = d3.scaleLinear().domain([-1, 8]).range([0, width]);
            const yScale = d3.scaleLinear().domain([-4, 4]).range([height, 0]);

            g.append('g')
                .attr('transform', `translate(0, ${yScale(0)})`)
                .call(d3.axisBottom(xScale).ticks(8))
                .call(sel => sel.select('.domain').attr('stroke-width', 1.5));
            g.append('g')
                .attr('transform', `translate(${xScale(0)}, 0)`)
                .call(d3.axisLeft(yScale).ticks(8))
                .call(sel => sel.select('.domain').attr('stroke-width', 1.5));

            const sliderContainer = container.append('div')
                .style('position', 'absolute')
                .style('bottom', '20px')
                .style('left', '50%')
                .style('transform', 'translateX(-50%)')
                .style('background', 'rgba(255, 255, 255, 0.9)')
                .style('padding', '10px')
                .style('border-radius', '8px')
                .style('box-shadow', '0 2px 8px rgba(0,0,0,0.15)');

            sliderContainer.append('label').text('åº•æ•° a: ').style('color', 'black');
            const slider = sliderContainer.append('input')
                .attr('type', 'range')
                .attr('min', 0.2)
                .attr('max', 4)
                .attr('step', 0.1)
                .attr('value', 2);
            const label = sliderContainer.append('span').text('2.0').style('color', 'black').style('font-weight', 'bold');

            const path = g.append("path")
                .attr("fill", "none")
                .attr("stroke-width", 3);
                
            const fixedPointLabel = g.append('text')
                .attr('x', xScale(1) + 5)
                .attr('y', yScale(0) - 5)
                .style('font-size', '12px')
                .text('æ’è¿‡ç‚¹ (1, 0)');

            g.append('circle')
                .attr('cx', xScale(1))
                .attr('cy', yScale(0))
                .attr('r', 5)
                .attr('fill', 'var(--accent-color)');

            function update(a) {
                label.text(a.toFixed(1));
                path.style('opacity', 1);

                let description = '';
                if (a > 1) {
                    path.attr("stroke", "var(--danger-color)");
                    description = 'a > 1, å‡½æ•°å•è°ƒé€’å¢';
                } else if (a === 1) {
                    path.style('opacity', 0); // log base 1 is undefined
                    description = 'a = 1, å¯¹æ•°å‡½æ•°æ— æ„ä¹‰';
                } else { // 0 < a < 1
                    path.attr("stroke", "var(--success-color)");
                    description = '0 < a < 1, å‡½æ•°å•è°ƒé€’å‡';
                }

                svg.selectAll('.desc-text').remove();
                svg.append('text')
                    .attr('class', 'desc-text')
                    .attr('x', width / 2 + 50)
                    .attr('y', height - 5)
                    .attr('text-anchor', 'middle')
                    .style('font-size', '14px')
                    .style('fill', '#555')
                    .text(description);

                if (a === 1) return;

                const line = d3.line()
                    .x(d => xScale(d))
                    .y(d => yScale(Math.log(d) / Math.log(a)));

                const data = d3.range(0.01, 8.1, 0.01);
                path.datum(data).attr("d", line);
            }

            update(2);
            slider.on('input', function() {
                update(+this.value);
            });
        }

        function visualizeInteractiveTrig(containerId) {
            const container = d3.select(`#${containerId}`);
            if (container.empty()) {
                console.error("Container not found:", containerId);
                return null;
            }
            container.html('');
            container.style('touch-action', 'none');

            const width = container.node().clientWidth;
            const height = container.node().clientHeight;
            const margin = {top: 40, right: 20, bottom: 40, left: 20};
            
            const plotSize = Math.min(width - margin.left - margin.right, height - margin.top - margin.bottom);
            const radius = plotSize / 2.5;

            const svg = container.append('svg')
                .attr('width', width)
                .attr('height', height);

            const g = svg.append('g')
                .attr('transform', `translate(${width / 2}, ${height / 2})`);

            const xScale = d3.scaleLinear().domain([-1.5, 1.5]).range([-radius * 1.5, radius * 1.5]);
            const yScale = d3.scaleLinear().domain([-1.5, 1.5]).range([radius * 1.5, -radius * 1.5]);

            // Grid lines
            const grid = g.append('g').attr('class', 'grid');
            grid.selectAll('.x-grid')
                .data(yScale.ticks(10))
                .enter().append('line')
                .attr('class', 'x-grid')
                .attr('x1', xScale.range()[0])
                .attr('x2', xScale.range()[1])
                .attr('y1', d => yScale(d))
                .attr('y2', d => yScale(d))
                .attr('stroke', '#e0e0e0')
                .attr('stroke-width', 0.5);

            grid.selectAll('.y-grid')
                .data(xScale.ticks(10))
                .enter().append('line')
                .attr('class', 'y-grid')
                .attr('x1', d => xScale(d))
                .attr('x2', d => xScale(d))
                .attr('y1', yScale.range()[0])
                .attr('y2', yScale.range()[1])
                .attr('stroke', '#e0e0e0')
                .attr('stroke-width', 0.5);

            // Axes
            const xAxis = g.append('g').attr('class', 'axis x-axis').call(d3.axisBottom(xScale).ticks(5));
            const yAxis = g.append('g').attr('class', 'axis y-axis').call(d3.axisLeft(yScale).ticks(5));
            xAxis.select('.domain').attr('stroke-width', 1.5);
            yAxis.select('.domain').attr('stroke-width', 1.5);

            // Unit circle
            g.append('circle')
                .attr('r', radius)
                .attr('fill', 'rgba(200, 200, 200, 0.1)')
                .attr('stroke', '#888');

            const angleArc = d3.arc().innerRadius(0).outerRadius(radius * 0.3);
            const anglePath = g.append('path').attr('fill', 'rgba(0,0,0,0.1)');
            const angleLabel = g.append('text').attr('class', 'angle-label').attr('dy', '0.35em');

            const angleLine = g.append('line').attr('x1', 0).attr('y1', 0).attr('stroke', '#555').attr('stroke-width', 2);
            const sineLine = g.append('line').attr('stroke', 'var(--danger-color)').attr('stroke-width', 2.5);
            const cosineLine = g.append('line').attr('stroke', 'var(--primary-color)').attr('stroke-width', 2.5);
            
            const sineLabel = g.append('text').attr('class', 'label sine-label').style('fill', 'var(--danger-color)');
            const cosineLabel = g.append('text').attr('class', 'label cosine-label').style('fill', 'var(--primary-color)');

            const draggablePoint = g.append('circle').attr('r', 8).attr('fill', 'var(--accent-color)').style('cursor', 'pointer');
            const infoBox = d3.select('#trig-info-box');

            function update(angle) {
                const x = radius * Math.cos(angle);
                const y = -radius * Math.sin(angle); // y is inverted in SVG

                draggablePoint.attr('cx', x).attr('cy', y);
                angleLine.attr('x2', x).attr('y2', y);

                sineLine.attr('x1', x).attr('y1', y).attr('x2', x).attr('y2', 0);
                cosineLine.attr('x1', x).attr('y1', 0).attr('x2', 0).attr('y2', 0);

                sineLabel.attr('x', x + 5).attr('y', y / 2).text('sin(Î¸)');
                cosineLabel.attr('x', x / 2).attr('y', -5).text('cos(Î¸)');

                anglePath.attr('d', angleArc({startAngle: 0, endAngle: -angle}));
                const [angleX, angleY] = angleArc.centroid({startAngle: 0, endAngle: -angle});
                angleLabel.attr('x', angleX).attr('y', angleY).text(`${(-angle * 180 / Math.PI).toFixed(0)}Â°`);

                infoBox.html(
                    `<strong>Angle (Î¸):</strong> ${(-angle * 180 / Math.PI).toFixed(1)}Â° / ${(-angle).toFixed(2)} rad<br>` +
                    `<strong class="color-cosine">Cosine:</strong> ${Math.cos(angle).toFixed(3)}<br>` +
                    `<strong class="color-sine">Sine:</strong> ${Math.sin(angle).toFixed(3)}<br>`
                );
                renderMathJax(infoBox.node());
            }

            const drag = d3.drag().on('drag', function(event) {
                const angle = Math.atan2(-event.y, event.x);
                update(angle);
            });

            draggablePoint.call(drag);
            update(-Math.PI / 4);
        }

        // å…­ç§ä¸‰è§’ä¸ä½™å‡½æ•°å›¾åƒæ€»è§ˆ
        function visualizeTrigAll(containerId) {
            const setup = setupD3(containerId, {top: 50, right: 40, bottom: 50, left: 50});
            if (!setup) return;
            const { svg, g, width, height } = setup;

            const xScale = d3.scaleLinear().domain([-Math.PI * 2, Math.PI * 2]).range([0, width]);
            const yScale = d3.scaleLinear().domain([-2.2, 2.2]).range([height, 0]);

            // åæ ‡è½´
            g.append('g').attr('transform', `translate(0, ${yScale(0)})`)
                .call(d3.axisBottom(xScale)
                    .ticks(9)
                    .tickFormat(d => {
                        const k = Math.round(d / (Math.PI / 2));
                        const map = {
                            '-4': '-2Ï€','-3': '-3Ï€/2','-2': '-Ï€','-1': '-Ï€/2','0': '0','1': 'Ï€/2','2': 'Ï€','3': '3Ï€/2','4': '2Ï€'
                        };
                        return map[String(k)] ?? '';
                    })
                );
            g.append('g').call(d3.axisLeft(yScale).tickValues([-2,-1,0,1,2]));

            const funcs = [
                { key: 'sin', color: 'var(--danger-color)', f: x => Math.sin(x) },
                { key: 'cos', color: 'var(--primary-color)', f: x => Math.cos(x) },
                { key: 'tan', color: '#8e44ad', f: x => Math.tan(x), clip: true },
                { key: 'csc', color: '#16a085', f: x => 1/Math.sin(x), clip: true },
                { key: 'sec', color: '#d35400', f: x => 1/Math.cos(x), clip: true },
                { key: 'cot', color: '#2c3e50', f: x => 1/Math.tan(x), clip: true },
            ];

            svg.append('text')
                .attr('x', width/2)
                .attr('y', 24)
                .attr('text-anchor', 'middle')
                .style('font-size', '18px')
                .style('font-weight', 'bold')
                .text('sin x, cos x, tan x, csc x, sec x, cot x');

            funcs.forEach(({key, color, f, clip}) => {
                const data = [];
                const step = 0.01;
                for (let x = -Math.PI*2; x <= Math.PI*2; x += step) {
                    let y = f(x);
                    if (!isFinite(y)) {
                        data.push({break: true});
                        continue;
                    }
                    if (clip && Math.abs(y) > 2.2) {
                        data.push({break: true});
                        continue;
                    }
                    data.push({x,y});
                }

                // å°†å«æœ‰æ–­ç‚¹çš„æ•°æ®åˆ†æ®µç»˜åˆ¶
                let seg = [];
                data.forEach(p => {
                    if (p.break) {
                        if (seg.length) {
                            draw(seg);
                            seg = [];
                        }
                    } else {
                        seg.push(p);
                    }
                });
                if (seg.length) draw(seg);

                function draw(segment) {
                    const line = d3.line()
                        .x(d => xScale(d.x))
                        .y(d => yScale(d.y));
                    g.append('path')
                        .datum(segment)
                        .attr('fill', 'none')
                        .attr('stroke', color)
                        .attr('stroke-width', 2)
                        .attr('d', line)
                        .attr('opacity', 0.95);
                }
            });

            // å›¾ä¾‹
            const legend = g.append('g').attr('transform', `translate(${width-120}, 10)`);
            const legendItems = [
                {label: 'sin x', color: 'var(--danger-color)'},
                {label: 'cos x', color: 'var(--primary-color)'},
                {label: 'tan x', color: '#8e44ad'},
                {label: 'csc x', color: '#16a085'},
                {label: 'sec x', color: '#d35400'},
                {label: 'cot x', color: '#2c3e50'},
            ];
            legendItems.forEach((item, i) => {
                const row = legend.append('g').attr('transform', `translate(0, ${i*18})`);
                row.append('line').attr('x1',0).attr('y1',6).attr('x2',20).attr('y2',6).attr('stroke', item.color).attr('stroke-width', 3);
                row.append('text').attr('x',26).attr('y',9).text(item.label).style('font-size', '12px').style('fill', '#333');
            });
        }

        function visualizeInteractiveInvTrig(containerId) {
            const setup = setupD3(containerId, {top: 60, right: 40, bottom: 60, left: 60});
            if (!setup) return;
            const { container, svg, g, width, height } = setup;

            // æ¸…ç†æ—§çš„æŒ‰é’®å®¹å™¨ï¼ˆè‹¥é‡å¤è¿›å…¥æ­¤é¡µï¼‰
            d3.select(`#${containerId}`).selectAll('.invtrig-controls').remove();

            const title = svg.append('text')
                .attr('x', width / 2 + 30)
                .attr('y', 30)
                .attr('text-anchor', 'middle')
                .style('font-size', '20px')
                .style('font-weight', 'bold');

            const pi = Math.PI;
            const xScale = d3.scaleLinear().domain([-pi, pi]).range([0, width]);
            const yScale = d3.scaleLinear().domain([-1.6, 1.6]).range([height, 0]);

            g.append('g').attr('transform', `translate(0, ${yScale(0)})`)
                .call(d3.axisBottom(xScale)
                    .tickValues([-pi, -pi/2, 0, pi/2, pi])
                    .tickFormat(d => ({
                        '-3.141592653589793': '-Ï€',
                        '-1.5707963267948966': '-Ï€/2',
                        '0': '0',
                        '1.5707963267948966': 'Ï€/2',
                        '3.141592653589793': 'Ï€'
                    }[d]))
                );
            g.append('g').call(d3.axisLeft(yScale).tickValues([-1, 0, 1]));

            // åº•å›¾ç½‘æ ¼ï¼šä¸‰è§’å‡½æ•°æ›²çº¿ï¼ˆç°è‰²ï¼‰
            const dataFull = d3.range(-pi, pi + 0.001, 0.005);
            const sinLine = d3.line().x(d => xScale(d)).y(d => yScale(Math.sin(d)));
            const cosLine = d3.line().x(d => xScale(d)).y(d => yScale(Math.cos(d)));
            const tanLine = d3.line().x(d => xScale(d)).y(d => yScale(Math.tan(d)));

            const baseCurve = g.append('path')
                .attr('fill', 'none')
                .attr('stroke', '#ccc')
                .attr('stroke-width', 2);

            // å—é™åŒºé—´é«˜äº®
            const restrictedCurve = g.append('path')
                .attr('fill', 'none')
                .attr('stroke', 'var(--danger-color)')
                .attr('stroke-width', 4);

            // åå‡½æ•°æ›²çº¿
            const inverseCurve = g.append('path')
                .attr('fill', 'none')
                .attr('stroke', 'var(--primary-color)')
                .attr('stroke-width', 4)
                .style('opacity', 0);

            // å¯æ‹–åŠ¨æ°´å¹³çº¿ä¸äº¤ç‚¹
            const yLine = g.append('line')
                .attr('x1', 0)
                .attr('x2', width)
                .attr('stroke', 'var(--accent-color)')
                .attr('stroke-width', 2)
                .style('cursor', 'row-resize');
            const intersections = g.append('g');

            function updateIntersections(yVal, mode) {
                yLine.attr('y1', yScale(yVal)).attr('y2', yScale(yVal));
                let xVals = [];
                const eps = 0.01;
                if (mode === 'arcsin') {
                    xVals = dataFull.filter(t => Math.abs(Math.sin(t) - yVal) < eps);
                } else if (mode === 'arccos') {
                    xVals = dataFull.filter(t => Math.abs(Math.cos(t) - yVal) < eps);
                } else {
                    xVals = dataFull.filter(t => Math.abs(Math.tan(t) - yVal) < 0.05 && Math.abs(t) < pi/2 - 0.05);
                }
                intersections.selectAll('circle').remove();
                intersections.selectAll('circle')
                    .data(xVals)
                    .enter().append('circle')
                    .attr('cx', d => xScale(d))
                    .attr('cy', yScale(yVal))
                    .attr('r', 5)
                    .attr('fill', 'var(--accent-color)');
            }

            // æ§ä»¶ï¼šæ¨¡å¼åˆ‡æ¢
            const controls = container.append('div')
                .attr('class', 'invtrig-controls')
                .style('position', 'absolute')
                .style('top', '20px')
                .style('right', '20px')
                .style('display', 'flex')
                .style('gap', '8px');

            const modes = [
                { key: 'arcsin', label: 'arcsin', func: 'sin', restrict: [-pi/2, pi/2], invY: [-pi/2, pi/2] },
                { key: 'arccos', label: 'arccos', func: 'cos', restrict: [0, pi], invY: [0, pi] },
                { key: 'arctan', label: 'arctan', func: 'tan', restrict: [-pi/2, pi/2], invY: [-pi/2, pi/2] }
            ];

            let currentMode = 'arcsin';

            const buttons = controls.selectAll('button')
                .data(modes)
                .enter()
                .append('button')
                .attr('class', 'nav-btn')
                .style('width', 'auto')
                .style('padding', '5px 10px')
                .style('border-radius', '5px')
                .style('opacity', d => d.key === currentMode ? 1 : 0.7)
                .text(d => d.label)
                .on('click', (event, d) => {
                    currentMode = d.key;
                    buttons.style('opacity', b => b.key === currentMode ? 1 : 0.7);
                    inverseCurve.style('opacity', 0);
                    render(currentMode);
                });

            // ç¬¬äºŒä¸ªæŒ‰é’®ï¼šæ˜¾ç¤º/éšè—åå‡½æ•°
            const toggleInverseBtn = controls.append('button')
                .attr('class', 'nav-btn')
                .style('width', 'auto')
                .style('padding', '5px 10px')
                .style('border-radius', '5px')
                .text('æ˜¾ç¤ºåå‡½æ•°')
                .on('click', function() {
                    const visible = inverseCurve.style('opacity') !== '0';
                    inverseCurve.transition().duration(300).style('opacity', visible ? 0 : 1);
                    d3.select(this).text(visible ? 'æ˜¾ç¤ºåå‡½æ•°' : 'éšè—åå‡½æ•°');
                });

            const drag = d3.drag().on('drag', function(event) {
                const yVal = yScale.invert(event.y);
                const limit = currentMode === 'arctan' ? 1.5 : 1;
                if (yVal >= -limit && yVal <= limit) {
                    updateIntersections(yVal, currentMode);
                }
            });

            yLine.call(drag);

            function render(mode) {
                // åŸºç¡€æ›²çº¿
                if (mode === 'arcsin') {
                    title.text('Sine ä¸ Arcsine');
                    baseCurve.attr('d', sinLine(dataFull));
                } else if (mode === 'arccos') {
                    title.text('Cosine ä¸ Arccosine');
                    baseCurve.attr('d', cosLine(dataFull));
                } else {
                    title.text('Tangent ä¸ Arctangent');
                    // é™åˆ¶æ˜¾ç¤ºï¼Œé¿å… tan å¥‡å¼‚ç‚¹
                    const segments = [];
                    let seg = [];
                    for (let t = -pi/2 + 0.05; t <= pi/2 - 0.05; t += 0.01) seg.push(t);
                    segments.push(seg);
                    baseCurve.attr('d', tanLine(segments[0]));
                }

                // å—é™åŒºé—´
                const spec = modes.find(m => m.key === mode);
                const restricted = d3.range(spec.restrict[0], spec.restrict[1] + 0.0001, 0.005);
                if (mode === 'arcsin') restrictedCurve.attr('d', sinLine(restricted));
                if (mode === 'arccos') restrictedCurve.attr('d', cosLine(restricted));
                if (mode === 'arctan') restrictedCurve.attr('d', tanLine(restricted));

                // åå‡½æ•°æ›²çº¿æ˜ å°„åˆ°åŒä¸€åæ ‡ç³»ï¼ˆé€šè¿‡è‡ªå®šä¹‰ç¼©æ”¾åˆ°å—é™åŒºé—´æ¨ªå‘ï¼Œ[-1,1] çºµå‘ï¼‰
                let invXDom, invXRange, invYDom;
                if (mode === 'arcsin') {
                    invXDom = [-1, 1];
                    invXRange = [xScale(-pi/2), xScale(pi/2)];
                    invYDom = [-pi/2, pi/2];
                } else if (mode === 'arccos') {
                    invXDom = [-1, 1];
                    invXRange = [xScale(0), xScale(pi)];
                    invYDom = [0, pi];
                } else { // arctan
                    invXDom = [-1.5, 1.5];
                    invXRange = [xScale(-pi/2), xScale(pi/2)];
                    invYDom = [-pi/2, pi/2];
                }

                const invXScale = d3.scaleLinear().domain(invXDom).range(invXRange);
                const invYScale = d3.scaleLinear().domain(invYDom).range([yScale(-1), yScale(1)]);

                let invData, invLine;
                if (mode === 'arcsin') {
                    invData = d3.range(-1, 1.001, 0.002);
                    invLine = d3.line().x(d => invXScale(d)).y(d => invYScale(Math.asin(d)));
                } else if (mode === 'arccos') {
                    invData = d3.range(-1, 1.001, 0.002);
                    invLine = d3.line().x(d => invXScale(d)).y(d => invYScale(Math.acos(d)));
                } else {
                    invData = d3.range(invXDom[0], invXDom[1] + 0.001, 0.002);
                    invLine = d3.line().x(d => invXScale(d)).y(d => invYScale(Math.atan(d)));
                }
                inverseCurve.attr('d', invLine(invData));

                // åˆå§‹åŒ–æ°´å¹³çº¿ä¸äº¤ç‚¹
                const initY = mode === 'arctan' ? 0.5 : 0.5;
                updateIntersections(initY, mode);
            }

            render(currentMode);
        }

        function visualizeInteractiveInverseExpLog(containerId) {
            const setup = setupD3(containerId, {top: 60, right: 40, bottom: 60, left: 50});
            if (!setup) return;
            const { container, svg, g, width, height } = setup;

            svg.append('text')
                .attr('x', width / 2 + 50)
                .attr('y', 30)
                .attr('text-anchor', 'middle')
                .style('font-size', '20px')
                .style('font-weight', 'bold')
                .text('æŒ‡æ•°å‡½æ•°ä¸å¯¹æ•°å‡½æ•°äº’ä¸ºåå‡½æ•°');

            const domainRange = 5;
            const xScale = d3.scaleLinear().domain([-domainRange, domainRange]).range([0, width]);
            const yScale = d3.scaleLinear().domain([-domainRange, domainRange]).range([height, 0]);

            g.append('g')
                .attr('transform', `translate(0, ${yScale(0)})`)
                .call(d3.axisBottom(xScale));
            g.append('g')
                .attr('transform', `translate(${xScale(0)}, 0)`)
                .call(d3.axisLeft(yScale));

            g.append("line")
                .attr("x1", xScale(-domainRange))
                .attr("y1", yScale(-domainRange))
                .attr("x2", xScale(domainRange))
                .attr("y2", yScale(domainRange))
                .attr("stroke", "#aaa")
                .attr("stroke-width", 2)
                .attr("stroke-dasharray", "5,5");
            g.append('text').attr('x', xScale(4)).attr('y', yScale(4) - 5).text('y=x').style('fill', '#aaa');

            const expPath = g.append("path").attr("fill", "none").attr("stroke", "var(--danger-color)").attr("stroke-width", 2.5);
            const logPath = g.append("path").attr("fill", "none").attr("stroke", "var(--primary-color)").attr("stroke-width", 2.5);

            const sliderContainer = container.append('div')
                .style('position', 'absolute')
                .style('bottom', '20px')
                .style('left', '50%')
                .style('transform', 'translateX(-50%)')
                .style('background', 'rgba(255, 255, 255, 0.9)')
                .style('padding', '10px')
                .style('border-radius', '8px')
                .style('box-shadow', '0 2px 8px rgba(0,0,0,0.15)');

            sliderContainer.append('label').text('åº•æ•° a: ').style('color', 'black');
            const slider = sliderContainer.append('input').attr('type', 'range').attr('min', 0.2).attr('max', 4).attr('step', 0.1).attr('value', 2);
            const label = sliderContainer.append('span').text('2.0').style('color', 'black').style('font-weight', 'bold');

            const expLabel = g.append('text').attr('class', 'label').style('fill', 'var(--danger-color)');
            const logLabel = g.append('text').attr('class', 'label').style('fill', 'var(--primary-color)');

            function update(a) {
                label.text(a.toFixed(1));

                if (a.toFixed(1) === '1.0') {
                    expPath.style('opacity', 0);
                    logPath.style('opacity', 0);
                    return;
                }
                expPath.style('opacity', 1);
                logPath.style('opacity', 1);

                const expLine = d3.line().x(d => xScale(d)).y(d => yScale(Math.pow(a, d)));
                const logLine = d3.line().x(d => xScale(d)).y(d => yScale(Math.log(d) / Math.log(a)));

                const expData = d3.range(-domainRange, domainRange, 0.1).filter(x => {
                    const y = Math.pow(a, x);
                    return y < domainRange && y > -domainRange;
                });
                const logData = d3.range(0.01, domainRange, 0.1);

                expPath.datum(expData).attr("d", expLine);
                logPath.datum(logData).attr("d", logLine);
                
                expLabel.attr('x', xScale(1.5)).attr('y', yScale(Math.pow(a, 1.5)) - 5).text(`y = a^x`);
                logLabel.attr('x', xScale(Math.max(2, Math.pow(a, 1.5)))).attr('y', yScale(1.5) + 15).text(`y = log_a(x)`);
            }

            update(2);
            slider.on('input', function() {
                update(+this.value);
            });
        }

        // è¿è¡Œå¯è§†åŒ–å‡½æ•°æ˜ å°„
        function runVisualization(slideIndex) {
            stopCurrentAnimation();

            let handlers;

            switch (slideIndex) {
                case 3: handlers = visualizeVariables('vis-variables'); break;
                case 4: handlers = visualizeIntervals('vis-intervals'); break;
                case 5: handlers = visualizeFunctionMachine('vis-function-machine'); break;
                case 6: handlers = visualizeDomain('vis-domain'); break;
                case 7: handlers = visualizeRange('vis-range'); break;
                case 8: handlers = visualizeElementaryIntro('vis-elementary-intro'); break;
                case 9: handlers = visualizePowerFunction('vis-power-function'); break;
                case 10: handlers = visualizeExponents('vis-exponents'); break;
                case 11: handlers = visualizeExponentRules1('vis-exponent-rules-1'); break;
                case 12: handlers = visualizeExponentRules2('vis-exponent-rules-2'); break;
                case 13: handlers = visualizeSpecialExponentsNew('vis-special-exponents'); break;
                case 14: handlers = visualizeFractionalExponents('vis-fractional-exponents'); break;
                case 15: handlers = visualizeInteractiveExponential('vis-interactive-exponential'); break;
                case 16: handlers = visualizeLogHistory('vis-log-history'); break;
                case 17: handlers = visualizeLogDefinition('vis-log-definition'); break;
                case 18: handlers = visualizeInteractiveLogarithm('vis-interactive-logarithm'); break;
                case 19: handlers = visualizeLogProperties('vis-log-properties'); break;
                case 20: handlers = visualizeCommonLogs('vis-common-logs'); break;
                case 21: handlers = visualizeLogOperations('vis-log-operations'); break;
                case 22: handlers = visualizeInteractiveTrig('vis-interactive-trig'); break;
                case 23: handlers = visualizeTrigAll('vis-trig-all'); break;
                case 24: handlers = visualizeInteractiveInvTrig('vis-interactive-inv-trig'); break;
                case 25: handlers = visualizePropertiesIntro('vis-properties-intro'); break;
                case 26: handlers = visualizeMonotonicityInc('vis-monotonicity-inc'); break;
                case 27: handlers = visualizeMonotonicityDec('vis-monotonicity-dec'); break;
                case 28: handlers = visualizeMonotonicityIntervals('vis-monotonicity-intervals'); break;
                case 29: handlers = visualizeParityIntro('vis-parity-intro'); break;
                case 30: handlers = visualizeEvenFunction('vis-even-function'); break;
                case 31: handlers = visualizeOddFunction('vis-odd-function'); break;
                case 32: handlers = visualizeBoundedness('vis-boundedness'); break;
                case 33: handlers = visualizeInverseMachine('vis-inverse-machine'); break;
                case 34: handlers = visualizeInverseGraph('vis-inverse-graph'); break;
                case 35: handlers = visualizeInteractiveInverseExpLog('vis-interactive-inverse-exp-log'); break;
                case 36: handlers = visualizeCompositeMachine('vis-composite-machine'); break;
            }

            applyCurrentAnimation(handlers);
        }

        // å¹‚å‡½æ•°å¯è§†åŒ–å‡½æ•° - é‡æ–°è®¾è®¡
        function visualizePowerFunction(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;

            // æ¸…ç©ºå®¹å™¨
            container.innerHTML = '';

            // åˆ›å»ºSVG
            const width = container.offsetWidth;
            const height = container.offsetHeight;
            const margin = { top: 40, right: 40, bottom: 40, left: 40 };
            const plotWidth = width - margin.left - margin.right;
            const plotHeight = height - margin.top - margin.bottom;

            const svg = d3.select(container)
                .append('svg')
                .attr('width', width)
                .attr('height', height);

            // åˆ›å»ºä¸»ç»˜å›¾ç»„ï¼ŒåŸç‚¹åœ¨ä¸­å¿ƒ
            const g = svg.append('g')
                .attr('transform', `translate(${width/2}, ${height/2})`);

            // è®¾ç½®æ¯”ä¾‹å°º - åŸç‚¹åœ¨ä¸­å¿ƒ
            const xScale = d3.scaleLinear()
                .domain([-10, 10])
                .range([-plotWidth/2, plotWidth/2]);

            const yScale = d3.scaleLinear()
                .domain([-10, 10])
                .range([plotHeight/2, -plotHeight/2]);

            // å½“å‰æŒ‡æ•°å€¼
            let currentExponent = 1;

            // ç»˜åˆ¶åæ ‡è½´
            function drawAxes() {
                // æ¸…é™¤ä¹‹å‰çš„åæ ‡è½´
                g.selectAll('.axis').remove();
                g.selectAll('.grid').remove();

                // Xè½´
                g.append('line')
                    .attr('class', 'axis x-axis')
                    .attr('x1', xScale(-10))
                    .attr('x2', xScale(10))
                    .attr('y1', 0)
                    .attr('y2', 0)
                    .attr('stroke', '#333')
                    .attr('stroke-width', 2);

                // Yè½´
                g.append('line')
                    .attr('class', 'axis y-axis')
                    .attr('x1', 0)
                    .attr('x2', 0)
                    .attr('y1', yScale(-10))
                    .attr('y2', yScale(10))
                    .attr('stroke', '#333')
                    .attr('stroke-width', 2);

                // ç½‘æ ¼çº¿
                for (let i = -10; i <= 10; i += 2) {
                    if (i !== 0) {
                        // å‚ç›´ç½‘æ ¼çº¿
                        g.append('line')
                            .attr('class', 'grid')
                            .attr('x1', xScale(i))
                            .attr('x2', xScale(i))
                            .attr('y1', yScale(-10))
                            .attr('y2', yScale(10))
                            .attr('stroke', '#ddd')
                            .attr('stroke-width', 1)
                            .style('opacity', 0.5);

                        // æ°´å¹³ç½‘æ ¼çº¿
                        g.append('line')
                            .attr('class', 'grid')
                            .attr('x1', xScale(-10))
                            .attr('x2', xScale(10))
                            .attr('y1', yScale(i))
                            .attr('y2', yScale(i))
                            .attr('stroke', '#ddd')
                            .attr('stroke-width', 1)
                            .style('opacity', 0.5);
                    }
                }

                // åæ ‡è½´æ ‡ç­¾
                g.append('text')
                    .attr('class', 'axis-label')
                    .attr('x', xScale(9))
                    .attr('y', -10)
                    .style('text-anchor', 'middle')
                    .style('font-size', '14px')
                    .style('fill', '#333')
                    .text('x');

                g.append('text')
                    .attr('class', 'axis-label')
                    .attr('x', 10)
                    .attr('y', yScale(9))
                    .style('text-anchor', 'middle')
                    .style('font-size', '14px')
                    .style('fill', '#333')
                    .text('y');
            }

            // ç»˜åˆ¶å¹‚å‡½æ•°
            function drawPowerFunction(exponent) {
                // æ¸…é™¤ä¹‹å‰çš„å‡½æ•°
                g.selectAll('.power-curve').remove();
                g.selectAll('.power-points').remove();

                // ç”Ÿæˆæ•°æ®ç‚¹ - ä½¿ç”¨æ›´å°æ­¥é•¿è®©æ›²çº¿æ›´åœ†æ¶¦
                const data = [];
                for (let x = -10; x <= 10; x += 0.1) {
                    let y;
                    
                    if (exponent === 0) {
                        y = 1; // x^0 = 1
                    } else if (exponent > 0) {
                        if (x < 0 && exponent % 1 !== 0) {
                            continue; // è´Ÿæ•°çš„å°æ•°æ¬¡æ–¹æ— æ„ä¹‰
                        } else {
                            y = Math.pow(x, exponent);
                        }
                    } else {
                        if (x === 0) {
                            continue; // 0çš„è´Ÿæ¬¡æ–¹æ— æ„ä¹‰
                        } else {
                            y = Math.pow(x, exponent);
                        }
                    }
                    
                    if (!isNaN(y) && isFinite(y)) {
                        data.push({ x, y });
                    }
                }

                // ç»˜åˆ¶æ›²çº¿ - ä½¿ç”¨å¹³æ»‘æ’å€¼è®©æ›²çº¿æ›´åœ†æ¶¦
                const line = d3.line()
                    .x(d => xScale(d.x))
                    .y(d => yScale(d.y))
                    .curve(d3.curveCardinal);

                g.append('path')
                    .attr('class', 'power-curve')
                    .attr('d', line(data))
                    .attr('fill', 'none')
                    .attr('stroke', '#e74c3c')
                    .attr('stroke-width', 4)
                    .style('stroke-linecap', 'round')
                    .style('stroke-linejoin', 'round');

                // æ·»åŠ å…³é”®ç‚¹
                const keyPoints = [];
                for (let x = -10; x <= 10; x += 1) {
                    let y;
                    
                    if (exponent === 0) {
                        y = 1;
                    } else if (exponent > 0) {
                        if (x < 0 && exponent % 1 !== 0) {
                            continue;
                        } else {
                            y = Math.pow(x, exponent);
                        }
                    } else {
                        if (x === 0) {
                            continue;
                        } else {
                            y = Math.pow(x, exponent);
                        }
                    }
                    
                    if (!isNaN(y) && isFinite(y)) {
                        keyPoints.push({ x, y });
                    }
                }

                g.selectAll('.power-points')
                    .data(keyPoints)
                    .enter()
                    .append('circle')
                    .attr('class', 'power-points')
                    .attr('cx', d => xScale(d.x))
                    .attr('cy', d => yScale(d.y))
                    .attr('r', 3)
                    .attr('fill', '#e74c3c');

                // å‡½æ•°æ ‡ç­¾ - ä½¿ç”¨MathJaxæ¸²æŸ“
                g.selectAll('.function-label').remove();
                const functionLabel = g.append('foreignObject')
                    .attr('class', 'function-label')
                    .attr('x', xScale(6))
                    .attr('y', yScale(8))
                    .attr('width', 80)
                    .attr('height', 30)
                    .html(`<div style="font-size: 16px; font-weight: bold; color: #e74c3c; text-align: center;">$y = x^{${exponent.toFixed(0)}}$</div>`);
                
                // æ¸²æŸ“MathJax
                if (window.MathJax && window.MathJax.typesetPromise) {
                    window.MathJax.typesetPromise([functionLabel.node()]).catch(error => {
                        console.warn('MathJax rendering failed for function label:', error);
                    });
                }
            }

            // æ»‘è½®æ§åˆ¶
            const sliderContainer = d3.select(container)
                .append('div')
                .style('position', 'absolute')
                .style('bottom', '20px')
                .style('left', '50%')
                .style('transform', 'translateX(-50%)')
                .style('background', 'rgba(255,255,255,0.9)')
                .style('padding', '10px 20px')
                .style('border-radius', '10px')
                .style('box-shadow', '0 2px 10px rgba(0,0,0,0.1)')
                .style('z-index', '1001');

            sliderContainer.append('label')
                .style('display', 'block')
                .style('text-align', 'center')
                .style('margin-bottom', '5px')
                .style('font-size', '14px')
                .style('color', '#2c3e50')
                .text('æŒ‡æ•° n = ');

            const slider = sliderContainer.append('input')
                .attr('type', 'range')
                .attr('min', 0)
                .attr('max', 10)
                .attr('step', 1)
                .attr('value', 1)
                .style('width', '200px')
                .style('margin', '0 10px');

            const valueDisplay = sliderContainer.append('span')
                .style('font-size', '14px')
                .style('font-weight', 'bold')
                .style('color', '#e74c3c')
                .text('1');

            // æ»‘è½®äº‹ä»¶
            slider.on('input', function() {
                currentExponent = parseFloat(this.value);
                valueDisplay.text(currentExponent.toFixed(0));
                drawPowerFunction(currentExponent);
            });

            // åˆå§‹åŒ–
            drawAxes();
            drawPowerFunction(currentExponent);
            
            // ç¡®ä¿MathJaxå…¬å¼æ­£ç¡®æ¸²æŸ“
            setTimeout(() => {
                if (window.MathJax && window.MathJax.typesetPromise) {
                    window.MathJax.typesetPromise([container]).catch(error => {
                        console.warn('MathJax rendering failed for power function:', error);
                    });
                }
            }, 100);
        }
    </script>
</body>
</html>