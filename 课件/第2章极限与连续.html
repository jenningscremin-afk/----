<!DOCTYPE html>

<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>å¾®ç§¯åˆ†ç¬¬äºŒç« ï¼šæé™ä¸è¿ç»­ - å®Œæ•´ç‰ˆ</title>
<script src="../common-assets/js/d3-7.8.5.min.js"></script>
<!-- ä½¿ç”¨ç»Ÿä¸€çš„MathJaxé…ç½®æ–‡ä»¶ï¼Œé¿å…é…ç½®å†²çª -->
<script src="../common-assets/js/mathjax-config.js"></script>
<script async="" id="MathJax-script" src="../common-assets/js/mathjax-3.2.2-tex-svg.min.js" type="text/javascript">
</script>
<style>
        @import url('../common-assets/css/fonts.css');

        :root {
            --chalkboard-bg: #2c3e50;
            --chalk-text: #ecf0f1;
            --visualization-bg: #ffffff;
            --primary-color: #3498db;
            --accent-color: #e67e22;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --info-color: #9b59b6;
            --text-color: #34495e;
            --heading-font: 'Noto Serif SC', serif;
            --handwriting-font: 'Noto Serif SC', serif;
        }

        body {
            font-family: var(--heading-font);
            margin: 0;
            background-color: #f0f2f5;
        }

        .scrolly-container {
            display: flex;
            width: 100%;
            min-height: 100vh;
        }

        .lecture-notes {
            flex: 0 0 40%;
            max-width: 40%;
            word-wrap: break-word;
        }

        .step {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 40px;
            background-color: var(--chalkboard-bg);
            background-image: url('../common-assets/images/black-felt.png');
            border-bottom: 1px solid #444;
            color: var(--chalk-text);
            box-sizing: border-box;
            opacity: 0.3;
            transition: opacity 0.5s;
        }

        .step.is-active {
            opacity: 1;
        }

        .step:last-child {
            border-bottom: none;
        }

        .step h2 {
            font-family: var(--handwriting-font);
            font-size: 2.2rem;
            color: #f1c40f;
            border-bottom: 2px solid rgba(241, 196, 15, 0.5);
        }

        .step h3 {
            font-family: var(--handwriting-font);
            font-size: 1.5rem;
            color: var(--primary-color);
        }

        .step p, .step li {
            font-size: 1.1rem;
            line-height: 1.7;
        }

        .step ul {
            list-style-type: 'â†’ ';
        }

        .visualization-panel {
            flex: 1;
            position: relative;
        }

        #sticky-vis-container {
            position: sticky;
            top: 0;
            width: 100%;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--visualization-bg);
            transition: opacity 0.5s;
        }

        #sticky-vis-container.visualization-flex {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 30px;
            box-sizing: border-box;
        }

        #sticky-vis-container.visualization-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            padding: 30px;
            box-sizing: border-box;
            overflow-y: auto;
        }

        .visualization-flex {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 30px;
            box-sizing: border-box;
        }

        .visualization-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            padding: 30px;
            box-sizing: border-box;
            overflow-y: auto;
        }

        .step.fullscreen {
            padding: 0;
            border: none;
        }

        .step.fullscreen .fullscreen-vis-container {
            width: 100%;
            height: 100vh;
            background-color: var(--visualization-bg);
        }

        .step.fullscreen[data-theme="dark"] .fullscreen-vis-container {
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
        }

        .chalkboard {
            background-color: #2c3e50 !important;
            border: 10px solid #8B4513; /* æœ¨è´¨è¾¹æ¡† */
            box-shadow: 0 10px 20px rgba(0,0,0,0.5), inset 0 0 15px rgba(0,0,0,0.7);
            color: var(--chalk-text, #f0f0f0);
            padding: 15px;
            box-sizing: border-box;
            word-wrap: break-word;
            word-break: break-word;
        }
        
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
        .chalkboard::-webkit-scrollbar {
            width: 8px;
        }
        
        .chalkboard::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }
        
        .chalkboard::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }
        
        .chalkboard::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .chalkboard h2 {
            font-family: var(--handwriting-font);
            font-size: 2.2rem;
            color: #f1c40f;
            border-bottom: 2px solid rgba(241, 196, 15, 0.5);
            padding-bottom: 2px;
            margin-bottom:3px;
        }

        .chalkboard h3 {
            font-family: var(--handwriting-font);
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-top: 5px;
            margin-bottom: 5px;
        }

        .chalkboard p, .chalkboard li {
            font-size: 1.1rem;
            line-height: 1.4;
            margin-bottom: 8px;
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-width: 100%;
        }

        .chalkboard ul {
            list-style-type: 'â–¸ ';
            padding-left: 20px;
            margin-bottom: 8px;
        }

        .math-formula {
            font-size: 1.2rem;
            color: #1abc9c;
            background: rgba(26, 188, 156, 0.1);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            margin: 15px 0;
            border: 2px solid rgba(26, 188, 156, 0.3);
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-width: 100%;
        }

        .highlight {
            color: var(--warning-color);
            font-weight: bold;
            background: rgba(243, 156, 18, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
        }

        .example-box {
            background: rgba(52, 152, 219, 0.1);
            border-left: 4px solid var(--primary-color);
            padding: 15px;
            margin: 20px 0;
        }

        .example-box h4 {
            color: var(--primary-color);
            margin-top: 0;
            font-size: 1rem;
        }

        .step-box {
            background: rgba(46, 204, 113, 0.1);
            border: 1px solid rgba(46, 204, 113, 0.3);
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .warning-box {
            background: rgba(231, 76, 60, 0.1);
            border: 2px solid rgba(231, 76, 60, 0.3);
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .visualization {
            flex: 1;
            padding: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            overflow-y: auto;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        .vis-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            position: relative;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .vis-item:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .vis-item svg {
            width: 100%;
            height: auto;
        }

        .vis-title {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            gap: 0.1em;
            font-size: 1rem;
            color: var(--text-color);
            margin-bottom: 10px;
            height: auto;
            line-height: 1.2;
        }

        .approach-indicator {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(52, 152, 219, 0.9);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .approach-left {
            background: rgba(231, 76, 60, 0.9);
        }

        .approach-right {
            background: rgba(46, 204, 113, 0.9);
        }

        .approach-both {
            background: rgba(155, 89, 182, 0.9);
        }

        .expanded-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .expanded-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .expanded-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            width: 80vw;
            height: 80vh;
            position: relative;
            transform: scale(0.8);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .expanded-overlay.active .expanded-content {
            transform: scale(1);
        }

        .expanded-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            text-align: center;
            color: var(--text-color);
            line-height: 1.8;
            min-height: 3rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .expanded-title mjx-container {
            font-size: 1.2em !important;
        }

        .simple-annotation {
            font-family: var(--heading-font);
        }

        .simple-annotation mjx-container {
            font-size: 1.1em !important;
        }

        .expanded-annotation {
            text-align: center;
            margin-bottom: 15px;
            font-style: italic;
            color: #6c757d;
        }

        .expanded-svg-container {
            flex: 1;
            overflow: auto;
            position: relative;
        }

        .expanded-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: #f8f9fa;
            border-radius: 10px;
            margin: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            color: #495057;
        }

        .control-group input[type="range"] {
            width: 120px;
        }

        .control-group button {
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .control-group button:hover {
            background: #0056b3;
        }

        .annotation-text {
            background: rgba(52, 152, 219, 0.1);
            color: #2980b9;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 14px;
            display: inline-block;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--danger-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 18px;
        }

        .close-btn:hover {
            background: #c0392b;
        }



        .page-info {
            display: none;
        }

        .interactive-panel {
            position: absolute;
            bottom: 30px;
            right: 70px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .draggable-panel {
            cursor: move;
            user-select: none;
        }

        .draggable-panel h3 {
            cursor: grab;
            margin: 0 0 15px 0;
            padding: 5px 0;
            border-bottom: 2px solid var(--primary-color);
            color: var(--primary-color);
            font-weight: bold;
        }

        .draggable-panel h3:hover {
            background: rgba(52, 152, 219, 0.1);
            border-radius: 5px;
            padding: 5px;
        }

        .draggable-panel.dragging {
            cursor: grabbing;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            transform: scale(1.02);
            transition: transform 0.1s ease;
        }

        .draggable-panel.dragging h3 {
            cursor: grabbing;
        }

        .button-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
            align-items: center;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 10px 0;
        }

        .slider {
            flex: 1;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 5px;
            background: linear-gradient(to right, var(--primary-color) 0%, var(--accent-color) 100%);
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            border: 3px solid var(--primary-color);
            cursor: pointer;
        }


        .formula-step {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 15px 0;
            font-size: 1.3rem;
        }

        .formula-arrow {
            color: var(--accent-color);
            font-size: 1.5rem;
        }

        @keyframes pulse {
            0%, 100% { 
                opacity: 0.8; 
                transform: scale(1); 
            }
            50% { 
                opacity: 1; 
                transform: scale(1.05); 
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animated-point, .fade-in, .pulse {
            will-change: transform, opacity;
            transform: translateZ(0);
            backface-visibility: hidden;
        }

        .animated-point {
            animation: pulse 2s ease-in-out infinite;
        }

        .fade-in {
            animation: fadeIn 0.8s ease-out;
        }

        .limit-arrow {
            stroke: var(--danger-color);
            stroke-width: 2;
            marker-end: url(#arrowhead);
            stroke-dasharray: 5, 5;
            animation: dash 2s linear infinite;
        }

        @keyframes dash {
            to { stroke-dashoffset: -10; }
        }

        .epsilon-band {
            fill: rgba(52, 152, 219, 0.2);
            stroke: rgba(52, 152, 219, 0.5);
            stroke-width: 1;
            stroke-dasharray: 3, 3;
        }

        .thinking-bubble {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 15px;
            position: relative;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

               /* æé™åŠ¨ç”»å¢å¼ºæ ·å¼ */
               .limit-approach-container .approach-indicator {
            animation: pulse 2s infinite ease-in-out;
        }

        @keyframes pulse {
            0%, 100% { 
                opacity: 0.8; 
                transform: scale(1); 
            }
            50% { 
                opacity: 1; 
                transform: scale(1.05); 
            }
        }

        .left-approach-point, .right-approach-point {
            filter: drop-shadow(0 0 4px currentColor);
        }
        
        .chart-annotation {
            margin-top: 15px;
            padding: 12px 20px;
            background: rgba(52, 73, 94, 0.08);
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.5;
            color: var(--text-color);
            border: none;
            font-family: 'Noto Serif SC', serif;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .chart-annotation .conclusion {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .chart-annotation .analysis {
            margin-top: 4px;
            opacity: 0.8;
        }

    /* å°é¢æ ·å¼ */
    .cover-full {
        display: flex;
        flex-direction: column;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        justify-content: center;
        align-items: center;
        padding: 60px;
        box-sizing: border-box;
    }

    .cover-content {
        max-width: 1000px;
        text-align: center;
        background: rgba(255, 255, 255, 0.95);
        padding: 60px;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .cover-header {
        margin-bottom: 50px;
    }

    .cover-title-main {
        font-size: 3.5rem;
        color: var(--primary-color);
        font-weight: bold;
        margin: 0 0 15px 0;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }

    .cover-title-subtitle {
        font-size: 2.2rem;
        color: var(--accent-color);
        margin: 0;
        font-weight: 600;
    }

    .cover-version {
        font-size: 1.4rem;
        color: var(--success-color);
        margin-top: 20px;
        font-weight: 500;
    }

    .cover-center {
        margin: 50px 0;
    }

    .cover-icon {
        font-size: 5rem;
        margin-bottom: 40px;
        text-shadow: 2px 2px 8px rgba(0,0,0,0.2);
        animation: pulse 3s ease-in-out infinite;
    }

    .cover-objectives {
        margin-bottom: 40px;
    }

    .objectives-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }

    .objective-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px;
        background: rgba(52, 152, 219, 0.1);
        border-radius: 10px;
        border-left: 4px solid var(--primary-color);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .objective-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 15px rgba(0,0,0,0.15);
    }

    .objective-icon {
        font-size: 1.5rem;
        flex-shrink: 0;
    }

    .knowledge-flow {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-top: 40px;
        padding: 25px;
        background: rgba(155, 89, 182, 0.1);
        border-radius: 15px;
        border: 2px solid rgba(155, 89, 182, 0.3);
    }

    .flow-item {
        padding: 12px 25px;
        background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
        color: white;
        border-radius: 25px;
        font-weight: 600;
        font-size: 0.95rem;
        text-align: center;
        min-width: 140px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        transition: transform 0.3s ease;
    }

    .current {
        background: linear-gradient(135deg, var(--success-color), #27ae60) !important;
        transform: scale(1.05);
    }

    .flow-arrow {
        font-size: 1.5rem;
        color: var(--accent-color);
        font-weight: bold;
    }

    .cover-footer {
        margin-top: 60px;
        border-top: 2px solid rgba(0,0,0,0.1);
        padding-top: 30px;
    }

    .nav-guide {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-bottom: 30px;
    }

    .nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        padding: 15px 20px;
        background: rgba(52, 152, 219, 0.1);
        border-radius: 10px;
        transition: background 0.3s ease;
    }

    .nav-item:hover {
        background: rgba(52, 152, 219, 0.2);
    }

    .nav-icon {
        font-size: 1.5rem;
    }

    .tech-info {
        color: var(--info-color);
        font-size: 0.9rem;
        font-weight: 500;
        padding: 10px 20px;
        background: rgba(26, 188, 156, 0.1);
        border-radius: 20px;
        display: inline-block;
    }

    /* é¦–é¡µå¯¼èˆªæŒ‰é’®æ ·å¼ */
    .home-nav-buttons {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 40px;
        flex-wrap: wrap;
    }

    .nav-btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 15px 20px;
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 15px;
        text-decoration: none;
        color: white;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
        min-width: 120px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .nav-btn:hover {
        background: rgba(255, 255, 255, 0.2);
        border-color: rgba(255, 255, 255, 0.5);
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }

    .nav-btn .btn-icon {
        font-size: 1.2rem;
        margin-bottom: 8px;
        font-weight: bold;
        letter-spacing: 1px;
    }

    .nav-btn .btn-text {
        font-size: 1.1rem;
        font-weight: 500;
    }

    /* ä¸åŒæŒ‰é’®çš„ç‰¹æ®Šé¢œè‰² */
    .home-btn:hover {
        background: rgba(52, 152, 219, 0.3);
        border-color: rgba(52, 152, 219, 0.6);
    }

    .story-btn:hover {
        background: rgba(155, 89, 182, 0.3);
        border-color: rgba(155, 89, 182, 0.6);
    }

    .exercise-btn:hover {
        background: rgba(46, 204, 113, 0.3);
        border-color: rgba(46, 204, 113, 0.6);
    }

    .resource-btn:hover {
        background: rgba(230, 126, 34, 0.3);
        border-color: rgba(230, 126, 34, 0.6);
    }

    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 768px) {
        .home-nav-buttons {
            gap: 15px;
            margin-top: 30px;
        }
        
        .nav-btn {
            padding: 12px 16px;
            min-width: 100px;
        }
        
        .nav-btn .btn-icon {
            font-size: 1rem;
        }
        
        .nav-btn .btn-text {
            font-size: 1rem;
        }
    }

    /* æµ®åŠ¨èœå•æ ·å¼ */
    #floating-menu {
        position: fixed;
        bottom: 20px;
        right: 200px;
        z-index: 9999;
        font-family: var(--heading-font);
    }

    /* ç« èŠ‚ç›®å½•èœå•æ ·å¼ */
    #chapter-menu {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 9999;
        font-family: var(--heading-font);
    }

    .menu-toggle {
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: rgba(255, 255, 255, 0.8);
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        font-weight: normal;
        transition: all 0.2s ease;
        backdrop-filter: blur(5px);
        min-width: 50px;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .menu-toggle:hover {
        background: rgba(0, 0, 0, 0.5);
        color: rgba(255, 255, 255, 1);
        border-color: rgba(255, 255, 255, 0.4);
    }

    .menu-toggle:active {
        transform: scale(0.95);
    }

    .menu-toggle .menu-icon {
        font-size: 10px;
        font-weight: normal;
        transition: transform 0.3s ease;
    }

    .menu-toggle.active .menu-icon {
        transform: rotate(45deg);
    }

    .menu-content {
        position: absolute;
        bottom: 50px;
        right: 0;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        padding: 10px 0;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        opacity: 0;
        visibility: hidden;
        transform: translateY(20px);
        transition: all 0.3s ease;
        min-width: 220px;
        max-height: 400px;
        overflow-y: auto;
    }

    .menu-content.active {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }

    /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
    .menu-content::-webkit-scrollbar {
        width: 6px;
    }

    .menu-content::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.1);
        border-radius: 3px;
    }

    .menu-content::-webkit-scrollbar-thumb {
        background: rgba(102, 126, 234, 0.5);
        border-radius: 3px;
    }

    .menu-content::-webkit-scrollbar-thumb:hover {
        background: rgba(102, 126, 234, 0.7);
    }

    .menu-item {
        display: flex;
        align-items: center;
        padding: 10px 15px;
        text-decoration: none;
        color: #333;
        transition: all 0.3s ease;
        border-radius: 10px;
        margin: 0 8px;
    }

    .menu-item:hover {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        transform: translateX(5px);
    }

    .menu-item .menu-icon {
        font-size: 12px;
        margin-right: 10px;
        width: 40px;
        text-align: center;
        font-weight: bold;
        letter-spacing: 0.5px;
    }

    .menu-item .menu-text {
        font-size: 14px;
        font-weight: 500;
    }

    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 768px) {
        #floating-menu {
            bottom: 15px;
            right: 150px;
        }
        
        .menu-content {
            min-width: 200px;
        }
        
        .menu-item {
            padding: 8px 12px;
        }
        
        .menu-item .menu-text {
            font-size: 13px;
        }
    }

    </style>
<style>
        .return-home-panel {
            position: fixed;
            top: 16px;
            left: 16px;
            display: flex;
            gap: 10px;
            z-index: 9999;
            flex-wrap: wrap;
        }
        .return-home-panel .return-link {
            padding: 8px 14px;
            border-radius: 999px;
            background: rgba(15, 23, 42, 0.8);
            color: #f8fafc;
            font-size: 14px;
            text-decoration: none;
            box-shadow: 0 6px 20px rgba(15, 23, 42, 0.25);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .return-home-panel .return-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(15, 23, 42, 0.35);
        }
        .return-home-panel .return-link.return-main {
            background: rgba(79, 70, 229, 0.85);
        }
        @media (max-width: 640px) {
            .return-home-panel {
                top: 12px;
                left: 12px;
                right: 12px;
                justify-content: center;
            }
            .return-home-panel .return-link {
                width: 100%;
                text-align: center;
            }
        }
    </style>
</head>
<body>
<div class="return-home-panel">
<a class="return-link return-sub" href="index.html">â† è¿”å›ç›®å½•</a>
<a class="return-link return-main" href="../index.html">âŒ‚ è¿”å›ä¸»ç«™</a>
</div>
<div class="scrolly-container">
<div class="lecture-notes">
<section class="step" data-animation="intro" id="step-intro">
<div class="chalkboard" style="flex: 1; text-align: center; ">
<h2 style="font-size: 4rem; border: none;">ç¬¬äºŒç« </h2>
<p style="font-size: 2.5rem; color: white;">æé™ä¸è¿ç»­</p>
<!-- å¯¼èˆªæŒ‰é’®ç»„ -->
<div class="home-nav-buttons">
<a class="nav-btn home-btn" href="../index.html">
<span class="btn-icon">HOME</span>
<span class="btn-text">ä¸»é¡µ</span>
</a>
<a class="nav-btn story-btn" href="../æ•…äº‹ä¹¦/index.html">
<span class="btn-icon">STORY</span>
<span class="btn-text">æ•…äº‹ä¹¦</span>
</a>
<a class="nav-btn exercise-btn" href="../ä¹ é¢˜/index.html">
<span class="btn-icon">EXERCISE</span>
<span class="btn-text">ä¹ é¢˜</span>
</a>
<a class="nav-btn resource-btn" href="../ç½‘é¡µèµ„æº/index.html">
<span class="btn-icon">RESOURCE</span>
<span class="btn-text">ç½‘é¡µèµ„æº</span>
</a>
</div>
</div>
</section>
<section class="step" data-animation="toc" id="step-toc"><!-- ç›®å½•é¡µ -->
<div class="chalkboard" style="flex: 1; text-align: center;   overflow-y: auto; align-items: flex-start; justify-content: flex-start;">
<div style="writing-mode: vertical-rl; text-orientation: mixed; font-size: 3rem; border: none; margin-bottom: 1.5rem; height: 8rem; display: flex; align-items: flex-start; justify-content: center;">
                ç›®å½•
            </div>
<div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1.5rem; margin: 0 auto; max-width: 1400px; text-align: left;">
<div style="background: rgba(255,255,255,0.1); padding: 0.8rem; border-radius: 10px; backdrop-filter: blur(10px);">
<h3 style="color: #e74c3c; font-size: 1.3rem; margin-bottom: 0.5rem; border-bottom: 2px solid #e74c3c; padding-bottom: 0.2rem;">1. æé™æ¦‚å¿µ</h3>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; font-size: 1rem; line-height: 1.3;">
<div>â€¢ æé™çš„ç›´è§‚ç†è§£</div>
<div>â€¢ æ•°åˆ—æé™</div>
<div>â€¢ å‡½æ•°æé™</div>
<div>â€¢ å·¦å³æé™</div>
<div></div>
<div></div>
</div>
</div>
<div style="background: rgba(255,255,255,0.1); padding: 0.8rem; border-radius: 10px; backdrop-filter: blur(10px);">
<h3 style="color: #e74c3c; font-size: 1.3rem; margin-bottom: 0.5rem; border-bottom: 2px solid #e74c3c; padding-bottom: 0.2rem;">2. æé™è®¡ç®—</h3>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; font-size: 1rem; line-height: 1.3;">
<div>â€¢ å››åˆ™è¿ç®—æ³•åˆ™</div>
<div>â€¢ ç›´æ¥ä»£å…¥æ³•</div>
<div>â€¢ å› å¼åˆ†è§£æ³•</div>
<div>â€¢ æœ‰ç†åŒ–æ–¹æ³•</div>
<div>â€¢ è®¡ç®—æŠ€å·§</div>
<div></div>
</div>
</div>
<div style="background: rgba(255,255,255,0.1); padding: 0.8rem; border-radius: 10px; backdrop-filter: blur(10px);">
<h3 style="color: #e74c3c; font-size: 1.3rem; margin-bottom: 0.5rem; border-bottom: 2px solid #e74c3c; padding-bottom: 0.2rem;">3. ä¸¤ä¸ªé‡è¦æé™</h3>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; font-size: 1rem; line-height: 1.3;">
<div>â€¢ ç¬¬ä¸€é‡è¦æé™</div>
<div>â€¢ ç¬¬äºŒé‡è¦æé™</div>
<div>â€¢ é‡è¦æé™åº”ç”¨</div>
<div>â€¢ æé™å˜å½¢æŠ€å·§</div>
<div></div>
<div></div>
</div>
</div>
<div style="background: rgba(255,255,255,0.1); padding: 0.8rem; border-radius: 10px; backdrop-filter: blur(10px);">
<h3 style="color: #e74c3c; font-size: 1.3rem; margin-bottom: 0.5rem; border-bottom: 2px solid #e74c3c; padding-bottom: 0.2rem;">4. æ— ç©·å°çš„æ¯”è¾ƒ</h3>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; font-size: 1rem; line-height: 1.3;">
<div>â€¢ æ— ç©·å°å®šä¹‰</div>
<div>â€¢ æ— ç©·å¤§å®šä¹‰</div>
<div>â€¢ æ— ç©·å°æ¯”è¾ƒ</div>
<div>â€¢ ç­‰ä»·æ— ç©·å°</div>
<div>â€¢ ç­‰ä»·æ›¿æ¢åº”ç”¨</div>
<div></div>
</div>
</div>
<div style="background: rgba(255,255,255,0.1); padding: 0.8rem; border-radius: 10px; backdrop-filter: blur(10px);">
<h3 style="color: #e74c3c; font-size: 1.3rem; margin-bottom: 0.5rem; border-bottom: 2px solid #e74c3c; padding-bottom: 0.2rem;">5. è¿ç»­æ€§ä¸é—´æ–­ç‚¹</h3>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; font-size: 1rem; line-height: 1.3;">
<div>â€¢ è¿ç»­çš„å®šä¹‰</div>
<div>â€¢ é—´æ–­ç‚¹åˆ†ç±»</div>
<div>â€¢ åˆç­‰å‡½æ•°è¿ç»­æ€§</div>
<div>â€¢ è¿ç»­æ€§åˆ¤å®š</div>
<div>â€¢ è¿ç»­æ€§çš„åº”ç”¨</div>
<div></div>
</div>
</div>
<div style="background: rgba(255,255,255,0.1); padding: 0.8rem; border-radius: 10px; backdrop-filter: blur(10px);">
<h3 style="color: #e74c3c; font-size: 1.3rem; margin-bottom: 0.5rem; border-bottom: 2px solid #e74c3c; padding-bottom: 0.2rem;">6. ç« èŠ‚æ€»ç»“</h3>
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; font-size: 1rem; line-height: 1.3;">
<div>â€¢ æ ¸å¿ƒæ¦‚å¿µå›é¡¾</div>
<div>â€¢ é‡è¦å…¬å¼æ€»ç»“</div>
<div>â€¢ è§£é¢˜æ–¹æ³•å½’çº³</div>
<div>â€¢ ä¸‹ç« é¢„å‘Š</div>
<div></div>
<div></div>
</div>
</div>
</div>
</div>
</section>
<section class="step" data-animation="why-limit" id="step-why-limit"><!-- ç¬¬1é¡µï¼šå¼•è¨€ - ä¸ºä»€ä¹ˆè¦å­¦æé™ -->
<div class="chalkboard">
<h2>ä¸ºä»€ä¹ˆè¦å­¦æé™ï¼Ÿ</h2>
<h3>å¤ä»£éš¾é¢˜</h3>
<p>å¤å¸Œè…Šå“²å­¦å®¶èŠè¯ºæå‡ºï¼š<span class="highlight">é˜¿åŸºé‡Œæ–¯è¿½é¾Ÿæ‚–è®º</span></p>
<p>è·‘å¾—å¿«çš„é˜¿åŸºé‡Œæ–¯æ°¸è¿œè¿½ä¸ä¸Šå‰é¢çš„ä¹Œé¾Ÿï¼Ÿå› ä¸ºå½“ä»–è·‘åˆ°ä¹Œé¾ŸåŸæ¥çš„ä½ç½®æ—¶ï¼Œä¹Œé¾Ÿåˆå‘å‰çˆ¬äº†ä¸€æ®µ...</p>
<h3>ç°å®é—®é¢˜</h3>
<ul>
<li><strong>ç¬æ—¶é€Ÿåº¦</strong>ï¼šæ±½è½¦é€Ÿåº¦è¡¨æ˜¾ç¤ºçš„æ˜¯ç¬é—´é€Ÿåº¦ï¼Œæ€ä¹ˆç®—ï¼Ÿ</li>
<li><strong>æ›²çº¿åˆ‡çº¿</strong>ï¼šGPSå¯¼èˆªçš„è½¬å¼¯æç¤ºéœ€è¦è®¡ç®—é“è·¯åˆ‡çº¿</li>
<li><strong>ç»æµå†³ç­–</strong>ï¼šå½“äº§é‡å¢åŠ ä¸€ä¸ªå•ä½æ—¶ï¼Œæˆæœ¬å¢åŠ å¤šå°‘ï¼Ÿ</li>
<li><strong>å›¾åƒå‹ç¼©</strong>ï¼šJPEGå¦‚ä½•ç”¨æœ‰é™æ•°æ®é€¼è¿‘åŸå§‹å›¾åƒï¼Ÿ</li>
</ul>
<div class="warning-box">
<p><strong>æ ¸å¿ƒçŸ›ç›¾ï¼š</strong>æˆ‘ä»¬æƒ³çŸ¥é“"ç¬é—´"çš„å˜åŒ–ç‡ï¼Œä½†"ç¬é—´"æ„å‘³ç€æ—¶é—´ä¸º0ï¼Œè€Œ0ä¸èƒ½åšåˆ†æ¯ï¼</p>
<p>æé™å°±æ˜¯è§£å†³è¿™ä¸ªçŸ›ç›¾çš„<span class="highlight">æ•°å­¦å·¥å…·</span>ã€‚</p>
</div>
</div>
</section>
<section class="step" data-animation="intuitive-limit" id="step-intuitive-limit"><!-- ç¬¬2é¡µï¼šä»€ä¹ˆæ˜¯æé™ - ç›´è§‚ç†è§£ -->
<div class="chalkboard">
<h2>ä»€ä¹ˆæ˜¯æé™ï¼Ÿ</h2>
<h3>æ ¸å¿ƒæ€æƒ³</h3>
<p>æé™æè¿°çš„æ˜¯ä¸€ä¸ª<span class="highlight">å˜åŒ–è¿‡ç¨‹çš„è¶‹åŠ¿</span>ï¼Œè€Œä¸æ˜¯æœ€ç»ˆç»“æœã€‚</p>
<div class="example-box">
<h4>ç”Ÿæ´»ä¾‹å­1ï¼šå¾€æ¯å­é‡Œå€’æ°´</h4>
<p>å‡è®¾æ¯å­å®¹é‡æ˜¯1å‡ï¼Œä½ æ¯æ¬¡å€’å…¥å‰©ä½™ç©ºé—´çš„ä¸€åŠï¼š</p>
<ul>
<li>ç¬¬1æ¬¡ï¼šå€’å…¥0.5å‡ï¼ˆæ¯ä¸­0.5å‡ï¼‰</li>
<li>ç¬¬2æ¬¡ï¼šå€’å…¥0.25å‡ï¼ˆæ¯ä¸­0.75å‡ï¼‰</li>
<li>ç¬¬3æ¬¡ï¼šå€’å…¥0.125å‡ï¼ˆæ¯ä¸­0.875å‡ï¼‰</li>
</ul>
<p>æ°¸è¿œå€’ä¸æ»¡ï¼Œä½†<span class="highlight">æ— é™æ¥è¿‘1å‡</span>ï¼</p>
</div>
<!-- æ–°å¢æ›´è´´è¿‘ç”Ÿæ´»çš„ä¾‹å­ -->
<div class="example-box" style="background: rgba(155, 89, 182, 0.1);">
<h4>ç”Ÿæ´»ä¾‹å­2ï¼šæ‰‹æœºç”µé‡</h4>
<p>æ‰‹æœºæ˜¾ç¤º"1%ç”µé‡"ï¼Œä½†æ°¸è¿œç”¨ä¸å®Œï¼Ÿ</p>
<p>å®é™…ä¸Šæ˜¯ 1.4% â†’ 1.1% â†’ 1.01% â†’ ...</p>
<p><span class="highlight">æ— é™æ¥è¿‘0ï¼Œä½†è¿˜æ²¡åˆ°0</span></p>
</div>
<div class="example-box" style="background: rgba(230, 126, 34, 0.1);">
<h4>ç”Ÿæ´»ä¾‹å­3ï¼šå’Œæœ‹å‹çº¦è§é¢</h4>
<p>"é©¬ä¸Šåˆ°" â†’ "5åˆ†é’Ÿ" â†’ "2åˆ†é’Ÿ" â†’ "æ¥¼ä¸‹äº†"</p>
<p>æ—¶é—´é—´éš”è¶Šæ¥è¶Šå°ï¼Œ<span class="highlight">è¶‹å‘äºè§é¢é‚£ä¸€åˆ»</span></p>
</div>
<div class="warning-box">
<p><strong>è®°ä½ï¼š</strong></p>
<p>æé™ = "è¶Šæ¥è¶Šæ¥è¿‘" è€Œä¸æ˜¯ "åˆ°è¾¾"</p>
<p>å°±åƒè¿½å¥³æœ‹å‹ï¼Œè¿‡ç¨‹æ¯”ç»“æœé‡è¦ï¼ğŸ˜Š</p>
</div>
<div class="math-formula">
                æ€»é‡ = 0.5 + 0.25 + 0.125 + ... â†’ 1
            </div>
<p><strong>å…³é”®ç†è§£ï¼š</strong>æé™ä¸æ˜¯"åˆ°è¾¾"ï¼Œè€Œæ˜¯"è¶‹å‘"ï¼</p>
</div>
</section>
<section class="step" data-animation="convergent-sequences" id="step-convergent-sequences"><!-- ç¬¬3é¡µï¼šæ•°åˆ—æé™ - æ”¶æ•›æ•°åˆ— -->
<div class="chalkboard">
<h2>æ•°åˆ—æé™ï¼ˆæ”¶æ•›ï¼‰</h2>
<h3>ä»€ä¹ˆæ˜¯æ•°åˆ—ï¼Ÿ</h3>
<p>æŒ‰ä¸€å®šè§„å¾‹æ’åˆ—çš„ä¸€ä¸²æ•°ï¼š$a_1, a_2, a_3, ..., a_n, ...$</p>
<h3>æ”¶æ•›æ•°åˆ—</h3>
<p>å½“é¡¹æ•° $n$ æ— é™å¢å¤§æ—¶ï¼Œ$a_n$ æ— é™æ¥è¿‘æŸä¸ªç¡®å®šçš„æ•° $A$ã€‚</p>
<div class="math-formula">
                $\lim\limits_{n \to \infty} a_n = A$
            </div>
<div class="example-box">
<h4>å…¸å‹æ”¶æ•›æ¨¡å¼</h4>
<ul>
<li>æŒ‡æ•°è¡°å‡ï¼šè¶Šæ¥è¶Šå¿«åœ°æ¥è¿‘æé™</li>
<li>äº¤æ›¿æ”¶æ•›ï¼šæ­£è´Ÿäº¤æ›¿ä½†å¹…åº¦é€’å‡</li>
<li>è°ƒå’Œæ”¶æ•›ï¼šç¼“æ…¢ä½†ç¨³å®šåœ°æ¥è¿‘</li>
<li>æŒ¯è¡æ”¶æ•›ï¼šæ³¢åŠ¨ä¸­è¶‹å‘æé™</li>
</ul>
</div>
<p>è§‚å¯Ÿå³ä¾§15ç§ä¸åŒçš„æ”¶æ•›æ¨¡å¼ï¼Œä½“ä¼šæ”¶æ•›çš„å¤šæ ·æ€§ã€‚</p>
</div>
</section>
<section class="step" data-animation="divergent-sequences" id="step-divergent-sequences"><!-- ç¬¬4é¡µï¼šæ•°åˆ—æé™ - å‘æ•£æ•°åˆ— -->
<div class="chalkboard">
<h2>æ•°åˆ—æé™ï¼ˆå‘æ•£ï¼‰</h2>
<h3>å‘æ•£æ•°åˆ—çš„ç‰¹å¾</h3>
<p>æ•°åˆ—çš„é¡¹ä¸è¶‹å‘äºä»»ä½•å›ºå®šå€¼ã€‚</p>
<div class="example-box">
<h4>å‘æ•£çš„ç±»å‹</h4>
<ul>
<li><strong>è¶‹å‘æ— ç©·ï¼š</strong>$a_n = n$ â†’ $+\infty$</li>
<li><strong>æŒ¯è¡å‘æ•£ï¼š</strong>$a_n = (-1)^n \cdot n$</li>
<li><strong>å‘¨æœŸæŒ¯è¡ï¼š</strong>$a_n = (-1)^n$</li>
<li><strong>æ··æ²Œå‘æ•£ï¼š</strong>æ— è§„å¾‹çš„å˜åŒ–</li>
</ul>
</div>
<div class="warning-box">
<p><strong>åˆ¤æ–­æŠ€å·§ï¼š</strong></p>
<p>â€¢ å¦‚æœèƒ½æ‰¾åˆ°æé™å€¼ â†’ æ”¶æ•›</p>
<p>â€¢ å¦‚æœæ— é™å¢å¤§/å‡å° â†’ å‘æ•£</p>
<p>â€¢ å¦‚æœæŒç»­æŒ¯è¡ â†’ å‘æ•£</p>
</div>
</div>
</section>
<section class="step" data-animation="sequence-calculation" id="step-sequence-calculation"><!-- ç¬¬5é¡µï¼šæ•°åˆ—æé™çš„è®¡ç®— -->
<div class="chalkboard">
<h2>æ•°åˆ—æé™çš„è®¡ç®—æ–¹æ³•</h2>
<h3>åŸºæœ¬æ–¹æ³•</h3>
<div class="example-box">
<h4>æ–¹æ³•1ï¼šç›´æ¥ä»£å…¥æ³•</h4>
<p>$\lim\limits_{n \to \infty} \frac{1}{n^2} = \frac{1}{\infty} = 0$</p>
<p>ï¼ˆæ— ç©·å¤§çš„å€’æ•°æ˜¯0ï¼‰</p>
</div>
<div class="example-box">
<h4>æ–¹æ³•2ï¼šåˆ†å­åˆ†æ¯åŒé™¤æœ€é«˜æ¬¡</h4>
<p>æ±‚ï¼š$\lim\limits_{n \to \infty} \frac{2n^2 + 3n + 1}{n^2 + 5}$</p>
<div class="step-box">
<p>æ­¥éª¤1ï¼šåˆ†å­åˆ†æ¯åŒé™¤ä»¥ $n^2$</p>
<p>$= \lim\limits_{n \to \infty} \frac{2 + \frac{3}{n} + \frac{1}{n^2}}{1 + \frac{5}{n^2}}$</p>
<p>æ­¥éª¤2ï¼šå½“ $n \to \infty$ æ—¶ï¼Œ$\frac{1}{n} \to 0$</p>
<p>$= \frac{2 + 0 + 0}{1 + 0} = 2$</p>
</div>
</div>
<h3>è®°ä½è§„å¾‹</h3>
<ul>
<li>åˆ†å­æ¬¡æ•° &gt; åˆ†æ¯æ¬¡æ•° â†’ æé™ä¸º âˆ</li>
<li>åˆ†å­æ¬¡æ•° = åˆ†æ¯æ¬¡æ•° â†’ æé™ä¸ºç³»æ•°æ¯”</li>
<li>åˆ†å­æ¬¡æ•° &lt; åˆ†æ¯æ¬¡æ•° â†’ æé™ä¸º 0</li>
</ul>
</div>
</section>
<section class="step" data-animation="function-limits" id="step-function-limits"><!-- ç¬¬6é¡µï¼šå‡½æ•°æé™ -->
<div class="chalkboard">
<h2>å‡½æ•°çš„æé™</h2>
<h3>ä¸¤ç§åŸºæœ¬æƒ…å†µ</h3>
<div class="example-box">
<h4>æƒ…å†µ1ï¼š$x$ è¶‹å‘äºæŸä¸ªæ•°</h4>
<p>$\lim\limits_{x \to a} f(x) = L$</p>
<p>æ„ä¹‰ï¼šå½“ $x$ æ— é™æ¥è¿‘ $a$ æ—¶ï¼Œ$f(x)$ æ— é™æ¥è¿‘ $L$</p>
</div>
<div class="example-box">
<h4>æƒ…å†µ2ï¼š$x$ è¶‹å‘äºæ— ç©·</h4>
<p>$\lim\limits_{x \to \infty} f(x) = L$</p>
<p>æ„ä¹‰ï¼šå½“ $x$ æ— é™å¢å¤§æ—¶ï¼Œ$f(x)$ æ— é™æ¥è¿‘ $L$</p>
</div>
<div class="math-formula">
                $\lim\limits_{x \to a} f(x) = L$ çš„å«ä¹‰ï¼š<br/>
                å¯¹ä»»æ„å°çš„ $\varepsilon &gt; 0$ï¼Œå­˜åœ¨ $\delta &gt; 0$ï¼Œ<br/>
                å½“ $0 &lt; |x - a| &lt; \delta$ æ—¶ï¼Œ$|f(x) - L| &lt; \varepsilon$
            </div>
<p><strong>å…³é”®ï¼š</strong>$x$ å¯ä»¥ä»ä»»æ„æ–¹å‘æ¥è¿‘ç›®æ ‡å€¼ï¼</p>
</div>
</section>
<section class="step" data-animation="one-sided-limits" id="step-one-sided-limits"><!-- ç¬¬7é¡µï¼šå·¦å³æé™ -->
<div class="chalkboard">
<h2>å·¦æé™ä¸å³æé™</h2>
<h3>ä¸ºä»€ä¹ˆè¦åˆ†å·¦å³ï¼Ÿ</h3>
<p>æœ‰äº›å‡½æ•°åœ¨æŸç‚¹å¤„ä»ä¸åŒæ–¹å‘æ¥è¿‘ä¼šå¾—åˆ°<span class="highlight">ä¸åŒçš„å€¼</span>ã€‚</p>
<div class="example-box">
<h4>å·¦æé™</h4>
<p>$\lim\limits_{x \to a^-} f(x) = L_1$</p>
<p>ä»å·¦ä¾§ï¼ˆå°äº$a$çš„æ–¹å‘ï¼‰æ¥è¿‘</p>
</div>
<div class="example-box">
<h4>å³æé™</h4>
<p>$\lim\limits_{x \to a^+} f(x) = L_2$</p>
<p>ä»å³ä¾§ï¼ˆå¤§äº$a$çš„æ–¹å‘ï¼‰æ¥è¿‘</p>
</div>
<div class="warning-box">
<p><strong>æé™å­˜åœ¨çš„æ¡ä»¶ï¼š</strong></p>
<p>$\lim\limits_{x \to a} f(x)$ å­˜åœ¨ âŸº $\lim\limits_{x \to a^-} f(x) = \lim\limits_{x \to a^+} f(x)$</p>
<p>å·¦æé™ = å³æé™ = å…±åŒå€¼</p>
</div>
<p><strong>è®°å¿†å£è¯€ï¼š</strong>å·¦å³ç›¸ç­‰æé™åœ¨ï¼Œå·¦å³ä¸ç­‰æ— æé™ã€‚</p>
</div>
</section>
<section class="step" data-animation="one-sided-detailed" id="step-one-sided-detailed"><!-- ç¬¬7.1é¡µï¼šå·¦å³æé™è¯¦ç»†æ¼”ç¤º -->
<div class="chalkboard">
<h2>å·¦å³æé™è¯¦ç»†æ¼”ç¤º</h2>
<p>å•ä¾§æé™çš„å„ç§æƒ…å†µï¼š</p>
<ul>
<li>ç›¸ç­‰ï¼ˆæé™å­˜åœ¨ï¼‰</li>
<li>ä¸ç›¸ç­‰ï¼ˆè·³è·ƒï¼‰</li>
<li>ä¸€ä¾§ä¸å­˜åœ¨</li>
<li>æŒ¯è¡é—´æ–­</li>
<li>å¯å»é—´æ–­</li>
</ul>
</div>
</section>
<section class="step" data-animation="limit-operations" id="step-limit-operations"><!-- ç¬¬8é¡µï¼šæé™çš„å››åˆ™è¿ç®— -->
<div class="chalkboard">
<h2>æé™çš„å››åˆ™è¿ç®—æ³•åˆ™</h2>
<h3>åŸºæœ¬æ³•åˆ™</h3>
<p>è‹¥ $\lim f(x) = A$ï¼Œ$\lim g(x) = B$ï¼Œåˆ™ï¼š</p>
<div class="math-formula">
<p>åŠ æ³•ï¼š$\lim [f(x) + g(x)] = A + B$</p>
<p>å‡æ³•ï¼š$\lim [f(x) - g(x)] = A - B$</p>
<p>ä¹˜æ³•ï¼š$\lim [f(x) \cdot g(x)] = A \cdot B$</p>
<p>é™¤æ³•ï¼š$\lim \frac{f(x)}{g(x)} = \frac{A}{B}$ ï¼ˆ$B \neq 0$ï¼‰</p>
</div>
<div class="example-box">
<h4>æ¨è®º</h4>
<ul>
<li>å¸¸æ•°å€ï¼š$\lim [c \cdot f(x)] = c \cdot A$</li>
<li>å¹‚è¿ç®—ï¼š$\lim [f(x)]^n = A^n$</li>
<li>æ ¹è¿ç®—ï¼š$\lim \sqrt[n]{f(x)} = \sqrt[n]{A}$ï¼ˆ$A &gt; 0$ï¼‰</li>
</ul>
</div>
<p><strong>æ³¨æ„ï¼š</strong>åªæœ‰å½“å„éƒ¨åˆ†æé™éƒ½å­˜åœ¨æ—¶ï¼Œæ³•åˆ™æ‰èƒ½ç”¨ï¼</p>
</div>
</section>
<section class="step" data-animation="limit-methods-detailed" id="step-limit-methods-detailed"><!-- ç¬¬8.1é¡µï¼šæé™è¿ç®—æ–¹æ³• -->
<div class="chalkboard">
<h2>æé™è¿ç®—æ–¹æ³•</h2>
<p><strong>ç›´æ¥ä»£å…¥æ³•</strong>ï¼šè¿ç»­ç‚¹å¤„ç›´æ¥ä»£å…¥</p>
<p><strong>å› å¼åˆ†è§£æ³•</strong>ï¼šçº¦å»é›¶å› å­</p>
<p><strong>æ ¹å¼æœ‰ç†åŒ–</strong>ï¼šåˆ†å­åˆ†æ¯æœ‰ç†åŒ–</p>
<p><strong>æ— ç©·å¤§æ¯”è¾ƒæ³•</strong>ï¼šæ¯”è¾ƒæœ€é«˜æ¬¡é¡¹</p>
<p><strong>ç­‰ä»·æ— ç©·å°æ›¿æ¢</strong>ï¼šä¹˜é™¤å…³ç³»ä¸­æ›¿æ¢</p>
<p>å±•ç¤º12ç§å¸¸ç”¨çš„æé™è®¡ç®—æŠ€å·§</p>
</div>
</section>
<section class="step" data-animation="limit-methods" id="step-limit-methods"><!-- ç¬¬9é¡µï¼šæé™è®¡ç®—æŠ€å·§ -->
<div class="chalkboard">
<h2>æé™è®¡ç®—æŠ€å·§</h2>
<h3>0/0å‹æœªå®šå¼</h3>
<p>ç›´æ¥ä»£å…¥å¾—åˆ°0/0æ—¶ï¼Œéœ€è¦åŒ–ç®€ï¼</p>
<div class="example-box">
<h4>æ–¹æ³•1ï¼šå› å¼åˆ†è§£</h4>
<p>$\lim\limits_{x \to 1} \frac{x^2 - 1}{x - 1} = \lim\limits_{x \to 1} \frac{(x+1)(x-1)}{x-1} = 2$</p>
</div>
<div class="example-box">
<h4>æ–¹æ³•2ï¼šæœ‰ç†åŒ–</h4>
<p>$\lim\limits_{x \to 0} \frac{\sqrt{x+1} - 1}{x}$ </p>
<p>åˆ†å­åˆ†æ¯åŒä¹˜ $\sqrt{x+1} + 1$ åå¾— $\frac{1}{2}$</p>
</div>
<h3>âˆ/âˆå‹æœªå®šå¼</h3>
<div class="example-box">
<h4>æ–¹æ³•ï¼šé™¤ä»¥æœ€é«˜æ¬¡</h4>
<p>$\lim\limits_{x \to \infty} \frac{3x^2 + 2x}{x^2 - 5} = \lim\limits_{x \to \infty} \frac{3 + \frac{2}{x}}{1 - \frac{5}{x^2}} = 3$</p>
</div>
<p><strong>è®°ä½ï¼š</strong>é‡åˆ°0/0è¦åŒ–ç®€ï¼Œé‡åˆ°âˆ/âˆçœ‹æœ€é«˜æ¬¡ï¼</p>
</div>
</section>
<section class="step" data-animation="important-limit-1" id="step-important-limit-1"><!-- ç¬¬10é¡µï¼šç¬¬ä¸€é‡è¦æé™ -->
<div class="chalkboard">
<h2>ç¬¬ä¸€é‡è¦æé™</h2>
<div class="math-formula">
                $\lim\limits_{x \to 0} \frac{\sin x}{x} = 1$
            </div>
<h3>å‡ ä½•ç†è§£</h3>
<p>åœ¨å•ä½åœ†ä¸­ï¼Œå½“è§’åº¦å¾ˆå°æ—¶ï¼š</p>
<p>å¼§é•¿ â‰ˆ å¼¦é•¿ â‰ˆ æ­£åˆ‡çº¿é•¿</p>
<p>å³ï¼š$x â‰ˆ \sin x â‰ˆ \tan x$ ï¼ˆ$x$å¾ˆå°æ—¶ï¼‰</p>
<h3>æ¨å¹¿å½¢å¼</h3>
<p>è‹¥ $f(x) \to 0$ï¼Œåˆ™ï¼š</p>
<div class="math-formula">
                $\lim\limits_{f(x) \to 0} \frac{\sin f(x)}{f(x)} = 1$
            </div>
<div class="example-box">
<h4>åº”ç”¨ä¾‹å­</h4>
<p>$\lim\limits_{x \to 0} \frac{\sin 3x}{x} = \lim\limits_{x \to 0} \frac{\sin 3x}{3x} \cdot 3 = 1 \cdot 3 = 3$</p>
</div>
<p><strong>æŠ€å·§ï¼š</strong>å‡‘å‡ºæ ‡å‡†å½¢å¼ï¼Œç„¶ååº”ç”¨é‡è¦æé™ã€‚</p>
</div>
</section>
<section class="step" data-animation="important-limit-2" id="step-important-limit-2"><!-- ç¬¬11é¡µï¼šç¬¬äºŒé‡è¦æé™ -->
<div class="chalkboard">
<h2>ç¬¬äºŒé‡è¦æé™</h2>
<div class="math-formula">
                $\lim\limits_{x \to \infty} \left(1 + \frac{1}{x}\right)^x = e \approx 2.718$
            </div>
<h3>è‡ªç„¶å¸¸æ•° $e$ çš„æ„ä¹‰</h3>
<p>è¿™æ˜¯<span class="highlight">è‡ªç„¶å¸¸æ•°e</span>çš„å®šä¹‰ï¼Œåœ¨å¤åˆ©ã€äººå£å¢é•¿ã€æ”¾å°„æ€§è¡°å˜ç­‰é—®é¢˜ä¸­å¹¿æ³›åº”ç”¨ã€‚</p>
<h3>æ¨å¹¿å½¢å¼</h3>
<p>è‹¥ $f(x) \to \infty$ï¼Œåˆ™ï¼š</p>
<div class="math-formula">
                $\lim\limits_{f(x) \to \infty} \left(1 + \frac{1}{f(x)}\right)^{f(x)} = e$
            </div>
<div class="example-box">
<h4>å˜å½¢åº”ç”¨</h4>
<p>$\lim\limits_{x \to \infty} \left(1 + \frac{2}{x}\right)^x = \lim\limits_{x \to \infty} \left[\left(1 + \frac{1}{x/2}\right)^{x/2}\right]^2 = e^2$</p>
</div>
<p><strong>æ„ä¹‰ï¼š</strong>æè¿°äº†è¿ç»­å¤åˆ©çš„æé™æƒ…å†µã€‚</p>
</div>
</section>
<section class="step" data-animation="important-limits-detailed" id="step-important-limits-detailed"><!-- ç¬¬11.1é¡µï¼šä¸¤ä¸ªé‡è¦æé™ -->
<div class="chalkboard">
<h2>ä¸¤ä¸ªé‡è¦æé™</h2>
<p><strong>é‡è¦æé™ Iï¼š</strong> $\lim\limits_{x \to 0} \frac{\sin x}{x} = 1$</p>
<p><strong>é‡è¦æé™ IIï¼š</strong> $\lim\limits_{x \to \infty} \left(1+\frac{1}{x}\right)^x = e$</p>
<p>å±•ç¤ºå„ç§å˜å½¢å’Œåº”ç”¨</p>
</div>
</section>
<section class="step" data-animation="infinitesimal-infinity" id="step-infinitesimal-infinity"><!-- ç¬¬12é¡µï¼šæ— ç©·å°ä¸æ— ç©·å¤§ -->
<div class="chalkboard">
<h2>æ— ç©·å°ä¸æ— ç©·å¤§</h2>
<h3>æ— ç©·å°é‡</h3>
<p>æé™ä¸º0çš„å˜é‡å«<span class="highlight">æ— ç©·å°</span>ã€‚</p>
<div class="example-box">
<h4>æ€§è´¨</h4>
<ul>
<li>æœ‰é™ä¸ªæ— ç©·å°çš„å’Œä»æ˜¯æ— ç©·å°</li>
<li>æœ‰é™ä¸ªæ— ç©·å°çš„ç§¯ä»æ˜¯æ— ç©·å°</li>
<li>æœ‰ç•Œå‡½æ•°ä¸æ— ç©·å°çš„ç§¯æ˜¯æ— ç©·å°</li>
</ul>
</div>
<h3>æ— ç©·å¤§é‡</h3>
<p>æé™ä¸ºæ— ç©·çš„å˜é‡å«<span class="highlight">æ— ç©·å¤§</span>ã€‚</p>
<div class="warning-box">
<p><strong>é‡è¦å…³ç³»ï¼š</strong></p>
<p>åœ¨åŒä¸€è¿‡ç¨‹ä¸­ï¼Œæ— ç©·å¤§ä¸æ— ç©·å°ï¼ˆâ‰ 0ï¼‰äº’ä¸ºå€’æ•°ï¼š</p>
<p>è‹¥ $\lim f(x) = 0$ï¼ˆ$f(x) \neq 0$ï¼‰ï¼Œåˆ™ $\lim \frac{1}{f(x)} = \infty$</p>
</div>
<p><strong>æ³¨æ„ï¼š</strong>æ— ç©·å°æ˜¯å˜é‡ï¼Œä¸æ˜¯å¾ˆå°çš„æ•°ï¼</p>
</div>
</section>
<section class="step" data-animation="infinitesimal-comparison" id="step-infinitesimal-comparison"><!-- ç¬¬13é¡µï¼šæ— ç©·å°çš„æ¯”è¾ƒ -->
<div class="chalkboard">
<h2>æ— ç©·å°çš„æ¯”è¾ƒ</h2>
<!-- æ–°å¢ï¼šé€Ÿåº¦å¯¹æ¯”è¡¨ -->
<div class="example-box">
<h4>è¶‹å‘0çš„é€Ÿåº¦æ¯”èµ›ï¼ˆxâ†’0æ—¶ï¼‰</h4>
<table style="width: 100%; text-align: center;">
<tr style="background: rgba(255,255,255,0.1);">
<th>å‡½æ•°</th>
<th>x=0.1</th>
<th>x=0.01</th>
<th>x=0.001</th>
<th>é€Ÿåº¦</th>
</tr>
<tr>
<td>x</td>
<td>0.1</td>
<td>0.01</td>
<td>0.001</td>
<td>ğŸ¢ æ…¢</td>
</tr>
<tr>
<td>xÂ²</td>
<td>0.01</td>
<td>0.0001</td>
<td>0.000001</td>
<td>ğŸ° å¿«</td>
</tr>
<tr>
<td>xÂ³</td>
<td>0.001</td>
<td>0.000001</td>
<td>0.000000001</td>
<td>ğŸš€ è¶…å¿«</td>
</tr>
</table>
<p style="margin-top: 10px;">
<span class="highlight">ç»“è®ºï¼šæ¬¡æ•°è¶Šé«˜ï¼Œè¶‹å‘0è¶Šå¿«ï¼</span>
</p>
</div>
<h3>é˜¶çš„æ¦‚å¿µ</h3>
<p>è®¾ $\alpha$ã€$\beta$ éƒ½æ˜¯æ— ç©·å°ï¼Œä¸” $\alpha \neq 0$ï¼š</p>
<div class="math-formula">
<p>è‹¥ $\lim \frac{\beta}{\alpha} = 0$ â†’ $\beta$ æ˜¯ $\alpha$ çš„é«˜é˜¶æ— ç©·å°</p>
<p>è‹¥ $\lim \frac{\beta}{\alpha} = \infty$ â†’ $\beta$ æ˜¯ $\alpha$ çš„ä½é˜¶æ— ç©·å°</p>
<p>è‹¥ $\lim \frac{\beta}{\alpha} = k \neq 0$ â†’ $\beta$ ä¸ $\alpha$ åŒé˜¶</p>
<p>è‹¥ $\lim \frac{\beta}{\alpha} = 1$ â†’ $\beta$ ä¸ $\alpha$ ç­‰ä»·ï¼Œè®°ä½œ $\alpha \sim \beta$</p>
</div>
<h3>æ„ä¹‰</h3>
<p>æ¯”è¾ƒä¸åŒæ— ç©·å°è¶‹äº0çš„"é€Ÿåº¦"ï¼š</p>
<ul>
<li>$x^2$ æ¯” $x$ æ›´å¿«è¶‹äº0ï¼ˆé«˜é˜¶ï¼‰</li>
<li>$\sin x$ ä¸ $x$ ä»¥ç›¸åŒé€Ÿåº¦è¶‹äº0ï¼ˆç­‰ä»·ï¼‰</li>
</ul>
</div>
</section>
<section class="step" data-animation="equivalent-infinitesimal" id="step-equivalent-infinitesimal"><!-- ç¬¬14é¡µï¼šç­‰ä»·æ— ç©·å° -->
<div class="chalkboard">
<h2>å¸¸ç”¨ç­‰ä»·æ— ç©·å°</h2>
<p>å½“ $x \to 0$ æ—¶ï¼š</p>
<div class="math-formula">
<p>$\sin x \sim x$ï¼Œ$\tan x \sim x$</p>
<p>$\arcsin x \sim x$ï¼Œ$\arctan x \sim x$</p>
<p>$1 - \cos x \sim \frac{x^2}{2}$</p>
<p>$e^x - 1 \sim x$ï¼Œ$\ln(1+x) \sim x$</p>
<p>$(1+x)^a - 1 \sim ax$</p>
</div>
<div class="warning-box">
<p><strong>æ›¿æ¢è§„åˆ™ï¼š</strong></p>
<p>âœ“ ä¹˜é™¤å…³ç³»ä¸­å¯ä»¥æ›¿æ¢</p>
<p>âœ— åŠ å‡å…³ç³»ä¸­ä¸èƒ½ç›´æ¥æ›¿æ¢</p>
</div>
<div class="example-box">
<h4>åº”ç”¨ä¾‹å­</h4>
<p>$\lim\limits_{x \to 0} \frac{\sin x \cdot \tan x}{x^2} = \lim\limits_{x \to 0} \frac{x \cdot x}{x^2} = 1$</p>
</div>
</div>
</section>
<section class="step" data-animation="equivalent-infinitesimal-app" id="step-equivalent-infinitesimal-app"><!-- ç¬¬15é¡µï¼šç­‰ä»·æ— ç©·å°åº”ç”¨ -->
<div class="chalkboard">
<h2>ç­‰ä»·æ— ç©·å°åº”ç”¨æŠ€å·§</h2>
<h3>æ­£ç¡®ä½¿ç”¨æ–¹æ³•</h3>
<div class="example-box">
<h4>âœ“ æ­£ç¡®ï¼šä¹˜é™¤ä¸­æ›¿æ¢</h4>
<p>$\lim\limits_{x \to 0} \frac{\sin 3x \cdot \tan 2x}{x^2} = \lim\limits_{x \to 0} \frac{3x \cdot 2x}{x^2} = 6$</p>
</div>
<div class="warning-box">
<h4>âœ— é”™è¯¯ï¼šåŠ å‡ä¸­ç›´æ¥æ›¿æ¢</h4>
<p>$\lim\limits_{x \to 0} \frac{\sin x - \tan x}{x^3}$ ä¸èƒ½æ›¿æ¢ä¸º $\frac{x - x}{x^3} = 0$</p>
<p>æ­£ç¡®åšæ³•ï¼šå…ˆåŒ–ç®€å†æ›¿æ¢</p>
</div>
<h3>å¤„ç†åŠ å‡çš„æŠ€å·§</h3>
<ul>
<li>å…ˆé€šåˆ†æˆ–å› å¼åˆ†è§£</li>
<li>è½¬åŒ–ä¸ºä¹˜é™¤å½¢å¼</li>
<li>ä½¿ç”¨æ³°å‹’å±•å¼€ï¼ˆé«˜çº§æ–¹æ³•ï¼‰</li>
</ul>
<p><strong>è®°ä½ï¼š</strong>ç­‰ä»·æ— ç©·å°æ›¿æ¢èƒ½å¤§å¤§ç®€åŒ–è®¡ç®—ï¼</p>
</div>
</section>
<section class="step" data-animation="continuous-functions" id="step-continuous-functions"><!-- ç¬¬16é¡µï¼šå‡½æ•°çš„è¿ç»­æ€§ -->
<div class="chalkboard">
<h2>å‡½æ•°çš„è¿ç»­æ€§</h2>
<h3>è¿ç»­çš„ç›´è§‚ç†è§£</h3>
<p>å‡½æ•°å›¾åƒ<span class="highlight">ä¸æ–­å¼€</span>ï¼Œå¯ä»¥ä¸€ç¬”ç”»å‡ºæ¥ã€‚</p>
<h3>è¿ç»­çš„ä¸‰ä¸ªæ¡ä»¶</h3>
<div class="step-box">
<p><strong>æ¡ä»¶1ï¼š</strong>$f(x_0)$ æœ‰å®šä¹‰ï¼ˆç‚¹å­˜åœ¨ï¼‰</p>
<p><strong>æ¡ä»¶2ï¼š</strong>$\lim\limits_{x \to x_0} f(x)$ å­˜åœ¨ï¼ˆæé™å­˜åœ¨ï¼‰</p>
<p><strong>æ¡ä»¶3ï¼š</strong>$\lim\limits_{x \to x_0} f(x) = f(x_0)$ï¼ˆæé™ç­‰äºå‡½æ•°å€¼ï¼‰</p>
</div>
<div class="math-formula">
                å‡½æ•°åœ¨ $x_0$ å¤„è¿ç»­ âŸº $\lim\limits_{x \to x_0} f(x) = f(x_0)$
            </div>
<h3>å•ä¾§è¿ç»­</h3>
<ul>
<li>å·¦è¿ç»­ï¼š$\lim\limits_{x \to x_0^-} f(x) = f(x_0)$</li>
<li>å³è¿ç»­ï¼š$\lim\limits_{x \to x_0^+} f(x) = f(x_0)$</li>
</ul>
<p><strong>æ„ä¹‰ï¼š</strong>è¿ç»­å‡½æ•°ä¾¿äºç ”ç©¶ï¼Œè®¸å¤šå®šç†åªå¯¹è¿ç»­å‡½æ•°æˆç«‹ã€‚</p>
</div>
</section>
<section class="step" data-animation="discontinuities" id="step-discontinuities"><!-- ç¬¬17é¡µï¼šé—´æ–­ç‚¹åˆ†ç±» -->
<div class="chalkboard">
<h2>é—´æ–­ç‚¹çš„åˆ†ç±»</h2>
<h3>ç¬¬ä¸€ç±»é—´æ–­ç‚¹ï¼ˆå·¦å³æé™éƒ½å­˜åœ¨ï¼‰</h3>
<div class="example-box">
<h4>1. å¯å»é—´æ–­ç‚¹</h4>
<p>å·¦æé™ = å³æé™ â‰  å‡½æ•°å€¼ï¼ˆæˆ–æ— å®šä¹‰ï¼‰</p>
<p>ä¾‹ï¼š$f(x) = \frac{\sin x}{x}$ åœ¨ $x=0$ å¤„</p>
<p><span class="highlight">å¯ä»¥é€šè¿‡è¡¥å……å®šä¹‰"å»æ‰"é—´æ–­</span></p>
</div>
<div class="example-box">
<h4>2. è·³è·ƒé—´æ–­ç‚¹</h4>
<p>å·¦æé™ â‰  å³æé™</p>
<p>ä¾‹ï¼šç¬¦å·å‡½æ•° $\text{sgn}(x)$ åœ¨ $x=0$ å¤„</p>
<p><span class="highlight">æ— æ³•é€šè¿‡è¡¥å……å®šä¹‰æ¶ˆé™¤</span></p>
</div>
<h3>ç¬¬äºŒç±»é—´æ–­ç‚¹ï¼ˆè‡³å°‘ä¸€ä¾§æé™ä¸å­˜åœ¨ï¼‰</h3>
<div class="example-box">
<h4>æ— ç©·é—´æ–­ç‚¹</h4>
<p>ä¾‹ï¼š$f(x) = \frac{1}{x}$ åœ¨ $x=0$ å¤„</p>
</div>
<div class="example-box">
<h4>æŒ¯è¡é—´æ–­ç‚¹</h4>
<p>ä¾‹ï¼š$f(x) = \sin\frac{1}{x}$ åœ¨ $x=0$ å¤„</p>
</div>
</div>
</section>
<section class="step" data-animation="elementary-functions" id="step-elementary-functions"><!-- ç¬¬18é¡µï¼šåˆç­‰å‡½æ•°çš„è¿ç»­æ€§ -->
<div class="chalkboard">
<h2>åˆç­‰å‡½æ•°çš„è¿ç»­æ€§</h2>
<h3>åŸºæœ¬åˆç­‰å‡½æ•°</h3>
<p>åœ¨å…¶å®šä¹‰åŸŸå†…éƒ½æ˜¯è¿ç»­çš„ï¼š</p>
<div class="math-formula">
<p>â€¢ å¸¸æ•°å‡½æ•°ï¼š$f(x) = c$</p>
<p>â€¢ å¹‚å‡½æ•°ï¼š$f(x) = x^n$</p>
<p>â€¢ æŒ‡æ•°å‡½æ•°ï¼š$f(x) = a^x$ ($a &gt; 0, a \neq 1$)</p>
<p>â€¢ å¯¹æ•°å‡½æ•°ï¼š$f(x) = \log_a x$ ($a &gt; 0, a \neq 1$)</p>
<p>â€¢ ä¸‰è§’å‡½æ•°ï¼š$\sin x, \cos x, \tan x$ ç­‰</p>
<p>â€¢ åä¸‰è§’å‡½æ•°ï¼š$\arcsin x, \arccos x$ ç­‰</p>
</div>
<h3>å¤åˆè¿ç®—çš„è¿ç»­æ€§</h3>
<p>è¿ç»­å‡½æ•°ç»è¿‡ä»¥ä¸‹è¿ç®—ä»è¿ç»­ï¼š</p>
<ul>
<li>å››åˆ™è¿ç®—ï¼ˆé™¤æ³•è¦æ±‚åˆ†æ¯ä¸ä¸º0ï¼‰</li>
<li>å¤åˆè¿ç®—</li>
<li>åå‡½æ•°ï¼ˆå•è°ƒè¿ç»­å‡½æ•°ï¼‰</li>
</ul>
<p><strong>ç»“è®ºï¼š</strong>åˆç­‰å‡½æ•°åœ¨å…¶å®šä¹‰åŸŸå†…å¤„å¤„è¿ç»­ï¼</p>
</div>
</section>
<section class="step" data-animation="continuity-determination" id="step-continuity-determination"><!-- ç¬¬19é¡µï¼šè¿ç»­æ€§åˆ¤å®šä¸åº”ç”¨ -->
<div class="chalkboard">
<h2>è¿ç»­æ€§çš„åˆ¤å®šä¸åº”ç”¨</h2>
<h3>åˆ¤å®šæ­¥éª¤</h3>
<div class="step-box">
<p>1. æ£€æŸ¥å‡½æ•°æ˜¯å¦æœ‰å®šä¹‰</p>
<p>2. è®¡ç®—å·¦æé™ $\lim\limits_{x \to x_0^-} f(x)$</p>
<p>3. è®¡ç®—å³æé™ $\lim\limits_{x \to x_0^+} f(x)$</p>
<p>4. æ¯”è¾ƒï¼šå·¦æé™ = å³æé™ = å‡½æ•°å€¼ï¼Ÿ</p>
</div>
<h3>è¿ç»­å‡½æ•°çš„æ€§è´¨</h3>
<div class="example-box">
<h4>é›¶ç‚¹å®šç†</h4>
<p>è‹¥ $f(x)$ åœ¨ $[a,b]$ è¿ç»­ï¼Œ$f(a) \cdot f(b) &lt; 0$</p>
<p>åˆ™å­˜åœ¨ $c \in (a,b)$ ä½¿ $f(c) = 0$</p>
</div>
<div class="example-box">
<h4>æœ€å€¼å®šç†</h4>
<p>è¿ç»­å‡½æ•°åœ¨é—­åŒºé—´ä¸Šå¿…æœ‰æœ€å¤§å€¼å’Œæœ€å°å€¼</p>
</div>
<div class="example-box">
<h4>ä»‹å€¼å®šç†</h4>
<p>è¿ç»­å‡½æ•°å–éæœ€å€¼ä¹‹é—´çš„æ‰€æœ‰å€¼</p>
</div>
</div>
</section>
<section class="step" data-animation="applications" id="step-applications"><!-- ç¬¬20é¡µï¼šæé™åœ¨å®é™…ä¸­çš„åº”ç”¨ -->
<div class="chalkboard">
<h2>æé™çš„å®é™…åº”ç”¨</h2>
<h3>1. ç¬æ—¶é€Ÿåº¦</h3>
<div class="example-box">
<h4>é—®é¢˜ï¼šæ±½è½¦tç§’æ—¶çš„ç¬æ—¶é€Ÿåº¦</h4>
<p>ä½ç½®å‡½æ•°ï¼š$s(t) = 5t^2$ï¼ˆç±³ï¼‰</p>
<p>ç¬æ—¶é€Ÿåº¦ = $\lim\limits_{h \to 0} \frac{s(t+h) - s(t)}{h} = 10t$ m/s</p>
</div>
<h3>2. è¾¹é™…æˆæœ¬</h3>
<div class="example-box">
<h4>æˆæœ¬å‡½æ•°ï¼š$C(x) = 100 + 2x + 0.01x^2$</h4>
<p>è¾¹é™…æˆæœ¬ = $\lim\limits_{h \to 0} \frac{C(x+h) - C(x)}{h} = 2 + 0.02x$</p>
</div>
<h3>3. å›¾åƒå‹ç¼©ï¼ˆJPEGï¼‰</h3>
<div class="example-box">
<h4>æ¸è¿›å¼å‹ç¼©</h4>
<p>å›¾åƒåºåˆ— $\{P_n\}$ é€æ­¥é€¼è¿‘åŸå›¾ $P_{åŸå§‹}$</p>
<p>è¯¯å·®åºåˆ—ï¼š$\{d_n\} \to 0$ (å½“ $n \to \infty$)</p>
</div>
<p><strong>æœ¬è´¨ï¼š</strong>æé™è®©æˆ‘ä»¬èƒ½è®¡ç®—<span class="highlight">ç¬é—´çš„å˜åŒ–ç‡</span>ï¼</p>
</div>
</section>
<section class="step" data-animation="summary" id="step-summary"><!-- ç¬¬21é¡µï¼šç« èŠ‚æ€»ç»“ -->
<div class="chalkboard">
<h2>ç« èŠ‚æ€»ç»“</h2>
<h3>æ ¸å¿ƒæ¦‚å¿µç½‘ç»œ</h3>
<div class="step-box">
<p><strong>æé™</strong> â†’ æè¿°å˜åŒ–è¶‹åŠ¿</p>
<p>â”œâ”€ <strong>æ•°åˆ—æé™</strong> â†’ $n \to \infty$</p>
<p>â”œâ”€ <strong>å‡½æ•°æé™</strong> â†’ $x \to a$ æˆ– $x \to \infty$</p>
<p>â”‚   â”œâ”€ å·¦æé™ã€å³æé™</p>
<p>â”‚   â””â”€ æé™å­˜åœ¨æ¡ä»¶</p>
<p>â”œâ”€ <strong>é‡è¦æé™</strong> â†’ $\frac{\sin x}{x}$ã€$(1+\frac{1}{x})^x$</p>
<p>â”œâ”€ <strong>æ— ç©·å°</strong> â†’ æé™ä¸º0</p>
<p>â”‚   â””â”€ ç­‰ä»·æ— ç©·å°æ›¿æ¢</p>
<p>â””â”€ <strong>è¿ç»­æ€§</strong> â†’ æé™=å‡½æ•°å€¼</p>
<p>    â””â”€ é—´æ–­ç‚¹åˆ†ç±»</p>
</div>
<h3>å­¦ä¹ è¦ç‚¹</h3>
<ul>
<li>æé™æ˜¯<span class="highlight">è¶‹åŠ¿</span>ï¼Œä¸æ˜¯ç»“æœ</li>
<li>è®¡ç®—æé™è¦å…ˆåˆ¤æ–­<span class="highlight">ç±»å‹</span></li>
<li>0/0å‹è¦<span class="highlight">åŒ–ç®€</span></li>
<li>âˆ/âˆå‹çœ‹<span class="highlight">æœ€é«˜æ¬¡</span></li>
<li>ç­‰ä»·æ— ç©·å°å¯<span class="highlight">æ›¿æ¢</span></li>
</ul>
<div class="warning-box">
<p><strong>ä¸‹ä¸€æ­¥ï¼š</strong>æé™æ˜¯å¯¼æ•°çš„åŸºç¡€ï¼Œå¯¼æ•°æ˜¯å¾®åˆ†çš„æ ¸å¿ƒï¼</p>
</div>
</div>
</section>
</div>
<div class="visualization-panel">
<div class="visualization-flex" id="sticky-vis-container"></div>
</div>
</div>
<script>
    // ============ å…¨å±€å˜é‡å’Œåˆå§‹åŒ– ============
    let currentAnimations = [];
    let globalAnimationSpeed = 1.0;

    // MathJaxé‡æ–°æ¸²æŸ“
    const renderMathJax = async (container) => {
        if (window.MathJax && window.MathJax.typesetPromise) {
            try {
                await window.MathJax.typesetPromise([container]);
            } catch (error) {
                console.warn('MathJax rendering failed:', error);
            }
        }
    };

    // å¹»ç¯ç‰‡æ§åˆ¶
    function cleanupAnimations() {
        currentAnimations.forEach(cleanup => {
            if (typeof cleanup === 'function') {
                cleanup();
            }
        });
        currentAnimations = [];
    }

    function getContainer(containerId, mode = 'flex') {
        const element = document.getElementById(containerId);
        if (!element) {
            console.error(`Container ${containerId} not found`);
            return null;
        }

        element.innerHTML = '';
        element.classList.remove('visualization-grid', 'visualization-flex');
        if (mode === 'grid') {
            element.classList.add('visualization-grid');
        } else {
            element.classList.add('visualization-flex');
        }
        return element;
    }

    // ============ D3.js è¾…åŠ©å‡½æ•° ============
    function setupD3(containerId, margins = {top: 40, right: 40, bottom: 60, left: 60}) {
        const containerElement = document.getElementById(containerId);
        if (!containerElement) {
            console.error(`Container ${containerId} not found`);
            return null;
        }

        containerElement.innerHTML = '';
        containerElement.classList.remove('visualization-grid');
        containerElement.classList.add('visualization-flex');

        const container = d3.select(containerElement);
        const bounds = containerElement.getBoundingClientRect();
        
        const svg = container.append('svg')
            .attr('width', bounds.width)
            .attr('height', bounds.height);
            
        const width = bounds.width - margins.left - margins.right;
        const height = bounds.height - margins.top - margins.bottom;
        
        const g = svg.append('g')
            .attr('transform', `translate(${margins.left}, ${margins.top})`);
        
        // æ·»åŠ ç®­å¤´æ ‡è®°
        svg.append('defs').append('marker')
            .attr('id', 'arrowhead')
            .attr('viewBox', '0 -5 10 10')
            .attr('refX', 8)
            .attr('refY', 0)
            .attr('markerWidth', 8)
            .attr('markerHeight', 8)
            .attr('orient', 'auto')
            .append('path')
            .attr('d', 'M0,-5L10,0L0,5')
            .attr('fill', 'var(--danger-color)');
            
        return { container, svg, g, width, height };
    }

    // é€šç”¨å¯è§†åŒ–è®¾ç½®å‡½æ•°
    const setup = (container, index, title, approachDirection = 'both', approachValue = 'a') => {
        if (container && container.classList) {
            container.classList.remove('visualization-flex');
            container.classList.add('visualization-grid');
        }

        function parseVisTitle(title) {
            let formula = '', chinese = '';
            let t = title.trim();
            let brMatch = t.match(/^(.*?)(?:<br\s*\/?>)(.*)$/i);
            if (brMatch) {
                let part1 = brMatch[1].trim();
                let part2 = brMatch[2].trim();
                if (/^\$|\\|[a-zA-Z0-9_{}^]/.test(part2)) {
                    if (/[\u4e00-\u9fa5]/.test(part1)) {
                        chinese = part1;
                        formula = part2;
                    } else {
                        formula = part1;
                        chinese = part2;
                    }
                } else {
                    formula = part1;
                    chinese = part2;
                }
            } else {
                let colonMatch = t.match(/^(.+?)[:ï¼š]\s*(.+)$/);
                if (colonMatch) {
                    formula = colonMatch[2].trim();
                    chinese = colonMatch[1].trim();
                } else {
                    if (/[\u4e00-\u9fa5]/.test(t)) {
                        chinese = t;
                        formula = '';
                    } else {
                        formula = t;
                        chinese = '';
                    }
                }
            }
            formula = formula.trim();
            chinese = chinese.trim();
            if (formula && !/^\$.*\$$/.test(formula)) {
                formula = '$' + formula + '$';
            }
            return { formula, chinese };
        }

        function fracReplace(str) {
            return str
                .replace(/\\frac\s*{([^}]*)}\s*{([^}]*)}/g, '\\dfrac{$1}{$2}')
                .replace(/([^a-zA-Z0-9_\\])([0-9]+)\/([a-zA-Z0-9]+)/g, '$1\\dfrac{$2}{$3}')
                .replace(/([^a-zA-Z0-9_\\])([a-zA-Z0-9^{}\\]+)\/([a-zA-Z0-9^{}\\]+)/g, function(m, pre, num, den) {
                    if (num.startsWith('\\dfrac') || den.startsWith('\\dfrac')) return m;
                    return pre + '\\dfrac{' + num + '}{' + den + '}';
                });
        }

        const div = document.createElement('div');
        div.className = 'vis-item';

        // å¤„ç†è¶‹å‘å€¼æ˜¾ç¤º
        const indicator = document.createElement('div');
        indicator.className = `approach-indicator approach-${approachDirection}`;
        let displayValue = approachValue;
        if (approachValue === 'a') {
            displayValue = '0'; // é»˜è®¤æ˜¾ç¤º0è€Œä¸æ˜¯a
        } else if (approachValue === Infinity || approachValue === 'âˆ') {
            displayValue = 'âˆ';
        } else if (typeof approachValue === 'number') {
            if (approachValue === Math.PI/2) {
                displayValue = 'Ï€/2';
            } else {
                displayValue = Number.isInteger(approachValue) ? approachValue : approachValue.toFixed(1);
            }
        }
        
        const indicatorText = {
            'left': `xâ†’${displayValue}â»`,
            'right': `xâ†’${displayValue}âº`,
            'both': `xâ†’${displayValue}`,
            'infinity': 'nâ†’âˆ'
        };
        indicator.textContent = indicatorText[approachDirection] || `xâ†’${displayValue}`;
        div.appendChild(indicator);

        const titleDiv = document.createElement('div');
        titleDiv.className = 'vis-title';

        const { formula, chinese } = parseVisTitle(title);

        let formulaHtml = formula ? fracReplace(formula) : '';
        if (formulaHtml) {
            const formulaSpan = document.createElement('span');
            formulaSpan.className = 'vis-formula';
            formulaSpan.innerHTML = formulaHtml;
            titleDiv.appendChild(formulaSpan);
        }
        if (chinese) {
            const chineseSpan = document.createElement('span');
            chineseSpan.className = 'vis-chinese';
            chineseSpan.textContent = chinese;
            titleDiv.appendChild(chineseSpan);
        }

        div.appendChild(titleDiv);

        const svg = d3.select(div).append('svg')
            .attr('width', 260)
            .attr('height', 200)
            .attr('viewBox', '0 0 260 200')
            .attr('preserveAspectRatio', 'xMidYMid meet');
        
        container.appendChild(div);

        // æ·»åŠ ç‚¹å‡»å±•å¼€åŠŸèƒ½
        div.addEventListener('click', () => expandVisualization(div, title, approachDirection, displayValue));

        const width = 240;
        const height = 180;
        const margin = {top: 20, right: 20, bottom: 30, left: 30};
        const innerWidth = width - margin.left - margin.right;
        const innerHeight = height - margin.top - margin.bottom;

        const g = svg.append('g')
            .attr('transform', `translate(${margin.left},${margin.top})`);

        return { svg, g, width: innerWidth, height: innerHeight, div };
    };

    // æ ¼å¼åŒ–æ•°å€¼ä¸ºåˆ†æ•°æˆ–å°æ•°
    function formatLimitValue(value) {
        if (typeof value !== 'number') {
            return value;
        }

        if (Math.abs(value - Math.sqrt(2)) < 0.001) {
            return 'âˆš2 â‰ˆ 1.414';
        } else if (Math.abs(value - 1.618) < 0.001) {
            return '(1+âˆš5)/2 â‰ˆ 1.618';  // é»„é‡‘æ¯”ä¾‹
        } else if (Math.abs(value - 2/3) < 0.001) {
            return '2/3';  // 2/3 â‰ˆ 0.6666666666666666
        } else if (Math.abs(value - 1/3) < 0.001) {
            return '1/3';  // 1/3 â‰ˆ 0.3333333333333333
        } else if (Math.abs(value - 1/2) < 0.001) {
            return '1/2';  // 1/2 = 0.5
        } else if (Math.abs(value - 3/4) < 0.001) {
            return '3/4';  // 3/4 = 0.75
        } else if (Math.abs(value - 1/4) < 0.001) {
            return '1/4';  // 1/4 = 0.25
        } else if (Math.abs(value - 5/6) < 0.001) {
            return '5/6';  // 5/6 â‰ˆ 0.8333333333333334
        } else if (Math.abs(value - 1/6) < 0.001) {
            return '1/6';  // 1/6 â‰ˆ 0.16666666666666666
        } else if (Number.isInteger(value)) {
            return value.toString();
        } else if (value === 0) {
            return '0';
        } else {
            return value.toFixed(3);
        }
    }

    // å±•å¼€å¯è§†åŒ–åŠŸèƒ½
    function expandVisualization(originalDiv, title, approachDirection = 'both', approachValue = 'a') {
        const overlay = document.createElement('div');
        overlay.className = 'expanded-overlay';

        const content = document.createElement('div');
        content.className = 'expanded-content';
        
        // è·å–å½“å‰é¡µé¢ä¸­æ‰€æœ‰çš„å¯è§†åŒ–é¡¹ç›®
        const currentSlide = document.querySelector('.step.is-active');
        const allVisItems = currentSlide ? currentSlide.querySelectorAll('.vis-item') : [];
        const currentIndex = Array.from(allVisItems).indexOf(originalDiv);

        const titleElement = document.createElement('div');
        titleElement.className = 'expanded-title';
        
        // å¤„ç†æ ‡é¢˜ï¼Œä¿æŒæ•°å­¦å…¬å¼çš„æ­£ç¡®æ ¼å¼
        function parseExpandedTitle(title) {
            let formula = '', chinese = '';
            let t = title.trim();
            let brMatch = t.match(/^(.*?)(?:<br\s*\/?>)(.*)$/i);
            if (brMatch) {
                let part1 = brMatch[1].trim();
                let part2 = brMatch[2].trim();
                if (/^\$|\\|[a-zA-Z0-9_{}^]/.test(part2)) {
                    if (/[\u4e00-\u9fa5]/.test(part1)) {
                        chinese = part1;
                        formula = part2;
                    } else {
                        formula = part1;
                        chinese = part2;
                    }
                } else {
                    formula = part1;
                    chinese = part2;
                }
            } else {
                let colonMatch = t.match(/^(.+?)[:ï¼š]\s*(.+)$/);
                if (colonMatch) {
                    formula = colonMatch[2].trim();
                    chinese = colonMatch[1].trim();
                } else {
                    if (/[\u4e00-\u9fa5]/.test(t)) {
                        chinese = t;
                        formula = '';
                    } else {
                        formula = t;
                        chinese = '';
                    }
                }
            }
            formula = formula.trim();
            chinese = chinese.trim();
            if (formula && !/^\$.*\$$/.test(formula)) {
                formula = '$' + formula + '$';
            }
            return { formula, chinese };
        }

        function fracReplace(str) {
            return str
                .replace(/\\frac\s*{([^}]*)}\s*{([^}]*)}/g, '\\dfrac{$1}{$2}')
                .replace(/([^a-zA-Z0-9_\\])([0-9]+)\/([a-zA-Z0-9]+)/g, '$1\\dfrac{$2}{$3}')
                .replace(/([^a-zA-Z0-9_\\])([a-zA-Z0-9^{}\\]+)\/([a-zA-Z0-9^{}\\]+)/g, function(m, pre, num, den) {
                    if (num.startsWith('\\dfrac') || den.startsWith('\\dfrac')) return m;
                    return pre + '\\dfrac{' + num + '}{' + den + '}';
                });
        }

        const { formula, chinese } = parseExpandedTitle(title);
        let processedFormula = formula;
        if (formula) {
            processedFormula = fracReplace(formula);
        }
        
        if (chinese && processedFormula) {
            titleElement.innerHTML = `${chinese} - ${processedFormula}`;
        } else if (processedFormula) {
            titleElement.innerHTML = processedFormula;
        } else {
            titleElement.innerHTML = chinese;
        }
        
        content.appendChild(titleElement);

        // ä¸ºå±•å¼€çš„æ ‡é¢˜é‡æ–°æ¸²æŸ“MathJax
        setTimeout(async () => {
            await renderMathJax(titleElement);
        }, 100);

        const svgContainer = document.createElement('div');
        svgContainer.className = 'expanded-svg-container';

        const closeBtn = document.createElement('button');
        closeBtn.className = 'close-btn';
        closeBtn.innerHTML = 'Ã—';
        closeBtn.onclick = () => {
            overlay.classList.remove('active');
            setTimeout(() => document.body.removeChild(overlay), 300);
        };

        // åˆ›å»ºç®€æ´æ³¨é‡Šå†…å®¹å¹¶æ·»åŠ åˆ°æ ‡é¢˜ä¸­
        const annotation = generateSimpleAnnotation(title, approachDirection, approachValue);
        
        // å°†æ³¨é‡Šæ·»åŠ åˆ°æ ‡é¢˜çš„åŒä¸€è¡Œ
        if (chinese && processedFormula) {
            titleElement.innerHTML = `${chinese} - ${processedFormula} <span style="margin-left: 20px; color: #666; font-size: 0.9em;">${annotation}</span>`;
        } else if (processedFormula) {
            titleElement.innerHTML = `${processedFormula} <span style="margin-left: 20px; color: #666; font-size: 0.9em;">${annotation}</span>`;
        } else {
            titleElement.innerHTML = `${chinese} <span style="margin-left: 20px; color: #666; font-size: 0.9em;">${annotation}</span>`;
        }

        // è·å–åŸå§‹æ•°æ®å¹¶é‡æ–°ç»˜åˆ¶å¤§å›¾
        console.log('Original div:', originalDiv);
        console.log('Original div properties:', Object.keys(originalDiv));
        const originalData = originalDiv.__chartData;
        console.log('Original data:', originalData);
        
        // å°è¯•ä»divçš„çˆ¶å…ƒç´ æˆ–å…¶ä»–æ–¹å¼è·å–æ•°æ®
        if (!originalData) {
            console.log('Trying to find data in parent elements...');
            let parent = originalDiv.parentElement;
            while (parent && !originalData) {
                console.log('Checking parent:', parent);
                if (parent.__chartData) {
                    console.log('Found data in parent:', parent.__chartData);
                    break;
                }
                parent = parent.parentElement;
            }
        }
        
        if (originalData && originalData.drawFunction) {
            console.log('Drawing expanded chart...');
            const expandedSvg = d3.select(svgContainer).append('svg')
                .attr('width', '100%')
                .attr('height', '100%')
                .attr('viewBox', '0 0 800 500')
                .attr('preserveAspectRatio', 'xMidYMid meet');
            
            const g = expandedSvg.append('g')
                .attr('transform', 'translate(60, 50)');
            
            originalData.drawFunction(g, 680, 400);
        } else {
            console.log('No original data or drawFunction found');
            // åˆ›å»ºä¸€ä¸ªå ä½ç¬¦
            const expandedSvg = d3.select(svgContainer).append('svg')
                .attr('width', '100%')
                .attr('height', '100%')
                .attr('viewBox', '0 0 800 500')
                .attr('preserveAspectRatio', 'xMidYMid meet');
            
            expandedSvg.append('text')
                .attr('x', 400)
                .attr('y', 250)
                .attr('text-anchor', 'middle')
                .style('font-size', '18px')
                .style('fill', '#666')
                .text('å›¾è¡¨æ•°æ®æœªæ‰¾åˆ°');
        }

        content.appendChild(svgContainer);
        
        // æ·»åŠ åº•éƒ¨æ ‡æ³¨
        if (originalData && originalData.annotationData) {
            const annotationDiv = document.createElement('div');
            annotationDiv.className = 'chart-annotation';
            annotationDiv.innerHTML = generateChartAnnotation(title, originalData.annotationData);
            content.appendChild(annotationDiv);
        }
        content.appendChild(closeBtn);
        overlay.appendChild(content);
        document.body.appendChild(overlay);

        setTimeout(async () => {
            overlay.classList.add('active');
            // ä¸ºæ•´ä¸ªå±•å¼€çš„å†…å®¹é‡æ–°æ¸²æŸ“MathJaxï¼Œå»¶è¿Ÿç¡®ä¿DOMå®Œå…¨åŠ è½½
            setTimeout(async () => {
                await renderMathJax(titleElement);
                await renderMathJax(content);
            }, 300);
        }, 10);
        
        overlay.addEventListener('click', (e) => {
            if (e.target === overlay) {
                closeBtn.click();
            }
        });
    }

    // ç”Ÿæˆåº•éƒ¨æ ‡æ³¨å‡½æ•°
    function generateChartAnnotation(title, data) {
        const { type, approachPoint, limitValue, leftLimit, rightLimit, functionValue, isSequence, isDivergent, discontinuityType } = data;
        
        if (isSequence) {
            // æ•°åˆ—æé™æ ‡æ³¨
            if (isDivergent) {
                return `<span class="conclusion">ç»“è®º: å‘æ•£</span>ã€‚å½“ nâ†’âˆ æ—¶, æ•°åˆ—çš„ç‚¹${getSequenceBehavior(title)}ã€‚`;
            } else {
                // æ ¼å¼åŒ–æé™å€¼
                const formattedLimit = formatLimitValue(limitValue);
                return `<span class="conclusion">ç»“è®º: æ”¶æ•›äº${formattedLimit}</span>ã€‚å½“ nâ†’âˆ æ—¶, æ•°åˆ—çš„ç‚¹åœ¨ y=${formattedLimit} ä¸Šä¸‹æŒ¯è¡ä¸”å¹…åº¦è¡°å‡ä¸º0ã€‚`;
            }
        } else {
            // å‡½æ•°æé™æ ‡æ³¨
            if (type === 'limit') {
                if (limitValue === null) {
                    const discType = getDiscontinuityType(title, leftLimit, rightLimit);
                    return `<span class="conclusion">ç»“è®º: æé™ä¸å­˜åœ¨(${discType})</span>ã€‚<br>å·¦æé™(xâ†’${approachPoint}â»): ${leftLimit}ã€‚å³æé™(xâ†’${approachPoint}âº): ${rightLimit}ã€‚<br><div class="analysis">åˆ†æ: ${getAnalysis(leftLimit, rightLimit, discType)}ã€‚</div>`;
                } else {
                    const formattedLimit = formatLimitValue(limitValue);
                    return `<span class="conclusion">ç»“è®º: æé™å­˜åœ¨ï¼Œå€¼ä¸º${formattedLimit}</span>ã€‚<br>å·¦æé™(xâ†’${approachPoint}â»): ${formattedLimit}ã€‚å³æé™(xâ†’${approachPoint}âº): ${formattedLimit}ã€‚<br><div class="analysis">åˆ†æ: å·¦å³æé™å­˜åœ¨ä¸”ç›¸ç­‰ã€‚</div>`;
                }
            } else if (type === 'continuity') {
                if (limitValue !== null && leftLimit === rightLimit && leftLimit === functionValue) {
                    const formattedLeft = formatLimitValue(leftLimit);
                    const formattedRight = formatLimitValue(rightLimit);
                    const formattedFunction = formatLimitValue(functionValue);
                    return `<span class="conclusion">ç»“è®º: åœ¨x=${approachPoint}å¤„è¿ç»­</span>ã€‚<br><div class="analysis">åˆ†æ: å·¦æé™=${formattedLeft}, å³æé™=${formattedRight}, å‡½æ•°å€¼f(${approachPoint})=${formattedFunction}ã€‚ä¸‰è€…ç›¸ç­‰ã€‚</div>`;
                } else {
                    const formattedLeft = leftLimit ? formatLimitValue(leftLimit) : 'ä¸å­˜åœ¨';
                    const formattedRight = rightLimit ? formatLimitValue(rightLimit) : 'ä¸å­˜åœ¨';
                    const formattedFunction = functionValue ? formatLimitValue(functionValue) : 'ä¸å­˜åœ¨';
                    return `<span class="conclusion">ç»“è®º: åœ¨x=${approachPoint}å¤„é—´æ–­</span>ã€‚<br><div class="analysis">åˆ†æ: å·¦æé™=${formattedLeft}, å³æé™=${formattedRight}, å‡½æ•°å€¼f(${approachPoint})=${formattedFunction}ã€‚ä¸‰è€…ä¸å®Œå…¨ç›¸ç­‰ã€‚</div>`;
                }
            }
        }
        
        return '';
    }
    
    function getSequenceBehavior(title) {
        if (title.includes('çº¿æ€§å¢é•¿') || title.includes('å¹³æ–¹å¢é•¿')) return 'æ— é™å¢é«˜ï¼Œè¶‹äº+âˆ';
        if (title.includes('æŒ‡æ•°å¢é•¿')) return 'æŒ‡æ•°å¼æ— é™å¢é«˜';
        if (title.includes('éœ‡è¡')) return 'ä¸Šä¸‹éœ‡è¡ä¸”å¹…åº¦å¢å¤§';
        if (title.includes('äº¤æ›¿')) return 'æ­£è´Ÿäº¤æ›¿ä¸”ç»å¯¹å€¼å¢å¤§';
        if (title.includes('æ··æ²Œ')) return 'æ— è§„å¾‹éœ‡è¡';
        return 'å‘æ•£åˆ°æ— ç©·';
    }
    
    function getDiscontinuityType(title, leftLimit, rightLimit) {
        if (leftLimit === 'âˆ' || leftLimit === '-âˆ' || rightLimit === 'âˆ' || rightLimit === '-âˆ') {
            return 'æ— ç©·é—´æ–­ç‚¹';
        }
        if (leftLimit !== rightLimit && leftLimit !== 'æŒ¯è¡' && rightLimit !== 'æŒ¯è¡') {
            return 'è·³è·ƒé—´æ–­ç‚¹';
        }
        if (leftLimit === 'æŒ¯è¡' || rightLimit === 'æŒ¯è¡') {
            return 'æŒ¯è¡é—´æ–­ç‚¹';
        }
        return 'é—´æ–­ç‚¹';
    }
    
    function getAnalysis(leftLimit, rightLimit, discType) {
        if (discType === 'è·³è·ƒé—´æ–­ç‚¹') return 'å·¦å³æé™å­˜åœ¨ä½†ä¸ç›¸ç­‰';
        if (discType === 'æ— ç©·é—´æ–­ç‚¹') return 'è‡³å°‘ä¸€ä¾§æé™ä¸ºæ— ç©·';
        if (discType === 'æŒ¯è¡é—´æ–­ç‚¹') return 'è‡³å°‘ä¸€ä¾§æé™ä¸å­˜åœ¨';
        return 'æé™æ€§è´¨å¤æ‚';
    }
    
    function calculateLeftLimit(caseItem, a) {
        try {
            if (caseItem.name.includes('æŒ¯è¡')) return 'æŒ¯è¡';
            if (caseItem.name.includes('ä¸å­˜åœ¨') && caseItem.name.includes('å·¦æé™')) return 'ä¸å­˜åœ¨';
            const testVal = a - 0.01;
            const result = caseItem.fnLeft(testVal);
            if (!isFinite(result)) return result > 0 ? '+âˆ' : '-âˆ';
            return result.toFixed(1);
        } catch(e) {
            return 'ä¸å­˜åœ¨';
        }
    }
    
    function calculateRightLimit(caseItem, a) {
        try {
            if (caseItem.name.includes('æŒ¯è¡')) return 'æŒ¯è¡';
            if (caseItem.name.includes('ä¸å­˜åœ¨') && caseItem.name.includes('å³æé™')) return 'ä¸å­˜åœ¨';
            const testVal = a + 0.01;
            const result = caseItem.fnRight(testVal);
            if (!isFinite(result)) return result > 0 ? '+âˆ' : '-âˆ';
            return result.toFixed(1);
        } catch(e) {
            return 'ä¸å­˜åœ¨';
        }
    }

    // ç”Ÿæˆç®€æ´æ³¨é‡Š
    function generateSimpleAnnotation(title, approachDirection, approachValue) {
        const annotations = {
            'å·¦æé™': 'ä»å·¦ä¾§æ¥è¿‘',
            'å³æé™': 'ä»å³ä¾§æ¥è¿‘',
            'åŒä¾§æé™': 'ä»ä¸¤ä¾§æ¥è¿‘',
            'æ— ç©·å¤§': 'è¶‹å‘æ— ç©·',
            'æ— ç©·å°': 'è¶‹å‘é›¶',
            'è¿ç»­å‡½æ•°': 'æ— é—´æ–­ç‚¹',
            'é—´æ–­ç‚¹': 'å­˜åœ¨é—´æ–­',
            'åˆç­‰å‡½æ•°': 'åŸºæœ¬å‡½æ•°ç±»å‹',
            'ç­‰ä»·æ— ç©·å°': 'æé™å€¼ç›¸ç­‰'
        };
        
        for (const [key, value] of Object.entries(annotations)) {
            if (title.includes(key)) {
                return `<div class="annotation-text">${value}</div>`;
            }
        }
        
        if (approachDirection === 'left') {
            return '<div class="annotation-text">ä»å·¦ä¾§æ¥è¿‘</div>';
        } else if (approachDirection === 'right') {
            return '<div class="annotation-text">ä»å³ä¾§æ¥è¿‘</div>';
        } else if (approachDirection === 'both') {
            return '<div class="annotation-text">ä»ä¸¤ä¾§æ¥è¿‘</div>';
        }
        
        return null;
    }

    // åæ ‡è½´ç»˜åˆ¶å‡½æ•°
    function drawAxes(g, xScale, yScale, width, height) {
        const xDomain = xScale.domain();
        const yDomain = yScale.domain();
        
        // Xè½´
        const xAxisY = (yDomain[0] <= 0 && yDomain[1] >= 0) ? yScale(0) : height;
        g.append('g')
            .attr('class', 'x-axis')
            .attr('transform', `translate(0,${xAxisY})`)
            .call(d3.axisBottom(xScale).ticks(5).tickSizeOuter(0));
        
        // Yè½´
        const yAxisX = (xDomain[0] <= 0 && xDomain[1] >= 0) ? xScale(0) : 0;
        g.append('g')
            .attr('class', 'y-axis')
            .attr('transform', `translate(${yAxisX},0)`)
            .call(d3.axisLeft(yScale).ticks(5).tickSizeOuter(0));
            
        // ç½‘æ ¼çº¿
        g.append('g')
            .attr('class', 'grid')
            .attr('opacity', 0.1)
            .call(d3.axisBottom(xScale).ticks(5)
                .tickSize(height)
                .tickFormat(''))
            .attr('transform', `translate(0,0)`);
            
        g.append('g')
            .attr('class', 'grid')
            .attr('opacity', 0.1)
            .call(d3.axisLeft(yScale).ticks(5)
                .tickSize(-width)
                .tickFormat(''));
    }

    // åŠ¨ç”»å‡½æ•°
    const animatePath = (path, duration = 2000, loop = true) => {
        if (!path || !path.node()) return;
        const totalLength = path.node().getTotalLength();
        if (totalLength === 0) return;

        function restart() {
            path
                .attr('stroke-dasharray', totalLength + ' ' + totalLength)
                .attr('stroke-dashoffset', totalLength)
                .transition()
                .duration(duration)
                .ease(d3.easeLinear)
                .attr('stroke-dashoffset', 0)
                .on('end', () => {
                    if (loop) {
                        setTimeout(restart, 500);
                    }
                });
        }
        restart();
    };

    const animatePoints = (selection, loop = true) => {
        const duration = 300;
        const delay = 50;

        function restart() {
            selection
                .style('opacity', 0)
                .transition()
                .delay((d, i) => i * delay)
                .duration(duration)
                .style('opacity', 1)
                .on('end', (d, i, nodes) => {
                    if (i === nodes.length - 1 && loop) {
                        setTimeout(() => {
                            selection.transition()
                                .duration(500)
                                .style('opacity', 0.3)
                                .on('end', () => restart());
                        }, 1500);
                    }
                });
        }
        restart();
    };

    // æé™è¶‹è¿‘åŠ¨ç”»å‡½æ•°
    const animateLimitApproach = (g, xScale, yScale, func, approachPoint, limitValue, width, height) => {
        const duration = 3000;
        
        // é™ä½å‡½æ•°æ›²çº¿é€æ˜åº¦ï¼Œè®©åŠ¨ç”»æ›´çªå‡º
        g.selectAll('path').attr('opacity', 0.6);
        
        if (approachPoint === Infinity || approachPoint === -Infinity) {
            // å¯¹äºæ— ç©·å¤§æé™ï¼Œå•ç‚¹å‘å³ç§»åŠ¨
            const animateInfinity = () => {
                const movingPoint = g.append('circle')
                    .attr('class', 'moving-point')
                    .attr('r', 4)
                    .attr('fill', '#3498db')
                    .attr('opacity', 0);
                
                const xStart = xScale.domain()[0];
                const xEnd = xScale.domain()[1];
                
                movingPoint
                    .attr('cx', xScale(xStart))
                    .attr('cy', yScale(func(xStart)))
                    .transition()
                    .duration(200)
                    .attr('opacity', 1)
                    .transition()
                    .duration(duration)
                    .ease(d3.easeLinear)
                    .attr('cx', xScale(xEnd))
                    .attr('cy', yScale(func(xEnd)))
                    .on('end', () => {
                        movingPoint.transition()
                            .duration(200)
                            .attr('opacity', 0)
                            .on('end', () => {
                                movingPoint.remove();
                                setTimeout(animateInfinity, 500);
                            });
                    });
            };
            animateInfinity();
            
        } else {
            // åŒè¾¹è¶‹è¿‘åŠ¨ç”»
            const animateApproach = () => {
                const xDomain = xScale.domain();
                const range = Math.abs(xDomain[1] - xDomain[0]) * 0.4;
                const leftStart = Math.max(approachPoint - range, xDomain[0]);
                const rightStart = Math.min(approachPoint + range, xDomain[1]);
                
                // å·¦ä¾§è¶‹è¿‘ç‚¹ï¼ˆçº¢è‰²ï¼‰- æ›´å¤§
                const leftPoint = g.append('circle')
                    .attr('class', 'left-approach-point')
                    .attr('r', 6)
                    .attr('fill', '#e74c3c')
                    .attr('opacity', 0);
                
                // å³ä¾§è¶‹è¿‘ç‚¹ï¼ˆè“è‰²ï¼‰- æ›´å¤§
                const rightPoint = g.append('circle')
                    .attr('class', 'right-approach-point')
                    .attr('r', 6)
                    .attr('fill', '#3498db')
                    .attr('opacity', 0);
                
                // xè½´ä¸Šçš„ä¸‰è§’å½¢æŒ‡ç¤ºå™¨ - æ›´å¤§
                const leftTriangle = g.append('polygon')
                    .attr('class', 'left-triangle')
                    .attr('points', '0,-5 10,0 0,5')
                    .attr('fill', '#e74c3c')
                    .attr('opacity', 0);
                
                const rightTriangle = g.append('polygon')
                    .attr('class', 'right-triangle')
                    .attr('points', '0,-5 -10,0 0,5')
                    .attr('fill', '#3498db')
                    .attr('opacity', 0);
                
                // å‚ç›´è½¨è¿¹çº¿
                const leftTrail = g.append('line')
                    .attr('class', 'left-trail')
                    .attr('stroke', '#e74c3c')
                    .attr('stroke-width', 1)
                    .attr('stroke-dasharray', '2,2')
                    .attr('opacity', 0);
                
                const rightTrail = g.append('line')
                    .attr('class', 'right-trail')
                    .attr('stroke', '#3498db')
                    .attr('stroke-width', 1)
                    .attr('stroke-dasharray', '2,2')
                    .attr('opacity', 0);
                
                // ä¸å†æ˜¾ç¤ºæé™ç‚¹æ ‡è®°
                let limitPoint = null;
                
                // åˆå§‹ä½ç½®
                leftPoint
                    .attr('cx', xScale(leftStart))
                    .attr('cy', yScale(func(leftStart)));
                
                rightPoint
                    .attr('cx', xScale(rightStart))
                    .attr('cy', yScale(func(rightStart)));
                
                leftTriangle
                    .attr('transform', `translate(${xScale(leftStart)}, ${height + 15})`);
                
                rightTriangle
                    .attr('transform', `translate(${xScale(rightStart)}, ${height + 15})`);
                
                // å¼€å§‹åŠ¨ç”»
                const animationPromises = [];
                
                // æ˜¾ç¤ºæ‰€æœ‰å…ƒç´ 
                animationPromises.push(
                    leftPoint.transition().duration(300).attr('opacity', 1).end(),
                    rightPoint.transition().duration(300).attr('opacity', 1).end(),
                    leftTriangle.transition().duration(300).attr('opacity', 0.8).end(),
                    rightTriangle.transition().duration(300).attr('opacity', 0.8).end()
                );
                
                Promise.all(animationPromises).then(() => {
                    // ä¸»è¦çš„è¶‹è¿‘åŠ¨ç”» - ç¡®ä¿xå’Œyéƒ½åœ¨åŠ¨
                    const leftEndX = approachPoint - 0.02;
                    const rightEndX = approachPoint + 0.02;
                    
                    // åˆ›å»ºè¿ç»­çš„åŠ¨ç”»åºåˆ—ï¼Œè®©ç‚¹æ²¿ç€å‡½æ•°æ›²çº¿ç§»åŠ¨
                    const animatePoint = (point, startX, endX, color, trail, triangle) => {
                        const steps = 50; // å¢åŠ æ­¥æ•°è®©åŠ¨ç”»æ›´æµç•…
                        const stepDuration = duration / steps;
                        let currentStep = 0;
                        
                        const animate = () => {
                            if (currentStep >= steps) {
                                // åŠ¨ç”»å®Œæˆï¼Œé‡æ–°å¼€å§‹
                                setTimeout(() => {
                                    g.selectAll('.left-approach-point, .right-approach-point, .left-triangle, .right-triangle, .left-trail, .right-trail').remove();
                                    animateApproach();
                                }, 1000);
                                return;
                            }
                            
                            const progress = currentStep / steps;
                            const currentX = startX + (endX - startX) * progress;
                            const currentY = func(currentX);
                            
                            // ç¡®ä¿å‡½æ•°å€¼æœ‰æ•ˆ
                            if (isFinite(currentY)) {
                                point
                                    .transition()
                                    .duration(stepDuration)
                                    .ease(d3.easeLinear)
                                    .attr('cx', xScale(currentX))
                                    .attr('cy', yScale(currentY));
                                
                                // æ›´æ–°è½¨è¿¹çº¿
                                if (currentStep === 0) {
                                    trail
                                        .attr('x1', xScale(startX))
                                        .attr('y1', yScale(func(startX)))
                                        .attr('x2', xScale(startX))
                                        .attr('y2', yScale(func(startX)))
                                        .attr('opacity', 0.5);
                                }
                                
                                trail
                                    .transition()
                                    .duration(stepDuration)
                                    .attr('x2', xScale(currentX))
                                    .attr('y2', yScale(currentY));
                                
                                // æ›´æ–°ä¸‰è§’å½¢æŒ‡ç¤ºå™¨
                                triangle
                                    .transition()
                                    .duration(stepDuration)
                                    .attr('transform', `translate(${xScale(currentX)}, ${height + 15})`);
                            }
                            
                            currentStep++;
                            setTimeout(animate, stepDuration);
                        };
                        
                        animate();
                    };
                    
                    // åŒæ—¶å¯åŠ¨å·¦å³ä¸¤ä¸ªç‚¹çš„åŠ¨ç”»
                    animatePoint(leftPoint, leftStart, leftEndX, '#e74c3c', leftTrail, leftTriangle);
                    animatePoint(rightPoint, rightStart, rightEndX, '#3498db', rightTrail, rightTriangle);
                });
            };
            
            animateApproach();
        }
    };

    // ============ å¯è§†åŒ–å‡½æ•° ============
    const animationMap = {
        'intro': () => {},
        'toc': () => {},
        'why-limit': visualizeWhyLimit,
        'intuitive-limit': visualizeIntuitiveLimit,
        'convergent-sequences': visualizeConvergentSequences,
        'divergent-sequences': visualizeDivergentSequences,
        'sequence-calculation': visualizeSequenceCalculation,
        'function-limits': visualizeFunctionLimits,
        'one-sided-limits': visualizeOneSidedLimits,
        'one-sided-detailed': visualizeOneSidedLimitsDetailed,
        'limit-operations': visualizeLimitOperations,
        'limit-methods-detailed': visualizeLimitMethodsDetailed,
        'limit-methods': visualizeLimitMethods,
        'important-limit-1': visualizeImportantLimit1,
        'important-limit-2': visualizeImportantLimit2,
        'important-limits-detailed': visualizeImportantLimitsDetailed,
        'infinitesimal-infinity': visualizeInfinitesimalInfinity,
        'infinitesimal-comparison': visualizeInfinitesimalComparison,
        'equivalent-infinitesimal': visualizeEquivalentInfinitesimal,
        'equivalent-infinitesimal-app': visualizeEquivalentInfinitesimalApp,
        'continuous-functions': visualizeContinuousFunctions,
        'discontinuities': visualizeDiscontinuities,
        'elementary-functions': visualizeElementaryFunctions,
        'continuity-determination': visualizeContinuityDetermination,
        'applications': visualizeApplications,
        'summary': visualizeSummary
    };

    function scrollToStep(stepKey) {
        const target = document.getElementById(`step-${stepKey}`);
        if (target) {
            target.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    }

    window.scrollToStep = scrollToStep;

    document.addEventListener('DOMContentLoaded', () => {
        const steps = Array.from(document.querySelectorAll('.step'));
        const visContainer = d3.select('#sticky-vis-container');
        let activeStep = null;

        function handleStepEnter(step) {
            if (activeStep === step) {
                return;
            }

            activeStep = step;
            cleanupAnimations();

            steps.forEach(s => s.classList.remove('is-active'));
            step.classList.add('is-active');

            const animationKey = step.dataset.animation;
            const isFullscreen = step.classList.contains('fullscreen');
            const targetContainerId = isFullscreen ? `vis-${animationKey}` : 'sticky-vis-container';

            visContainer.style('opacity', isFullscreen ? 0 : 1);

            if (!isFullscreen) {
                visContainer.classed('visualization-flex', true);
                visContainer.classed('visualization-grid', false);
                visContainer.html('');
            }

            const animator = animationMap[animationKey];
            if (typeof animator === 'function') {
                animator(targetContainerId);
            }

            if (window.MathJax && window.MathJax.typesetPromise) {
                window.MathJax.typesetPromise([step]);
            }
        }

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    handleStepEnter(entry.target);
                }
            });
        }, {
            rootMargin: '-50% 0px -50% 0px',
            threshold: 0
        });

        steps.forEach(step => observer.observe(step));

        if (steps.length > 0) {
            handleStepEnter(steps[0]);
        }

        if (window.MathJax && window.MathJax.typesetPromise) {
            window.MathJax.typesetPromise();
        }
    });

    // è¾…åŠ©å‡½æ•°
    function factorial(n) {
        if (n <= 1) return 1;
        return n * factorial(n - 1);
    }

    function fibonacciRatio(n) {
        let a = 1, b = 1;
        for(let i = 2; i < n; i++) {
            [a, b] = [b, a + b];
        }
        return b / a;
    }

    // ç¬¬1é¡µï¼šä¸ºä»€ä¹ˆè¦å­¦æé™
    function visualizeWhyLimit(containerId) {
        const setup = setupD3(containerId);
        if (!setup) return;
        const { g, width, height } = setup;
        
        // é˜¿åŸºé‡Œæ–¯è¿½é¾ŸåŠ¨ç”»
        const trackY = height / 2;
        g.append('line')
            .attr('x1', 0)
            .attr('x2', width)
            .attr('y1', trackY)
            .attr('y2', trackY)
            .attr('stroke', '#34495e')
            .attr('stroke-width', 3);
        
        // é˜¿åŸºé‡Œæ–¯
        const achilles = g.append('g');
        achilles.append('circle')
            .attr('r', 15)
            .attr('fill', '#3498db')
            .attr('cy', trackY - 30);
        achilles.append('text')
            .attr('y', trackY - 50)
            .attr('text-anchor', 'middle')
            .attr('fill', '#34495e')
            .text('é˜¿åŸºé‡Œæ–¯');
        
        // ä¹Œé¾Ÿ
        const tortoise = g.append('g');
        tortoise.append('circle')
            .attr('r', 10)
            .attr('fill', '#2ecc71')
            .attr('cy', trackY + 30);
        tortoise.append('text')
            .attr('y', trackY + 50)
            .attr('text-anchor', 'middle')
            .attr('fill', '#34495e')
            .text('ä¹Œé¾Ÿ');
        
        // è·ç¦»æ ‡è®°
        const distanceText = g.append('text')
            .attr('x', width / 2)
            .attr('y', 30)
            .attr('text-anchor', 'middle')
            .attr('fill', '#34495e')
            .style('font-size', '18px');
        
        let step = 0;
        const steps = [
            { achilles: 0, tortoise: 200, text: "åˆå§‹ï¼šä¹Œé¾Ÿé¢†å…ˆ200ç±³" },
            { achilles: 200, tortoise: 220, text: "ç¬¬1æ­¥ï¼šé˜¿åŸºé‡Œæ–¯è·‘åˆ°200ç±³ï¼Œä¹Œé¾Ÿåˆ°220ç±³" },
            { achilles: 220, tortoise: 222, text: "ç¬¬2æ­¥ï¼šé˜¿åŸºé‡Œæ–¯è·‘åˆ°220ç±³ï¼Œä¹Œé¾Ÿåˆ°222ç±³" },
            { achilles: 222, tortoise: 222.2, text: "ç¬¬3æ­¥ï¼šè·ç¦»è¶Šæ¥è¶Šå°..." },
            { achilles: 222.2, tortoise: 222.22, text: "ç¬¬4æ­¥ï¼šå·®è·ä»…0.02ç±³" },
            { achilles: 222.22, tortoise: 222.222, text: "æ— é™æ¥è¿‘ï¼æé™æ€æƒ³çš„ä½“ç°" }
        ];
        
        function animate() {
            if (step >= steps.length) {
                step = 0;
            }
            
            const currentStep = steps[step];
            const scale = width / 300;
            
            achilles.transition()
                .duration(2000 / globalAnimationSpeed)
                .attr('transform', `translate(${currentStep.achilles * scale}, 0)`);
            
            tortoise.transition()
                .duration(2000 / globalAnimationSpeed)
                .attr('transform', `translate(${currentStep.tortoise * scale}, 0)`);
            
            distanceText.text(currentStep.text);
            
            step++;
            const timeoutId = setTimeout(animate, 3000 / globalAnimationSpeed);
            currentAnimations.push(() => clearTimeout(timeoutId));
        }
        
        animate();
    }

    // ç¬¬2é¡µï¼šæé™çš„ç›´è§‚ç†è§£
    function visualizeIntuitiveLimit(containerId) {
        const setup = setupD3(containerId);
        if (!setup) return;
        const { g, width, height } = setup;
        
        // æ¯å­å€’æ°´åŠ¨ç”»
        const cupWidth = 100;
        const cupHeight = 200;
        const cupX = width / 2 - cupWidth / 2;
        const cupY = height / 2 - cupHeight / 2;
        
        // æ¯å­è½®å»“
        g.append('rect')
            .attr('x', cupX)
            .attr('y', cupY)
            .attr('width', cupWidth)
            .attr('height', cupHeight)
            .attr('fill', 'none')
            .attr('stroke', '#34495e')
            .attr('stroke-width', 3);
        
        // åˆ»åº¦çº¿
        for (let i = 1; i <= 10; i++) {
            const y = cupY + cupHeight - (cupHeight * i / 10);
            g.append('line')
                .attr('x1', cupX - 10)
                .attr('x2', cupX)
                .attr('y1', y)
                .attr('y2', y)
                .attr('stroke', '#34495e')
                .attr('stroke-width', 1);
            
            if (i % 2 === 0) {
                g.append('text')
                    .attr('x', cupX - 15)
                    .attr('y', y + 3)
                    .attr('text-anchor', 'end')
                    .attr('fill', '#34495e')
                    .style('font-size', '12px')
                    .text(`${i / 10}L`);
            }
        }
        
        // æ°´ä½
        const water = g.append('rect')
            .attr('x', cupX + 2)
            .attr('y', cupY + cupHeight - 2)
            .attr('width', cupWidth - 4)
            .attr('height', 0)
            .attr('fill', 'rgba(52, 152, 219, 0.7)');
        
        // æ˜¾ç¤ºå½“å‰æ°´é‡
        const volumeText = g.append('text')
            .attr('x', width / 2)
            .attr('y', cupY - 20)
            .attr('text-anchor', 'middle')
            .attr('fill', '#34495e')
            .style('font-size', '18px');
        
        let totalVolume = 0;
        let pourCount = 0;
        
        function pour() {
            if (pourCount > 8) {
                totalVolume = 0;
                pourCount = 0;
                water.attr('height', 0);
            }
            
            const pourAmount = 0.5 * Math.pow(0.5, pourCount);
            totalVolume += pourAmount;
            
            water.transition()
                .duration(1000 / globalAnimationSpeed)
                .attr('height', cupHeight * totalVolume)
                .attr('y', cupY + cupHeight - cupHeight * totalVolume);
            
            volumeText.text(`å½“å‰ï¼š${totalVolume.toFixed(4)}Lï¼Œæœ¬æ¬¡å€’å…¥ï¼š${pourAmount.toFixed(4)}L`);
            
            pourCount++;
            const timeoutId = setTimeout(pour, 2000 / globalAnimationSpeed);
            currentAnimations.push(() => clearTimeout(timeoutId));
        }
        
        pour();
    }

    // ç¬¬3é¡µï¼šæ”¶æ•›æ•°åˆ—
    function visualizeConvergentSequences(containerId) {
        const container = getContainer(containerId, 'grid');
        if (!container) return;

        const sequences = [
            { name: 'æŒ‡æ•°è¡°å‡: $a_n = \\frac{2}{3} + \\frac{1}{3}e^{-0.3n}$', fn: n => 2/3 + (1/3) * Math.exp(-0.3 * n), limit: 2/3 },
            { name: 'äº¤æ›¿æ”¶æ•›: $a_n = 2 + (-0.9)^n$', fn: n => 2 + Math.pow(-0.9, n), limit: 2 },
            { name: 'è°ƒå’Œæ”¶æ•›: $a_n = 1 + \\frac{1}{n}$', fn: n => 1 + 1/n, limit: 1 },
            { name: 'å¹³æ–¹æ ¹æ”¶æ•›: $a_n = \\sqrt{n+1} - \\sqrt{n}$', fn: n => Math.sqrt(n + 1) - Math.sqrt(n), limit: 0 },
            { name: 'å¯¹æ•°æ”¶æ•›: $a_n = \\frac{\\ln(n+1)}{\\ln n}$', fn: n => Math.log(n + 1) / Math.log(n), limit: 1 },
            { name: 'é˜¶ä¹˜æ¯”: $a_n = \\frac{2^n}{n!}$', fn: n => Math.pow(2, n) / (n > 10 ? 1000000 : factorial(n)), limit: 0 },
            { name: 'æ­£å¼¦è¡°å‡: $a_n = \\frac{\\sin n}{n}$', fn: n => Math.sin(n) / n, limit: 0 },
            { name: 'ä½™å¼¦è¡°å‡: $a_n = \\frac{1+\\cos n}{n}$', fn: n => (1 + Math.cos(n)) / n, limit: 0 },
            { name: 'å¹‚å‡½æ•°æ¯”: $a_n = \\frac{n^2}{n^{2.1}}$', fn: n => Math.pow(n, 2) / Math.pow(n, 2.1), limit: 0 },
            { name: 'åµŒå¥—æ ¹å¼: $a_n = \\sqrt{2 + \\frac{1}{n}}$', fn: n => Math.sqrt(2 + 1/n), limit: Math.sqrt(2) },
            { name: 'è¿åˆ†æ•°: $a_n = \\frac{1}{1 + 1/n}$', fn: n => 1 / (1 + 1/n), limit: 1 },
            { name: 'å‡ ä½•çº§æ•°å’Œ: $S_n = \\sum_{k=0}^{n-1} (\\frac{1}{2})^k$', fn: n => (1 - Math.pow(0.5, n)) / 0.5, limit: 2 },
            { name: 'å¤åˆå‡½æ•°: $a_n = n \\sin(\\frac{1}{n})$', fn: n => n * Math.sin(1/n), limit: 1 },
            { name: 'åŒæ›²å‡½æ•°: $a_n = \\tanh(\\frac{n}{5})$', fn: n => Math.tanh(n/5), limit: 1 },
            { name: 'Fibonacciæ¯”: $a_n = \\frac{F_{n+1}}{F_n}$', fn: n => fibonacciRatio(n), limit: 1.618 }
        ];

        sequences.forEach((seq, i) => {
            const drawFunction = (g, width, height) => {
                const xScale = d3.scaleLinear().domain([1, 20]).range([0, width]);
                const yScale = d3.scaleLinear()
                    .domain([Math.min(seq.limit - 1, -1), Math.max(seq.limit + 1, 4)])
                    .range([height, 0]);

                drawAxes(g, xScale, yScale, width, height);

                // æé™çº¿
                g.append('line')
                    .attr('x1', 0)
                    .attr('y1', yScale(seq.limit))
                    .attr('x2', width)
                    .attr('y2', yScale(seq.limit))
                    .attr('stroke', 'var(--success-color)')
                    .attr('stroke-dasharray', '3,3')
                    .attr('opacity', 0.7);

                const data = d3.range(1, 21).map(n => ({x: n, y: seq.fn(n)}));

                const points = g.selectAll('.point')
                    .data(data)
                    .enter().append('circle')
                    .attr('cx', d => xScale(d.x))
                    .attr('cy', d => yScale(d.y))
                    .attr('r', 3)
                    .attr('fill', 'var(--primary-color)');

                animatePoints(points);
            };

            const { g, width, height, div } = setup(container, i, seq.name, 'infinity');
            div.__chartData = { drawFunction, annotationData: { type: 'sequence', isSequence: true, limitValue: seq.limit } };
            drawFunction(g, width, height);
        });

        // æ¸²æŸ“MathJax
        setTimeout(() => renderMathJax(container), 100);
    }

    // ç¬¬4é¡µï¼šå‘æ•£æ•°åˆ—
function visualizeDivergentSequences(containerId) {
    const container = getContainer(containerId, 'grid');
    if (!container) return;

        const sequences = [
            { name: 'çº¿æ€§å¢é•¿: $a_n = n$', fn: n => n },
            { name: 'å¹³æ–¹å¢é•¿: $a_n = \\frac{n^2}{10}$', fn: n => n * n / 10 },
            { name: 'æŒ‡æ•°å¢é•¿: $a_n = (1.2)^n$', fn: n => Math.pow(1.2, n) },
            { name: 'å¯¹æ•°å¢é•¿: $a_n = 2\\ln n$', fn: n => Math.log(n) * 2 },
            { name: 'éœ‡è¡å‘æ•£: $a_n = \\frac{n(-1)^n}{5}$', fn: n => n * Math.pow(-1, n) / 5 },
            { name: 'æ­£å¼¦éœ‡è¡: $a_n = \\frac{n\\sin n}{10}$', fn: n => n * Math.sin(n) / 10 },
            { name: 'äº¤æ›¿æ— ç•Œ: $a_n = (-1.1)^n$', fn: n => Math.pow(-1.1, n) },
            { name: 'é˜¶ä¹˜å¢é•¿: $a_n = \\frac{n!}{10}$', fn: n => n > 6 ? 20 : factorial(n) / 10 },
            { name: 'æ··æ²Œ: $a_n = 3\\sin(\\frac{n^2}{10})$', fn: n => 3 * Math.sin(n * n / 10) },
            { name: 'åˆ†æ®µå‘æ•£: $a_n = f(n)$', fn: n => n % 3 === 0 ? n/2 : -n/3 },
            { name: 'å‘¨æœŸçˆ†ç‚¸: $a_n = e^{n/10}\\sin n$', fn: n => Math.sin(n) * Math.exp(n/10) },
            { name: 'èºæ—‹å‘æ•£: $a_n = \\frac{n}{5}\\cos(\\frac{n}{2})$', fn: n => n * Math.cos(n/2) / 5 }
        ];

        sequences.forEach((seq, i) => {
            const drawFunction = (g, width, height) => {
                const data = d3.range(1, 21).map(n => ({x: n, y: seq.fn(n)}));
                const yExtent = d3.extent(data, d => d.y);

                const xScale = d3.scaleLinear().domain([1, 20]).range([0, width]);
                const yScale = d3.scaleLinear()
                    .domain([Math.min(yExtent[0], -5), Math.max(yExtent[1], 5)])
                    .range([height, 0]);

                drawAxes(g, xScale, yScale, width, height);

                const points = g.selectAll('.point')
                    .data(data)
                    .enter().append('circle')
                    .attr('cx', d => xScale(d.x))
                    .attr('cy', d => yScale(d.y))
                    .attr('r', 3)
                    .attr('fill', 'var(--accent-color)');

                animatePoints(points);
            };

            const { g, width, height, div } = setup(container, i, seq.name, 'infinity');
            div.__chartData = { drawFunction, annotationData: { type: 'sequence', isSequence: true, limitValue: null } };
            drawFunction(g, width, height);
        });

        // æ¸²æŸ“MathJax
        setTimeout(() => renderMathJax(container), 100);
    }

    // ç¬¬5é¡µï¼šæ•°åˆ—æé™è®¡ç®—
    function visualizeSequenceCalculation(containerId) {
        const setup = setupD3(containerId);
        if (!setup) return;
        const { g, width, height } = setup;
        
        // åˆ›å»ºäº¤äº’å¼é¢æ¿
        const panel = d3.select('#vis-sequence-calculation')
            .append('div')
            .attr('class', 'interactive-panel')
            .style('bottom', '20px');
        
        panel.append('h3')
            .style('text-align', 'center')
            .text('åˆ†å­åˆ†æ¯åŒé™¤æœ€é«˜æ¬¡æ¼”ç¤º');
        
        // åˆ›å»ºæ­¥éª¤æ˜¾ç¤ºåŒº
        const stepsDiv = panel.append('div')
            .style('background', 'rgba(0, 0, 0, 0)')
            .style('padding', '20px')
            .style('border-radius', '8px')
            .style('margin-top', '20px');
        
        // å¢åŠ æ›´è¯¦ç»†çš„æ­¥éª¤ï¼Œé€‚åˆé«˜èŒå­¦ç”Ÿ
        const steps = [
            { delay: 0, html: `<span style="color: #e74c3c;">ç¬¬1æ­¥ï¼šè§‚å¯Ÿæœ€é«˜æ¬¡</span><br>
                              <span>åˆ†å­æœ€é«˜æ¬¡ï¼šnÂ² (ç³»æ•°æ˜¯2)</span><br>
                              <span>åˆ†æ¯æœ€é«˜æ¬¡ï¼šnÂ² (ç³»æ•°æ˜¯1)</span>` },
            { delay: 2000, html: `<span style="color: #e74c3c;">ç¬¬2æ­¥ï¼šåŸå¼</span><br>
                                 <span style="font-size: 1.5rem;">$$\\lim\\limits_{n \\to \\infty} \\frac{2n^2 + 3n + 1}{n^2 + 5}$$</span>` },
            { delay: 4000, html: `<span style="color: #e74c3c;">ç¬¬3æ­¥ï¼šåˆ†å­åˆ†æ¯åŒæ—¶é™¤ä»¥nÂ²</span><br>
                                 <span>åˆ†å­æ¯é¡¹éƒ½é™¤ä»¥nÂ²ï¼š</span><br>
                                 <span>$$\\frac{2n^2}{n^2} + \\frac{3n}{n^2} + \\frac{1}{n^2}$$</span>` },
            { delay: 6000, html: `<span style="color: #e74c3c;">ç¬¬4æ­¥ï¼šåŒ–ç®€æ¯ä¸€é¡¹</span><br>
                                 <span>$$2 + \\frac{3}{n} + \\frac{1}{n^2}$$</span><br>
                                 <span>åˆ†æ¯åŒæ ·å¤„ç†ï¼š$$1 + \\frac{5}{n^2}$$</span>` },
            { delay: 8000, html: `<span style="color: #e74c3c;">ç¬¬5æ­¥ï¼šæé™è§„å¾‹</span><br>
                                 <span style="color: #27ae60;">å½“nâ†’âˆæ—¶ï¼š</span><br>
                                 <span>$$\\frac{1}{n} â†’ 0, \\quad \\frac{1}{n^2} â†’ 0$$</span>` },
            { delay: 10000, html: `<span style="color: #e74c3c;">ç¬¬6æ­¥ï¼šä»£å…¥æé™å€¼</span><br>
                                  <span style="font-size: 1.8rem; color: #27ae60;">
                                  $$= \\frac{2 + 0 + 0}{1 + 0} = 2$$</span>` },
            { delay: 12000, html: `<div style="background: rgba(46, 204, 113, 0.1); padding: 15px; border-radius: 8px;">
                                  <strong>è®°å¿†å£è¯€ï¼š</strong><br>
                                  åˆ†å­åˆ†æ¯åŒé™¤ä»¥æœ€é«˜æ¬¡<br>
                                  çœ‹ç³»æ•°æ¯”å°±æ˜¯æé™å€¼ï¼<br>
                                  <span style="color: #e74c3c;">æœ€é«˜æ¬¡ç³»æ•°æ¯” = 2/1 = 2</span>
                                  </div>` }
        ];

        // è®¡ç®—æ­¥éª¤åŠ¨ç”»åªæ’­æ”¾ä¸€æ¬¡ï¼Œä¸å¾ªç¯
        let stepIndex = 0;
        function showNextStep() {
            if (stepIndex < steps.length) {
                const step = steps[stepIndex];
                stepsDiv.append('div')
                    .attr('class', 'formula-step fade-in')
                    .style('margin-top', stepIndex === 0 ? '0' : '20px')
                    .html(step.html);
                
                if (window.MathJax) {
                    MathJax.typesetPromise();
                }
                
                stepIndex++;
                if (stepIndex < steps.length) {
                    // ä½¿ç”¨ä¸‹ä¸€ä¸ªæ­¥éª¤çš„å»¶è¿Ÿæ—¶é—´å‡å»å½“å‰æ­¥éª¤çš„å»¶è¿Ÿæ—¶é—´
                    const nextStep = steps[stepIndex];
                    const delay = nextStep.delay - step.delay;
                    setTimeout(showNextStep, delay / globalAnimationSpeed);
                }
            }
        }
        
        showNextStep();
    }



    function visualizeFunctionLimits(containerId) {
        const container = getContainer(containerId, 'grid');
        if (!container) {
            console.error('Container vis-function-limits not found');
            return;
        }

        const functions = [
            { name: 'å¤šé¡¹å¼æé™<br>$x^2-2x+1$', fn: x => x*x - 2*x + 1, a: 2, L: 1 },
            { name: 'æœ‰ç†å‡½æ•°<br>$\\dfrac{x^2-4}{x-2}$', fn: x => Math.abs(x-2) > 0.01 ? (x*x - 4)/(x - 2) : 4, a: 2, L: 4 },
            { name: 'æ ¹å¼å‡½æ•°<br>$\\sqrt{x+1}$', fn: x => Math.sqrt(x + 1), a: 3, L: 2 },
            { name: 'ä¸‰è§’æé™<br>$\\dfrac{\\sin x}{x}$', fn: x => Math.abs(x) > 0.001 ? Math.sin(x)/x : 1, a: 0, L: 1 },
            { name: 'æŒ‡æ•°æé™<br>$e^{-|x|}$', fn: x => Math.exp(-Math.abs(x)), a: 0, L: 1 },
            { name: 'å¯¹æ•°æé™<br>$\\ln(x+1)$', fn: x => Math.log(x + 1), a: Math.E - 1, L: 1 },
            { name: 'åä¸‰è§’<br>$\\arctan x$', fn: x => Math.atan(x), a: 0, L: 0 },
            { name: 'åŒæ›²å‡½æ•°<br>$\\dfrac{\\sinh x}{x}$', fn: x => Math.abs(x) > 0.001 ? Math.sinh(x)/x : 1, a: 0, L: 1 },
            { name: 'åˆ†æ®µå‡½æ•°<br>$\\begin{cases} x+2, & x<0 \\\\ x^2, & x\\ge0 \\end{cases}$', fn: x => x < 0 ? x + 2 : x*x, a: 0, L: null },
            { name: 'ç»å¯¹å€¼<br>$|x-1|$', fn: x => Math.abs(x - 1), a: 1, L: 0 },
            { name: 'å–æ•´å‡½æ•°<br>$\\lfloor x \\rfloor$', fn: x => Math.floor(x), a: 2, L: null },
            { name: 'ç¬¦å·å‡½æ•°<br>$\\text{sgn}(x)$', fn: x => Math.sign(x), a: 0, L: null },
            { name: 'æŒ¯è¡è¡°å‡<br>$x\\sin\\left(\\dfrac{1}{x}\\right)$', fn: x => Math.abs(x) > 0.01 ? x * Math.sin(1/x) : 0, a: 0, L: 0 },
            { name: 'å¤åˆå‡½æ•°<br>$\\sin(\\cos x)$', fn: x => Math.sin(Math.cos(x)), a: 1, L: Math.sin(Math.cos(1)) },
            { name: 'å¹‚æŒ‡å‡½æ•°<br>$x^x$', fn: x => x > 0 ? Math.pow(x, x) : undefined, a: 1, L: 1 }
        ];

        functions.forEach((func, i) => {
            const drawFunction = (g, width, height) => {
                const range = 2;
                const xMin = func.a - range;
                const xMax = func.a + range;

                const xScale = d3.scaleLinear().domain([xMin, xMax]).range([0, width]);
                
                const testPoints = d3.range(xMin, xMax, 0.1).map(x => func.fn(x)).filter(y => isFinite(y));
                const yExtent = d3.extent(testPoints);
                const yPadding = Math.abs(yExtent[1] - yExtent[0]) * 0.2 || 1;
                const yScale = d3.scaleLinear()
                    .domain([yExtent[0] - yPadding, yExtent[1] + yPadding])
                    .range([height, 0]);

                drawAxes(g, xScale, yScale, width, height);

                const line = d3.line()
                    .x(d => xScale(d.x))
                    .y(d => yScale(d.y))
                    .defined(d => !isNaN(d.y) && isFinite(d.y));

                const data = d3.range(xMin, xMax, 0.05).map(x => ({
                    x: x,
                    y: func.fn(x)
                }));

                const path = g.append('path')
                    .datum(data)
                    .attr('fill', 'none')
                    .attr('stroke', 'var(--primary-color)')
                    .attr('stroke-width', 2)
                    .attr('d', line);

                animatePath(path, 2000, false);

                // æ·»åŠ æé™è¶‹è¿‘åŠ¨ç”»
                setTimeout(() => {
                    animateLimitApproach(g, xScale, yScale, func.fn, func.a, func.L, width, height);
                }, 100);

                if (func.L !== undefined && func.L !== null && !isNaN(func.L) && isFinite(func.L)) {
                    g.append('circle')
                        .attr('cx', xScale(func.a))
                        .attr('cy', yScale(func.L))
                        .attr('r', 4)
                        .attr('fill', 'var(--success-color)');
                }
            };

            const { g, width, height, div } = setup(container, i, func.name, 'both', func.a);
            div.__chartData = { drawFunction, annotationData: { type: 'limit', isSequence: false, approachPoint: func.a, limitValue: func.L, leftLimit: func.L, rightLimit: func.L } };
            drawFunction(g, width, height);
        });
    }


// ç¬¬7é¡µï¼šå·¦å³æé™
function visualizeOneSidedLimits(containerId) {
    const container = getContainer(containerId, 'grid');
    if (!container) {
        console.error('Container vis-one-sided not found');
        return;
    }
    
    // åˆ›å»ºæ§åˆ¶é¢æ¿
    const controlPanel = document.createElement('div');
    controlPanel.className = 'interactive-panel';
    controlPanel.style.cssText = 'margin-bottom: 20px; text-align: center;';
    
    const title = document.createElement('h3');
    title.textContent = 'å·¦å³æé™æ¼”ç¤º';
    title.style.cssText = 'margin: 0 0 15px 0; color: var(--primary-color);';
    controlPanel.appendChild(title);
    
    const buttonContainer = document.createElement('div');
    buttonContainer.className = 'button-container';
    buttonContainer.style.cssText = 'display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;';
    controlPanel.appendChild(buttonContainer);
    
    container.appendChild(controlPanel);
    
    // åˆ›å»ºSVGå®¹å™¨
    const svgContainer = document.createElement('div');
    svgContainer.style.cssText = 'width: 100%; height: calc(100% - 80px); position: relative;';
    container.appendChild(svgContainer);
    
    const svg = d3.select(svgContainer)
        .append('svg')
        .attr('width', '100%')
        .attr('height', '100%');
    
    const margins = {top: 40, right: 40, bottom: 60, left: 60};
    const bounds = svgContainer.getBoundingClientRect();
    const width = bounds.width - margins.left - margins.right;
    const height = bounds.height - margins.top - margins.bottom;
    
    const g = svg.append('g')
        .attr('transform', `translate(${margins.left}, ${margins.top})`);
    
    // æ·»åŠ ç®­å¤´æ ‡è®°
    svg.append('defs').append('marker')
        .attr('id', 'arrowhead-one-sided')
        .attr('viewBox', '0 -5 10 10')
        .attr('refX', 8)
        .attr('refY', 0)
        .attr('markerWidth', 8)
        .attr('markerHeight', 8)
        .attr('orient', 'auto')
        .append('path')
        .attr('d', 'M0,-5L10,0L0,5')
        .attr('fill', 'var(--danger-color)');
    
    // åˆ›å»ºåˆ†æ®µå‡½æ•°ç¤ºä¾‹
    const cases = [
        {
            name: 'è·³è·ƒé—´æ–­',
            fnLeft: x => x,
            fnRight: x => x + 2,
            a: 0,
            leftLimit: 0,
            rightLimit: 2
        },
        {
            name: 'å¯å»é—´æ–­',
            fnLeft: x => (x*x - 1)/(x - 1),
            fnRight: x => (x*x - 1)/(x - 1),
            a: 1,
            leftLimit: 2,
            rightLimit: 2
        },
        {
            name: 'æ— ç©·é—´æ–­',
            fnLeft: x => -1/x,
            fnRight: x => 1/x,
            a: 0,
            leftLimit: -Infinity,
            rightLimit: Infinity
        }
    ];
    
    // åˆ›å»ºæŒ‰é’®
    cases.forEach((c, i) => {
        const button = document.createElement('button');
        button.className = 'nav-btn';
        button.textContent = c.name;
        button.style.cssText = 'margin: 5px; padding: 8px 16px; border: 1px solid var(--primary-color); background: white; color: var(--primary-color); border-radius: 4px; cursor: pointer; transition: all 0.3s;';
        button.onmouseover = function() {
            this.style.background = 'var(--primary-color)';
            this.style.color = 'white';
        };
        button.onmouseout = function() {
            this.style.background = 'white';
            this.style.color = 'var(--primary-color)';
        };
        button.onclick = () => drawCase(i);
        buttonContainer.appendChild(button);
    });
    
    const xScale = d3.scaleLinear().domain([-3, 3]).range([0, width]);
    const yScale = d3.scaleLinear().domain([-5, 5]).range([height, 0]);
    
    // åæ ‡è½´
    g.append('g')
        .attr('transform', `translate(0, ${yScale(0)})`)
        .call(d3.axisBottom(xScale));
    
    g.append('g')
        .attr('transform', `translate(${xScale(0)}, 0)`)
        .call(d3.axisLeft(yScale));
    
    function drawCase(index) {
        g.selectAll('.function-path').remove();
        g.selectAll('.limit-marker').remove();
        
        const caseItem = cases[index];
        
        // å·¦ä¾§å‡½æ•°
        const leftData = d3.range(-3, caseItem.a - 0.01, 0.01)
            .map(x => ({x: x, y: caseItem.fnLeft(x)}))
            .filter(d => !isNaN(d.y) && isFinite(d.y) && Math.abs(d.y) < 10);
        
        const line = d3.line()
            .x(d => xScale(d.x))
            .y(d => yScale(d.y));
        
        g.append('path')
            .attr('class', 'function-path')
            .datum(leftData)
            .attr('d', line)
            .attr('fill', 'none')
            .attr('stroke', '#e74c3c')
            .attr('stroke-width', 2);
        
        // å³ä¾§å‡½æ•°
        const rightData = d3.range(caseItem.a + 0.01, 3, 0.01)
            .map(x => ({x: x, y: caseItem.fnRight(x)}))
            .filter(d => !isNaN(d.y) && isFinite(d.y) && Math.abs(d.y) < 10);
        
        g.append('path')
            .attr('class', 'function-path')
            .datum(rightData)
            .attr('d', line)
            .attr('fill', 'none')
            .attr('stroke', '#3498db')
            .attr('stroke-width', 2);
        
        // æ ‡è®°é—´æ–­ç‚¹ä½ç½®
        g.append('line')
            .attr('class', 'limit-marker')
            .attr('x1', xScale(caseItem.a))
            .attr('y1', 0)
            .attr('x2', xScale(caseItem.a))
            .attr('y2', height)
            .attr('stroke', 'gray')
            .attr('stroke-dasharray', '2,2')
            .attr('opacity', 0.5);
        
        // æ˜¾ç¤ºå·¦å³æé™å€¼
        if (isFinite(caseItem.leftLimit)) {
            g.append('circle')
                .attr('class', 'limit-marker')
                .attr('cx', xScale(caseItem.a))
                .attr('cy', yScale(caseItem.leftLimit))
                .attr('r', 5)
                .attr('fill', 'white')
                .attr('stroke', '#e74c3c')
                .attr('stroke-width', 2);
            
            g.append('text')
                .attr('class', 'limit-marker')
                .attr('x', xScale(caseItem.a) - 60)
                .attr('y', yScale(caseItem.leftLimit))
                .attr('fill', '#e74c3c')
                .text(`å·¦æé™: ${caseItem.leftLimit}`);
        }
        
        if (isFinite(caseItem.rightLimit)) {
            g.append('circle')
                .attr('class', 'limit-marker')
                .attr('cx', xScale(caseItem.a))
                .attr('cy', yScale(caseItem.rightLimit))
                .attr('r', 5)
                .attr('fill', 'white')
                .attr('stroke', '#3498db')
                .attr('stroke-width', 2);
            
            g.append('text')
                .attr('class', 'limit-marker')
                .attr('x', xScale(caseItem.a) + 10)
                .attr('y', yScale(caseItem.rightLimit))
                .attr('fill', '#3498db')
                .text(`å³æé™: ${caseItem.rightLimit}`);
        }
        
        // æ·»åŠ è¯´æ˜æ–‡å­—
        g.append('text')
            .attr('class', 'limit-marker')
            .attr('x', width / 2)
            .attr('y', height + 30)
            .attr('text-anchor', 'middle')
            .attr('fill', '#34495e')
            .style('font-size', '14px')
            .text(`å‡½æ•°ç±»å‹: ${caseItem.name} - è§‚å¯Ÿ x = ${caseItem.a} å¤„çš„å·¦å³æé™`);
    }
    
    drawCase(0);
}

// ç¬¬7.1é¡µï¼šå·¦å³æé™è¯¦ç»†æ¼”ç¤º
function visualizeOneSidedLimitsDetailed(containerId) {
    const container = getContainer(containerId, 'grid');
    if (!container) {
        console.error('Container vis-one-sided-detailed not found');
        return;
    }

    const cases = [
        {
            name: 'å·¦å³æé™ç›¸ç­‰<br>$x+1$',
            fnLeft: x => x + 1,
            fnRight: x => x + 1,
            a: 0, L: 1
        },
        {
            name: 'è·³è·ƒé—´æ–­<br>$\\begin{cases} x,\\ x<0 \\\\ x+2,\\ x \\ge 0 \\end{cases}$',
            fnLeft: x => x,
            fnRight: x => x + 2,
            a: 0, L: null
        },
        {
            name: 'å·¦æé™ä¸å­˜åœ¨<br>$\\begin{cases} \\dfrac{1}{x},\\ x<0 \\\\ x+1,\\ x \\ge 0 \\end{cases}$',
            fnLeft: x => 1/x,
            fnRight: x => x + 1,
            a: 0, L: null
        },
        {
            name: 'å³æé™ä¸å­˜åœ¨<br>$\\begin{cases} x-1,\\ x<1 \\\\ \\dfrac{1}{x-1},\\ x \\ge 1 \\end{cases}$',
            fnLeft: x => x - 1,
            fnRight: x => 1/(x-1),
            a: 1, L: null
        },
        {
            name: 'æŒ¯è¡é—´æ–­<br>$\\sin\\left(\\dfrac{1}{x}\\right)$',
            fnLeft: x => Math.sin(1/x),
            fnRight: x => Math.sin(1/x),
            a: 0, L: null
        },
        {
            name: 'å¯å»é—´æ–­<br>$\\dfrac{x^2-1}{x-1}$',
            fnLeft: x => (x*x - 1)/(x - 1),
            fnRight: x => (x*x - 1)/(x - 1),
            a: 1, L: 2
        },
        {
            name: 'æ— ç©·é—´æ–­<br>$\\begin{cases} -\\dfrac{1}{x^2},\\ x<0 \\\\ \\dfrac{1}{x^2},\\ x>0 \\end{cases}$',
            fnLeft: x => -1/(x*x),
            fnRight: x => 1/(x*x),
            a: 0, L: null
        },
        {
            name: 'åˆ†æ®µè¿ç»­<br>$\\begin{cases} \\sin x,\\ x<0 \\\\ x,\\ x \\ge 0 \\end{cases}$',
            fnLeft: x => Math.sin(x),
            fnRight: x => x,
            a: 0, L: 0
        },
        {
            name: 'æŒ‡æ•°è·³è·ƒ<br>$\\begin{cases} e^x,\\ x<0 \\\\ e^x+1,\\ x \\ge 0 \\end{cases}$',
            fnLeft: x => Math.exp(x),
            fnRight: x => Math.exp(x) + 1,
            a: 0, L: null
        },
        {
            name: 'å¯¹æ•°é—´æ–­<br>$\\ln|x|$',
            fnLeft: x => Math.log(-x),
            fnRight: x => Math.log(x),
            a: 0, L: null
        },
        {
            name: 'ä¸‰è§’è·³è·ƒ<br>$\\begin{cases} \\cos x,\\ x<\\pi/2 \\\\ \\sin x,\\ x \\ge \\pi/2 \\end{cases}$',
            fnLeft: x => Math.cos(x),
            fnRight: x => Math.sin(x),
            a: Math.PI/2, L: null
        },
        {
            name: 'å¹‚å‡½æ•°è·³è·ƒ<br>$\\begin{cases} x^2,\\ x<1 \\\\ x^3+1,\\ x \\ge 1 \\end{cases}$',
            fnLeft: x => Math.pow(x, 2),
            fnRight: x => Math.pow(x, 3) + 1,
            a: 1, L: null
        }
    ];

    cases.forEach((caseItem, i) => {
        const drawFunction = (g, width, height) => {
            const range = 1.5;
            const xScale = d3.scaleLinear()
                .domain([caseItem.a - range, caseItem.a + range])
                .range([0, width]);
            const yScale = d3.scaleLinear()
                .domain([-3, 3])
                .range([height, 0]);

            drawAxes(g, xScale, yScale, width, height);

            const line = d3.line()
                .x(d => xScale(d.x))
                .y(d => yScale(d.y))
                .defined(d => !isNaN(d.y) && isFinite(d.y) && Math.abs(d.y) < 10);

            const leftData = d3.range(caseItem.a - range, caseItem.a - 0.01, 0.01)
                .map(x => ({x: x, y: caseItem.fnLeft(x)}));

            const leftPath = g.append('path')
                .datum(leftData)
                .attr('fill', 'none')
                .attr('stroke', 'var(--danger-color)')
                .attr('stroke-width', 2)
                .attr('d', line);
            animatePath(leftPath);

            const rightData = d3.range(caseItem.a + 0.01, caseItem.a + range, 0.01)
                .map(x => ({x: x, y: caseItem.fnRight(x)}));

            const rightPath = g.append('path')
                .datum(rightData)
                .attr('fill', 'none')
                .attr('stroke', 'var(--primary-color)')
                .attr('stroke-width', 2)
                .attr('d', line);
            animatePath(rightPath, 2000, false);

            g.append('line')
                .attr('x1', xScale(caseItem.a))
                .attr('y1', 0)
                .attr('x2', xScale(caseItem.a))
                .attr('y2', height)
                .attr('stroke', 'gray')
                .attr('stroke-dasharray', '2,2')
                .attr('opacity', 0.5);

            // æ·»åŠ åŒè¾¹è¶‹è¿‘åŠ¨ç”»
            setTimeout(() => {
                // è®¡ç®—å·¦å³æé™å€¼
                const leftLimit = caseItem.fnLeft(caseItem.a - 0.001);
                const rightLimit = caseItem.fnRight(caseItem.a + 0.001);
                const avgLimit = isFinite(leftLimit) && isFinite(rightLimit) ? (leftLimit + rightLimit) / 2 : (caseItem.L || 0);
                animateLimitApproach(g, xScale, yScale, x => x < caseItem.a ? caseItem.fnLeft(x) : caseItem.fnRight(x), caseItem.a, avgLimit, width, height);
            }, 100);
        };

        let approachVal;
        if (caseItem.a === Math.PI/2) {
            approachVal = 'Ï€/2';
        } else if (caseItem.a === 0) {
            approachVal = '0';
        } else if (caseItem.a === 1) {
            approachVal = '1';
        } else {
            approachVal = caseItem.a.toString();
        }
        const { g, width, height, div } = setup(container, i, caseItem.name, 'both', approachVal);
        div.__chartData = { drawFunction, annotationData: { type: 'limit', isSequence: false, approachPoint: caseItem.a, limitValue: caseItem.L, leftLimit: caseItem.L, rightLimit: caseItem.L } };
        drawFunction(g, width, height);
    });
}

// ç¬¬8é¡µï¼šæé™çš„å››åˆ™è¿ç®—æ³•åˆ™
function visualizeLimitOperations(containerId) {
    const container = getContainer(containerId, 'grid');
    if (!container) return;

  

const operations = [
    { name: 'å’Œ<br>$x+x^2$', f: x => x, g: x => x*x, op: (a,b) => a+b },
    { name: 'å·®<br>$x^2-x$', f: x => x*x, g: x => x, op: (a,b) => a-b },
    { name: 'ç§¯<br>$x \\sin x$', f: x => x, g: x => Math.sin(x), op: (a,b) => a*b },
    { name: 'å•†<br>$x^2/x$', f: x => x*x, g: x => x, op: (a,b) => a/b },
    { name: 'æ•°ä¹˜<br>$2\\sin x$', f: x => Math.sin(x), g: x => 2, op: (a,b) => a*b },
    { name: 'å¹‚<br>$x^2$', f: x => x, g: x => 2, op: (a,b) => Math.pow(a, b) },
    { name: 'å¼€æ–¹<br>$\\sqrt{x+4}$', f: x => x + 4, g: x => 0, op: (a,b) => Math.sqrt(a) },
    { name: 'ç»å¯¹å€¼<br>$|x-1|$', f: x => x - 1, g: x => 0, op: (a,b) => Math.abs(a) },
    { name: 'å¤åˆ<br>$(x+1)^2$', f: x => x*x, g: x => x+1, op: (a,b) => (b*b) },
    { name: 'æœ€å¤§å€¼<br>$\\max(x, 1-x)$', f: x => x, g: x => 1-x, op: (a,b) => Math.max(a,b) },
    { name: 'æœ€å°å€¼<br>$\\min(x^2, x)$', f: x => x*x, g: x => x, op: (a,b) => Math.min(a,b) },
    { name: 'å¹‚æŒ‡<br>$(x+2)^2$', f: x => x+2, g: x => 2, op: (a,b) => Math.pow(a,b) }
];

operations.forEach((op, i) => {
    const drawFunction = (g, width, height) => {
        const xScale = d3.scaleLinear().domain([-2, 2]).range([0, width]);
        const yScale = d3.scaleLinear().domain([-2, 4]).range([height, 0]);

        drawAxes(g, xScale, yScale, width, height);

        const data1 = d3.range(-2, 2, 0.05).map(x => ({x: x, y: op.f(x)}));
        const data2 = d3.range(-2, 2, 0.05).map(x => ({x: x, y: op.g(x)}));
        const dataResult = d3.range(-2, 2, 0.05).map(x => ({
            x: x,
            y: op.op(op.f(x), op.g(x))
        })).filter(d => !isNaN(d.y) && isFinite(d.y));

        const line = d3.line()
            .x(d => xScale(d.x))
            .y(d => yScale(d.y))
            .defined(d => !isNaN(d.y) && isFinite(d.y));

        const path1 = g.append('path')
            .datum(data1)
            .attr('fill', 'none')
            .attr('stroke', 'var(--accent-color)')
            .attr('stroke-width', 1)
            .attr('stroke-dasharray', '3,3')
            .attr('d', line);
        animatePath(path1, 1500);

        const path2 = g.append('path')
            .datum(data2)
            .attr('fill', 'none')
            .attr('stroke', 'var(--primary-color)')
            .attr('stroke-width', 1)
            .attr('stroke-dasharray', '3,3')
            .attr('d', line);
        animatePath(path2, 1500);

        const pathResult = g.append('path')
            .datum(dataResult)
            .attr('fill', 'none')
            .attr('stroke', 'var(--success-color)')
            .attr('stroke-width', 2)
            .attr('d', line);
        animatePath(pathResult, 2000);
    };

    const { g, width, height, div } = setup(container, i, op.name);
    div.__chartData = {
        drawFunction,
        annotationData: {
            type: 'limit',
            isSequence: false,
            approachPoint: 0,
            limitValue: op.op(op.f(0), op.g(0)),
            leftLimit: op.op(op.f(0), op.g(0)),
            rightLimit: op.op(op.f(0), op.g(0))
        }
    };
    drawFunction(g, width, height);
});
}
    
// ç¬¬8.1é¡µï¼šæé™è¿ç®—æ–¹æ³•
function visualizeLimitMethodsDetailed(containerId) {
    const container = getContainer(containerId, 'grid');
    if (!container) {
        console.error('Container vis-limit-methods-detailed not found');
        return;
    }

    const methods = [
        { name: 'ç›´æ¥ä»£å…¥æ³•<br>$\\frac{x^2+1}{x+2}$', fn: x => (x*x + 1)/(x+2), a: 1, L: 2/3 },
        { name: 'å› å¼åˆ†è§£æ³•<br>$\\frac{x^2-1}{x-1}$', fn: x => Math.abs(x-1) > 0.01 ? (x*x - 1)/(x-1) : 2, a: 1, L: 2 },
        { name: 'åˆ†å­æœ‰ç†åŒ–<br>$\\frac{\\sqrt{x+1}-1}{x}$', fn: x => Math.abs(x) > 0.01 ? (Math.sqrt(x+1)-1)/x : 0.5, a: 0, L: 0.5 },
        { name: 'åˆ†æ¯æœ‰ç†åŒ–<br>$\\frac{x}{\\sqrt{x+4}-2}$', fn: x => Math.abs(Math.sqrt(x+4)-2) > 0.01 ? x/(Math.sqrt(x+4)-2) : 4, a: 0, L: 4 },
        { name: 'æ— ç©·å¤§æ¯”è¾ƒæ³•<br>$\\frac{2x^2-3}{3x^2+x}$', fn: x => (2*x*x - 3)/(3*x*x + x), a: 10, L: 2/3 },
        { name: 'å¤¹é€¼å®šç†<br>$x^2\\sin(\\frac{1}{x})$', fn: x => Math.abs(x) > 0.01 ? x*x * Math.sin(1/x) : 0, a: 0, L: 0 },
        { name: 'é‡è¦æé™ I<br>$\\frac{\\sin x}{x}$', fn: x => Math.abs(x) > 0.001 ? Math.sin(x)/x : 1, a: 0, L: 1 },
        { name: 'é‡è¦æé™ II<br>$\\left(1+\\frac{1}{x}\\right)^x$', fn: x => x > 0.1 ? Math.pow(1+1/x, x) : Math.E, a: 10, L: Math.E },
        { name: 'æ´›å¿…è¾¾æ³•åˆ™<br>$\\frac{e^x-1}{\\sin x}$', fn: x => Math.abs(x) > 0.001 ? (Math.exp(x)-1)/Math.sin(x) : 1, a: 0, L: 1 },
        { name: 'ç­‰ä»·æ— ç©·å°<br>$\\frac{\\tan(2x)}{\\ln(1+x)}$', fn: x => Math.abs(x) > 0.01 ? Math.tan(2*x) / Math.log(1+x) : 2, a: 0, L: 2 },
        { name: 'é€šåˆ†æ³•<br>$\\frac{1}{x-1}-\\frac{2}{x^2-1}$', fn: x => Math.abs(x-1) > 0.01 ? 1/(x-1) - 2/(x*x-1) : 0.5, a: 1, L: 0.5 },
        { name: 'å˜é‡æ›¿æ¢æ³•<br>$\\frac{e^x-1}{e^x+1}$', fn: x => (Math.exp(x) - 1)/(Math.exp(x) + 1), a: 0, L: 0 }
    ];

    methods.forEach((method, i) => {
        const drawFunction = (g, width, height) => {
            let xDomain, data;
            if (method.a >= 10) {
                xDomain = [1, 20];
                data = d3.range(1, 20, 0.5).map(x => ({x: x, y: method.fn(x)}));
            } else {
                xDomain = [method.a - 2, method.a + 2];
                data = d3.range(xDomain[0], xDomain[1], 0.02)
                    .filter(x => Math.abs(x - method.a) > 1e-6)
                    .map(x => ({x: x, y: method.fn(x)}));
            }

            const yExtent = d3.extent(data.filter(d => isFinite(d.y)), d => d.y);
            const yPadding = Math.abs(yExtent[1] - yExtent[0]) * 0.2 || 1;
            const yDomain = [yExtent[0] - yPadding, yExtent[1] + yPadding];

            const xScale = d3.scaleLinear().domain(xDomain).range([0, width]);
            const yScale = d3.scaleLinear().domain(yDomain).range([height, 0]);

            drawAxes(g, xScale, yScale, width, height);

            const line = d3.line()
                .x(d => xScale(d.x))
                .y(d => yScale(d.y))
                .defined(d => !isNaN(d.y) && isFinite(d.y));

            const path = g.append('path')
                .datum(data.filter(d => isFinite(d.y)))
                .attr('fill', 'none')
                .attr('stroke', 'var(--primary-color)')
                .attr('stroke-width', 2)
                .attr('d', line);
            animatePath(path, 2000, false);

            // æ·»åŠ æé™è¶‹è¿‘åŠ¨ç”»
            setTimeout(() => {
                const approachVal = method.a >= 10 ? Infinity : method.a;
                animateLimitApproach(g, xScale, yScale, method.fn, approachVal, method.L, width, height);
            }, 100);

            if (method.a < 10) {
                g.append('circle')
                    .attr('cx', xScale(method.a))
                    .attr('cy', yScale(method.L))
                    .attr('r', 4)
                    .attr('fill', 'white')
                    .attr('stroke', 'var(--success-color)')
                    .attr('stroke-width', 2);
            }
        };

        const { g, width, height, div } = setup(container, i, method.name, 'both', method.a);
        div.__chartData = {
            drawFunction,
            annotationData: {
                type: 'limit',
                isSequence: false,
                approachPoint: method.a,
                limitValue: method.L,
                leftLimit: method.L,
                rightLimit: method.L
            }
        };
        drawFunction(g, width, height);
    });
}

// ç¬¬9é¡µï¼šæé™è®¡ç®—æ–¹æ³•
function visualizeLimitMethods(containerId) {
    const setup = setupD3(containerId);
    if (!setup) return;
    const { g, width, height } = setup;
    
    const panel = d3.select('#vis-limit-methods')
        .append('div')
        .attr('class', 'interactive-panel')
        .style('width', '50%')
        .style('fill', 'rgba(255, 255, 255, 0)');
 
    
    const methods = [
        {
            name: 'å› å¼åˆ†è§£æ³•',
            problem: '$$\\lim\\limits_{x \\to 1} \\frac{x^2 - 1}{x - 1}$$',
            steps: [
                'åˆ†è§£: $\\frac{(x+1)(x-1)}{x-1}$',
                'çº¦åˆ†: $x+1$',
                'ä»£å…¥: $1+1 = 2$'
            ],
            fn: x => Math.abs(x-1) > 0.01 ? (x*x - 1)/(x - 1) : 2,
            a: 1,
            L: 2
        },
        {
            name: 'æœ‰ç†åŒ–æ³•',
            problem: '$$\\lim\\limits_{x \\to 0} \\frac{\\sqrt{x+1}-1}{x}$$',
            steps: [
                'åˆ†å­åˆ†æ¯åŒä¹˜ $\\sqrt{x+1}+1$',
                '= $\\frac{(x+1)-1}{x(\\sqrt{x+1}+1)}$',
                '= $\\frac{1}{\\sqrt{x+1}+1} = \\frac{1}{2}$'
            ],
            fn: x => Math.abs(x) > 0.01 ? (Math.sqrt(x+1)-1)/x : 0.5,
            a: 0,
            L: 0.5
        },
        {
            name: 'ç­‰ä»·æ— ç©·å°',
            problem: '$$\\lim\\limits_{x \\to 0} \\frac{\\sin x}{x}$$',
            steps: [
                'å½“ $x \\to 0$ æ—¶',
                '$\\sin x \\sim x$',
                'æé™ = 1'
            ],
            fn: x => Math.abs(x) > 0.001 ? Math.sin(x)/x : 1,
            a: 0,
            L: 1
        }
    ];
    
    let currentMethod = 0;
    
    const buttonContainer = panel.append('div')
        .style('display', 'flex')
        .style('gap', '10px')
        .style('margin-bottom', '20px');
    
    methods.forEach((method, i) => {
        buttonContainer.append('button')
            .attr('class', 'nav-btn')
            .text(method.name)
            .on('click', () => showMethod(i));
    });
    
    const stepsContainer = panel.append('div')
        .style('background', 'rgba(0,0,0,0.05)')
        .style('padding', '20px')
        .style('border-radius', '8px');
    
    const xScale = d3.scaleLinear().domain([-2, 2]).range([0, width]);
    const yScale = d3.scaleLinear().domain([-1, 4]).range([height - 100, 0]);
    
    // åæ ‡è½´
    g.append('g')
        .attr('transform', `translate(0, ${yScale(0)})`)
        .call(d3.axisBottom(xScale));
    
    g.append('g')
        .attr('transform', `translate(${xScale(0)}, 0)`)
        .call(d3.axisLeft(yScale));
    
    function showMethod(index) {
        currentMethod = index;
        const method = methods[index];
        
        // æ¸…é™¤ä¹‹å‰çš„å†…å®¹
        stepsContainer.selectAll('*').remove();
        g.selectAll('.method-graph').remove();
        
        // æ˜¾ç¤ºé—®é¢˜
        stepsContainer.append('div')
            .style('font-size', '1.5rem')
            .style('margin-bottom', '20px')
            .html(method.problem);
        
        // é€æ­¥æ˜¾ç¤ºæ­¥éª¤ - åªæ’­æ”¾ä¸€æ¬¡ï¼Œä¸å¾ªç¯
        let stepIndex = 0;
        function showMethodStep() {
            if (stepIndex < method.steps.length) {
                const step = method.steps[stepIndex];
                stepsContainer.append('div')
                    .attr('class', 'formula-step fade-in')
                    .style('margin', '10px 0')
                    .style('padding-left', '20px')
                    .html(`æ­¥éª¤ ${stepIndex+1}: ${step}`);
                
                if (window.MathJax) {
                    MathJax.typesetPromise();
                }
                
                stepIndex++;
                if (stepIndex < method.steps.length) {
                    setTimeout(showMethodStep, 1000 / globalAnimationSpeed);
                }
            }
        }
        
        showMethodStep();
        
        // ç»˜åˆ¶å‡½æ•°
        const data = d3.range(-2, 2, 0.01)
            .map(x => ({x: x, y: method.fn(x)}))
            .filter(d => !isNaN(d.y) && isFinite(d.y) && Math.abs(d.y) < 10);
        
        const line = d3.line()
            .x(d => xScale(d.x))
            .y(d => yScale(d.y));
        
        const path = g.append('path')
            .attr('class', 'method-graph')
            .datum(data)
            .attr('d', line)
            .attr('fill', 'none')
            .attr('stroke', 'var(--primary-color)')
            .attr('stroke-width', 2);
        
        // æ ‡è®°æé™ç‚¹
        g.append('circle')
            .attr('class', 'method-graph')
            .attr('cx', xScale(method.a))
            .attr('cy', yScale(method.L))
            .attr('r', 6)
            .attr('fill', 'var(--success-color)');
        
        // åŠ¨ç”»
        const totalLength = path.node().getTotalLength();
        path
            .attr('stroke-dasharray', totalLength + ' ' + totalLength)
            .attr('stroke-dashoffset', totalLength)
            .transition()
            .duration(2000 / globalAnimationSpeed)
            .ease(d3.easeLinear)
            .attr('stroke-dashoffset', 0);
    }
    
    showMethod(0);
}

// ç¬¬10é¡µï¼šç¬¬ä¸€é‡è¦æé™
function visualizeImportantLimit1(containerId) {
    const container = getContainer(containerId, 'flex');
    if (!container) return;
    
    // åˆ›å»ºå·¦å³åˆ†æ å¸ƒå±€
    const mainDiv = d3.select(container)
        .append('div')
        .style('display', 'flex')
        .style('height', '100%');
    
    // å·¦ä¾§ï¼šå›¾å½¢å±•ç¤º
    const leftDiv = mainDiv.append('div')
        .style('flex', '1')
        .style('padding', '20px');
    
    // å³ä¾§ï¼šç»ƒä¹ é¢˜
    const rightDiv = mainDiv.append('div')
        .style('flex', '0.5')
        .style('padding', '20px')
        .style('background', 'rgba(52, 152, 219, 0.05)')
        .style('border-radius', '10px')
        .style('margin', '20px');
    
    rightDiv.append('h3')
        .style('color', '#3498db')
        .text('è¯•è¯•çœ‹ï¼š');
    
    // ç»ƒä¹ é¢˜ç»„
    const exercises = [
        { 
            problem: '$$\\lim_{xâ†’0} \\frac{\\sin 2x}{x}$$',
            hint: 'æŠŠ2xçœ‹ä½œæ•´ä½“',
            answer: '2'
        },
        { 
            problem: '$$\\lim_{xâ†’0} \\frac{\\sin 3x}{2x}$$',
            hint: 'åˆ†å­åˆ†æ¯éƒ½æœ‰ç³»æ•°',
            answer: '3/2'
        },
        { 
            problem: '$$\\lim_{xâ†’0} \\frac{\\sin 5x}{\\sin 2x}$$',
            hint: 'ä¸Šä¸‹åŒé™¤ä»¥x',
            answer: '5/2'
        }
    ];
    
    exercises.forEach((ex, i) => {
        const exDiv = rightDiv.append('div')
            .style('margin', '20px 0')
            .style('padding', '15px')
            .style('background', 'white')
            .style('border-radius', '8px');
        
        exDiv.append('div')
            .html(`é¢˜${i+1}ï¼š${ex.problem}`);
        
        const hintBtn = exDiv.append('button')
            .style('margin', '10px 5px')
            .style('padding', '5px 10px')
            .style('background', '#f39c12')
            .style('color', 'white')
            .style('border', 'none')
            .style('border-radius', '4px')
            .style('cursor', 'pointer')
            .text('æç¤º')
            .on('click', function() {
                d3.select(this.parentNode)
                    .append('div')
                    .style('color', '#f39c12')
                    .style('margin-top', '5px')
                    .text(ex.hint);
            });
        
        const answerBtn = exDiv.append('button')
            .style('margin', '10px 5px')
            .style('padding', '5px 10px')
            .style('background', '#27ae60')
            .style('color', 'white')
            .style('border', 'none')
            .style('border-radius', '4px')
            .style('cursor', 'pointer')
            .text('ç­”æ¡ˆ')
            .on('click', function() {
                d3.select(this.parentNode)
                    .append('div')
                    .style('color', '#27ae60')
                    .style('margin-top', '5px')
                    .style('font-weight', 'bold')
                    .text(`ç­”æ¡ˆï¼š${ex.answer}`);
            });
    });
    
    // å·¦ä¾§å›¾å½¢ä»£ç 
    const titleDiv = leftDiv
        .append('div')
        .style('text-align', 'center')
        .style('font-size', '20px')
        .style('color', 'black')
        .style('margin-bottom', '10px')
        .html('$$\\lim\\limits_{x \\to 0} \\frac{\\sin x}{x} = 1$$');
    
    const width = 500;
    const height = 300;
    const margin = { top: 20, right: 50, bottom: 50, left: 50 };
    
    const svg = leftDiv
        .append('svg')
        .attr('width', width + margin.left + margin.right)
        .attr('height', height + margin.top + margin.bottom);
    
    const g = svg.append('g')
        .attr('transform', `translate(${margin.left}, ${margin.top})`);
    
    const xScale = d3.scaleLinear().domain([-Math.PI, Math.PI]).range([0, width]);
    const yScale = d3.scaleLinear().domain([-0.5, 1.5]).range([height, 0]);
    
    // åæ ‡è½´
    g.append('g')
        .attr('transform', `translate(0, ${yScale(0)})`)
        .call(d3.axisBottom(xScale).tickFormat(d => {
            if (d === 0) return '0';
            if (d === Math.PI) return 'Ï€';
            if (d === -Math.PI) return '-Ï€';
            return d.toFixed(1);
        }));
    
    g.append('g')
        .call(d3.axisLeft(yScale));
    
    // æ¸²æŸ“MathJax
    if (window.MathJax) {
        MathJax.typesetPromise([titleDiv.node()]);
    }
    
    // ç»˜åˆ¶sin(x)/x
    const data = [];
    for (let x = -Math.PI; x <= Math.PI; x += 0.01) {
        if (Math.abs(x) > 0.001) {
            data.push({ x: x, y: Math.sin(x) / x });
        }
    }
    
    const line = d3.line()
        .x(d => xScale(d.x))
        .y(d => yScale(d.y));
    
    g.append('path')
        .datum(data)
        .attr('d', line)
        .attr('fill', 'none')
        .attr('stroke', 'cyan')
        .attr('stroke-width', 3);
    
    // æé™å€¼çº¿ y=1
    g.append('line')
        .attr('x1', 0)
        .attr('x2', width)
        .attr('y1', yScale(1))
        .attr('y2', yScale(1))
        .attr('stroke', 'darkgreen')
        .attr('stroke-width', 6)
        .attr('stroke-dasharray', '5,5');
    
    g.append('text')
        .attr('x', width - 90)
        .attr('y', yScale(1) - 25)
        .attr('fill', 'darkgreen')
        .style('font-size', '24px')
        .text('y = 1');
    
    // x=0å¤„çš„æé™ç‚¹
    g.append('circle')
        .attr('cx', xScale(0))
        .attr('cy', yScale(1))
        .attr('r', 6)
        .attr('fill', 'red')
        .attr('stroke', 'black')
        .attr('stroke-width', 2);
}

// ç¬¬11é¡µï¼šç¬¬äºŒé‡è¦æé™
function visualizeImportantLimit2(containerId) {
    const container = getContainer(containerId, 'flex');
    if (!container) return;
    
    // åˆ›å»ºä¸»å®¹å™¨ï¼Œç¡®ä¿å‚ç›´å¸ƒå±€
    const mainDiv = d3.select(container)
        .append('div')
        .style('display', 'flex')
        .style('flex-direction', 'column')
        .style('align-items', 'center')
        .style('width', '100%');
    
    // æ ‡é¢˜å®¹å™¨
    const titleDiv = mainDiv
        .append('div')
        .style('text-align', 'center')
        .style('font-size', '20px')
        .style('color', 'black')
        .style('margin-bottom', '10px')
        .style('width', '100%')
        .html('$$\\lim\\limits_{x \\to \\infty} \\left(1+\\frac{1}{x}\\right)^x = e$$');
    
    // å›¾è¡¨å®¹å™¨
    const chartDiv = mainDiv
        .append('div')
        .style('width', '100%')
        .style('display', 'flex')
        .style('justify-content', 'center');
    
    const width = 600;
    const height = 400;
    const margin = { top: 20, right: 50, bottom: 50, left: 50 };
    
    const svg = chartDiv
        .append('svg')
        .attr('width', width + margin.left + margin.right)
        .attr('height', height + margin.top + margin.bottom);
    
    const g = svg.append('g')
        .attr('transform', `translate(${margin.left}, ${margin.top})`);
    
    const xScale = d3.scaleLog().domain([1, 100]).range([0, width]);
    const yScale = d3.scaleLinear().domain([2, 3]).range([height, 0]);
    
    // åæ ‡è½´
    g.append('g')
        .attr('transform', `translate(0, ${height})`)
        .call(d3.axisBottom(xScale).tickFormat(d => {
            if (d === 1) return '1';
            if (d === 10) return '10';
            if (d === 100) return '100';
            return d.toString();
        }));
    
    g.append('g')
        .call(d3.axisLeft(yScale));
    
    // æ¸²æŸ“MathJax
    if (window.MathJax) {
        MathJax.typesetPromise([titleDiv.node()]);
    }
    
    // ç»˜åˆ¶(1+1/x)^x - å¸¦åŠ¨ç”»æ•ˆæœ
    const data = [];
    for (let x = 1; x <= 100; x *= 1.1) {
        data.push({ x: x, y: Math.pow(1 + 1/x, x) });
    }
    
    const line = d3.line()
        .x(d => xScale(d.x))
        .y(d => yScale(d.y));
    
    const path = g.append('path')
        .datum(data)
        .attr('d', line)
        .attr('fill', 'none')
        .attr('stroke', 'lime')
        .attr('stroke-width', 3);
    
    // è·¯å¾„åŠ¨ç”»
    const totalLength = path.node().getTotalLength();
    path.attr('stroke-dasharray', totalLength + ' ' + totalLength)
        .attr('stroke-dashoffset', totalLength)
        .transition()
        .duration(2000)
        .attr('stroke-dashoffset', 0);
    
    // eå€¼çº¿ - å»¶è¿Ÿå‡ºç°
    const eLine = g.append('line')
        .attr('x1', 0)
        .attr('x2', width)
        .attr('y1', yScale(Math.E))
        .attr('y2', yScale(Math.E))
        .attr('stroke', 'orange')
        .attr('stroke-width', 6)
        .attr('stroke-dasharray', '5,5')
        .attr('opacity', 0);
    
    eLine.transition()
        .delay(1000)
        .duration(1000)
        .attr('opacity', 1);
    
    const eLabel = g.append('text')
        .attr('x', width - 120)
        .attr('y', yScale(Math.E) - 15)
        .attr('fill', 'orange')
        .style('font-size', '24px')
        .style('opacity', 0)
        .text(`e â‰ˆ ${Math.E.toFixed(5)}`);
    
    eLabel.transition()
        .delay(1500)
        .duration(1000)
        .style('opacity', 1);
    
    // æ·»åŠ æ•°å€¼è¡¨æ ¼ - å¸¦åŠ¨ç”»å’Œå…¬å¼æ¸²æŸ“
    const table = g.append('g')
        .attr('transform', `translate(50, 50)`)
        .style('opacity', 0);
    
    table.append('rect')
        .attr('width', 250)
        .attr('height', 180)
        .attr('fill', 'rgba(255, 255, 255, 0)')
        .attr('stroke', 'black')
        .attr('stroke-width', 2)
        .attr('rx', 5);
    
    const tableValues = [
        { x: 1, y: Math.pow(1 + 1/1, 1) },
        { x: 10, y: Math.pow(1 + 1/10, 10) },
        { x: 100, y: Math.pow(1 + 1/100, 100) },
        { x: 1000, y: Math.pow(1 + 1/1000, 1000) },
        { x: 10000, y: Math.pow(1 + 1/10000, 10000) }
    ];
    
    // è¡¨æ ¼æ ‡é¢˜ - ä½¿ç”¨MathJaxå…¬å¼
    const tableTitle = table.append('foreignObject')
        .attr('x', 10)
        .attr('y', 5)
        .attr('width', 230)
        .attr('height', 80);
    
    tableTitle.append('xhtml:div')
        .style('text-align', 'center')
        .style('font-size', '10px')
        .style('font-weight', 'bold')
        .html('$$\\left(1+\\frac{1}{x}\\right)^x$$');
    
    // è¡¨æ ¼æ•°æ®è¡Œ - é€è¡ŒåŠ¨ç”»å‡ºç°
    tableValues.forEach((val, i) => {
        const row = table.append('g')
            .style('opacity', 0);
        
        // xå€¼
        const xLabel = row.append('foreignObject')
            .attr('x', 10)
            .attr('y', 40 + i * 25)
            .attr('width', 80)
            .attr('height', 25);
        
        xLabel.append('xhtml:div')
            .style('font-size', '12px')
            .html(`$$x=${val.x}$$`);
        
        // åˆ†éš”ç¬¦
        row.append('text')
            .attr('x', 90)
            .attr('y', 55 + i * 25)
            .attr('fill', 'black')
            .style('font-size', '12px')
            .text('â†’');
        
        // è®¡ç®—ç»“æœ
        row.append('text')
            .attr('x', 110)
            .attr('y', 55 + i * 25)
            .attr('fill', 'darkgreen')
            .style('font-size', '12px')
            .style('font-weight', 'bold')
            .text(`${val.y.toFixed(6)}`);
        
        // é€è¡Œå‡ºç°åŠ¨ç”»
        row.transition()
            .delay(2000 + i * 300)
            .duration(500)
            .style('opacity', 1);
    });
    
    // è¡¨æ ¼æ•´ä½“å‡ºç°åŠ¨ç”»
    table.transition()
        .delay(1800)
        .duration(500)
        .style('opacity', 1)
        .on('end', () => {
            // æ¸²æŸ“è¡¨æ ¼ä¸­çš„MathJax
            if (window.MathJax) {
                MathJax.typesetPromise([table.node()]);
            }
        });
    
    // æ·»åŠ æé™å€¼ç‚¹ - æœ€åå‡ºç°
    const limitPoint = g.append('circle')
        .attr('cx', xScale(100))
        .attr('cy', yScale(Math.E))
        .attr('r', 0)
        .attr('fill', 'red')
        .attr('stroke', 'black')
        .attr('stroke-width', 2);
    
    limitPoint.transition()
        .delay(3000)
        .duration(800)
        .attr('r', 8)
        .transition()
        .duration(300)
        .attr('r', 6);
    
    // æ·»åŠ æ”¶æ•›åŠ¨ç”»æç¤º
    const convergenceText = g.append('text')
        .attr('x', width / 2)
        .attr('y', height - 35)
        .attr('text-anchor', 'middle')
        .attr('fill', 'darkblue')
        .style('font-size', '16px')
        .style('font-weight', 'bold')
        .style('opacity', 0)
        .text('å½“ x â†’ âˆ æ—¶ï¼Œå‡½æ•°å€¼æ”¶æ•›åˆ° e');
    
    convergenceText.transition()
        .delay(3500)
        .duration(1000)
        .style('opacity', 1);
}

// ç¬¬11.1é¡µï¼šä¸¤ä¸ªé‡è¦æé™
function visualizeImportantLimitsDetailed(containerId) {
    const container = getContainer(containerId, 'grid');
    if (!container) {
        console.error('Container vis-important-limits-detailed not found');
        return;
    }

    const limits = [
        { name: 'é‡è¦æé™ I<br>$\\frac{\\sin x}{x}$', fn: x => Math.abs(x) > 0.001 ? Math.sin(x)/x : 1, center: 0, L: 1 },
        { name: 'å˜å½¢ I<br>$\\frac{\\tan x}{x}$', fn: x => Math.abs(x) > 0.001 ? Math.tan(x)/x : 1, center: 0, L: 1 },
        { name: 'å˜å½¢ II<br>$\\frac{1-\\cos x}{x^2}$', fn: x => Math.abs(x) > 0.001 ? (1-Math.cos(x))/(x*x) : 0.5, center: 0, L: 0.5 },
        { name: 'å˜å½¢ III<br>$\\frac{\\sin 2x}{x}$', fn: x => Math.abs(x) > 0.001 ? Math.sin(2*x)/x : 2, center: 0, L: 2 },
        { name: 'å˜å½¢ IV<br>$\\frac{\\arcsin x}{x}$', fn: x => Math.abs(x) > 0.001 && Math.abs(x) <= 1 ? Math.asin(x)/x : 1, center: 0, L: 1 },
        { name: 'é‡è¦æé™ II<br>$\\left(1+\\frac{1}{x}\\right)^x$', fn: x => x > 0.1 ? Math.pow(1+1/x, x) : Math.E, center: Infinity, L: Math.E },
        { name: 'å˜å½¢ I<br>$(1+x)^{\\frac{1}{x}}$', fn: x => Math.abs(x) > 0.01 && x > -1 ? Math.pow(1+x, 1/x) : Math.E, center: 0, L: Math.E },
        { name: 'å˜å½¢ II<br>$\\left(1+\\frac{2}{x}\\right)^x$', fn: x => x > 0.1 ? Math.pow(1+2/x, x) : Math.exp(2), center: Infinity, L: Math.exp(2) },
        { name: 'å˜å½¢ III<br>$\\left(1-\\frac{1}{x}\\right)^x$', fn: x => x > 1 ? Math.pow(1-1/x, x) : 1/Math.E, center: Infinity, L: 1/Math.E },
        { name: 'å˜å½¢ IV<br>$\\frac{\\ln(1+x)}{x}$', fn: x => Math.abs(x) > 0.001 && x > -1 ? Math.log(1+x)/x : 1, center: 0, L: 1 },
        { name: 'å˜å½¢ V<br>$\\frac{e^x-1}{x}$', fn: x => Math.abs(x) > 0.001 ? (Math.exp(x)-1)/x : 1, center: 0, L: 1 },
        { name: 'å˜å½¢ VI<br>$\\frac{2^x-1}{x}$', fn: x => Math.abs(x) > 0.001 ? (Math.pow(2,x)-1)/x : Math.log(2), center: 0, L: Math.log(2) }
    ];

    limits.forEach((limit, i) => {
        const drawFunction = (g, width, height) => {
            let xDomain, data;
            if (limit.center === 0) {
                xDomain = [-1, 1];
                data = d3.range(-1, 1, 0.01).filter(x => Math.abs(x) > 0.01)
                    .map(x => ({x: x, y: limit.fn(x)}));
            } else {
                xDomain = [1, 10];
                data = d3.range(1, 10, 0.1)
                    .map(x => ({x: x, y: limit.fn(x)}));
            }

            const yExtent = d3.extent(data, d => d.y);
            const yScale = d3.scaleLinear()
                .domain([Math.min(yExtent[0] - 0.5, limit.L - 1), Math.max(yExtent[1] + 0.5, limit.L + 1)])
                .range([height, 0]);
            const xScale = d3.scaleLinear().domain(xDomain).range([0, width]);

            drawAxes(g, xScale, yScale, width, height);

            const line = d3.line()
                .x(d => xScale(d.x))
                .y(d => yScale(d.y))
                .defined(d => !isNaN(d.y) && isFinite(d.y));

            const path = g.append('path')
                .datum(data)
                .attr('fill', 'none')
                .attr('stroke', 'var(--primary-color)')
                .attr('stroke-width', 2)
                .attr('d', line);
            animatePath(path, 2000, false);

            // æ·»åŠ é‡è¦æé™çš„ç‰¹æ®ŠåŠ¨ç”»å¤„ç†
            setTimeout(() => {
                const approachVal = limit.center === 0 ? 0 : (limit.center === Infinity ? Infinity : limit.center);
                animateLimitApproach(g, xScale, yScale, limit.fn, approachVal, limit.L, width, height);
            }, 100);
        };

        const approachVal = limit.center === 0 ? '0' : (limit.center === Infinity ? 'âˆ' : limit.center.toString());
        const { g, width, height, div } = setup(container, i, limit.name, 'both', approachVal);
        div.__chartData = {
            drawFunction,
            annotationData: {
                type: 'limit',
                isSequence: false,
                approachPoint: limit.center,
                limitValue: limit.L,
                leftLimit: limit.L,
                rightLimit: limit.L
            }
        };
        drawFunction(g, width, height);
    });
}


// ç¬¬12é¡µï¼šæ— ç©·å°ä¸æ— ç©·å¤§
function visualizeInfinitesimalInfinity(containerId) {
    const setup = setupD3(containerId);
    if (!setup) return;
    const { g, width, height } = setup;
    
    const xScale = d3.scaleLinear().domain([-2, 2]).range([0, width]);
    const yScale = d3.scaleLinear().domain([-5, 5]).range([height, 0]);
    
    // åæ ‡è½´
    g.append('g')
        .attr('transform', `translate(0, ${yScale(0)})`)
        .call(d3.axisBottom(xScale));
    
    g.append('g')
        .attr('transform', `translate(${xScale(0)}, 0)`)
        .call(d3.axisLeft(yScale));
    
    // æ— ç©·å°å‡½æ•°
    const infinitesimals = [
        { fn: x => x, color: '#3498db', label: 'x' },
        { fn: x => x*x, color: '#2ecc71', label: 'xÂ²' },
        { fn: x => x*x*x, color: '#e74c3c', label: 'xÂ³' }
    ];
    
    infinitesimals.forEach(item => {
        const data = d3.range(-2, 2, 0.01)
            .map(x => ({x: x, y: item.fn(x)}))
            .filter(d => !isNaN(d.y) && isFinite(d.y));
        
        const line = d3.line()
            .x(d => xScale(d.x))
            .y(d => yScale(d.y));
        
        g.append('path')
            .datum(data)
            .attr('d', line)
            .attr('fill', 'none')
            .attr('stroke', item.color)
            .attr('stroke-width', 2);
    });
    
    // æ— ç©·å¤§å‡½æ•° 1/x
    const infinityData1 = d3.range(-2, -0.05, 0.01)
        .map(x => ({x: x, y: Math.min(Math.max(1/x, -5), 5)}));
    const infinityData2 = d3.range(0.05, 2, 0.01)
        .map(x => ({x: x, y: Math.min(Math.max(1/x, -5), 5)}));
    
    const line = d3.line()
        .x(d => xScale(d.x))
        .y(d => yScale(d.y));
    
    g.append('path')
        .datum(infinityData1)
        .attr('d', line)
        .attr('fill', 'none')
        .attr('stroke', 'orange')
        .attr('stroke-width', 2);
    
    g.append('path')
        .datum(infinityData2)
        .attr('d', line)
        .attr('fill', 'none')
        .attr('stroke', 'orange')
        .attr('stroke-width', 2);
    
    // å›¾ä¾‹
    const legend = g.append('g')
        .attr('transform', `translate(${width - 150}, 30)`);
    
    legend.append('rect')
        .attr('width', 140)
        .attr('height', 120)
        .attr('fill', 'rgba(0, 0, 0, 0.7)')
        .attr('stroke', 'white')
        .attr('rx', 5);
    
    const items = [
        { color: '#3498db', text: 'x (ä¸€é˜¶æ— ç©·å°)' },
        { color: '#2ecc71', text: 'xÂ² (äºŒé˜¶æ— ç©·å°)' },
        { color: '#e74c3c', text: 'xÂ³ (ä¸‰é˜¶æ— ç©·å°)' },
        { color: 'orange', text: '1/x (æ— ç©·å¤§)' }
    ];
    
    items.forEach((item, i) => {
        legend.append('line')
            .attr('x1', 10)
            .attr('x2', 30)
            .attr('y1', 25 + i * 25)
            .attr('y2', 25 + i * 25)
            .attr('stroke', item.color)
            .attr('stroke-width', 2);
        
        legend.append('text')
            .attr('x', 35)
            .attr('y', 30 + i * 25)
            .attr('fill', 'white')
            .style('font-size', '11px')
            .text(item.text);
    });
}

// ç¬¬13é¡µï¼šæ— ç©·å°çš„æ¯”è¾ƒ
function visualizeInfinitesimalComparison(containerId) {
    const setup = setupD3(containerId);
    if (!setup) return;
    const { g, width, height } = setup;
    
    const panel = d3.select('#vis-infinitesimal-comparison')
        .append('div')
        .attr('class', 'interactive-panel draggable-panel');
    
    panel.append('h3').text('æ— ç©·å°é˜¶çš„æ¯”è¾ƒ');
    
    // æ·»åŠ æ‹–æ‹½åŠŸèƒ½
    let isDragging = false;
    let dragOffset = { x: 0, y: 0 };
    
    // é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶
    panel.on('mousedown', function(event) {
        // åªåœ¨æ ‡é¢˜åŒºåŸŸè§¦å‘æ‹–æ‹½
        if (event.target.tagName === 'H3') {
            isDragging = true;
            const rect = this.getBoundingClientRect();
            dragOffset.x = event.clientX - rect.left;
            dragOffset.y = event.clientY - rect.top;
            
            // æ·»åŠ æ‹–æ‹½æ ·å¼
            d3.select(this).classed('dragging', true);
            
            // é˜»æ­¢é»˜è®¤è¡Œä¸º
            event.preventDefault();
        }
    });
    
    // é¼ æ ‡ç§»åŠ¨äº‹ä»¶
    d3.select(document).on('mousemove.drag', function(event) {
        if (isDragging) {
            const panelNode = panel.node();
            const containerRect = panelNode.parentElement.getBoundingClientRect();
            
            // è®¡ç®—æ–°ä½ç½®
            let newX = event.clientX - containerRect.left - dragOffset.x;
            let newY = event.clientY - containerRect.top - dragOffset.y;
            
            // é™åˆ¶åœ¨å®¹å™¨èŒƒå›´å†…
            const panelRect = panelNode.getBoundingClientRect();
            newX = Math.max(0, Math.min(newX, containerRect.width - panelRect.width));
            newY = Math.max(0, Math.min(newY, containerRect.height - panelRect.height));
            
            // åº”ç”¨æ–°ä½ç½®
            panelNode.style.left = newX + 'px';
            panelNode.style.top = newY + 'px';
        }
    });
    
    // é¼ æ ‡é‡Šæ”¾äº‹ä»¶
    d3.select(document).on('mouseup.drag', function() {
        if (isDragging) {
            isDragging = false;
            d3.select(panel.node()).classed('dragging', false);
        }
    });
    
    // åˆ›å»ºæ»‘å—æ§åˆ¶xçš„å€¼
    const sliderContainer = panel.append('div')
        .attr('class', 'slider-container');
    
    sliderContainer.append('label').text('xå€¼: ');
    const valueDisplay = sliderContainer.append('span')
        .attr('class', 'value-display')
        .text('0.5');
    
    const slider = sliderContainer.append('input')
        .attr('type', 'range')
        .attr('class', 'slider')
        .attr('min', '0.01')
        .attr('max', '1')
        .attr('step', '0.01')
        .attr('value', '0.5');
    
    // æ¯”è¾ƒè¡¨æ ¼
    const table = panel.append('table')
        .style('width', '100%')
        .style('margin-top', '20px');
    
    const functions = [
        { name: 'x', fn: x => x, order: 1 },
        { name: 'xÂ²', fn: x => x*x, order: 2 },
        { name: 'xÂ³', fn: x => x*x*x, order: 3 },
        { name: 'sin(x)', fn: x => Math.sin(x), order: 1 },
        { name: '1-cos(x)', fn: x => 1 - Math.cos(x), order: 2 }
    ];
    
    // è¡¨å¤´
    const header = table.append('tr');
    header.append('th').text('å‡½æ•°');
    header.append('th').text('å€¼');
    header.append('th').text('é˜¶');
    
    const rows = functions.map(f => {
        const row = table.append('tr');
        row.append('td').text(f.name);
        row.append('td').attr('class', 'value-cell').text('');
        row.append('td').text(f.order);
        return row;
    });
    
    // å›¾å½¢åŒºåŸŸ
    const xScale = d3.scaleLinear().domain([0, 1]).range([0, width]);
    const yScale = d3.scaleLinear().domain([0, 1]).range([height - 50, 0]);
    
    // åæ ‡è½´
    g.append('g')
        .attr('transform', `translate(0, ${height - 50})`)
        .call(d3.axisBottom(xScale));
    
    g.append('g')
        .call(d3.axisLeft(yScale));
    
    // ç»˜åˆ¶å‡½æ•°
    functions.forEach((f, i) => {
        const data = d3.range(0, 1, 0.01)
            .map(x => ({x: x, y: f.fn(x)}));
        
        const line = d3.line()
            .x(d => xScale(d.x))
            .y(d => yScale(d.y));
        
        g.append('path')
            .datum(data)
            .attr('d', line)
            .attr('fill', 'none')
            .attr('stroke', d3.schemeCategory10[i])
            .attr('stroke-width', 2);
    });
    
    // æ›´æ–°å‡½æ•°
    function update(x) {
        valueDisplay.text(x);
        
        rows.forEach((row, i) => {
            const value = functions[i].fn(x);
            row.select('.value-cell').text(value.toFixed(6));
        });
        
        // æ ‡è®°å½“å‰xä½ç½®
        g.selectAll('.current-line').remove();
        g.append('line')
            .attr('class', 'current-line')
            .attr('x1', xScale(x))
            .attr('x2', xScale(x))
            .attr('y1', 0)
            .attr('y2', height - 50)
            .attr('stroke', 'red')
            .attr('stroke-dasharray', '3,3');
        
        // æ ‡è®°å„å‡½æ•°å€¼
        g.selectAll('.current-point').remove();
        functions.forEach((f, i) => {
            g.append('circle')
                .attr('class', 'current-point')
                .attr('cx', xScale(x))
                .attr('cy', yScale(f.fn(x)))
                .attr('r', 4)
                .attr('fill', d3.schemeCategory10[i]);
        });
    }
    
    slider.on('input', function() {
        update(+this.value);
    });
    
    update(0.5);
}

// ç¬¬14é¡µï¼šç­‰ä»·æ— ç©·å°
function visualizeEquivalentInfinitesimal(containerId) {
    const container = getContainer(containerId, 'grid');
    if (!container) return;
    
    const pairs = [
        { name: 'æ­£å¼¦<br>$\\sin x \\sim x$', f1: Math.sin, f2: x => x },
        { name: 'æ­£åˆ‡<br>$\\tan x \\sim x$', f1: Math.tan, f2: x => x },
        { name: 'ä½™å¼¦<br>$1-\\cos x \\sim \\frac{x^2}{2}$', f1: x => 1-Math.cos(x), f2: x => x*x/2 },
        { name: 'åæ­£å¼¦<br>$\\arcsin x \\sim x$', f1: Math.asin, f2: x => x },
        { name: 'åæ­£åˆ‡<br>$\\arctan x \\sim x$', f1: Math.atan, f2: x => x },
        { name: 'æŒ‡æ•°<br>$e^x-1 \\sim x$', f1: x => Math.exp(x)-1, f2: x => x },
        { name: 'å¯¹æ•°<br>$\\ln(1+x) \\sim x$', f1: x => Math.log(1+x), f2: x => x },
        { name: 'å¹‚å‡½æ•°<br>$(1+x)^2-1 \\sim 2x$', f1: x => Math.pow(1+x, 2)-1, f2: x => 2*x },
        { name: 'åŒæ›²æ­£å¼¦<br>$\\sinh x \\sim x$', f1: x => Math.sinh(x), f2: x => x },
        { name: 'é«˜é˜¶ I<br>$\\sin(x^2) \\sim x^2$', f1: x => Math.sin(x*x), f2: x => x*x },
        { name: 'é«˜é˜¶ II<br>$x-\\sin x \\sim \\frac{x^3}{6}$', f1: x => x-Math.sin(x), f2: x => x*x*x/6 },
        { name: 'é«˜é˜¶ III<br>$\\tan x-x \\sim \\frac{x^3}{3}$', f1: x => Math.tan(x)-x, f2: x => x*x*x/3 }
    ];
    
    pairs.forEach((pair, i) => {
        const drawFunction = (g, width, height) => {
            const xScale = d3.scaleLinear().domain([-0.5, 0.5]).range([0, width]);
            const yScale = d3.scaleLinear().domain([-0.3, 0.3]).range([height, 0]);

            drawAxes(g, xScale, yScale, width, height);

        const data1 = d3.range(-0.5, 0.5, 0.01)
            .map(x => ({x: x, y: pair.f1(x)}))
            .filter(d => !isNaN(d.y) && isFinite(d.y));
        
        const data2 = d3.range(-0.5, 0.5, 0.01)
            .map(x => ({x: x, y: pair.f2(x)}))
            .filter(d => !isNaN(d.y) && isFinite(d.y));
        
        const line = d3.line()
            .x(d => xScale(d.x))
            .y(d => yScale(d.y));
        
            const path1 = g.append('path')
            .datum(data1)
            .attr('fill', 'none')
            .attr('stroke', 'var(--primary-color)')
                .attr('stroke-width', 2)
                .attr('d', line);
            animatePath(path1);
        
            const path2 = g.append('path')
            .datum(data2)
            .attr('fill', 'none')
            .attr('stroke', 'var(--accent-color)')
            .attr('stroke-width', 2)
                .attr('stroke-dasharray', '3,3')
                .attr('d', line);
            animatePath(path2);
        };

        const { g, width, height, div } = setup(container, i, pair.name, 'both', 0);
        div.__chartData = {
            drawFunction,
            annotationData: {
                type: 'limit',
                isSequence: false,
                approachPoint: 0,
                limitValue: 1,
                leftLimit: 1,
                rightLimit: 1
            }
        };
        drawFunction(g, width, height);
    });
}


// ç¬¬15é¡µï¼šç­‰ä»·æ— ç©·å°åº”ç”¨
function visualizeEquivalentInfinitesimalApp(containerId) {
    const setup = setupD3(containerId);
    if (!setup) return;
    const { g, width, height } = setup;
    
    const panel = d3.select('#vis-equivalent-infinitesimal-app')
        .append('div')
        .attr('class', 'interactive-panel')
        .style('width', '50%');
    
    panel.append('h3').text('ç­‰ä»·æ— ç©·å°æ›¿æ¢åº”ç”¨');
    
    const examples = [
        {
            original: '$$\\lim\\limits_{x \\to 0} \\frac{\\sin 3x \\cdot \\tan 2x}{x^2}$$',
            replaced: '$$\\lim\\limits_{x \\to 0} \\frac{3x \\cdot 2x}{x^2} = 6$$',
            steps: [
                'sin(3x) ~ 3x',
                'tan(2x) ~ 2x',
                'ä»£å…¥å¾— 6'
            ]
        },
        {
            original: '$$\\lim\\limits_{x \\to 0} \\frac{e^x - 1}{\\sin x}$$',
            replaced: '$$\\lim\\limits_{x \\to 0} \\frac{x}{x} = 1$$',
            steps: [
                'e^x - 1 ~ x',
                'sin(x) ~ x',
                'ä»£å…¥å¾— 1'
            ]
        },
        {
            original: '$$\\lim\\limits_{x \\to 0} \\frac{1 - \\cos x}{x^2}$$',
            replaced: '$$\\lim\\limits_{x \\to 0} \\frac{\\frac{x^2}{2}}{x^2} = \\frac{1}{2}$$',
            steps: [
                '1 - cos(x) ~ xÂ²/2',
                'ä»£å…¥å¾— 1/2'
            ]
        },
        {
            original: '$$\\lim\\limits_{x \\to 0} \\frac{\\ln(1+x)}{\\sin x}$$',
            replaced: '$$\\lim\\limits_{x \\to 0} \\frac{x}{x} = 1$$',
            steps: [
                'ln(1+x) ~ x',
                'sin(x) ~ x',
                'ä»£å…¥å¾— 1'
            ]
        },
        {
            original: '$$\\lim\\limits_{x \\to 0} \\frac{\\tan x - x}{x^3}$$',
            replaced: '$$\\lim\\limits_{x \\to 0} \\frac{\\frac{x^3}{3}}{x^3} = \\frac{1}{3}$$',
            steps: [
                'tan(x) - x ~ xÂ³/3',
                'ä»£å…¥å¾— 1/3'
            ]
        }
    ];
    
    let currentExample = 0;
    let autoPlay = true;
    
    // æ·»åŠ æ§åˆ¶æŒ‰é’®
    const buttonContainer = panel.append('div')
        .attr('class', 'button-container');
    
    // åˆ‡æ¢æŒ‰é’®
    buttonContainer.append('button')
        .attr('class', 'nav-btn')
        .text('ä¸Šä¸€ä¸ª')
        .on('click', () => {
            currentExample = (currentExample - 1 + examples.length) % examples.length;
            showExample();
        });
    
    buttonContainer.append('button')
        .attr('class', 'nav-btn')
        .text('ä¸‹ä¸€ä¸ª')
        .on('click', () => {
            currentExample = (currentExample + 1) % examples.length;
            showExample();
        });
    
    // è‡ªåŠ¨æ’­æ”¾å¼€å…³
    buttonContainer.append('button')
        .attr('class', 'nav-btn')
        .text('æš‚åœ')
        .on('click', function() {
            autoPlay = !autoPlay;
            d3.select(this).text(autoPlay ? 'æš‚åœ' : 'æ’­æ”¾');
            if (autoPlay) {
                showExample();
            }
        });
    
    function showExample() {
        // æ¸…é™¤ä¹‹å‰çš„åŠ¨ç”»
        currentAnimations.forEach(clear => clear());
        currentAnimations = [];
        
        panel.selectAll('.example-content').remove();
        
        const example = examples[currentExample];
        const content = panel.append('div')
            .attr('class', 'example-content');
        
        // æ·»åŠ é¡µç æ˜¾ç¤º
        content.append('div')
            .style('text-align', 'center')
            .style('margin-bottom', '15px')
            .style('color', 'var(--accent-color)')
            .style('font-weight', 'bold')
            .text(`ä¾‹ ${currentExample + 1} / ${examples.length}`);
        
        content.append('div')
            .style('font-size', '1.5rem')
            .style('margin-bottom', '20px')
            .style('text-align', 'center')
            .html(`åŸå¼: ${example.original}`);
        
        // ç«‹å³æ¸²æŸ“æ•°å­¦å…¬å¼
        if (window.MathJax) {
            MathJax.typesetPromise();
        }
        
        setTimeout(() => {
            content.append('div')
                .attr('class', 'fade-in')
                .style('font-size', '1.3rem')
                .style('margin', '20px 0')
                .style('text-align', 'center')
                .html('åº”ç”¨ç­‰ä»·æ— ç©·å°æ›¿æ¢:');
            
            // æ­¥éª¤åªæ˜¾ç¤ºä¸€æ¬¡ï¼Œä¸å¾ªç¯
            example.steps.forEach((step, i) => {
                content.append('div')
                    .attr('class', 'fade-in')
                    .style('margin-left', '30px')
                    .style('margin-top', '10px')
                    .style('text-align', 'left')
                    .text(`â€¢ ${step}`);
            });
        }, 1000 / globalAnimationSpeed);
        
        setTimeout(() => {
            content.append('div')
                .attr('class', 'fade-in')
                .style('font-size', '1.5rem')
                .style('margin-top', '20px')
                .style('color', 'var(--success-color)')
                .style('text-align', 'center')
                .html(`ç»“æœ: ${example.replaced}`);
            
            // é‡æ–°æ¸²æŸ“æ•°å­¦å…¬å¼
            if (window.MathJax) {
                MathJax.typesetPromise();
            }
        }, 2500 / globalAnimationSpeed);
        
        // åªæœ‰åœ¨è‡ªåŠ¨æ’­æ”¾æ¨¡å¼ä¸‹æ‰ç»§ç»­ä¸‹ä¸€ä¸ª
        if (autoPlay) {
        currentExample = (currentExample + 1) % examples.length;
        const timeoutId = setTimeout(showExample, 5000 / globalAnimationSpeed);
        currentAnimations.push(() => clearTimeout(timeoutId));
        }
    }
    
    showExample();
}

// ç¬¬16é¡µï¼šè¿ç»­å‡½æ•°
function visualizeContinuousFunctions(containerId) {
    const container = getContainer(containerId, 'grid');
    if (!container) return;
    
    const functions = [
        { name: 'å¤šé¡¹å¼<br>$x^3-3x+1$', fn: x => x*x*x - 3*x + 1 },
        { name: 'æœ‰ç†å‡½æ•°<br>$\\frac{x^2+1}{x^2+2}$', fn: x => (x*x + 1)/(x*x + 2) },
        { name: 'ä¸‰è§’å‡½æ•°<br>$\\sin(2x)$', fn: x => Math.sin(2*x) },
        { name: 'æŒ‡æ•°å‡½æ•°<br>$e^{-x^2}$', fn: x => Math.exp(-x*x) },
        { name: 'å¯¹æ•°å‡½æ•°<br>$\\ln(x+4)$', fn: x => Math.log(x + 4) },
        { name: 'åŒæ›²å‡½æ•°<br>$\\tanh(x)$', fn: x => Math.tanh(x) },
        { name: 'å¤åˆä¸‰è§’<br>$\\sin(\\cos x)$', fn: x => Math.sin(Math.cos(x)) },
        { name: 'æ ¹å¼å‡½æ•°<br>$\\sqrt{4-x^2}$', fn: x => Math.abs(x) <= 2 ? Math.sqrt(4 - x*x) : undefined },
        { name: 'åä¸‰è§’<br>$\\arcsin(x/2)$', fn: x => Math.abs(x) <= 2 ? Math.asin(x/2) : undefined },
        { name: 'ç»å¯¹å€¼<br>$|\\sin x|$', fn: x => Math.abs(Math.sin(x)) },
        { name: 'åˆ†æ®µè¿ç»­<br>$\\begin{cases} e^x, x<0 \\\\ 1, x \\ge 0 \\end{cases}$', fn: x => x < 0 ? Math.exp(x) : 1 },
        { name: 'å…‰æ»‘æ›²çº¿<br>$\\frac{x}{1+x^2}$', fn: x => x/(1 + x*x) },
        { name: 'å‘¨æœŸå‡½æ•°<br>$\\sin x + \\frac{\\sin 2x}{2}$', fn: x => Math.sin(x) + Math.sin(2*x)/2 },
        { name: 'Sigmoid<br>$\\frac{1}{1+e^{-x}}$', fn: x => 1/(1 + Math.exp(-x)) },
        { name: 'é«˜æ–¯å‡½æ•°<br>$e^{-x^2/2}$', fn: x => Math.exp(-x*x/2) }
    ];

    functions.forEach((func, i) => {
        const drawFunction = (g, width, height) => {
    const xScale = d3.scaleLinear().domain([-3, 3]).range([0, width]);
    const yScale = d3.scaleLinear().domain([-2, 2]).range([height, 0]);
    
            drawAxes(g, xScale, yScale, width, height);

        const data = d3.range(-3, 3, 0.05)
            .map(x => ({x: x, y: func.fn(x)}))
                .filter(d => !isNaN(d.y) && isFinite(d.y));
        
        const line = d3.line()
            .x(d => xScale(d.x))
            .y(d => yScale(d.y))
            .curve(d3.curveCatmullRom);
        
        const path = g.append('path')
            .datum(data)
            .attr('fill', 'none')
                .attr('stroke', 'var(--primary-color)')
            .attr('stroke-width', 2)
                .attr('d', line);

            animatePath(path, 2000, false);

            // ä¸ºç¬¬16é¡µæ‰€æœ‰é¡¹æ·»åŠ åŒè¾¹è¶‹è¿‘åŠ¨ç”»
            setTimeout(() => {
                // é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„è¶‹è¿‘ç‚¹ï¼Œé€šå¸¸é€‰æ‹©0æˆ–å‡½æ•°å®šä¹‰åŸŸå†…çš„ä¸€ä¸ªç‚¹
                const approachPoint = 0;
                const limitValue = func.fn(approachPoint);
                animateLimitApproach(g, xScale, yScale, func.fn, approachPoint, limitValue, width, height);
            }, 100);
        };

        const { g, width, height, div } = setup(container, i, func.name, 'both', '0');
        div.__chartData = {
            drawFunction,
            annotationData: {
                type: 'continuity',
                isSequence: false,
                approachPoint: 0,
                limitValue: func.fn(0),
                leftLimit: func.fn(0),
                rightLimit: func.fn(0),
                functionValue: func.fn(0)
            }
        };
        drawFunction(g, width, height);
    });
}

// ç¬¬17é¡µï¼šé—´æ–­ç‚¹ç±»å‹
function visualizeDiscontinuities(containerId) {
    const container = getContainer(containerId, 'grid');
    if (!container) return;
    
    const discontinuities = [
        {
            name: 'å¯å»é—´æ–­ç‚¹<br>$\\frac{x^2-1}{x-1}$',
            fn: x => Math.abs(x-1) > 0.01 ? (x*x - 1)/(x - 1) : undefined,
            special: {x: 1, y: 2, type: 'removable'}
        },
        {
            name: 'è·³è·ƒé—´æ–­ç‚¹<br>$\\begin{cases} x+1, x<0 \\\\ x-1, x \\ge 0 \\end{cases}$',
            fn: x => x < 0 ? x + 1 : x - 1,
            special: null
        },
        {
            name: 'æ— ç©·é—´æ–­ç‚¹<br>$1/x^2$',
            fn: x => 1/(x*x),
            special: null
        },
        {
            name: 'æŒ¯è¡é—´æ–­ç‚¹<br>$\\sin\\left(\\frac{1}{x}\\right)$',
            fn: x => Math.abs(x) > 0.01 ? Math.sin(1/x) : undefined,
            special: null
        },
        {
            name: 'æ··åˆé—´æ–­<br>$\\begin{cases} 1/x, x<0 \\\\ \\sqrt{x}, x \\ge 0 \\end{cases}$',
            fn: x => x < 0 ? 1/x : Math.sqrt(x),
            special: null
        },
        {
            name: 'å‘¨æœŸé—´æ–­<br>$\\tan x$',
            fn: x => Math.tan(x),
            special: null
        },
        {
            name: 'é˜¶æ¢¯å‡½æ•°<br>$\\lfloor x \\rfloor$',
            fn: x => Math.floor(x),
            special: null
        },
        {
            name: 'ç¬¦å·å‡½æ•°<br>$\\text{sgn}(x)$',
            fn: x => Math.sign(x),
            special: null
        }
    ];
    
    discontinuities.forEach((disc, i) => {
        const drawFunction = (g, width, height) => {
            const xScale = d3.scaleLinear().domain([-2, 2]).range([0, width]);
            const yScale = d3.scaleLinear().domain([-3, 3]).range([height, 0]);

            drawAxes(g, xScale, yScale, width, height);

        const data = d3.range(-2, 2, 0.01)
            .map(x => ({x: x, y: disc.fn(x)}))
            .filter(d => !isNaN(d.y) && isFinite(d.y) && Math.abs(d.y) < 10);
        
        const line = d3.line()
            .x(d => xScale(d.x))
            .y(d => yScale(d.y));
        
            const path = g.append('path')
            .datum(data)
            .attr('fill', 'none')
            .attr('stroke', 'var(--danger-color)')
                .attr('stroke-width', 2)
                .attr('d', line);
            animatePath(path, 2000, false);

            // ä¸ºç¬¬17é¡µæ‰€æœ‰é¡¹æ·»åŠ åŒè¾¹è¶‹è¿‘åŠ¨ç”»
            setTimeout(() => {
                let approachPoint = 0; // é»˜è®¤è¶‹è¿‘ç‚¹
                let limitValue = 0;
                
                // æ ¹æ®ä¸åŒçš„é—´æ–­ç‚¹ç±»å‹è®¾ç½®è¶‹è¿‘ç‚¹
                if (disc.name.includes('å¯å»é—´æ–­')) {
                    approachPoint = 1;
                    limitValue = 2;
                } else if (disc.name.includes('é˜¶æ¢¯å‡½æ•°') || disc.name.includes('ç¬¦å·å‡½æ•°')) {
                    approachPoint = 0;
                    limitValue = 0;
                } else {
                    approachPoint = 0;
                    limitValue = 0;
                }
                
                animateLimitApproach(g, xScale, yScale, disc.fn, approachPoint, limitValue, width, height);
            }, 100);

        if (disc.special && disc.special.type === 'removable') {
                g.append('circle')
                .attr('cx', xScale(disc.special.x))
                .attr('cy', yScale(disc.special.y))
                .attr('r', 4)
                .attr('fill', 'white')
                .attr('stroke', 'var(--danger-color)')
                .attr('stroke-width', 2);
        }
        };

        let discApproachVal = '0';
        if (disc.name.includes('å¯å»é—´æ–­')) {
            discApproachVal = '1';
        }
        const { g, width, height, div } = setup(container, i, disc.name, 'both', discApproachVal);

        // æ ¹æ®é—´æ–­ç‚¹ç±»å‹è®¾ç½®æ³¨é‡Šæ•°æ®
        let discontinuityType = 'unknown';
        let leftLimit = 'ä¸å­˜åœ¨', rightLimit = 'ä¸å­˜åœ¨';
        let approachPoint = disc.name.includes('å¯å»é—´æ–­') ? 1 : 0;

        if (disc.name.includes('å¯å»é—´æ–­')) {
            discontinuityType = 'å¯å»é—´æ–­ç‚¹';
            leftLimit = '2';
            rightLimit = '2';
        } else if (disc.name.includes('è·³è·ƒé—´æ–­')) {
            discontinuityType = 'è·³è·ƒé—´æ–­ç‚¹';
            leftLimit = '1';
            rightLimit = '-1';
        } else if (disc.name.includes('æ— ç©·é—´æ–­')) {
            discontinuityType = 'æ— ç©·é—´æ–­ç‚¹';
            leftLimit = '+âˆ';
            rightLimit = '+âˆ';
        } else if (disc.name.includes('æŒ¯è¡é—´æ–­')) {
            discontinuityType = 'æŒ¯è¡é—´æ–­ç‚¹';
            leftLimit = 'æŒ¯è¡';
            rightLimit = 'æŒ¯è¡';
        }

        div.__chartData = {
            drawFunction,
            annotationData: {
                type: 'limit',
                isSequence: false,
                approachPoint: approachPoint,
                limitValue: null,
                leftLimit: leftLimit,
                rightLimit: rightLimit,
                discontinuityType: discontinuityType
            }
        };
        drawFunction(g, width, height);
    });
}

// ç¬¬18é¡µï¼šåˆç­‰å‡½æ•°è¿ç»­æ€§
function visualizeElementaryFunctions(containerId) {
    const container = getContainer(containerId, 'grid');
    if (!container) return;

    const elementaryFunctions = [
        { name: 'å¸¸æ•°å‡½æ•°<br>$y = c$', fn: x => 1.5 },
        { name: 'å¹‚å‡½æ•°<br>$y = x^2$', fn: x => x*x },
        { name: 'å¹‚å‡½æ•°<br>$y = x^3$', fn: x => x*x*x },
        { name: 'æ ¹å¼å‡½æ•°<br>$y = \\sqrt[3]{x}$', fn: x => Math.cbrt(x) },
        { name: 'å€’æ•°å‡½æ•°<br>$y = \\frac{1}{x}$', fn: x => 1/x },
        { name: 'æŒ‡æ•°å‡½æ•°<br>$y = e^x$', fn: x => Math.exp(x) },
        { name: 'å¯¹æ•°å‡½æ•°<br>$y = \\ln x$', fn: x => Math.log(x) },
        { name: 'æ­£å¼¦å‡½æ•°<br>$y = \\sin x$', fn: x => Math.sin(x) },
        { name: 'ä½™å¼¦å‡½æ•°<br>$y = \\cos x$', fn: x => Math.cos(x) },
        { name: 'æ­£åˆ‡å‡½æ•°<br>$y = \\tan x$', fn: x => Math.tan(x) },
        { name: 'åæ­£å¼¦<br>$y = \\arcsin x$', fn: x => Math.asin(x) },
        { name: 'åä½™å¼¦<br>$y = \\arccos x$', fn: x => Math.acos(x) },
        { name: 'åæ­£åˆ‡<br>$y = \\arctan x$', fn: x => Math.atan(x) },
        { name: 'åŒæ›²æ­£å¼¦<br>$y = \\sinh x$', fn: x => Math.sinh(x) },
        { name: 'åŒæ›²ä½™å¼¦<br>$y = \\cosh x$', fn: x => Math.cosh(x) }
    ];

    elementaryFunctions.forEach((func, i) => {
        const drawFunction = (g, width, height) => {
            const xScale = d3.scaleLinear().domain([-3, 3]).range([0, width]);
            const yScale = d3.scaleLinear().domain([-3, 3]).range([height, 0]);

            drawAxes(g, xScale, yScale, width, height);

            const data = d3.range(-3, 3, 0.05)
            .map(x => ({x: x, y: func.fn(x)}))
            .filter(d => !isNaN(d.y) && isFinite(d.y) && Math.abs(d.y) < 10);
        
        const line = d3.line()
            .x(d => xScale(d.x))
            .y(d => yScale(d.y));
        
            const path = g.append('path')
            .datum(data)
            .attr('fill', 'none')
            .attr('stroke', 'var(--info-color)')
                .attr('stroke-width', 2)
                .attr('d', line);
            animatePath(path, 2000, false);

            // ä¸ºç¬¬18é¡µæ‰€æœ‰é¡¹æ·»åŠ åŒè¾¹è¶‹è¿‘åŠ¨ç”»
            setTimeout(() => {
                let approachPoint = 0; // é»˜è®¤è¶‹è¿‘ç‚¹
                let limitValue = func.fn(0);
                
                // æ ¹æ®ä¸åŒçš„å‡½æ•°ç±»å‹é€‰æ‹©åˆé€‚çš„è¶‹è¿‘ç‚¹
                if (func.name.includes('å¯¹æ•°å‡½æ•°')) {
                    approachPoint = 1; // å¯¹æ•°å‡½æ•°åœ¨x=1å¤„
                    limitValue = func.fn(1);
                } else if (func.name.includes('å€’æ•°å‡½æ•°')) {
                    approachPoint = 1; // é¿å¼€x=0çš„å¥‡ç‚¹
                    limitValue = func.fn(1);
                } else if (func.name.includes('åæ­£å¼¦') || func.name.includes('åä½™å¼¦')) {
                    approachPoint = 0.5; // åœ¨å®šä¹‰åŸŸå†…
                    limitValue = func.fn(0.5);
                } else {
                    approachPoint = 0;
                    limitValue = func.fn(0);
                }
                
                animateLimitApproach(g, xScale, yScale, func.fn, approachPoint, limitValue, width, height);
            }, 100);
        };

        let funcApproachVal = '0';
        if (func.name.includes('å¯¹æ•°å‡½æ•°') || func.name.includes('å€’æ•°å‡½æ•°')) {
            funcApproachVal = '1';
        } else if (func.name.includes('åæ­£å¼¦') || func.name.includes('åä½™å¼¦')) {
            funcApproachVal = '0.5';
        }
        const { g, width, height, div } = setup(container, i, func.name, 'both', funcApproachVal);

        // æ ¹æ®å‡½æ•°ç±»å‹è®¾ç½®æ³¨é‡Šæ•°æ®
        let approachPoint = 0;
        let limitValue = func.fn(0);
        if (func.name.includes('å¯¹æ•°å‡½æ•°')) {
            approachPoint = 1;
            limitValue = func.fn(1);
        } else if (func.name.includes('å€’æ•°å‡½æ•°')) {
            approachPoint = 1;
            limitValue = func.fn(1);
        } else if (func.name.includes('åæ­£å¼¦') || func.name.includes('åä½™å¼¦')) {
            approachPoint = 0.5;
            limitValue = func.fn(0.5);
        }

        div.__chartData = {
            drawFunction,
            annotationData: {
                type: 'continuity',
                isSequence: false,
                approachPoint: approachPoint,
                limitValue: limitValue,
                leftLimit: limitValue,
                rightLimit: limitValue,
                functionValue: limitValue
            }
        };
        drawFunction(g, width, height);
    });
}

// ç¬¬19é¡µï¼šè¿ç»­æ€§åˆ¤å®š
function visualizeContinuityDetermination(containerId) {
    const container = getContainer(containerId, 'grid');
    if (!container) return;

    const continuityExamples = [
        { name: 'è¿ç»­<br>$\\sin x$', fn: x => Math.sin(x), a: 0, continuous: true },
        { name: 'å¯å»é—´æ–­<br>$\\frac{x^2-1}{x-1}$', fn: x => Math.abs(x-1) > 0.01 ? (x*x-1)/(x-1) : undefined, a: 1, continuous: false, type: 'removable' },
        { name: 'è·³è·ƒé—´æ–­<br>$\\begin{cases} x, x<0 \\\\ x+1, x \\ge 0 \\end{cases}$', fn: x => x < 0 ? x : x + 1, a: 0, continuous: false, type: 'jump' },
        { name: 'æ— ç©·é—´æ–­<br>$1/x^2$', fn: x => 1/(x*x), a: 0, continuous: false, type: 'infinite' },
        { name: 'æŒ¯è¡é—´æ–­<br>$\\sin(1/x)$', fn: x => Math.abs(x) > 0.01 ? Math.sin(1/x) : undefined, a: 0, continuous: false, type: 'oscillating' },
        { name: 'åˆ†æ®µè¿ç»­<br>$\\begin{cases} x^2, x<1 \\\\ 2x-1, x \\ge 1 \\end{cases}$', fn: x => x < 1 ? x*x : 2*x - 1, a: 1, continuous: true },
        { name: 'ç»å¯¹å€¼è¿ç»­<br>$|x-1|$', fn: x => Math.abs(x - 1), a: 1, continuous: true },
        { name: 'æŒ‡æ•°è¿ç»­<br>$e^{-x^2}$', fn: x => Math.exp(-x*x), a: 0, continuous: true },
        { name: 'å¯¹æ•°é—´æ–­<br>$\\ln x$', fn: x => x > 0 ? Math.log(x) : undefined, a: 0, continuous: false, type: 'infinite' },
        { name: 'å¤åˆè¿ç»­<br>$\\sin(\\sqrt{|x|})$', fn: x => Math.sin(Math.sqrt(Math.abs(x))), a: 0, continuous: true }
    ];

    continuityExamples.forEach((example, i) => {
        const drawFunction = (g, width, height) => {
            const xScale = d3.scaleLinear().domain([example.a - 2, example.a + 2]).range([0, width]);
            const yScale = d3.scaleLinear().domain([-3, 3]).range([height, 0]);

            drawAxes(g, xScale, yScale, width, height);

            const data = d3.range(example.a - 2, example.a + 2, 0.02)
            .map(x => ({x: x, y: example.fn(x)}))
                .filter(d => !isNaN(d.y) && isFinite(d.y) && Math.abs(d.y) < 10);
        
        const line = d3.line()
            .x(d => xScale(d.x))
            .y(d => yScale(d.y));
        
            const color = example.continuous ? 'var(--success-color)' : 'var(--danger-color)';

            const path = g.append('path')
            .datum(data)
            .attr('fill', 'none')
                .attr('stroke', color)
                .attr('stroke-width', 2)
                .attr('d', line);
            animatePath(path, 1500, false);

            // ä¸ºç¬¬19é¡µæ‰€æœ‰é¡¹æ·»åŠ åŒè¾¹è¶‹è¿‘åŠ¨ç”»
            setTimeout(() => {
                const limitValue = example.continuous ? example.fn(example.a) : (example.type === 'removable' ? 2 : 0);
                animateLimitApproach(g, xScale, yScale, example.fn, example.a, limitValue, width, height);
            }, 100);

        g.append('line')
            .attr('x1', xScale(example.a))
            .attr('y1', 0)
            .attr('x2', xScale(example.a))
                .attr('y2', height)
            .attr('stroke', 'gray')
                .attr('stroke-dasharray', '2,2')
                .attr('opacity', 0.5);

            if (!example.continuous && example.type === 'removable') {
                g.append('circle')
                    .attr('cx', xScale(example.a))
                    .attr('cy', yScale(2))
                    .attr('r', 4)
                    .attr('fill', 'black')
                    .attr('stroke', 'var(--danger-color)')
                    .attr('stroke-width', 2);
            } else if (example.continuous) {
                const pointY = example.fn(example.a);
                if (isFinite(pointY)) {
                    g.append('circle')
                        .attr('cx', xScale(example.a))
                        .attr('cy', yScale(pointY))
                        .attr('r', 3)
                        .attr('fill', 'var(--success-color)');
                }
            }
        };

        const { g, width, height, div } = setup(container, i, example.name, 'both', example.a);

        // æ ¹æ®è¿ç»­æ€§è®¾ç½®æ³¨é‡Šæ•°æ®
        let limitValue = null;
        let leftLimit = null;
        let rightLimit = null;
        let functionValue = null;

        if (example.continuous) {
            limitValue = example.fn(example.a);
            leftLimit = limitValue;
            rightLimit = limitValue;
            functionValue = limitValue;
        } else {
            if (example.type === 'removable') {
                leftLimit = 2;
                rightLimit = 2;
                limitValue = 2;
                functionValue = null; // å‡½æ•°å€¼ä¸å­˜åœ¨
            } else if (example.type === 'jump') {
                leftLimit = example.a;
                rightLimit = example.a + 1;
                limitValue = null; // æé™ä¸å­˜åœ¨
                functionValue = example.a + 1;
            } else if (example.type === 'infinite') {
                leftLimit = '+âˆ';
                rightLimit = '+âˆ';
                limitValue = null;
                functionValue = null;
            } else if (example.type === 'oscillating') {
                leftLimit = 'æŒ¯è¡';
                rightLimit = 'æŒ¯è¡';
                limitValue = null;
                functionValue = null;
            }
        }

        div.__chartData = {
            drawFunction,
            annotationData: {
                type: 'continuity',
                isSequence: false,
                approachPoint: example.a,
                limitValue: limitValue,
                leftLimit: leftLimit,
                rightLimit: rightLimit,
                functionValue: functionValue,
                discontinuityType: example.type || null
            }
        };
        drawFunction(g, width, height);
    });
}

// ç¬¬20é¡µï¼šå®é™…åº”ç”¨
function visualizeApplications(containerId) {
    const setup = setupD3(containerId);
    if (!setup) return;
    const { g, width, height } = setup;
    
    // ç¬æ—¶é€Ÿåº¦æ¼”ç¤º
    const panel = d3.select('#vis-applications')
        .append('div')
        .attr('class', 'interactive-panel');
    
    panel.append('h3').text('æé™åœ¨å®é™…ä¸­çš„åº”ç”¨');
    
    const applications = [
        { name: 'ç¬æ—¶é€Ÿåº¦', icon: 'ğŸš—' },
        { name: 'è¾¹é™…æˆæœ¬', icon: 'ğŸ’°' },
        { name: 'å›¾åƒå‹ç¼©', icon: 'ğŸ–¼ï¸' }
    ];
    
    const buttonContainer = panel.append('div')
        .attr('class', 'button-container');
    applications.forEach((app, i) => {
        buttonContainer.append('button')
            .attr('class', 'nav-btn')
            .text(`${app.icon} ${app.name}`)
            .on('click', () => showApplication(i));
    });
    
    function showApplication(index) {
        g.selectAll('*').remove();
        
        if (index === 0) {
            // ç¬æ—¶é€Ÿåº¦
            const xScale = d3.scaleLinear().domain([0, 5]).range([0, width]);
            const yScale = d3.scaleLinear().domain([0, 130]).range([height - 50, 0]);
            
            g.append('g')
                .attr('transform', `translate(0, ${height - 50})`)
                .call(d3.axisBottom(xScale).tickFormat(d => d + 's'));
            
            g.append('g')
                .call(d3.axisLeft(yScale).tickFormat(d => d + 'm'));
            
            // ä½ç½®å‡½æ•° s(t) = 5tÂ²
            const positionData = d3.range(0, 5, 0.05)
                .map(t => ({t: t, s: 5 * t * t}));
            
            const line = d3.line()
                .x(d => xScale(d.t))
                .y(d => yScale(d.s));
            
            g.append('path')
                .datum(positionData)
                .attr('d', line)
                .attr('fill', 'none')
                .attr('stroke', 'cyan')
                .attr('stroke-width', 3);
            
            // ç§»åŠ¨çš„ç‚¹
            let t = 0;
            const point = g.append('circle')
                .attr('r', 6)
                .attr('fill', 'red');
            
            const velocityText = g.append('text')
                .attr('x', width - 150)
                .attr('y', 30)
                .attr('fill', 'black')
                .style('font-size', '16px');
            
            function animate() {
                t = (t + 0.02) % 5;
                const s = 5 * t * t;
                const v = 10 * t; // å¯¼æ•°
                
                point
                    .attr('cx', xScale(t))
                    .attr('cy', yScale(s));
                
                velocityText.text(`é€Ÿåº¦: ${v.toFixed(1)} m/s`);
                
                requestAnimationFrame(animate);
            }
            
            animate();
            currentAnimations.push(() => {});
            
        } else if (index === 1) {
            // è¾¹é™…æˆæœ¬
            const xScale = d3.scaleLinear().domain([0, 100]).range([0, width]);
            const yScale = d3.scaleLinear().domain([0, 300]).range([height - 50, 0]);
            
            g.append('g')
                .attr('transform', `translate(0, ${height - 50})`)
                .call(d3.axisBottom(xScale).tickFormat(d => d + 'ä¸ª'));
            
            g.append('g')
                .call(d3.axisLeft(yScale).tickFormat(d => '$' + d));
            
            // æˆæœ¬å‡½æ•° C(x) = 100 + 2x + 0.01xÂ²
            const costData = d3.range(0, 100, 1)
                .map(x => ({x: x, c: 100 + 2*x + 0.01*x*x}));
            
            const line = d3.line()
                .x(d => xScale(d.x))
                .y(d => yScale(d.c));
            
            g.append('path')
                .datum(costData)
                .attr('d', line)
                .attr('fill', 'none')
                .attr('stroke', 'lime')
                .attr('stroke-width', 3);
            
            g.append('text')
                .attr('x', width / 2)
                .attr('y', 30)
                .attr('text-anchor', 'middle')
                .attr('fill', 'black')
                .text('æˆæœ¬å‡½æ•°: C(x) = 100 + 2x + 0.01xÂ²');
            
        } else if (index === 2) {
            // å›¾åƒå‹ç¼©
            const steps = 10;
            const imageSize = 100;
            
            for (let i = 0; i <= steps; i++) {
                const quality = i / steps;
                const x = (width / (steps + 1)) * (i + 0.5);
                const y = height / 2;
                
                const rect = g.append('rect')
                    .attr('x', x - imageSize/2)
                    .attr('y', y - imageSize/2)
                    .attr('width', imageSize)
                    .attr('height', imageSize)
                    .attr('fill', d3.interpolateViridis(quality))
                    .attr('opacity', 0.3 + quality * 0.7);
                
                g.append('text')
                    .attr('x', x)
                    .attr('y', y + imageSize/2 + 20)
                    .attr('text-anchor', 'middle')
                    .attr('fill', 'black')
                    .style('font-size', '12px')
                    .text(`${(quality * 100).toFixed(0)}%`);
            }
            
            g.append('text')
                .attr('x', width / 2)
                .attr('y', 30)
                .attr('text-anchor', 'middle')
                .attr('fill', 'black')
                .text('æ¸è¿›å¼å›¾åƒå‹ç¼©ï¼šè´¨é‡é€æ­¥é€¼è¿‘åŸå›¾');
        }
    }
    
    showApplication(0);
}

// ç¬¬21é¡µï¼šæ€»ç»“
function visualizeSummary(containerId) {
    const setup = setupD3(containerId);
    if (!setup) return;
    const { g, width, height } = setup;
    
    // åˆ›å»ºæ€ç»´å¯¼å›¾
    const centerX = width / 2;
    const centerY = height / 2;
    
    // ä¸­å¿ƒèŠ‚ç‚¹
    const center = g.append('g')
        .attr('transform', `translate(${centerX}, ${centerY})`);
    
    center.append('circle')
        .attr('r', 0)
        .attr('fill', 'var(--primary-color)')
        .transition()
        .duration(500)
        .attr('r', 60);
    
    center.append('text')
        .attr('text-anchor', 'middle')
        .attr('dy', '0.3em')
        .attr('fill', 'black')
        .style('font-size', '24px')
        .style('font-weight', 'bold')
        .style('opacity', 0)
        .text('æé™')
        .transition()
        .delay(500)
        .duration(500)
        .style('opacity', 1);
    
    // åˆ†æ”¯
    const branches = [
        { angle: 0, text: 'æ•°åˆ—æé™', color: '#3498db', detail: 'nâ†’âˆ' },
        { angle: Math.PI/3, text: 'å‡½æ•°æé™', color: '#2ecc71', detail: 'xâ†’a' },
        { angle: 2*Math.PI/3, text: 'å·¦å³æé™', color: '#e74c3c', detail: 'å•ä¾§' },
        { angle: Math.PI, text: 'è¿ç®—æ³•åˆ™', color: '#f39c12', detail: 'å››åˆ™' },
        { angle: 4*Math.PI/3, text: 'é‡è¦æé™', color: '#9b59b6', detail: 'ä¸¤ä¸ª' },
        { angle: 5*Math.PI/3, text: 'è¿ç»­æ€§', color: '#1abc9c', detail: 'ä¸‰æ¡ä»¶' }
    ];
    
    branches.forEach((branch, i) => {
        const x = Math.cos(branch.angle) * 200;
        const y = Math.sin(branch.angle) * 200;
        
        // è¿çº¿
        const line = g.append('line')
            .attr('x1', centerX)
            .attr('y1', centerY)
            .attr('x2', centerX)
            .attr('y2', centerY)
            .attr('stroke', branch.color)
            .attr('stroke-width', 3)
            .style('opacity', 0);
        
        line.transition()
            .delay(1000 + i * 200)
            .duration(500)
            .attr('x2', centerX + x)
            .attr('y2', centerY + y)
            .style('opacity', 1);
        
        // èŠ‚ç‚¹
        const node = g.append('g')
            .attr('transform', `translate(${centerX + x}, ${centerY + y})`)
            .style('opacity', 0);
        
        node.append('circle')
            .attr('r', 40)
            .attr('fill', branch.color);
        
        node.append('text')
            .attr('text-anchor', 'middle')
            .attr('dy', '-0.2em')
            .attr('fill', 'black')
            .style('font-size', '14px')
            .style('font-weight', 'bold')
            .text(branch.text);
        
        node.append('text')
            .attr('text-anchor', 'middle')
            .attr('dy', '1.2em')
            .attr('fill', 'black')
            .style('font-size', '11px')
            .text(branch.detail);
        
        node.transition()
            .delay(1500 + i * 200)
            .duration(500)
            .style('opacity', 1);
    });
    
    // æ·»åŠ æ€»ç»“æ–‡å­—
    const summaryText = g.append('text')
        .attr('x', centerX)
        .attr('y', height - 30)
        .attr('text-anchor', 'middle')
        .attr('fill', 'black')
        .style('font-size', '16px')
        .style('opacity', 0)
        .text('æé™æ˜¯å¾®åˆ†çš„åŸºç¡€ï¼Œè¿ç»­æ˜¯ç§¯åˆ†çš„å‰æï¼');
    
    summaryText.transition()
        .delay(3000)
        .duration(1000)
        .style('opacity', 1);
}


    // æµ®åŠ¨èœå•åŠŸèƒ½
    document.addEventListener('DOMContentLoaded', function() {
        const menuToggle = document.getElementById('menu-toggle');
        const menuContent = document.getElementById('menu-content');
        
        if (menuToggle && menuContent) {
            menuToggle.addEventListener('click', function(e) {
                e.stopPropagation();
                menuToggle.classList.toggle('active');
                menuContent.classList.toggle('active');
            });
            
            // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­èœå•
            document.addEventListener('click', function(e) {
                if (!menuToggle.contains(e.target) && !menuContent.contains(e.target)) {
                    menuToggle.classList.remove('active');
                    menuContent.classList.remove('active');
                }
            });
            
            // é˜²æ­¢èœå•å†…å®¹ç‚¹å‡»æ—¶å…³é—­èœå•
            menuContent.addEventListener('click', function(e) {
                e.stopPropagation();
            });
        }

        // ç« èŠ‚ç›®å½•èœå•åŠŸèƒ½
        const chapterToggle = document.getElementById('chapter-toggle');
        const chapterContent = document.getElementById('chapter-content');
        
        if (chapterToggle && chapterContent) {
            chapterToggle.addEventListener('click', function(e) {
                e.stopPropagation();
                chapterToggle.classList.toggle('active');
                chapterContent.classList.toggle('active');
            });
            
            // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­èœå•
            document.addEventListener('click', function(e) {
                if (!chapterToggle.contains(e.target) && !chapterContent.contains(e.target)) {
                    chapterToggle.classList.remove('active');
                    chapterContent.classList.remove('active');
                }
            });
            
            // é˜²æ­¢èœå•å†…å®¹ç‚¹å‡»æ—¶å…³é—­èœå•
            chapterContent.addEventListener('click', function(e) {
                e.stopPropagation();
            });
        }
    });

    // ç« èŠ‚ç›®å½•èœå•åˆ‡æ¢å‡½æ•°
    function toggleChapterMenu() {
        const chapterToggle = document.getElementById('chapter-toggle');
        const chapterContent = document.getElementById('chapter-content');
        
        if (chapterToggle && chapterContent) {
            chapterToggle.classList.toggle('active');
            chapterContent.classList.toggle('active');
        }
    }
</script>
<!-- æµ®åŠ¨èœå•æŒ‰é’® -->
<div id="floating-menu">
<div class="menu-toggle" id="menu-toggle">
<span class="menu-icon">â˜°</span>
</div>
<div class="menu-content" id="menu-content">
<a class="menu-item" href="../ç½‘é¡µèµ„æº/lab 2-1.html" target="_blank">
<span class="menu-icon">LAB</span>
<span class="menu-text">å›¾åƒå‹ç¼©ä¸æ•°åˆ—æé™å®éªŒå®¤</span>
</a>
<a class="menu-item" href="../ç½‘é¡µèµ„æº/lab 2-2.html" target="_blank">
<span class="menu-icon">LAB</span>
<span class="menu-text">æ•°åˆ—æé™æ¡ˆä¾‹æ¢ç´¢å®éªŒå®¤</span>
</a>
<a class="menu-item" href="../ç½‘é¡µèµ„æº/lab 2-3.html" target="_blank">
<span class="menu-icon">LAB</span>
<span class="menu-text">å‡½æ•°æé™ä¸è‡ªå˜é‡å˜åŒ–å®éªŒå®¤</span>
</a>
<a class="menu-item" href="../ç½‘é¡µèµ„æº/lab 2-4.html" target="_blank">
<span class="menu-icon">LAB</span>
<span class="menu-text">å·¦å³æé™ä¸å­˜åœ¨æ€§åˆ¤å®šå®éªŒå®¤</span>
</a>
<a class="menu-item" href="../ç½‘é¡µèµ„æº/lab 2-5.html" target="_blank">
<span class="menu-icon">LAB</span>
<span class="menu-text">æ— ç©·å¤§ä¸æ— ç©·å°å€’æ•°å…³ç³»å®éªŒå®¤</span>
</a>
<a class="menu-item" href="../ç½‘é¡µèµ„æº/lab 2-6.html" target="_blank">
<span class="menu-icon">LAB</span>
<span class="menu-text">é‡è¦æé™å®éªŒå®¤</span>
</a>
<a class="menu-item" href="../ç½‘é¡µèµ„æº/lab 2-7.html" target="_blank">
<span class="menu-icon">LAB</span>
<span class="menu-text">æ— ç©·å°æ¯”è¾ƒå®éªŒå®¤</span>
</a>
<a class="menu-item" href="../ç½‘é¡µèµ„æº/lab 2-8.html" target="_blank">
<span class="menu-icon">LAB</span>
<span class="menu-text">å‡½æ•°å¢é‡å®éªŒå®¤</span>
</a>
<a class="menu-item" href="../ç½‘é¡µèµ„æº/lab 2-9.html" target="_blank">
<span class="menu-icon">LAB</span>
<span class="menu-text">ç­‰ä»·æ— ç©·å°å€’æ°´æ¸¸æˆ</span>
</a>
<a class="menu-item" href="../ç½‘é¡µèµ„æº/lab 2-10.html" target="_blank">
<span class="menu-icon">LAB</span>
<span class="menu-text">è¿ç»­ä¸é—´æ–­æ¸¸æˆ</span>
</a>
<a class="menu-item" href="../ç½‘é¡µèµ„æº/lab 2-11.html" target="_blank">
<span class="menu-icon">LAB</span>
<span class="menu-text">å‡½æ•°è¿ç»­æ€§å®éªŒå®¤</span>
</a>
<a class="menu-item" href="../ç½‘é¡µèµ„æº/lab 2-12.html" target="_blank">
<span class="menu-icon">LAB</span>
<span class="menu-text">å‡½æ•°é—´æ–­ç‚¹å®éªŒå®¤</span>
</a>
<a class="menu-item" href="../ç½‘é¡µèµ„æº/lab 2-13.html" target="_blank">
<span class="menu-icon">LAB</span>
<span class="menu-text">æé™ä¸è¿ç»­æ¸¸æˆ</span>
</a>
<a class="menu-item" href="../ä¹ é¢˜/assets/limit.html" target="_blank">
<span class="menu-icon">EXER</span>
<span class="menu-text">ä¹ é¢˜ç»ƒä¹ </span>
</a>
</div>
</div>
<!-- ç« èŠ‚ç›®å½•èœå• -->
<div id="chapter-menu">
<div class="menu-toggle" id="chapter-toggle">
<span class="menu-icon">ğŸ“š</span>
</div>
<div class="menu-content" id="chapter-content">
<a class="menu-item" href="#" onclick="scrollToStep('intro'); toggleChapterMenu();">
<span class="menu-icon">ğŸ </span>
<span class="menu-text">æ ‡é¢˜é¡µ</span>
</a>
<a class="menu-item" href="#" onclick="scrollToStep('toc'); toggleChapterMenu();">
<span class="menu-icon">ğŸ“‹</span>
<span class="menu-text">ç›®å½•</span>
</a>
<a class="menu-item" href="#" onclick="scrollToStep('why-limit'); toggleChapterMenu();">
<span class="menu-icon">1</span>
<span class="menu-text">ä¸ºä»€ä¹ˆè¦å­¦æé™ï¼Ÿ</span>
</a>
<a class="menu-item" href="#" onclick="scrollToStep('intuitive-limit'); toggleChapterMenu();">
<span class="menu-icon">2</span>
<span class="menu-text">ä»€ä¹ˆæ˜¯æé™ï¼Ÿ</span>
</a>
<a class="menu-item" href="#" onclick="scrollToStep('convergent-sequences'); toggleChapterMenu();">
<span class="menu-icon">3</span>
<span class="menu-text">æ•°åˆ—æé™ï¼ˆæ”¶æ•›ï¼‰</span>
</a>
<a class="menu-item" href="#" onclick="scrollToStep('divergent-sequences'); toggleChapterMenu();">
<span class="menu-icon">4</span>
<span class="menu-text">æ•°åˆ—æé™ï¼ˆå‘æ•£ï¼‰</span>
</a>
<a class="menu-item" href="#" onclick="scrollToStep('sequence-calculation'); toggleChapterMenu();">
<span class="menu-icon">5</span>
<span class="menu-text">æ•°åˆ—æé™çš„è®¡ç®—æ–¹æ³•</span>
</a>
<a class="menu-item" href="#" onclick="scrollToStep('function-limits'); toggleChapterMenu();">
<span class="menu-icon">6</span>
<span class="menu-text">å‡½æ•°çš„æé™</span>
</a>
<a class="menu-item" href="#" onclick="scrollToStep('one-sided-limits'); toggleChapterMenu();">
<span class="menu-icon">7</span>
<span class="menu-text">å·¦æé™ä¸å³æé™</span>
</a>
<a class="menu-item" href="#" onclick="scrollToStep('one-sided-detailed'); toggleChapterMenu();">
<span class="menu-icon">8</span>
<span class="menu-text">å·¦å³æé™è¯¦ç»†æ¼”ç¤º</span>
</a>
<a class="menu-item" href="#" onclick="scrollToStep('limit-operations'); toggleChapterMenu();">
<span class="menu-icon">9</span>
<span class="menu-text">æé™çš„å››åˆ™è¿ç®—æ³•åˆ™</span>
</a>
<a class="menu-item" href="#" onclick="scrollToStep('limit-methods-detailed'); toggleChapterMenu();">
<span class="menu-icon">10</span>
<span class="menu-text">æé™è¿ç®—æ–¹æ³•</span>
</a>
<a class="menu-item" href="#" onclick="scrollToStep('limit-methods'); toggleChapterMenu();">
<span class="menu-icon">11</span>
<span class="menu-text">æé™è®¡ç®—æŠ€å·§</span>
</a>
<a class="menu-item" href="#" onclick="scrollToStep('important-limit-1'); toggleChapterMenu();">
<span class="menu-icon">12</span>
<span class="menu-text">ç¬¬ä¸€é‡è¦æé™</span>
</a>
<a class="menu-item" href="#" onclick="scrollToStep('important-limit-2'); toggleChapterMenu();">
<span class="menu-icon">13</span>
<span class="menu-text">ç¬¬äºŒé‡è¦æé™</span>
</a>
<a class="menu-item" href="#" onclick="scrollToStep('important-limits-detailed'); toggleChapterMenu();">
<span class="menu-icon">14</span>
<span class="menu-text">ä¸¤ä¸ªé‡è¦æé™</span>
</a>
<a class="menu-item" href="#" onclick="scrollToStep('infinitesimal-infinity'); toggleChapterMenu();">
<span class="menu-icon">15</span>
<span class="menu-text">æ— ç©·å°ä¸æ— ç©·å¤§</span>
</a>
<a class="menu-item" href="#" onclick="scrollToStep('infinitesimal-comparison'); toggleChapterMenu();">
<span class="menu-icon">16</span>
<span class="menu-text">æ— ç©·å°çš„æ¯”è¾ƒ</span>
</a>
<a class="menu-item" href="#" onclick="scrollToStep('equivalent-infinitesimal'); toggleChapterMenu();">
<span class="menu-icon">17</span>
<span class="menu-text">å¸¸ç”¨ç­‰ä»·æ— ç©·å°</span>
</a>
<a class="menu-item" href="#" onclick="scrollToStep('equivalent-infinitesimal-app'); toggleChapterMenu();">
<span class="menu-icon">18</span>
<span class="menu-text">ç­‰ä»·æ— ç©·å°åº”ç”¨æŠ€å·§</span>
</a>
<a class="menu-item" href="#" onclick="scrollToStep('continuous-functions'); toggleChapterMenu();">
<span class="menu-icon">19</span>
<span class="menu-text">å‡½æ•°çš„è¿ç»­æ€§</span>
</a>
<a class="menu-item" href="#" onclick="scrollToStep('discontinuities'); toggleChapterMenu();">
<span class="menu-icon">20</span>
<span class="menu-text">é—´æ–­ç‚¹çš„åˆ†ç±»</span>
</a>
<a class="menu-item" href="#" onclick="scrollToStep('elementary-functions'); toggleChapterMenu();">
<span class="menu-icon">21</span>
<span class="menu-text">åˆç­‰å‡½æ•°çš„è¿ç»­æ€§</span>
</a>
<a class="menu-item" href="#" onclick="scrollToStep('continuity-determination'); toggleChapterMenu();">
<span class="menu-icon">22</span>
<span class="menu-text">è¿ç»­æ€§çš„åˆ¤å®šä¸åº”ç”¨</span>
</a>
<a class="menu-item" href="#" onclick="scrollToStep('applications'); toggleChapterMenu();">
<span class="menu-icon">23</span>
<span class="menu-text">æé™çš„å®é™…åº”ç”¨</span>
</a>
<a class="menu-item" href="#" onclick="scrollToStep('summary'); toggleChapterMenu();">
<span class="menu-icon">24</span>
<span class="menu-text">ç« èŠ‚æ€»ç»“</span>
</a>
</div>
</div>
</body>
</html>
