<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第十三章：概率与统计 (交互式课件)</title>
    <script src="../common-assets/js/d3-7.8.5.min.js"></script>
    <!-- 使用统一的MathJax配置文件 -->
    <script src="../common-assets/js/mathjax-config.js"></script>
      <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            svg: {
                fontCache: 'global'
            },
            startup: {
                pageReady: () => {
                    return window.MathJax.startup.defaultPageReady().then(() => {
                        console.log('MathJax is ready!');
                    });
                }
            }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async
            src="../common-assets/js/mathjax-3.2.2-tex-svg.min.js">
    </script>


    
    <link rel="stylesheet" href="../common-assets/css/fonts.css">
    <link rel="stylesheet" href="../common-assets/css/chapter-light-theme.css">
    <link rel="stylesheet" href="../common-assets/css/chapter-light-overrides.css">

</head>
<body>
<div id="presentation-container">

    <!-- 第1页：标题页 -->
    <div class="slide active">
        <div class="chalkboard" style="flex: 1; text-align: center;">
            <h2 style="font-size: 4rem; border: none;">第十三章</h2>
            <p style="font-size: 2.5rem; color: #1a1a2e;">概率与统计</p>
            
            
            <div class="home-nav-buttons" style="display: flex; justify-content: center; gap: 20px; margin-top: 40px; flex-wrap: wrap;">
                <a href="../index.html" class="nav-btn home-btn" style="display: flex; flex-direction: column; align-items: center; padding: 15px 20px; background: rgba(255, 255, 255, 0.1); border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 15px; text-decoration: none; color: #1a1a2e; transition: all 0.3s ease; backdrop-filter: blur(10px); min-width: 120px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);">
                    <span class="btn-icon" style="font-size: 1.2rem; margin-bottom: 8px; font-weight: bold; letter-spacing: 1px;">HOME</span>
                    <span class="btn-text" style="font-size: 1.1rem; font-weight: 500;">主页</span>
                </a>
                <a href="../故事书/index.html" class="nav-btn story-btn" style="display: flex; flex-direction: column; align-items: center; padding: 15px 20px; background: rgba(255, 255, 255, 0.1); border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 15px; text-decoration: none; color: #1a1a2e; transition: all 0.3s ease; backdrop-filter: blur(10px); min-width: 120px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);">
                    <span class="btn-icon" style="font-size: 1.2rem; margin-bottom: 8px; font-weight: bold; letter-spacing: 1px;">STORY</span>
                    <span class="btn-text" style="font-size: 1.1rem; font-weight: 500;">故事书</span>
                </a>
                <a href="../习题/index.html" class="nav-btn exercise-btn" style="display: flex; flex-direction: column; align-items: center; padding: 15px 20px; background: rgba(255, 255, 255, 0.1); border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 15px; text-decoration: none; color: #1a1a2e; transition: all 0.3s ease; backdrop-filter: blur(10px); min-width: 120px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);">
                    <span class="btn-icon" style="font-size: 1.2rem; margin-bottom: 8px; font-weight: bold; letter-spacing: 1px;">EXERCISE</span>
                    <span class="btn-text" style="font-size: 1.1rem; font-weight: 500;">习题</span>
                </a>
                <a href="../网页资源/index.html" class="nav-btn resource-btn" style="display: flex; flex-direction: column; align-items: center; padding: 15px 20px; background: rgba(255, 255, 255, 0.1); border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 15px; text-decoration: none; color: #1a1a2e; transition: all 0.3s ease; backdrop-filter: blur(10px); min-width: 120px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);">
                    <span class="btn-icon" style="font-size: 1.2rem; margin-bottom: 8px; font-weight: bold; letter-spacing: 1px;">RESOURCE</span>
                    <span class="btn-text" style="font-size: 1.1rem; font-weight: 500;">网页资源</span>
                </a>
            </div>
        </div>
    </div>

    <!-- 第2页：生活中的随机现象 -->
    <div class="slide">
        <div class="chalkboard">
            <h2>生活中的随机现象</h2>
            <h3>什么是随机现象？</h3>
            <p>在相同条件下，可能出现不同结果的现象。</p>
            <ul>
                <li>抛硬币：正面或反面</li>
                <li>掷骰子：1到6的点数</li>
                <li>抽奖：中奖或不中奖</li>
                <li>天气：晴天或雨天</li>
            </ul>
            <div class="math-formula">
                虽然结果不确定，但有规律可循！
            </div>
        </div>
        <div class="visualization" id="vis-random"></div>
    </div>

    <!-- 第3页：随机试验 -->
    <div class="slide">
        <div class="chalkboard">
            <h2>随机试验</h2>
            <h3>三个特点</h3>
            <ol>
                <li><span class="highlight">可重复性</span>：试验可以重复进行</li>
                <li><span class="highlight">明确性</span>：所有可能结果已知</li>
                <li><span class="highlight">随机性</span>：每次结果不能预知</li>
            </ol>
            <h3>例子：掷骰子</h3>
            <ul>
                <li>可以反复投掷（可重复）</li>
                <li>结果是1,2,3,4,5,6之一（明确）</li>
                <li>投掷前不知道结果（随机）</li>
            </ul>
        </div>
        <div class="visualization" id="vis-experiment"></div>
    </div>

    <!-- 第4页：样本空间与随机事件 -->
    <div class="slide">
        <div class="chalkboard">
            <h2>样本空间与事件</h2>
            <h3>样本空间 Ω</h3>
            <p>试验所有可能结果的集合</p>
            <p>掷骰子：Ω = {1, 2, 3, 4, 5, 6}</p>
            
            <h3>随机事件 A</h3>
            <p>样本空间的子集</p>
            <ul>
                <li>事件A：掷出偶数 = {2, 4, 6}</li>
                <li>事件B：掷出大于4 = {5, 6}</li>
            </ul>
            
            <h3>特殊事件</h3>
            <ul>
                <li><span class="highlight">必然事件</span>：Ω（一定发生）</li>
                <li><span class="highlight">不可能事件</span>：∅（不会发生）</li>
            </ul>
        </div>
        <div class="visualization" id="vis-sample-space"></div>
    </div>

    <!-- 第5页：事件的关系 -->
    <div class="slide">
        <div class="chalkboard">
            <h2>事件的关系</h2>
            <h3>并事件 A∪B</h3>
            <p>"A或B发生"（至少一个发生）</p>
            
            <h3>交事件 A∩B</h3>
            <p>"A和B同时发生"</p>
            
            <h3>互斥事件</h3>
            <p>A∩B = ∅（不能同时发生）</p>
            
            <h3>对立事件</h3>
            <p>A∪B = Ω 且 A∩B = ∅</p>
            <p>例：掷骰子"奇数"与"偶数"</p>
        </div>
        <div class="visualization" id="vis-event-relations"></div>
    </div>

    <!-- 第6页：古典概率 -->
    <div class="slide">
        <div class="chalkboard">
            <h2>古典概率</h2>
            <h3>两个条件</h3>
            <ol>
                <li>试验结果<span class="highlight">有限个</span></li>
                <li>每个结果<span class="highlight">等可能</span></li>
            </ol>
            
            <h3>计算公式</h3>
            <div class="math-formula">
                $P(A) = \frac{\text{事件A包含的基本事件数}}{\text{样本空间的基本事件总数}}$
            </div>
            
            <h3>例子</h3>
            <p>掷骰子出现偶数的概率：</p>
            <div class="math-formula">
                $P(\text{偶数}) = \frac{3}{6} = \frac{1}{2}$
            </div>
        </div>
        <div class="visualization" id="vis-classical-prob"></div>
    </div>

    <!-- 第7页：频率与概率 -->
    <div class="slide">
        <div class="chalkboard">
            <h2>频率与概率</h2>
            <h3>频率</h3>
            <p>事件A在n次试验中发生m次：</p>
            <div class="math-formula">
                $\text{频率} = \frac{m}{n}$
            </div>
            
            <h3>大数定律</h3>
            <p>当试验次数n很大时：</p>
            <div class="math-formula">
                频率 → 概率
            </div>
            
            <h3>例子</h3>
            <p>抛硬币1000次，正面约500次</p>
            <p>频率 ≈ 0.5 = 概率</p>
        </div>
        <div class="visualization" id="vis-frequency"></div>
    </div>

    <!-- 第8页：概率的性质 -->
    <div class="slide">
        <div class="chalkboard">
            <h2>概率的基本性质</h2>
            <h3>三个公理</h3>
            <ol>
                <li><span class="highlight">非负性</span>：$0 \leq P(A) \leq 1$</li>
                <li><span class="highlight">规范性</span>：$P(\Omega) = 1$</li>
                <li><span class="highlight">可加性</span>：互斥事件<br>
                    $P(A∪B) = P(A) + P(B)$</li>
            </ol>
            
            <h3>重要公式</h3>
            <ul>
                <li>对立事件：$P(\bar{A}) = 1 - P(A)$</li>
                <li>一般加法：$P(A∪B) = P(A) + P(B) - P(A∩B)$</li>
            </ul>
        </div>
        <div class="visualization" id="vis-prob-properties"></div>
    </div>

    <!-- 第9页：条件概率 -->
    <div class="slide">
        <div class="chalkboard">
            <h2>条件概率</h2>
            <h3>定义</h3>
            <p>在事件B发生的条件下，事件A发生的概率：</p>
            <div class="math-formula">
                $P(A|B) = \frac{P(AB)}{P(B)}$
            </div>
            
            <h3>理解</h3>
            <p>"已知B发生，A发生的概率"</p>
            
            <h3>例子</h3>
            <p>已知掷出的是偶数，它是6的概率：</p>
            <ul>
                <li>偶数：{2, 4, 6}</li>
                <li>在偶数中，6占1/3</li>
                <li>$P(6|\text{偶数}) = \frac{1}{3}$</li>
            </ul>
        </div>
        <div class="visualization" id="vis-conditional"></div>
    </div>

    <!-- 第10页：独立事件 -->
    <div class="slide">
        <div class="chalkboard">
            <h2>独立事件</h2>
            <h3>定义</h3>
            <p>事件A的发生不影响事件B的概率</p>
            <div class="math-formula">
                $P(B|A) = P(B)$
            </div>
            
            <h3>独立事件的乘法</h3>
            <div class="math-formula">
                $P(AB) = P(A) \cdot P(B)$
            </div>
            
            <h3>例子</h3>
            <ul>
                <li>两次抛硬币（独立）</li>
                <li>有放回抽样（独立）</li>
                <li>无放回抽样（不独立）</li>
            </ul>
        </div>
        <div class="visualization" id="vis-independence"></div>
    </div>

    <!-- 第11页：随机变量 -->
    <div class="slide">
        <div class="chalkboard">
            <h2>随机变量</h2>
            <h3>什么是随机变量？</h3>
            <p>将随机试验的结果用<span class="highlight">数字</span>表示</p>
            
            <h3>例子</h3>
            <ul>
                <li>掷骰子的点数：X = {1,2,3,4,5,6}</li>
                <li>抛硬币（正=1，反=0）：X = {0,1}</li>
                <li>考试成绩：X = [0,100]</li>
            </ul>
            
            <h3>两种类型</h3>
            <ul>
                <li><span class="highlight">离散型</span>：可数的值（骰子点数）</li>
                <li><span class="highlight">连续型</span>：连续区间（身高、体重）</li>
            </ul>
        </div>
        <div class="visualization" id="vis-random-var"></div>
    </div>

    <!-- 第12页：二项分布 -->
    <div class="slide">
        <div class="chalkboard">
            <h2>二项分布</h2>
            <h3>背景</h3>
            <p>n次独立重复试验，每次成功概率p</p>
            
            <h3>记号</h3>
            <div class="math-formula">
                $X \sim B(n, p)$
            </div>
            
            <h3>概率公式</h3>
            <div class="math-formula">
                $P(X=k) = C_n^k p^k (1-p)^{n-k}$
            </div>
            
            <h3>例子</h3>
            <p>投10次硬币，恰好5次正面：</p>
            <p>$n=10, p=0.5, k=5$</p>
        </div>
        <div class="visualization" id="vis-binomial"></div>
    </div>

    <!-- 第13页：正态分布 -->
    <div class="slide">
        <div class="chalkboard">
            <h2>正态分布</h2>
            <h3>最重要的分布</h3>
            <p>自然界中大量现象服从正态分布</p>
            
            <h3>记号</h3>
            <div class="math-formula">
                $X \sim N(\mu, \sigma^2)$
            </div>
            <ul>
                <li>μ：均值（中心位置）</li>
                <li>σ：标准差（离散程度）</li>
            </ul>
            
            <h3>特点</h3>
            <ul>
                <li>钟形曲线</li>
                <li>关于μ对称</li>
                <li>68-95-99.7规则</li>
            </ul>
        </div>
        <div class="visualization" id="vis-normal"></div>
    </div>

    <!-- 第14页：数学期望 -->
    <div class="slide">
        <div class="chalkboard">
            <h2>数学期望（均值）</h2>
            <h3>含义</h3>
            <p>随机变量的<span class="highlight">平均值</span></p>
            
            <h3>离散型</h3>
            <div class="math-formula">
                $E(X) = \sum x_i p_i$
            </div>
            
            <h3>例子</h3>
            <p>掷骰子的期望：</p>
            <div class="formula-rule">
                $E = 1×\frac{1}{6} + 2×\frac{1}{6} + ... + 6×\frac{1}{6} = 3.5$
            </div>
        </div>
        <div class="visualization" id="vis-expectation"></div>
    </div>

    <!-- 第15页：总结 -->
    <div class="slide">
        <div class="chalkboard" style="flex: 1; text-align: center;">
            <h2 style="font-size: 3rem; border: none;">课程总结</h2>
            <div style="text-align: left; max-width: 600px; margin: 0 auto;">
                <h3>概率论</h3>
                <ul>
                    <li>随机事件与概率</li>
                    <li>条件概率与独立性</li>
                    <li>随机变量与分布</li>
                </ul>
                
                <h3>统计基础</h3>
                <ul>
                    <li>数据的收集与整理</li>
                    <li>数字特征：期望、方差</li>
                    <li>常见分布：二项分布、正态分布</li>
                </ul>
            </div>
            <p style="font-size: 1.5rem; color: #f39c12; margin-top: 50px;">
                掌握随机规律，做出科学决策！
            </p>
        </div>
    </div>

    <!-- 翻页按钮 -->

</div>

<script>
    // 全局变量
    let slides, totalSlides, currentSlide = 0;

    // 初始化
    document.addEventListener('DOMContentLoaded', function() {
        slides = document.querySelectorAll('.slide');
        totalSlides = slides.length;
        
        showSlide(0);
        
        // 键盘导航
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight' || e.key === 'ArrowDown' || e.key === ' ' ||
                e.key === 'PageDown' || e.key === 'Enter') {
                e.preventDefault();
                nextSlide();
            } else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp' ||
                       e.key === 'PageUp' || e.key === 'Backspace') {
                e.preventDefault();
                previousSlide();
            }
        });

        // 鼠标滚轮导航
        document.addEventListener('wheel', (e) => {
            e.preventDefault();
            if (e.deltaY > 0) {
                nextSlide();
            } else {
                previousSlide();
            }
        }, { passive: false });
    });

    // 显示指定幻灯片
    function showSlide(index) {
        if (index < 0 || index >= totalSlides) return;
        
        slides.forEach(slide => slide.classList.remove('active'));
        currentSlide = index;
        slides[currentSlide].classList.add('active');
        
        document.getElementById('page-indicator').textContent = `${currentSlide + 1} / ${totalSlides}`;
        updateNavButtons();
        
        // 运行对应的可视化
        runVisualization(currentSlide);
        
        // 渲染数学公式
        if (window.MathJax) {
            MathJax.typesetPromise([slides[currentSlide]]).catch(error => {
                console.warn('MathJax rendering failed:', error);
            });
        }
    }

    // 更新导航按钮状态
    function updateNavButtons() {
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        
        if (prevBtn && nextBtn) {
            prevBtn.disabled = (currentSlide === 0);
            nextBtn.disabled = (currentSlide === totalSlides - 1);
        }
    }

    // 下一页
    function nextSlide() {
        if (currentSlide < totalSlides - 1) {
            showSlide(currentSlide + 1);
        }
    }

    // 上一页
    function previousSlide() {
        if (currentSlide > 0) {
            showSlide(currentSlide - 1);
        }
    }

    // 运行可视化
    function runVisualization(slideIndex) {
        // 清理之前的动画
        cleanupAnimations();
        
        switch(slideIndex) {
            case 1: visualizeRandomPhenomena('vis-random'); break;
            case 2: visualizeExperiment('vis-experiment'); break;
            case 3: visualizeSampleSpace('vis-sample-space'); break;
            case 4: visualizeEventRelations('vis-event-relations'); break;
            case 5: visualizeClassicalProbability('vis-classical-prob'); break;
            case 6: visualizeFrequency('vis-frequency'); break;
            case 7: visualizeProbProperties('vis-prob-properties'); break;
            case 8: visualizeConditional('vis-conditional'); break;
            case 9: visualizeIndependence('vis-independence'); break;
            case 10: visualizeRandomVariable('vis-random-var'); break;
            case 11: visualizeBinomial('vis-binomial'); break;
            case 12: visualizeNormal('vis-normal'); break;
            case 13: visualizeExpectation('vis-expectation'); break;
        }
    }

    // 清理动画
    function cleanupAnimations() {
        // 清理所有定时器和动画
        const highestId = setTimeout(() => {}, 0);
        for (let i = 0; i < highestId; i++) {
            clearTimeout(i);
            clearInterval(i);
        }
    }

    // --- 可视化函数 ---

    // 第2页：随机现象
    function visualizeRandomPhenomena(containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;
        container.innerHTML = '';
        
        const examples = [
            { icon: '🪙', name: '抛硬币', outcomes: ['正面', '反面'], color: '#ffd700' },
            { icon: '🎲', name: '掷骰子', outcomes: ['1', '2', '3', '4', '5', '6'], color: '#e74c3c' },
            { icon: '🎰', name: '抽奖', outcomes: ['中奖', '未中奖'], color: '#2ecc71' },
            { icon: '☁️', name: '天气', outcomes: ['晴', '阴', '雨'], color: '#3498db' }
        ];
        
        const wrapper = document.createElement('div');
        wrapper.style.cssText = 'display: flex; flex-wrap: wrap; gap: 30px; justify-content: center; align-items: center;';
        
        examples.forEach((example, index) => {
            const card = document.createElement('div');
            card.className = 'card';
            card.style.cssText = `width: 200px; text-align: center; animation: fadeIn 0.5s ease-in-out ${index * 0.1}s both;`;
            
            const icon = document.createElement('div');
            icon.style.cssText = 'font-size: 80px; margin-bottom: 15px;';
            icon.textContent = example.icon;
            
            const name = document.createElement('h3');
            name.style.cssText = `margin: 10px 0; color: #2c3e50; font-size: 20px;`;
            name.textContent = example.name;
            
            const outcomes = document.createElement('div');
            outcomes.style.cssText = 'display: flex; gap: 10px; justify-content: center; margin-top: 20px; flex-wrap: wrap;';
            
            let currentIndex = 0;
            
            example.outcomes.forEach(outcome => {
                const chip = document.createElement('span');
                chip.style.cssText = `background: ${example.color}; color: white; padding: 8px 15px; border-radius: 20px; font-size: 14px; transition: all 0.3s ease;`;
                chip.textContent = outcome;
                outcomes.appendChild(chip);
            });
            
            // 添加循环高亮动画
            setInterval(() => {
                const chips = outcomes.children;
                for (let i = 0; i < chips.length; i++) {
                    chips[i].style.transform = i === currentIndex ? 'scale(1.2)' : 'scale(1)';
                    chips[i].style.opacity = i === currentIndex ? '1' : '0.6';
                }
                currentIndex = (currentIndex + 1) % chips.length;
            }, 1500);
            
            card.appendChild(icon);
            card.appendChild(name);
            card.appendChild(outcomes);
            wrapper.appendChild(card);
        });
        
        container.appendChild(wrapper);
        
        // 添加淡入动画
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(20px); }
                to { opacity: 1; transform: translateY(0); }
            }
        `;
        document.head.appendChild(style);
    }

    // 第3页：随机试验 - 掷骰子动画
    function visualizeExperiment(containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;
        container.innerHTML = '';
        
        const wrapper = document.createElement('div');
        wrapper.className = 'dice-container';
        
        // 骰子
        const dice = document.createElement('div');
        dice.className = 'dice';
        dice.textContent = '🎲';
        
        // 结果显示
        const result = document.createElement('div');
        result.style.cssText = 'font-size: 28px; color: #2c3e50; font-weight: bold;';
        result.textContent = '点击骰子投掷';
        
        // 历史记录
        const historyTitle = document.createElement('div');
        historyTitle.style.cssText = 'font-size: 18px; color: #7f8c8d; margin-top: 30px;';
        historyTitle.textContent = '投掷历史';
        
        const history = document.createElement('div');
        history.style.cssText = 'display: flex; gap: 15px; flex-wrap: wrap; max-width: 500px; justify-content: center; margin-top: 15px;';
        
        // 统计显示
        const stats = document.createElement('div');
        stats.style.cssText = 'display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; margin-top: 20px;';
        
        const counts = [0, 0, 0, 0, 0, 0];
        
        for (let i = 1; i <= 6; i++) {
            const statCard = document.createElement('div');
            statCard.style.cssText = 'background: white; padding: 10px; border-radius: 10px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1);';
            statCard.innerHTML = `
                <div style="font-size: 24px; margin-bottom: 5px;">
                    ${['⚀', '⚁', '⚂', '⚃', '⚄', '⚅'][i - 1]}
                </div>
                <div id="count-${i}" style="font-size: 18px; font-weight: bold; color: #3498db;">0</div>
            `;
            stats.appendChild(statCard);
        }
        
        dice.addEventListener('click', () => {
            dice.classList.add('rolling');
            
            setTimeout(() => {
                const value = Math.floor(Math.random() * 6) + 1;
                dice.textContent = ['⚀', '⚁', '⚂', '⚃', '⚄', '⚅'][value - 1];
                result.textContent = `投出了 ${value} 点！`;
                
                // 更新统计
                counts[value - 1]++;
                document.getElementById(`count-${value}`).textContent = counts[value - 1];
                
                // 添加到历史
                const record = document.createElement('span');
                record.style.cssText = `
                    background: linear-gradient(135deg, #667eea, #764ba2);
                    color: white;
                    padding: 8px 12px;
                    border-radius: 50%;
                    width: 40px;
                    height: 40px;
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 20px;
                    animation: bounceIn 0.5s ease;
                `;
                record.textContent = ['⚀', '⚁', '⚂', '⚃', '⚄', '⚅'][value - 1];
                history.appendChild(record);
                
                if (history.children.length > 10) {
                    history.removeChild(history.firstChild);
                }
                
                dice.classList.remove('rolling');
            }, 600);
        });
        
        wrapper.appendChild(dice);
        wrapper.appendChild(result);
        wrapper.appendChild(stats);
        wrapper.appendChild(historyTitle);
        wrapper.appendChild(history);
        container.appendChild(wrapper);
        
        // 添加弹入动画
        const style = document.createElement('style');
        style.textContent = `
            @keyframes bounceIn {
                0% { transform: scale(0); opacity: 0; }
                60% { transform: scale(1.2); }
                100% { transform: scale(1); opacity: 1; }
            }
        `;
        document.head.appendChild(style);
    }

    // 第4页：样本空间
    function visualizeSampleSpace(containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;
        container.innerHTML = '';
        
        const svg = d3.select(container)
            .append('svg')
            .attr('width', '100%')
            .attr('height', '100%')
            .attr('viewBox', '0 0 600 400');
        
        // 添加渐变定义
        const defs = svg.append('defs');
        const gradient = defs.append('linearGradient')
            .attr('id', 'space-gradient')
            .attr('x1', '0%')
            .attr('y1', '0%')
            .attr('x2', '100%')
            .attr('y2', '100%');
        
        gradient.append('stop')
            .attr('offset', '0%')
            .style('stop-color', '#ecf0f1')
            .style('stop-opacity', 1);
        
        gradient.append('stop')
            .attr('offset', '100%')
            .style('stop-color', '#bdc3c7')
            .style('stop-opacity', 1);
        
        // 样本空间（大圆）
        svg.append('circle')
            .attr('cx', 300)
            .attr('cy', 200)
            .attr('r', 150)
            .attr('fill', 'url(#space-gradient)')
            .attr('stroke', '#2c3e50')
            .attr('stroke-width', 3)
            .style('filter', 'drop-shadow(0 5px 15px rgba(0,0,0,0.2))');
        
        svg.append('text')
            .attr('x', 300)
            .attr('y', 70)
            .attr('text-anchor', 'middle')
            .attr('font-size', 22)
            .attr('font-weight', 'bold')
            .text('Ω = {1, 2, 3, 4, 5, 6}');
        
        // 事件A（偶数）
        const eventA = svg.append('g')
            .attr('opacity', 0);
        
        eventA.append('ellipse')
            .attr('cx', 250)
            .attr('cy', 200)
            .attr('rx', 80)
            .attr('ry', 100)
            .attr('fill', '#3498db')
            .attr('fill-opacity', 0.5)
            .attr('stroke', '#2980b9')
            .attr('stroke-width', 2);
        
        eventA.append('text')
            .attr('x', 250)
            .attr('y', 150)
            .attr('text-anchor', 'middle')
            .attr('font-size', 18)
            .attr('font-weight', 'bold')
            .attr('fill', 'white')
            .text('A = {2, 4, 6}');
        
        eventA.transition()
            .duration(1000)
            .delay(500)
            .attr('opacity', 1);
        
        // 事件B（大于4）
        const eventB = svg.append('g')
            .attr('opacity', 0);
        
        eventB.append('ellipse')
            .attr('cx', 350)
            .attr('cy', 200)
            .attr('rx', 80)
            .attr('ry', 100)
            .attr('fill', '#e74c3c')
            .attr('fill-opacity', 0.5)
            .attr('stroke', '#c0392b')
            .attr('stroke-width', 2);
        
        eventB.append('text')
            .attr('x', 350)
            .attr('y', 150)
            .attr('text-anchor', 'middle')
            .attr('font-size', 18)
            .attr('font-weight', 'bold')
            .attr('fill', 'white')
            .text('B = {5, 6}');
        
        eventB.transition()
            .duration(1000)
            .delay(1000)
            .attr('opacity', 1);
        
        // 样本点动画
        const points = [
            {x: 200, y: 200, value: 2, delay: 1500},
            {x: 250, y: 180, value: 4, delay: 1600},
            {x: 300, y: 200, value: 6, delay: 1700},
            {x: 350, y: 200, value: 5, delay: 1800},
            {x: 180, y: 250, value: 1, delay: 1900},
            {x: 380, y: 250, value: 3, delay: 2000}
        ];
        
        points.forEach(point => {
            const g = svg.append('g')
                .attr('opacity', 0);
            
            g.append('circle')
                .attr('cx', point.x)
                .attr('cy', point.y)
                .attr('r', 25)
                .attr('fill', 'white')
                .attr('stroke', '#2c3e50')
                .attr('stroke-width', 2)
                .style('filter', 'drop-shadow(0 2px 5px rgba(0,0,0,0.2))');
            
            g.append('text')
                .attr('x', point.x)
                .attr('y', point.y + 5)
                .attr('text-anchor', 'middle')
                .attr('font-size', 20)
                .attr('font-weight', 'bold')
                .text(point.value);
            
            g.transition()
                .duration(500)
                .delay(point.delay)
                .attr('opacity', 1)
                .attr('transform', 'scale(1.2)')
                .transition()
                .duration(300)
                .attr('transform', 'scale(1)');
        });
    }

    // 第5页：事件关系（文氏图）
    function visualizeEventRelations(containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;
        container.innerHTML = '';
        
        const wrapper = document.createElement('div');
        wrapper.style.cssText = 'display: grid; grid-template-columns: 1fr 1fr; gap: 30px; padding: 30px;';
        
        const relations = [
            { 
                name: '并事件 A∪B',
                colorA: '#3498db',
                colorB: '#e74c3c',
                type: 'union',
                description: 'A或B至少一个发生'
            },
            { 
                name: '交事件 A∩B',
                colorA: '#3498db',
                colorB: '#e74c3c',
                type: 'intersection',
                description: 'A和B同时发生'
            },
            { 
                name: '互斥事件',
                colorA: '#3498db',
                colorB: '#e74c3c',
                type: 'disjoint',
                description: '不能同时发生'
            },
            { 
                name: '对立事件',
                colorA: '#3498db',
                colorB: '#95a5a6',
                type: 'complement',
                description: '必有一个发生'
            }
        ];
        
        relations.forEach((rel, index) => {
            const card = document.createElement('div');
            card.className = 'card';
            card.style.cssText = 'padding: 20px; text-align: center;';
            
            const title = document.createElement('h3');
            title.style.cssText = 'margin: 0 0 10px 0; color: #2c3e50;';
            title.textContent = rel.name;
            
            const desc = document.createElement('p');
            desc.style.cssText = 'color: #7f8c8d; font-size: 14px; margin: 0 0 15px 0;';
            desc.textContent = rel.description;
            
            const svg = d3.select(card)
                .append('svg')
                .attr('width', 200)
                .attr('height', 150);
            
            // 绘制不同类型的关系
            if (rel.type === 'union' || rel.type === 'intersection') {
                // 有重叠的事件
                svg.append('circle')
                    .attr('cx', 80)
                    .attr('cy', 75)
                    .attr('r', 45)
                    .attr('fill', rel.colorA)
                    .attr('fill-opacity', rel.type === 'union' ? 0.5 : 0.2);
                
                svg.append('circle')
                    .attr('cx', 120)
                    .attr('cy', 75)
                    .attr('r', 45)
                    .attr('fill', rel.colorB)
                    .attr('fill-opacity', rel.type === 'union' ? 0.5 : 0.2);
                
                if (rel.type === 'intersection') {
                    // 高亮交集
                    const intersection = svg.append('path')
                        .attr('d', 'M 100 40 A 45 45 0 0 1 100 110 A 45 45 0 0 1 100 40')
                        .attr('fill', '#9b59b6')
                        .attr('fill-opacity', 0)
                        .transition()
                        .duration(1000)
                        .delay(index * 200)
                        .attr('fill-opacity', 0.7);
                }
            } else if (rel.type === 'disjoint') {
                // 互斥事件
                svg.append('circle')
                    .attr('cx', 60)
                    .attr('cy', 75)
                    .attr('r', 40)
                    .attr('fill', rel.colorA)
                    .attr('fill-opacity', 0.5);
                
                svg.append('circle')
                    .attr('cx', 140)
                    .attr('cy', 75)
                    .attr('r', 40)
                    .attr('fill', rel.colorB)
                    .attr('fill-opacity', 0.5);
            } else if (rel.type === 'complement') {
                // 对立事件
                svg.append('rect')
                    .attr('x', 20)
                    .attr('y', 30)
                    .attr('width', 80)
                    .attr('height', 90)
                    .attr('fill', rel.colorA)
                    .attr('fill-opacity', 0.5)
                    .attr('rx', 5);
                
                svg.append('rect')
                    .attr('x', 100)
                    .attr('y', 30)
                    .attr('width', 80)
                    .attr('height', 90)
                    .attr('fill', rel.colorB)
                    .attr('fill-opacity', 0.5)
                    .attr('rx', 5);
                
                svg.append('text')
                    .attr('x', 60)
                    .attr('y', 80)
                    .attr('text-anchor', 'middle')
                    .attr('fill', 'white')
                    .attr('font-weight', 'bold')
                    .text('A');
                
                svg.append('text')
                    .attr('x', 140)
                    .attr('y', 80)
                    .attr('text-anchor', 'middle')
                    .attr('fill', 'white')
                    .attr('font-weight', 'bold')
                    .text('Ā');
            }
            
            card.appendChild(title);
            card.appendChild(desc);
            wrapper.appendChild(card);
        });
        
        container.appendChild(wrapper);
    }

    // 第6页：古典概率
    function visualizeClassicalProbability(containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;
        container.innerHTML = '';
        
        const wrapper = document.createElement('div');
        wrapper.style.cssText = 'display: flex; flex-direction: column; align-items: center; gap: 30px;';
        
        // 骰子面板
        const dicePanel = document.createElement('div');
        dicePanel.style.cssText = 'display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;';
        
        const faces = ['⚀', '⚁', '⚂', '⚃', '⚄', '⚅'];
        const selected = new Set();
        
        faces.forEach((face, i) => {
            const die = document.createElement('div');
            die.style.cssText = `
                width: 100px;
                height: 100px;
                background: white;
                border: 3px solid #2c3e50;
                border-radius: 15px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 50px;
                cursor: pointer;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            `;
            die.textContent = face;
            die.dataset.value = i + 1;
            
            die.addEventListener('click', () => {
                if (selected.has(i + 1)) {
                    selected.delete(i + 1);
                    die.style.background = 'white';
                    die.style.transform = 'scale(1)';
                } else {
                    selected.add(i + 1);
                    die.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
                    die.style.color = 'white';
                    die.style.transform = 'scale(1.1)';
                }
                updateProbability();
            });
            
            dicePanel.appendChild(die);
        });
        
        // 概率显示
        const probDisplay = document.createElement('div');
        probDisplay.style.cssText = 'font-size: 24px; color: #2c3e50; text-align: center; font-weight: bold;';
        
        const formula = document.createElement('div');
        formula.style.cssText = `
            margin-top: 20px;
            padding: 25px;
            background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        `;
        formula.innerHTML = `
            <div style="font-size: 20px; margin-bottom: 10px;">概率计算</div>
            <div style="display: flex; align-items: center; justify-content: center; gap: 20px; font-size: 24px;">
                <span>P(A) = </span>
                <div style="display: flex; flex-direction: column; align-items: center;">
                    <span id="favorable" style="border-bottom: 2px solid #2c3e50; padding: 0 10px;">0</span>
                    <span id="total" style="padding: 0 10px;">6</span>
                </div>
                <span> = </span>
                <span id="prob" style="color: #3498db; font-weight: bold;">0</span>
            </div>
        `;
        
        // 概率条
        const probBar = document.createElement('div');
        probBar.className = 'probability-bar';
        probBar.style.width = '300px';
        
        const probFill = document.createElement('div');
        probFill.className = 'probability-fill';
        probFill.style.width = '0%';
        probFill.id = 'prob-fill';
        
        probBar.appendChild(probFill);
        
        function updateProbability() {
            const favorable = selected.size;
            const total = 6;
            const prob = favorable / total;
            
            document.getElementById('favorable').textContent = favorable;
            document.getElementById('prob').textContent = prob.toFixed(3);
            
            const fillEl = document.getElementById('prob-fill');
            fillEl.style.width = `${prob * 100}%`;
            fillEl.textContent = selected.size > 0 ? `${(prob * 100).toFixed(1)}%` : '';
            
            probDisplay.textContent = selected.size > 0 
                ? `选中事件: {${Array.from(selected).sort().join(', ')}}`
                : '点击选择事件中的基本事件';
        }
        
        wrapper.appendChild(dicePanel);
        wrapper.appendChild(probDisplay);
        wrapper.appendChild(formula);
        wrapper.appendChild(probBar);
        container.appendChild(wrapper);
        
        updateProbability();
    }

    // 第7页：频率与概率
    function visualizeFrequency(containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;
        container.innerHTML = '';
        
        const wrapper = document.createElement('div');
        wrapper.style.cssText = 'display: flex; flex-direction: column; align-items: center; gap: 20px; padding: 20px;';
        
        // 控制按钮
        const controls = document.createElement('div');
        controls.style.cssText = 'display: flex; gap: 20px;';
        
        const flipBtn = document.createElement('button');
        flipBtn.textContent = '抛100次硬币';
        flipBtn.className = 'control-btn';
        flipBtn.style.cssText = 'width: auto; padding: 10px 20px; font-size: 16px;';
        
        const autoBtn = document.createElement('button');
        autoBtn.textContent = '自动模拟';
        autoBtn.className = 'control-btn';
        autoBtn.style.cssText = 'width: auto; padding: 10px 20px; font-size: 16px; background: #2ecc71;';
        
        const resetBtn = document.createElement('button');
        resetBtn.textContent = '重置';
        resetBtn.className = 'control-btn';
        resetBtn.style.cssText = 'width: auto; padding: 10px 20px; font-size: 16px; background: #e74c3c;';
        
        controls.appendChild(flipBtn);
        controls.appendChild(autoBtn);
        controls.appendChild(resetBtn);
        
        // 统计显示
        const stats = document.createElement('div');
        stats.style.cssText = 'display: flex; gap: 50px; font-size: 20px;';
        
        const totalDisplay = document.createElement('div');
        const headsDisplay = document.createElement('div');
        const freqDisplay = document.createElement('div');
        
        // 图表容器
        const chartContainer = document.createElement('div');
        chartContainer.style.cssText = 'width: 600px; height: 350px;';
        
        let total = 0;
        let heads = 0;
        const history = [];
        let autoInterval;
        
        function updateDisplay() {
            totalDisplay.innerHTML = `总次数: <strong style="color: #3498db;">${total}</strong>`;
            headsDisplay.innerHTML = `正面: <strong style="color: #2ecc71;">${heads}</strong>`;
            const freq = total > 0 ? (heads / total).toFixed(4) : '0.0000';
            freqDisplay.innerHTML = `频率: <strong style="color: #e74c3c;">${freq}</strong>`;
            
            if (history.length > 0) {
                drawFrequencyChart();
            }
        }
        
        function drawFrequencyChart() {
            chartContainer.innerHTML = '';
            
            const svg = d3.select(chartContainer)
                .append('svg')
                .attr('width', 600)
                .attr('height', 350);
            
            const margin = {top: 20, right: 30, bottom: 40, left: 50};
            const width = 600 - margin.left - margin.right;
            const height = 350 - margin.top - margin.bottom;
            
            const g = svg.append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);
            
            const x = d3.scaleLinear()
                .domain([0, Math.max(history.length, 10)])
                .range([0, width]);
            
            const y = d3.scaleLinear()
                .domain([0, 1])
                .range([height, 0]);
            
            // 添加网格线
            g.append('g')
                .attr('class', 'grid')
                .attr('transform', `translate(0,${height})`)
                .call(d3.axisBottom(x).ticks(10).tickSize(-height).tickFormat(''))
                .style('stroke-dasharray', '2,2')
                .style('opacity', 0.3);
            
            g.append('g')
                .attr('class', 'grid')
                .call(d3.axisLeft(y).ticks(10).tickSize(-width).tickFormat(''))
                .style('stroke-dasharray', '2,2')
                .style('opacity', 0.3);
            
            const line = d3.line()
                .x((d, i) => x(i + 1))
                .y(d => y(d))
                .curve(d3.curveMonotoneX);
            
            // 添加0.5参考线
            g.append('line')
                .attr('x1', 0)
                .attr('x2', width)
                .attr('y1', y(0.5))
                .attr('y2', y(0.5))
                .attr('stroke', '#e74c3c')
                .attr('stroke-width', 2)
                .attr('stroke-dasharray', '10,5');
            
            // 添加标签
            g.append('text')
                .attr('x', width - 50)
                .attr('y', y(0.5) - 5)
                .text('理论概率 0.5')
                .attr('fill', '#e74c3c')
                .attr('font-size', 12);
            
            // 绘制频率线
            g.append('path')
                .datum(history)
                .attr('fill', 'none')
                .attr('stroke', '#3498db')
                .attr('stroke-width', 3)
                .attr('d', line);
            
            // 绘制数据点
            g.selectAll('.dot')
                .data(history.slice(-1))
                .enter().append('circle')
                .attr('class', 'dot')
                .attr('cx', (d, i) => x(history.length))
                .attr('cy', d => y(d))
                .attr('r', 5)
                .attr('fill', '#3498db')
                .style('filter', 'drop-shadow(0 0 5px rgba(52, 152, 219, 0.5))');
            
            // 添加坐标轴
            g.append('g')
                .attr('transform', `translate(0,${height})`)
                .call(d3.axisBottom(x).ticks(10));
            
            g.append('g')
                .call(d3.axisLeft(y).ticks(10));
            
            // 添加轴标签
            svg.append('text')
                .attr('transform', 'rotate(-90)')
                .attr('y', margin.left - 35)
                .attr('x', 0 - (height / 2) - margin.top)
                .attr('text-anchor', 'middle')
                .text('频率');
            
            svg.append('text')
                .attr('x', width / 2 + margin.left)
                .attr('y', height + margin.top + 35)
                .attr('text-anchor', 'middle')
                .text('试验次数');
        }
        
        function flip(n = 100) {
            for (let i = 0; i < n; i++) {
                total++;
                if (Math.random() < 0.5) heads++;
                history.push(heads / total);
                
                // 限制历史记录长度
                if (history.length > 1000) {
                    history.shift();
                }
            }
            updateDisplay();
        }
        
        flipBtn.addEventListener('click', () => flip(100));
        
        autoBtn.addEventListener('click', () => {
            if (autoInterval) {
                clearInterval(autoInterval);
                autoInterval = null;
                autoBtn.textContent = '自动模拟';
                autoBtn.style.background = '#2ecc71';
            } else {
                autoInterval = setInterval(() => flip(10), 100);
                autoBtn.textContent = '停止';
                autoBtn.style.background = '#f39c12';
            }
        });
        
        resetBtn.addEventListener('click', () => {
            if (autoInterval) {
                clearInterval(autoInterval);
                autoInterval = null;
                autoBtn.textContent = '自动模拟';
                autoBtn.style.background = '#2ecc71';
            }
            total = 0;
            heads = 0;
            history.length = 0;
            chartContainer.innerHTML = '';
            updateDisplay();
        });
        
        stats.appendChild(totalDisplay);
        stats.appendChild(headsDisplay);
        stats.appendChild(freqDisplay);
        
        wrapper.appendChild(controls);
        wrapper.appendChild(stats);
        wrapper.appendChild(chartContainer);
        container.appendChild(wrapper);
        
        updateDisplay();
    }

    // 其余可视化函数的占位实现
    function visualizeProbProperties(containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;
        
        container.innerHTML = `
            <div class="chart-container">
                <h3>概率性质演示</h3>
                <div style="text-align: center; padding: 50px;">
                    <p style="font-size: 20px; color: #2c3e50;">互动演示概率的基本性质</p>
                </div>
            </div>
        `;
    }

    function visualizeConditional(containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;
        
        container.innerHTML = `
            <div class="chart-container">
                <h3>条件概率可视化</h3>
                <div style="text-align: center; padding: 50px;">
                    <p style="font-size: 20px; color: #2c3e50;">条件概率的图形化理解</p>
                </div>
            </div>
        `;
    }

    function visualizeIndependence(containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;
        
        container.innerHTML = `
            <div class="chart-container">
                <h3>独立事件演示</h3>
                <div style="text-align: center; padding: 50px;">
                    <p style="font-size: 20px; color: #2c3e50;">独立性的直观理解</p>
                </div>
            </div>
        `;
    }

    function visualizeRandomVariable(containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;
        
        container.innerHTML = `
            <div class="chart-container">
                <h3>随机变量概念</h3>
                <div style="text-align: center; padding: 50px;">
                    <p style="font-size: 20px; color: #2c3e50;">从随机试验到数值的映射</p>
                </div>
            
    <div class="nav-container">
        <button class="nav-btn" id="prev-btn" onclick="previousSlide()" title="上一页 (←)">上一页</button>
        <span id="page-indicator">1 / 14</span>
        <button class="nav-btn" id="next-btn" onclick="nextSlide()" title="下一页 (→)">下一页</button>
    </div>
</div>
        `;
    }

    // 第12页：二项分布
    function visualizeBinomial(containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;
        container.innerHTML = '';
        
        const svg = d3.select(container)
            .append('svg')
            .attr('width', '100%')
            .attr('height', '100%')
            .attr('viewBox', '0 0 700 450');
        
        const n = 10;
        const p = 0.5;
        const data = [];
        
        // 计算二项分布概率
        for (let k = 0; k <= n; k++) {
            const prob = combination(n, k) * Math.pow(p, k) * Math.pow(1-p, n-k);
            data.push({k: k, prob: prob});
        }
        
        const margin = {top: 40, right: 40, bottom: 60, left: 60};
        const width = 700 - margin.left - margin.right;
        const height = 450 - margin.top - margin.bottom;
        
        const g = svg.append('g')
            .attr('transform', `translate(${margin.left},${margin.top})`);
        
        const x = d3.scaleBand()
            .domain(data.map(d => d.k))
            .range([0, width])
            .padding(0.1);
        
        const y = d3.scaleLinear()
            .domain([0, d3.max(data, d => d.prob) * 1.1])
            .range([height, 0]);
        
        // 添加渐变
        const gradient = svg.append('defs')
            .append('linearGradient')
            .attr('id', 'bar-gradient')
            .attr('x1', '0%')
            .attr('y1', '0%')
            .attr('x2', '0%')
            .attr('y2', '100%');
        
        gradient.append('stop')
            .attr('offset', '0%')
            .style('stop-color', '#3498db')
            .style('stop-opacity', 1);
        
        gradient.append('stop')
            .attr('offset', '100%')
            .style('stop-color', '#2980b9')
            .style('stop-opacity', 1);
        
        // 绘制柱状图
        g.selectAll('.bar')
            .data(data)
            .enter().append('rect')
            .attr('class', 'bar')
            .attr('x', d => x(d.k))
            .attr('y', height)
            .attr('width', x.bandwidth())
            .attr('height', 0)
            .attr('fill', 'url(#bar-gradient)')
            .style('filter', 'drop-shadow(0 2px 5px rgba(0,0,0,0.2))')
            .transition()
            .duration(1000)
            .delay((d, i) => i * 100)
            .attr('y', d => y(d.prob))
            .attr('height', d => height - y(d.prob));
        
        // 添加数值标签
        g.selectAll('.label')
            .data(data)
            .enter().append('text')
            .attr('class', 'label')
            .attr('x', d => x(d.k) + x.bandwidth() / 2)
            .attr('y', d => y(d.prob) - 5)
            .attr('text-anchor', 'middle')
            .attr('font-size', 12)
            .attr('fill', '#2c3e50')
            .text(d => d.prob.toFixed(3))
            .style('opacity', 0)
            .transition()
            .duration(500)
            .delay((d, i) => i * 100 + 1000)
            .style('opacity', 1);
        
        // 添加坐标轴
        g.append('g')
            .attr('transform', `translate(0,${height})`)
            .call(d3.axisBottom(x))
            .append('text')
            .attr('x', width / 2)
            .attr('y', 45)
            .attr('fill', '#000')
            .style('text-anchor', 'middle')
            .style('font-size', 14)
            .text('成功次数 k');
        
        g.append('g')
            .call(d3.axisLeft(y).ticks(10))
            .append('text')
            .attr('transform', 'rotate(-90)')
            .attr('y', -45)
            .attr('x', -height / 2)
            .attr('fill', '#000')
            .style('text-anchor', 'middle')
            .style('font-size', 14)
            .text('概率 P(X=k)');
        
        // 标题
        svg.append('text')
            .attr('x', 350)
            .attr('y', 25)
            .attr('text-anchor', 'middle')
            .attr('font-size', 20)
            .attr('font-weight', 'bold')
            .text(`二项分布 B(${n}, ${p})`);
    }

    // 组合数计算
    function combination(n, k) {
        if (k > n) return 0;
        if (k === 0 || k === n) return 1;
        let result = 1;
        for (let i = 0; i < k; i++) {
            result = result * (n - i) / (i + 1);
        }
        return result;
    }

    // 第13页：正态分布
    function visualizeNormal(containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;
        container.innerHTML = '';
        
        const svg = d3.select(container)
            .append('svg')
            .attr('width', '100%')
            .attr('height', '100%')
            .attr('viewBox', '0 0 700 450');
        
        const margin = {top: 40, right: 40, bottom: 60, left: 60};
        const width = 700 - margin.left - margin.right;
        const height = 450 - margin.top - margin.bottom;
        
        const g = svg.append('g')
            .attr('transform', `translate(${margin.left},${margin.top})`);
        
        // 正态分布参数
        const mu = 0;
        const sigma = 1;
        
        // 生成正态分布数据
        const xValues = d3.range(-4, 4.1, 0.1);
        const data = xValues.map(x => ({
            x: x,
            y: (1 / (sigma * Math.sqrt(2 * Math.PI))) * 
               Math.exp(-0.5 * Math.pow((x - mu) / sigma, 2))
        }));
        
        const x = d3.scaleLinear()
            .domain([-4, 4])
            .range([0, width]);
        
        const y = d3.scaleLinear()
            .domain([0, 0.45])
            .range([height, 0]);
        
        // 绘制坐标轴
        g.append('g')
            .attr('transform', `translate(0,${height})`)
            .call(d3.axisBottom(x).ticks(8));
        
        g.append('g')
            .call(d3.axisLeft(y).ticks(8));
        
        // 绘制正态曲线
        const line = d3.line()
            .x(d => x(d.x))
            .y(d => y(d.y))
            .curve(d3.curveNatural);
        
        const path = g.append('path')
            .datum(data)
            .attr('class', 'normal-curve')
            .attr('d', line)
            .attr('fill', 'none')
            .attr('stroke', '#3498db')
            .attr('stroke-width', 3);
        
        // 动画绘制曲线
        const totalLength = path.node().getTotalLength();
        path
            .attr('stroke-dasharray', totalLength + ' ' + totalLength)
            .attr('stroke-dashoffset', totalLength)
            .transition()
            .duration(2000)
            .attr('stroke-dashoffset', 0);
        
        // 添加1σ、2σ、3σ区域
        const sigmaRanges = [
            {range: 1, color: '#3498db', opacity: 0.3, percent: '68.3%'},
            {range: 2, color: '#2ecc71', opacity: 0.2, percent: '95.4%'},
            {range: 3, color: '#e74c3c', opacity: 0.1, percent: '99.7%'}
        ];
        
        sigmaRanges.forEach((s, i) => {
            const areaData = data.filter(d => d.x >= -s.range && d.x <= s.range);
            
            const area = d3.area()
                .x(d => x(d.x))
                .y0(height)
                .y1(d => y(d.y))
                .curve(d3.curveNatural);
            
            g.append('path')
                .datum(areaData)
                .attr('class', 'area-under-curve')
                .attr('fill', s.color)
                .attr('opacity', 0)
                .attr('d', area)
                .transition()
                .delay(2000 + i * 500)
                .duration(500)
                .attr('opacity', s.opacity);
            
            // 添加标签
            g.append('text')
                .attr('x', x(0))
                .attr('y', height - 20 - i * 25)
                .attr('text-anchor', 'middle')
                .text(`±${s.range}σ: ${s.percent}`)
                .attr('font-size', 14)
                .attr('fill', s.color)
                .style('font-weight', 'bold')
                .style('opacity', 0)
                .transition()
                .delay(2000 + i * 500)
                .duration(500)
                .style('opacity', 1);
        });
        
        // 添加标签
        g.append('text')
            .attr('x', x(1))
            .attr('y', height + 35)
            .attr('text-anchor', 'middle')
            .text('μ+σ')
            .attr('font-size', 12);
        
        g.append('text')
            .attr('x', x(-1))
            .attr('y', height + 35)
            .attr('text-anchor', 'middle')
            .text('μ-σ')
            .attr('font-size', 12);
        
        g.append('text')
            .attr('x', x(0))
            .attr('y', height + 35)
            .attr('text-anchor', 'middle')
            .text('μ')
            .attr('font-size', 12)
            .style('font-weight', 'bold');
        
        // 标题
        svg.append('text')
            .attr('x', 350)
            .attr('y', 25)
            .attr('text-anchor', 'middle')
            .attr('font-size', 20)
            .attr('font-weight', 'bold')
            .text('标准正态分布 N(0, 1)');
    }

    // 第14页：数学期望
    function visualizeExpectation(containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;
        container.innerHTML = '';
        
        const wrapper = document.createElement('div');
        wrapper.style.cssText = 'display: flex; flex-direction: column; align-items: center; gap: 30px; padding: 20px;';
        
        // 骰子期望演示
        const diceSection = document.createElement('div');
        diceSection.className = 'card';
        diceSection.style.cssText = 'padding: 30px; width: 600px;';
        
        const title = document.createElement('h3');
        title.style.cssText = 'text-align: center; color: #2c3e50; margin-bottom: 20px;';
        title.textContent = '掷骰子的数学期望';
        
        // 创建表格
        const table = document.createElement('table');
        table.style.cssText = `
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        `;
        
        const header = table.insertRow();
        ['点数 X', '概率 P', 'X × P'].forEach(text => {
            const th = document.createElement('th');
            th.style.cssText = 'background: #3498db; color: white; padding: 15px; text-align: center;';
            th.textContent = text;
            header.appendChild(th);
        });
        
        const faces = ['⚀', '⚁', '⚂', '⚃', '⚄', '⚅'];
        let sum = 0;
        
        faces.forEach((face, i) => {
            const row = table.insertRow();
            row.style.cssText = 'background: white; transition: all 0.3s;';
            
            const cellFace = row.insertCell();
            cellFace.style.cssText = 'padding: 10px; text-align: center; font-size: 30px;';
            cellFace.innerHTML = `${face} (${i + 1})`;
            
            const cellProb = row.insertCell();
            cellProb.style.cssText = 'padding: 10px; text-align: center;';
            cellProb.textContent = '1/6';
            
            const cellProduct = row.insertCell();
            cellProduct.style.cssText = 'padding: 10px; text-align: center;';
            const product = (i + 1) / 6;
            cellProduct.textContent = product.toFixed(3);
            
            sum += product;
            
            row.addEventListener('mouseenter', () => {
                row.style.background = '#ecf0f1';
                row.style.transform = 'scale(1.02)';
            });
            
            row.addEventListener('mouseleave', () => {
                row.style.background = 'white';
                row.style.transform = 'scale(1)';
            });
        });
        
        // 添加合计行
        const sumRow = table.insertRow();
        sumRow.style.cssText = 'background: #f8f9fa; font-weight: bold;';
        
        const sumLabel = sumRow.insertCell();
        sumLabel.style.cssText = 'padding: 15px; text-align: center;';
        sumLabel.colSpan = 2;
        sumLabel.textContent = '期望值 E(X) =';
        
        const sumValue = sumRow.insertCell();
        sumValue.style.cssText = 'padding: 15px; text-align: center; color: #e74c3c; font-size: 20px;';
        sumValue.textContent = sum.toFixed(1);
        
        diceSection.appendChild(title);
        diceSection.appendChild(table);
        
        // 图形化展示
        const visual = document.createElement('div');
        visual.style.cssText = 'margin-top: 30px; text-align: center;';
        
        const balanceBar = document.createElement('div');
        balanceBar.style.cssText = `
            width: 500px;
            height: 20px;
            background: linear-gradient(90deg, #3498db 0%, #2ecc71 50%, #e74c3c 100%);
            border-radius: 10px;
            margin: 20px auto;
            position: relative;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        `;
        
        const marker = document.createElement('div');
        marker.style.cssText = `
            position: absolute;
            top: -10px;
            left: ${(sum / 6) * 100}%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 15px solid #e74c3c;
            filter: drop-shadow(0 2px 5px rgba(0,0,0,0.3));
        `;
        
        balanceBar.appendChild(marker);
        
        const scale = document.createElement('div');
        scale.style.cssText = 'display: flex; justify-content: space-between; margin-top: 5px;';
        
        for (let i = 1; i <= 6; i++) {
            const tick = document.createElement('div');
            tick.style.cssText = 'font-size: 12px; color: #7f8c8d;';
            tick.textContent = i;
            scale.appendChild(tick);
        }
        
        visual.appendChild(balanceBar);
        visual.appendChild(scale);
        
        diceSection.appendChild(visual);
        wrapper.appendChild(diceSection);
        container.appendChild(wrapper);
    }
</script>

</body>
</html>
