<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬8ç«  è§†é¢‘ 8.3 ç« èŠ‚å¤ç›˜ä¸çº¦æŸæå€¼é¢„å‘Š</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="./assets/noto-serif-sc.css">
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\(', '\)']],
                displayMath: [['$$', '$$'], ['\[', '\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            },
            startup: {
                ready: () => {
                    console.log('âœ… MathJaxå·²åŠ è½½å¹¶é…ç½®å®Œæˆ');
                    MathJax.startup.defaultReady();
                }
            }
        };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="stylesheet" href="./assets/lesson-template.css">
</head>
<body class="blackboard">
    <div id="statusIndicator" class="status-indicator">ç­‰å¾…è¿æ¥</div>
    <div class="avatar-container">
        <div class="wrapper" id="avatarWrapper"></div>
    </div>
    <div id="slide-container" class="slide-container flex-grow">
        <div class="slide active">
            <div class="slide-content">
                <div class="blackboard-text">
                    <h2>å¤ç›˜å¼€åœº</h2>
      <ul><li>æ ‡é¢˜ï¼šå¤šå…ƒå‡½æ•°ç« èŠ‚å¤ç›˜</li><li>ä»Šæ—¥ä»»åŠ¡ï¼šçŸ¥è¯†æ‹¼å›¾ + å…¸å‹æ¡ˆä¾‹ + ä¸‹ä¸€æ­¥é¢„å‘Š</li></ul>
                </div>
                <div class="animation-pane">
                    <h3>åŠ¨ç”»æ‰§è¡Œæç¤º</h3>
      <ol><li>ä¸‰å—æ‹¼å›¾åˆ†åˆ«æ ‡è®°â€œæ›²é¢ç†è§£â€â€œæ¢¯åº¦å·¥å…·â€â€œåº”ç”¨æ¡ˆä¾‹â€ï¼Œé€å—æ‹¼åˆã€‚</li></ol>
                </div>
            </div>
        </div>
        <div class="slide">
            <div class="slide-content">
                <div class="blackboard-text">
                    <h2>çŸ¥è¯†ç»“æ„é€Ÿè§ˆ</h2>
      <ul><li>ä¸‰å±‚ç»“æ„ï¼š</li></ul>
      <ol><li>å½¢çŠ¶å±‚ï¼šå®šä¹‰åŸŸã€ç­‰å€¼çº¿ã€æé™ä¸è¿ç»­</li><li>å˜åŒ–å±‚ï¼šåå¯¼æ•°ã€å…¨å¾®åˆ†ã€æ¢¯åº¦ã€æ–¹å‘å¯¼æ•°</li><li>åº”ç”¨å±‚ï¼šä¼°ç®—ã€è·¯å¾„ã€ä¼˜åŒ–é—®é¢˜</li></ol>
      <ul><li>æ¯ä¸ªæ¨¡å—é™„ä¸Šå…³é”®è¯ä¸å…¬å¼</li></ul>
                </div>
                <div class="animation-pane">
                    <h3>åŠ¨ç”»æ‰§è¡Œæç¤º</h3>
      <ol><li>æ€ç»´å¯¼å›¾ä»ä¸­å¿ƒèŠ‚ç‚¹å‘å¤–å±•å¼€ï¼ŒèŠ‚ç‚¹ä¾æ¬¡äº®èµ·ã€‚</li><li>å…³é”®å…¬å¼éšèŠ‚ç‚¹å‡ºç°ï¼Œé¢œè‰²åŒºåˆ†å±‚çº§ã€‚</li></ol>
                </div>
            </div>
        </div>
        <div class="slide">
            <div class="slide-content">
                <div class="blackboard-text">
                    <h2>ä¾‹é¢˜ï¼šæœ€é™¡ä¸Šå‡æ–¹å‘</h2>
      <ul><li>å‡½æ•°ï¼šf(x, y) = xÂ² âˆ’ xy + yÂ²ï¼Œåœ¨ (1, 1) å¤„</li><li>æ¢¯åº¦ï¼šâˆ‡f = âŸ¨2x âˆ’ y, âˆ’x + 2yâŸ© â†’ âŸ¨1, 1âŸ©</li><li>æ–¹å‘å¯¼æ•°ï¼šæ²¿æ–¹å‘ (1, 2) å¾—åˆ° 3/âˆš5</li></ul>
                </div>
                <div class="animation-pane">
                    <h3>åŠ¨ç”»æ‰§è¡Œæç¤º</h3>
      <ol><li>æ›²é¢ä¸Šæ ‡å‡ºç‚¹ (1,1)ï¼Œæ¢¯åº¦ç®­å¤´è‡ªè¯¥ç‚¹ä¼¸å‡ºã€‚</li><li>æ–¹å‘ (1,2) ä»¥ä¸åŒé¢œè‰²æ ‡ç¤ºï¼Œç‚¹ä¹˜è¿‡ç¨‹é€æ­¥æ˜¾ç¤ºã€‚</li></ol>
                </div>
            </div>
        </div>
        <div class="slide">
            <div class="slide-content">
                <div class="blackboard-text">
                    <h2>åº”ç”¨åœºæ™¯ï¼šæ¸©åº¦åœºä¸çº¦æŸ</h2>
      <ul><li>æ¸©åº¦åœº T(x, y) ä¸ç­‰æ¸©çº¿å›¾</li><li>çº¦æŸï¼šxÂ² + yÂ² = 4 çš„åœ†å‘¨</li><li>è§‚å¯Ÿï¼šæå€¼ç‚¹å¾€å¾€å‡ºç°åœ¨æ¢¯åº¦ä¸çº¦æŸåˆ‡çº¿å‚ç›´å¤„</li></ul>
                </div>
                <div class="animation-pane">
                    <h3>åŠ¨ç”»æ‰§è¡Œæç¤º</h3>
      <ol><li>æ˜¾ç¤ºæ¸©åº¦ç­‰é«˜çº¿ä¸åœ†å½¢è¾¹ç•Œã€‚</li><li>æ¢¯åº¦ç®­å¤´ä¸åœ†å‘¨åˆ‡çº¿åŠ¨ç”»å±•ç¤ºå‚ç›´å…³ç³»ã€‚</li></ol>
                </div>
            </div>
        </div>
        <div class="slide">
            <div class="slide-content">
                <div class="blackboard-text">
                    <h2>æœ¬ç« æ€»ç»“ä¸é¢„å‘Š</h2>
      <ul><li>æ ¸å¿ƒè®°å¿†ï¼šæ›²é¢ç†è§£ã€æ¢¯åº¦å·¥å…·ã€æ–¹å‘å¯¼æ•°</li><li>é¢„å‘Šï¼šçº¦æŸæå€¼ä¸æ‹‰æ ¼æœ—æ—¥ä¹˜æ•°æ³•</li></ul>
                </div>
                <div class="animation-pane">
                    <h3>åŠ¨ç”»æ‰§è¡Œæç¤º</h3>
      <ol><li>ä¸‰ä¸ªæ ¸å¿ƒè¦ç‚¹ä»¥ç¿»ç‰Œå½¢å¼é”å®šã€‚</li><li>é¢„å‘Šå¡ç‰‡æ»‘å…¥ï¼Œæ˜¾ç¤ºä¸‹ä¸€èŠ‚â€œæ‹‰æ ¼æœ—æ—¥ä¹˜æ•°ä¸æå€¼åˆ¤å®šâ€ã€‚</li></ol>
                </div>
            </div>
        </div>
    </div>
    <div class="subtitle-area" id="subtitleArea">æ¬¢è¿å­¦ä¹ ç« èŠ‚å¤ç›˜ä¸çº¦æŸæå€¼é¢„å‘Šï¼ç‚¹å‡»å¼€å§‹è®²è¯¾å¯åŠ¨è™šæ‹Ÿäººè®²å¸ˆã€‚</div>
    <div class="control-bar">
        <div class="control-title">ç¬¬ <span id="currentSlide">1</span> é¡µ / å…± <span id="totalSlides">5</span> é¡µ</div>
        <button class="btn" onclick="previousSlide()">â¬…ï¸ ä¸Šä¸€é¡µ</button>
        <button class="btn primary" onclick="startTeaching()" id="startBtn">ğŸ€ å¼€å§‹è®²è¯¾</button>
        <button class="btn" onclick="nextSlide()">ä¸‹ä¸€é¡µ â¡ï¸</button>
        <button class="btn" onclick="restart()">ğŸ”„ é‡æ–°å¼€å§‹</button>
        <button class="btn autoplay" onclick="startAutoPlay()" id="autoPlayBtn">ğŸ¬ è‡ªåŠ¨æ’­æ”¾</button>
        <div class="control-hint">ğŸ’¡ å½•åˆ¶æç¤ºï¼šç‚¹å‡»è‡ªåŠ¨æ’­æ”¾åç«‹å³å¼€å§‹å½•å±ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å®Œæˆå…¨éƒ¨æ¼”ç¤ºã€‚</div>
        <div class="control-shortcuts">ğŸ’¡ å¿«æ·é”®ï¼šç©ºæ ¼/â†’ ä¸‹ä¸€é¡µï¼Œâ† ä¸Šä¸€é¡µï¼ŒEnter æ’­æ”¾å½“å‰é¡µ</div>
    </div>
    <script type="module">
        try {
            const { default: AvatarPlatform, SDKEvents, PlayerEvents, RecorderEvents, UserMedia } = await import('./avatar-sdk-web_3.1.2.1002/index.js');
            window.AvatarPlatform = AvatarPlatform;
            window.SDKEvents = SDKEvents;
            window.PlayerEvents = PlayerEvents;
            window.RecorderEvents = RecorderEvents;
            window.UserMedia = UserMedia;
            console.log('âœ… è®¯é£å®˜æ–¹SDKæ¨¡å—å·²åŠ è½½');
            console.log('SDKç‰ˆæœ¬:', AvatarPlatform.getVersion());
        } catch (error) {
            console.error('âŒ SDKæ¨¡å—åŠ è½½å¤±è´¥:', error);
        }
        window.dispatchEvent(new CustomEvent('sdkReady'));
    </script>
    <script>
        const lessonTitle = "ç« èŠ‚å¤ç›˜ä¸çº¦æŸæå€¼é¢„å‘Š";
        const subtitleScript = {
    "1": "è¿™ä¸€èŠ‚æˆ‘ä»¬è¦æŠŠå¤šå…ƒå‡½æ•°çš„æ­¦å™¨åº“æ”¶æŸèµ·æ¥ï¼šå…ˆå¤ç›˜æ ¸å¿ƒæ¦‚å¿µï¼Œå†åšä¸€é¢˜å…¸å‹ä¾‹é¢˜ï¼Œæœ€åé¢„å‘Šçº¦æŸæå€¼ã€‚",
    "2": "æŠŠçŸ¥è¯†ç»“æ„åŒ–è®°å¿†ï¼šå…ˆè®¤è¯†æ›²é¢ï¼Œå†æŒæ¡åå¯¼ä¸æ¢¯åº¦ç­‰å·¥å…·ï¼Œæœ€åæ‰èƒ½ç”¨å®ƒä»¬è§£å†³ä¼°ç®—ä¸ä¼˜åŒ–é—®é¢˜ã€‚",
    "3": "æ¢¯åº¦ä¸ä»…å‘Šè¯‰æˆ‘ä»¬å¾€å“ªé‡Œèµ°æœ€å¿«ä¸Šå‡ï¼Œè¿˜èƒ½å¸®æˆ‘ä»¬è®¡ç®—ä»»æ„æ–¹å‘çš„å˜åŒ–ç‡ã€‚ä¾‹é¢˜ä¸­æˆ‘ä»¬æŠŠæ–¹å‘ (1,2) å•ä½åŒ–ï¼Œå†ä¸æ¢¯åº¦åšç‚¹ä¹˜ï¼Œå¾—åˆ° 3/âˆš5ã€‚",
    "4": "å½“å­˜åœ¨çº¦æŸæ¡ä»¶æ—¶ï¼Œæœ€ä¼˜ç‚¹é€šå¸¸åœ¨æ¢¯åº¦å’Œçº¦æŸè¾¹ç•Œçš„åˆ‡çº¿å‚ç›´å¤„ã€‚è¿™å°±æ˜¯æ‹‰æ ¼æœ—æ—¥ä¹˜æ•°æ³•çš„ç›´è§‰åŸºç¡€ï¼Œæˆ‘ä»¬ä¸‹ä¸€ç« ä¼šæ­£å¼ä½¿ç”¨å®ƒã€‚",
    "5": "å¤šå…ƒå‡½æ•°çš„åŸºç¡€å·¥å…·å·²ç»å‡†å¤‡å°±ç»ªã€‚ä¸‹ä¸€èŠ‚æˆ‘ä»¬å°†å®ƒä»¬ç”¨äºçº¦æŸæå€¼ï¼Œæ­£å¼è¿›å…¥å¤šå…ƒä¼˜åŒ–ã€‚\" --- ### ç¬¬ä¹ç« ï¼šé‡ç§¯åˆ†ï¼ˆè™šæ‹ŸäººPPTæ‰§è¡ŒçŸ©é˜µï¼‰ #### æœ¬ç« PPTæ‰§è¡Œæ€»æ§è¡¨ | è§†é¢‘ | é¡µé¢æ•°é‡ | ä¸»è§†è§‰å…³é”®è¯ | åŠ¨ç”»äº®ç‚¹ | å®æ“/äº’åŠ¨æç¤º | | --- | --- | --- | --- | --- | | 9.1 äºŒé‡ç§¯åˆ†æ¦‚å¿µä¸å‡ ä½•æ„ä¹‰ | 6 | é¢ç‰‡ç´¯åŠ ã€ä½“ç§¯å †å ã€é»æ›¼å’Œ | çŸ©å½¢ç½‘æ ¼å¡«å……ã€ä½“ç§¯æŸ±æ¸è¿›ã€æé™è¿‡æ¸¡ | æ»‘å—æ§åˆ¶ç½‘æ ¼ç»†åˆ†ï¼Œè§‚å¯Ÿé€¼è¿‘è¿‡ç¨‹ | | 9.2 äºŒé‡ç§¯åˆ†è®¡ç®—ï¼ˆç›´è§’åæ ‡ï¼‰ | 6 | ç§¯åˆ†æ¡ã€ç§¯åˆ†æ¬¡åºã€åŒºåŸŸè¯†åˆ« | ç«–å‘/æ¨ªå‘æ‰«æã€ä¸Šä¸‹é™å¯¹æ¯”ã€æ¢æ¬¡åºæ¼”ç¤º | ç‚¹å‡»åŒºåŸŸä¸åŒéƒ¨åˆ†æŸ¥çœ‹å¯¹åº”ä¸Šä¸‹é™ | | 9.3 é‡ç§¯åˆ†åº”ç”¨ä¸æ€»ç»“ | 5 | è´¨é‡åˆ†å¸ƒã€è´¨å¿ƒã€å¹³å‡é«˜åº¦ | çƒ­åŠ›å›¾ã€ä½“ç§¯å¡«å……ã€æµç¨‹å›¾ | åµŒå…¥ç»ƒä¹ æŒ‰é’®ç»™å‡ºæ¡ˆä¾‹ä¸ç­”æ¡ˆæç¤º |"
};
        const actionMap = {
    "1": "A_RLH_welcome_O",
    "2": "A_LH_introduced_O",
    "3": "A_RH_please_O",
    "4": "A_U_No_pointing_O",
    "5": "A_RLH_welcome_O"
};
        const slideTitles = {
    "1": "å¤ç›˜å¼€åœº",
    "2": "çŸ¥è¯†ç»“æ„é€Ÿè§ˆ",
    "3": "ä¾‹é¢˜ï¼šæœ€é™¡ä¸Šå‡æ–¹å‘",
    "4": "åº”ç”¨åœºæ™¯ï¼šæ¸©åº¦åœºä¸çº¦æŸ",
    "5": "æœ¬ç« æ€»ç»“ä¸é¢„å‘Š"
};
        const slideDurations = {
    "1": 30000,
    "2": 70000,
    "3": 80000,
    "4": 60000,
    "5": 60000
};
        const totalSlides = 5;

        let avatarPlatform = null;
        let isConnected = false;
        let isTeaching = false;
        let currentSlide = 0;
        let isAutoPlaying = false;

        const slides = document.querySelectorAll('.slide');

        function showSlide(index) {
            slides.forEach((slide, i) => slide.classList.toggle('active', i === index));
            currentSlide = index;
            document.getElementById('currentSlide').textContent = index + 1;
            if (window.MathJax && window.MathJax.typesetPromise) {
                window.MathJax.typesetPromise([slides[index]]).catch(err => console.error(err));
            }
        }

        function nextSlide() {
            if (currentSlide < totalSlides - 1) {
                showSlide(currentSlide + 1);
                if (!isAutoPlaying) speakContent(currentSlide + 1);
            }
        }

        function previousSlide() {
            if (currentSlide > 0) {
                showSlide(currentSlide - 1);
                if (!isAutoPlaying) speakContent(currentSlide + 1);
            }
        }

        function restart() {
            showSlide(0);
            if (!isAutoPlaying) speakContent(1);
        }

        function updateSubtitle(text) {
            const area = document.getElementById('subtitleArea');
            if (area) {
                area.textContent = text;
            }
        }

        function updateStatus(message, type = 'normal') {
            const indicator = document.getElementById('statusIndicator');
            if (!indicator) return;
            indicator.textContent = message;
            indicator.className = 'status-indicator';
            if (type === 'connected') indicator.classList.add('connected');
            if (type === 'error') indicator.classList.add('error');
            if (type === 'connecting') indicator.classList.add('connecting');
            if (type === 'recording') indicator.classList.add('recording');
        }

        function waitForSDK() {
            return new Promise((resolve, reject) => {
                if (typeof AvatarPlatform !== 'undefined') {
                    resolve();
                    return;
                }
                const timeout = setTimeout(() => {
                    reject(new Error('SDKåŠ è½½è¶…æ—¶ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•'));
                }, 10000);
                window.addEventListener('sdkReady', function handler() {
                    clearTimeout(timeout);
                    window.removeEventListener('sdkReady', handler);
                    resolve();
                });
            });
        }

        async function startTeaching() {
            const startBtn = document.getElementById('startBtn');
            startBtn.textContent = 'ğŸ”„ å¯åŠ¨ä¸­...';
            startBtn.disabled = true;
            try {
                updateStatus('ç­‰å¾…SDKåŠ è½½...', 'connecting');
                await waitForSDK();
                if (avatarPlatform) {
                    avatarPlatform.destroy();
                }
                avatarPlatform = new AvatarPlatform({ useInlinePlayer: true });
                avatarPlatform
                    .on('connected', () => {
                        isConnected = true;
                        isTeaching = true;
                        updateStatus('å·²è¿æ¥', 'connected');
                        startBtn.textContent = 'ğŸ’– è™šæ‹Ÿäººå·²å°±ç»ª';
                        setTimeout(() => speakContent(currentSlide + 1), 500);
                    })
                    .on('disconnected', () => {
                        isConnected = false;
                        isTeaching = false;
                        updateStatus('è¿æ¥æ–­å¼€', 'error');
                        startBtn.textContent = 'é‡æ–°è¿æ¥';
                        startBtn.disabled = false;
                    })
                    .on('error', (error) => {
                        console.error('âŒ è™šæ‹Ÿäººé”™è¯¯:', error);
                        updateStatus('é”™è¯¯: ' + error.message, 'error');
                        startBtn.textContent = 'è¿æ¥å¤±è´¥';
                        startBtn.disabled = false;
                    });

                avatarPlatform.setApiInfo({
                    appId: 'b4889d02',
                    apiKey: 'de174061f9ffd1f4e7f1827aa98881be',
                    apiSecret: 'NWMyZThkMWVkMDZmYThlOTA5ZGE2NjM2',
                    sceneId: '213607046975721472',
                    serverUrl: 'wss://avatar.cn-huadong-1.xf-yun.com/v1/interact'
                });

                avatarPlatform.setGlobalParams({
                    stream: { protocol: 'xrtc', alpha: 1, bitrate: 1000000, fps: 25 },
                    avatar: { avatar_id: '110332017', width: 1920, height: 1080, scale: 1, move_h: 0, move_v: 0, audio_format: 1 },
                    tts: { vcn: 'x4_yiting', speed: 50, pitch: 50, volume: 100 },
                    avatar_dispatch: { interactive_mode: 1, content_analysis: 0 }
                });

                await avatarPlatform.start({ wrapper: document.getElementById('avatarWrapper') });
            } catch (error) {
                console.error('âŒ å¯åŠ¨å¤±è´¥:', error);
                updateStatus('å¯åŠ¨å¤±è´¥', 'error');
                startBtn.textContent = 'ğŸ”„ é‡è¯•';
                startBtn.disabled = false;
                alert('å¯åŠ¨å¤±è´¥: ' + error.message);
            }
        }

        async function speakContent(slideNum) {
            const text = subtitleScript[slideNum] || '';
            updateSubtitle(text ? `ã€ç¬¬${slideNum}é¡µ/${totalSlides}é¡µã€‘` + text : `ç¬¬${slideNum}é¡µ`);
            if (!isTeaching || !isConnected || !avatarPlatform || !text) return;
            try {
                const action = actionMap[slideNum];
                if (action) {
                    await avatarPlatform.writeCmd('action', action);
                }
                await avatarPlatform.writeText(text, { nlp: false });
            } catch (error) {
                console.error('âŒ è¯­éŸ³æ’­æŠ¥å¤±è´¥:', error);
            }
        }

        async function startAutoPlay() {
            const autoBtn = document.getElementById('autoPlayBtn');
            if (isAutoPlaying) {
                isAutoPlaying = false;
                autoBtn.textContent = 'ğŸ¬ è‡ªåŠ¨æ’­æ”¾';
                autoBtn.classList.remove('stop');
                updateStatus('è‡ªåŠ¨æ’­æ”¾å·²åœæ­¢');
                return;
            }
            isAutoPlaying = true;
            autoBtn.textContent = 'â¹ï¸ åœæ­¢æ’­æ”¾';
            autoBtn.classList.add('stop');
            updateStatus('ğŸ¬ è‡ªåŠ¨æ’­æ”¾å¼€å§‹ï¼', 'recording');

            for (let slide = 1; slide <= totalSlides; slide++) {
                if (!isAutoPlaying) break;
                showSlide(slide - 1);
                speakContent(slide);
                const duration = slideDurations[slide] || 15000;
                await new Promise(resolve => setTimeout(resolve, duration));
            }

            isAutoPlaying = false;
            autoBtn.textContent = 'ğŸ¬ è‡ªåŠ¨æ’­æ”¾';
            autoBtn.classList.remove('stop');
            updateStatus('è¯¾ç¨‹æ’­æ”¾ç»“æŸ');
        }

        document.addEventListener('keydown', (event) => {
            if (event.key === 'ArrowRight' || event.key === ' ') {
                event.preventDefault();
                nextSlide();
            } else if (event.key === 'ArrowLeft') {
                event.preventDefault();
                previousSlide();
            } else if (event.key === 'Enter') {
                event.preventDefault();
                speakContent(currentSlide + 1);
            }
        });

        window.addEventListener('beforeunload', () => {
            if (avatarPlatform && isConnected) {
                avatarPlatform.stop();
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('totalSlides').textContent = totalSlides;
            showSlide(0);
        });
    </script>
</body>
</html>
